<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-golang/examples/widget-store" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Fault-Tolerant Checkout | DBOS Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.dbos.dev/golang/examples/widget-store"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Fault-Tolerant Checkout | DBOS Docs"><meta data-rh="true" name="description" content="This example is also available in TypeScript and Python."><meta data-rh="true" property="og:description" content="This example is also available in TypeScript and Python."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.dbos.dev/golang/examples/widget-store"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/golang/examples/widget-store" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/golang/examples/widget-store" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UY2VKOMIL2-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Fault-Tolerant Checkout","item":"https://docs.dbos.dev/golang/examples/widget-store"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="DBOS Docs" href="/opensearch.xml">


<link rel="preconnect" href="https://dbosdev.matomo.cloud/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://dbosdev.matomo.cloud/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>

<link rel="preconnect" href="https://d2j9bas80r5yfz.cloudfront.net">
<script>!function(t,e){var o,r,s,a;e.__SV||(window.posthog=e,e._i=[],e.init=function(n,i,p){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(s=t.createElement("script")).type="text/javascript",s.async=!0,s.src=i.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(a=t.getElementsByTagName("script")[0]).parentNode.insertBefore(s,a);var g=e;for(void 0!==p?g=e[p]=[]:p="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==p&&(e+="."+p),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),r=0;r<o.length;r++)c(g,o[r]);e._i.push([n,i,p])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_vKGgPmFevFB3QVyqZdIZeNqcWAPqk3i3mDhwGqwk6nP",{api_host:"https://d2j9bas80r5yfz.cloudfront.net",id:"default"})</script>
<script async defer="defer" id="hs-script-loader" src="//js.hs-scripts.com/45237820.js"></script><link rel="stylesheet" href="/assets/css/styles.8102221d.css">
<script src="/assets/js/runtime~main.3f70ce62.js" defer="defer"></script>
<script src="/assets/js/main.b5982dd4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://dbos.dev" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/">Docs</a><a class="navbar__item navbar__link" href="/quickstart">Quickstart</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/examples">Examples</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://console.dbos.dev/login-redirect" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link dbos-button-blue">DBOS Console</a><a href="https://github.com/dbos-inc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/examples">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/python/examples/hacker-news-agent">Python Examples</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/hacker-news-agent">Hacker News Research Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/document-detective">Document Ingestion Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/widget-store">Fault-Tolerant Checkout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/stock-tracker">Stock Tracker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/customer-service">Reliable Customer Service Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/s3mirror">S3 Mirror</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/scheduled-reminders">Scheduled Reminders</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/rag-slackbot">AI-Powered Slackbot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/earthquake-tracker">Earthquake Tracker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/hacker-news-bot">Hacker News Slackbot</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/typescript/examples/checkout-tutorial">TypeScript Examples</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/examples/checkout-tutorial">Fault-Tolerant Checkout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/examples/hacker-news-agent">Hacker News Research Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/examples/kafka-alert-queue">Kafka Alert Queue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/examples/task-scheduler">DBOS Task Scheduler</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/golang/examples/widget-store">Go Examples</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/golang/examples/widget-store">Fault-Tolerant Checkout</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Go Examples</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Fault-Tolerant Checkout</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Fault-Tolerant Checkout</h1></header><div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>This example is also available in <a href="/typescript/examples/checkout-tutorial">TypeScript</a> and <a href="/python/examples/widget-store">Python</a>.</p></div></div>
<p>In this example, we use DBOS and Gin to build an online storefront that&#x27;s resilient to any failure.</p>
<p>You can see the application live <a href="https://demo-widget-store.cloud.dbos.dev/" target="_blank" rel="noopener noreferrer">here</a>.
Try playing with it and pressing the crash button as often as you want.
Within a few seconds, the app will recover and resume as if nothing happened.</p>
<p>All source code is <a href="https://github.com/dbos-inc/dbos-demo-apps/tree/main/golang/widget-store" target="_blank" rel="noopener noreferrer">available on GitHub</a>.</p>
<p><img decoding="async" loading="lazy" alt="Widget store UI" src="/assets/images/widget_store_ui-a4c2b42a8c4b98b711e3a2aa714511c9.png" width="1243" height="915" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-the-checkout-workflow">Building the Checkout Workflow<a href="#building-the-checkout-workflow" class="hash-link" aria-label="Direct link to Building the Checkout Workflow" title="Direct link to Building the Checkout Workflow">​</a></h2>
<p>The heart of this application is the checkout workflow, which orchestrates the entire purchase process.
This workflow is triggered whenever a customer buys a widget and handles the complete order lifecycle:</p>
<ol>
<li>Creates a new order in the system</li>
<li>Reserves inventory to ensure the item is available</li>
<li>Processes payment</li>
<li>Marks the order as paid and initiates fulfillment</li>
<li>Handles failures gracefully by releasing reserved inventory and canceling orders when necessary</li>
</ol>
<p>DBOS <strong>durably executes</strong> this workflow.
It checkpoints each step in the database so that if the app fails or is interrupted during checkout, it will automatically recover from the last completed step.
This means that customers never lose their order progress, no matter what breaks.</p>
<p>You can try this yourself!
On the <a href="https://demo-widget-store.cloud.dbos.dev/" target="_blank" rel="noopener noreferrer">live application</a>, start an order and press the crash button at any time.
Within seconds, your app will recover to exactly the state it was in before the crash and continue as if nothing happened.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">checkoutWorkflow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">DBOSContext</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">_</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    workflowID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">GetWorkflowID</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;workflow ID retrieval failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// Create a new order</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    orderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RunAsStep</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">createOrder</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;order creation failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;wf_id&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> workflowID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// Attempt to reserve inventory, cancelling the order if no inventory remains</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    success</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RunAsStep</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">bool</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">reserveInventory</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">||</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">!</span><span class="token plain">success </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Warn</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;no inventory&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;order&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RunAsStep</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">updateOrderStatus</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> UpdateOrderStatusInput</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">OrderID</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> OrderStatus</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> CANCELLED</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        err </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">SetEvent</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> PAYMENT_ID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    err </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">SetEvent</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> PAYMENT_ID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> workflowID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;payment event creation failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;order&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;payment&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> workflowID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    payment_status</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Recv</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> PAYMENT_STATUS</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">60</span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">||</span><span class="token plain"> payment_status </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;paid&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Warn</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;payment failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;order&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;payment&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> workflowID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;status&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> payment_status</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RunAsStep</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">undoReserveInventory</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RunAsStep</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">updateOrderStatus</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> UpdateOrderStatusInput</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">OrderID</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> OrderStatus</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> CANCELLED</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Info</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;payment success&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;order&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;payment&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> workflowID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RunAsStep</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">updateOrderStatus</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> UpdateOrderStatusInput</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">OrderID</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> OrderStatus</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> PAID</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Println</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;calling dispatchOrderWorkflow&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RunWorkflow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dispatchOrderWorkflow</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    err </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">SetEvent</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> ORDER_ID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> strconv</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Itoa</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">orderID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;order event creation failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;order&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-checkout-and-payment-endpoints">The Checkout and Payment Endpoints<a href="#the-checkout-and-payment-endpoints" class="hash-link" aria-label="Direct link to The Checkout and Payment Endpoints" title="Direct link to The Checkout and Payment Endpoints">​</a></h2>
<p>Now let&#x27;s implement the HTTP endpoints that handle customer interactions with the checkout system.</p>
<p>The checkout endpoint is triggered when a customer clicks the &quot;Buy Now&quot; button.
It starts the checkout workflow in the background, then waits for the workflow to generate and send it a unique payment ID.
It then returns the payment ID so the browser can redirect the user to the payments page.</p>
<p>The endpoint accepts an <a href="/golang/tutorials/workflow-tutorial#workflow-ids-and-idempotency">idempotency key</a> so that even if the customer presses &quot;buy now&quot; multiple times, only one checkout workflow is started.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">checkoutEndpoint</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dbosCtx dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">DBOSContext</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">slog</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    idempotencyKey </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Param</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;idempotency_key&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// Start the checkout workflow with the idempotency key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token boolean" style="color:#ae81ff">_</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RunWorkflow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">dbosCtx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> checkoutWorkflow</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">WithWorkflowID</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">idempotencyKey</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;checkout workflow start failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;key&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> idempotencyKey</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Checkout failed to start&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    payment_id</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">GetEvent</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">dbosCtx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> idempotencyKey</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> PAYMENT_ID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">60</span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">||</span><span class="token plain"> payment_id </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;payment ID retrieval failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;key&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> idempotencyKey</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Checkout failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">String</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusOK</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> payment_id</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<p>The payment endpoint handles the communication between the payment system and the checkout workflow.
It uses the payment ID to signal the checkout workflow whether the payment succeeded or failed.
It then retrieves the order ID from the checkout workflow so the browser can redirect the customer to the order status page.</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">paymentEndpoint</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dbosCtx dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">DBOSContext</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">slog</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    paymentID </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Param</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;payment_id&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    paymentStatus </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Param</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;payment_status&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Send</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">dbosCtx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> paymentID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> paymentStatus</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> PAYMENT_STATUS</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;payment notification failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;payment&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> paymentID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;status&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> paymentStatus</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Failed to process payment&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    orderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">GetEvent</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">dbosCtx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> paymentID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> ORDER_ID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">60</span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">||</span><span class="token plain"> orderID </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;order ID retrieval failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;payment&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> paymentID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Payment failed to process&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">String</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusOK</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="database-operations">Database Operations<a href="#database-operations" class="hash-link" aria-label="Direct link to Database Operations" title="Direct link to Database Operations">​</a></h2>
<p>Now, let&#x27;s implement the checkout workflow&#x27;s steps.
Each step performs a database operation, like updating inventory or order status.
These are implemented as regular Go functions that interact with the Postgres database.</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Database Operations</strong></summary><div><div class="collapsibleContent_i85q"><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">// Database operations for inventory management</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">reserveInventory</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">bool</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    result</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Exec</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:#a6e22e">&quot;UPDATE products SET inventory = inventory - 1 WHERE product_id = $1 AND inventory &gt; 0&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        WIDGET_ID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">false</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> result</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RowsAffected</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">undoReserveInventory</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token boolean" style="color:#ae81ff">_</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Exec</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:#a6e22e">&quot;UPDATE products SET inventory = inventory + 1 WHERE product_id = $1&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        WIDGET_ID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">// Database operations for order management</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">createOrder</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">var</span><span class="token plain"> orderID </span><span class="token builtin" style="color:#e6db74">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">QueryRow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:#a6e22e">&quot;INSERT INTO orders (order_status) VALUES ($1) RETURNING order_id&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#e6db74">int</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">PENDING</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Scan</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">orderID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">updateOrderStatus</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> input UpdateOrderStatusInput</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token boolean" style="color:#ae81ff">_</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Exec</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:#a6e22e">&quot;UPDATE orders SET order_status = $1 WHERE order_id = $2&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#e6db74">int</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">input</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">OrderStatus</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> input</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">OrderID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">updateOrderProgress</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> orderID </span><span class="token builtin" style="color:#e6db74">int</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">var</span><span class="token plain"> progressRemaining </span><span class="token builtin" style="color:#e6db74">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">QueryRow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:#a6e22e">&quot;UPDATE orders SET progress_remaining = progress_remaining - 1 WHERE order_id = $1 RETURNING progress_remaining&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        orderID</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Scan</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">progressRemaining</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> progressRemaining </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token boolean" style="color:#ae81ff">_</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">updateOrderStatus</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> UpdateOrderStatusInput</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">OrderID</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> orderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> OrderStatus</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> DISPATCHED</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> progressRemaining</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">// HTTP endpoints for accessing data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">getProduct</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> db </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">pgxpool</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Pool</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">slog</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">var</span><span class="token plain"> product Product</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">QueryRow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Background</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:#a6e22e">&quot;SELECT product_id, product, description, inventory, price FROM products LIMIT 1&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#e6db74">Scan</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ProductID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Product</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Description</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Inventory</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Price</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;product query failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Failed to fetch product&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusOK</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> product</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">getOrders</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> db </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">pgxpool</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Pool</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">slog</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    rows</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Query</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Background</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:#a6e22e">&quot;SELECT order_id, order_status, last_update_time, progress_remaining FROM orders&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;orders database query failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Failed to fetch orders&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">defer</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Close</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    orders </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">Order</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Next</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">var</span><span class="token plain"> order Order</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> rows</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Scan</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">order</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">OrderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">order</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">OrderStatus</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">order</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">LastUpdateTime</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">order</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ProgressRemaining</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;order data parsing failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Failed to process orders&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        orders </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">append</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">orders</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> order</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusOK</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> orders</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">getOrder</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> db </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">pgxpool</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Pool</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">slog</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    idStr </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Param</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;id&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    id</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> strconv</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Atoi</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">idStr</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Warn</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;invalid order ID&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;id&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> idStr</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusBadRequest</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Invalid order ID&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">var</span><span class="token plain"> order Order</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    err </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">QueryRow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Background</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:#a6e22e">&quot;SELECT order_id, order_status, last_update_time, progress_remaining FROM orders WHERE order_id = $1&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#e6db74">Scan</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">order</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">OrderID</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">order</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">OrderStatus</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">order</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">LastUpdateTime</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">order</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ProgressRemaining</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> pgx</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ErrNoRows </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Warn</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;order not found&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;order&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusNotFound</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Order not found&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;order database query failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;order&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Failed to fetch order&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusOK</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> order</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">restock</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> db </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">pgxpool</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Pool</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">slog</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token boolean" style="color:#ae81ff">_</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Exec</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Background</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;UPDATE products SET inventory = 100&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;inventory update failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Failed to restock inventory&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusOK</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;message&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Restocked successfully&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">// Crash the app--for demonstration purposes only :)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">crashApplication</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">slog</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Warn</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;application crash requested&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">http</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">StatusOK</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">H</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token string" style="color:#a6e22e">&quot;message&quot;</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Crashing application...&quot;</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// Give time for response to be sent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">go</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Sleep</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">100</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Millisecond</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;intentional crash for demo&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        os</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Exit</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div></div></div></details>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="launching-and-serving-the-app">Launching and Serving the App<a href="#launching-and-serving-the-app" class="hash-link" aria-label="Direct link to Launching and Serving the App" title="Direct link to Launching and Serving the App">​</a></h2>
<p>Finally, here&#x27;s the complete main function that initializes DBOS, sets up the database connection, registers workflows, and starts the Gin HTTP server:</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    logger </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> slog</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">New</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">slog</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">NewJSONHandler</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">os</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Stdout</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain">slog</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">HandlerOptions</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        Level</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> slog</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">LevelDebug</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    dbURL </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Getenv</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;DBOS_SYSTEM_DATABASE_URL&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> dbURL </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;DBOS_SYSTEM_DATABASE_URL required&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        os</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Exit</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    dbosContext</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">NewDBOSContext</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Background</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        AppName</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">         </span><span class="token string" style="color:#a6e22e">&quot;widget-store&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        DatabaseURL</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">     os</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Getenv</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;DBOS_SYSTEM_DATABASE_URL&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        AdminServer</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">     </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        Logger</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">          logger</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        ConductorAPIKey</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> os</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Getenv</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;DBOS_CONDUCTOR_API_KEY&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;DBOS initialization failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        os</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Exit</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RegisterWorkflow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">dbosContext</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> checkoutWorkflow</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RegisterWorkflow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">dbosContext</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dispatchOrderWorkflow</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    err </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Launch</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">dbosContext</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;DBOS service start failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        os</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Exit</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">defer</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Shutdown</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">dbosContext</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Second</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    db</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> pgxpool</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">New</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Background</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dbURL</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;database connection failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        os</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Exit</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">defer</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Close</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    r </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Default</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// Serve HTML</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">StaticFile</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;/&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;./html/app.html&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// HTTP endpoints</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">GET</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;/product&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">getProduct</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">GET</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;/orders&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">getOrders</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">GET</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;/order/:id&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">getOrder</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">POST</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;/restock&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">restock</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> db</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">POST</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;/checkout/:idempotency_key&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">checkoutEndpoint</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dbosContext</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">POST</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;/payment_webhook/:payment_id/:payment_status&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">paymentEndpoint</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dbosContext</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">POST</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;/crash_application&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">crashApplication</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> r</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Run</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;:8080&quot;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Error</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;HTTP server start failed&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;error&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        os</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Exit</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="try-it-yourself">Try it Yourself!<a href="#try-it-yourself" class="hash-link" aria-label="Direct link to Try it Yourself!" title="Direct link to Try it Yourself!">​</a></h2>
<p>First, clone and enter the <a href="https://github.com/dbos-inc/dbos-demo-apps" target="_blank" rel="noopener noreferrer">dbos-demo-apps</a> repository:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">git</span><span class="token plain"> clone https://github.com/dbos-inc/dbos-demo-apps.git</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#e6db74">cd</span><span class="token plain"> golang/widget-store</span><br></span></code></pre></div></div>
<p>Then follow the instructions in the README to build and run the app!</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/typescript/examples/task-scheduler"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">DBOS Task Scheduler</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#building-the-checkout-workflow" class="table-of-contents__link toc-highlight">Building the Checkout Workflow</a></li><li><a href="#the-checkout-and-payment-endpoints" class="table-of-contents__link toc-highlight">The Checkout and Payment Endpoints</a></li><li><a href="#database-operations" class="table-of-contents__link toc-highlight">Database Operations</a></li><li><a href="#launching-and-serving-the-app" class="table-of-contents__link toc-highlight">Launching and Serving the App</a></li><li><a href="#try-it-yourself" class="table-of-contents__link toc-highlight">Try it Yourself!</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Follow Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/dbos-inc/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://bsky.app/profile/dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bluesky<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/DBOS_Inc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter/X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.dbos.dev/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.dbos.dev/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Questions or Comments?</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/fMwQjeW5zg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat with us on Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:contact@dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Write to us at contact@dbos.dev<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://dbos.dev" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="100"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="100"></a></div><div class="footer__copyright">Copyright © 2025 DBOS, Inc. | <a href="https://www.dbos.dev/privacy" target="_blank">Privacy Policy</a></div></div></div></footer></div>
</body>
</html>