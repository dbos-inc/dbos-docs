---
sidebar_position: 70
title: OpenAPI Support
description: Learn how to automatically generate clients for DBOS applications.
---

[DBOS CLI](../../reference/tools/cli.md) v0.6 adds the `dbos-openapi generate` command that generates an [OpenAPI 3.0.x](https://www.openapis.org/) definition file for a DBOS application.
This definition file can be used to automatically generate strongly typed client code to invoke DBOS application endpoints.

### Generate OpenAPI Definition File

First, install `@dbos-inc/dbos-openapi` as a development dependency in your project:
```shell
npm install --save-dev @dbos-inc/dbos-openapi
```

To generate a OpenAPI definition file for a DBOS application, run the following `dbos-openapi` cli command:

```shell
npx dbos-openapi generate src/operations.ts
```

::::info
It is best to check that your code compiles before running `dbos-openapi generate`.
::::

This command takes a single required argument - the path to the DBOS application's TypeScript entrypoint files.  Lists of files and folders are also supported.
For DBOS applications generated by [`npx @dbos-inc/create`](../../reference/tools/cli.md#npx-dbos-inccreate), the entrypoint will be `src/operations.ts`.

The `dbos-openapi generate` command generates an OpenAPI definition file `.yaml` in the same folder as the entrypoint files.  If multiple entrypoints are specified, multiple files will be created.

::::info
This `entrypoints` argument is slightly different from the [`runtimeConfig.entrypoints`](../../reference/configuration.md#runtime) config setting.
The `dbos-openapi generate` argument references the TypeScript entrypoint files.
The `runtimeConfig.entrypoints` setting references the JavaScript file generated from the TypeScript entrypoint files.
::::

### Generate Client Code From OpenAPI Definition

Multiple vendors provide OpenAPI client generators that will work with a generated OpenAPI declaration file.
Each of these vendors have tools and documentation for generating client code for a variety of languages and runtimes.
Some of these tools include:

* [Microsoft Kiota](https://learn.microsoft.com/en-us/openapi/kiota/overview)
* [OpenAPI Generator](https://openapi-generator.tech/)
* [Swagger CodeGen](https://swagger.io/tools/swagger-codegen/) and [Online Editor](https://editor.swagger.io/)
* [openapi-typescript](https://openapi-ts.pages.dev/)
* [oazapfts](https://github.com/oazapfts/oazapfts)
* [OpenAPI TypeScript Codegen](https://github.com/ferdikoomen/openapi-typescript-codegen)

We can't provide tutorials for all of these OpenAPI generator tools, but the Swagger Editor runs in the browser so is straightforward to use for a simple tutorial

First, you need to run `npx dbos-openapi generate` against your DBOS application entrypoints as described above.

::::info
Note, the shop and payment backend applications from the [E-Commerce demo app](https://github.com/dbos-inc/dbos-demo-apps/tree/main/typescript/e-commerce)
include generated OpenApi definition files if you want to try this without creating your own application.
::::

Then, copy and paste the contents of the generated `openapi.yaml` file into [Swagger Editor](https://editor.swagger.io/).
Swagger Editor will validate the OpenAPI definitions and render a documentation page for the api.

::::info
Note, the Swagger Editor generated documentation includes tooling to trigger OpenAPI endpoints from directly in the web page.
This tooling will not work as the OpenAPI definition generated by `dbos-openapi generate` does not include server URL information.
::::

At the top of the Swagger Editor, there is a "Generate Client" dropdown menu. Select typescript-axios from the menu.
This will download a zip file containing a TypeScript package with the code generated from the OpenAPI definition.

The `typescript-axios` Swagger generator generates a full TypeScript package that supports `npm install` and `npm run build`.
Typically, you would incorporate the generated code into an existing client projects that needs to call into the DBOS project.

Here is some example code using the `typescript-axios` Swagger generator and the OpenAPI definition for the [E-Commerce Demo Shop DBOS application](https://github.com/dbos-inc/dbos-demo-apps/tree/main/typescript/e-commerce/shop-backend).


```ts
import { Configuration, DefaultApi } from "./index";

const config = new Configuration({
    basePath: "http://localhost:8082"
});

const api = new DefaultApi(config);

async function main() {
    const response = await api.getProducts();
    for (const product of response.data) {
        console.log(product.description);
    }
}

main();
```

::::info
As mentioned earlier, the OpenAPI definition file generated for an application does not include server URL information.
The server `basePath` must be included programmatically as in the code snippet above, regardless of the OpenAPI generator you choose to use.
::::

### Specify OpenAPI Security Scheme and Requirements

DBOS [handlers](../requestsandevents/http-serving-tutorial#handlers) (i.e. methods with `@DBOS.getApi` or `@DBOS.postApi`)
are mapped to OpenAPI [path items](https://spec.openapis.org/oas/v3.0.3#path-item-object).
Path item operations optionally include security requirements, which map to security schemes defined in the
`components.securitySchemes` section of the  OpenAPI definition file.
Some OpenAPI generators use this information to automatically manage user credentials in the generated client code.

[Authentication](../authentication-authorization.md) in DBOS is done via the middleware function passed to `@Authentication`.
Parsing the authentication logic to determine the OpenAPI security scheme information is not feasible.
To include authentication information in the OpenAPI file, declare the security scheme via the `@OpenApiSecurityScheme` class decorator.

```typescript
@Authentication(authMiddleware)
@OpenApiSecurityScheme({ type: 'http', scheme: 'bearer' })
export class Operations {
  @DBOS.getApi("/post/:id")
  @DBOS.requiredRoles(['user'])
  static async getPost(@ArgSource(ArgSources.URL) id: string) {
    ...
  }
}
```

The `@OpenApiSecurityScheme` decorator takes a single parameter, matching a supported security scheme
[from the OpenAPI spec](https://spec.openapis.org/oas/v3.0.3#security-scheme-object).

::::info
`dbos-openapi generate` does not support the `oauth2` OpenAPI security scheme at this time.
::::

All handler methods on a class use the same `@OpenApiSecurityScheme` in the generated OpenAPI definition,
except for methods that have no specified [`@DBOS.requiredRoles`](../authentication-authorization#authorization-decorators).
DBOS does not check authentication or authorization info for methods without any required roles.
Methods without any required roles do not emit security requirements in the generated OpenAPI definition file.


```typescript
@Authentication(authMiddleware)
@DBOS.defaultRequiredRoles(['user'])
@OpenApiSecurityScheme({ type: 'http', scheme: 'bearer' })
export class Operations {
  @DBOS.postApi('/api/login')
  @DBOS.requiredRoles([])
  static async login(ctx: HandlerContext, username: string, password: string) {
    ...
  }
}
```

This allows a developer to have authenticated and non authenticated methods within a single class.
If you need to support different security schemes for different methods, those need to be divided into separate classes.

