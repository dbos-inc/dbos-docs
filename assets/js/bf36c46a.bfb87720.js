"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[8522],{5477:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>t,metadata:()=>c,toc:()=>l});var i=s(4848),r=s(8453);const t={sidebar_position:7,title:"Package Library",description:"API reference for library of DBOS Optional Packages"},a=void 0,c={id:"typescript/reference/communicatorlib",title:"Package Library",description:"API reference for library of DBOS Optional Packages",source:"@site/docs/typescript/reference/communicatorlib.md",sourceDirName:"typescript/reference",slug:"/typescript/reference/communicatorlib",permalink:"/typescript/reference/communicatorlib",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7,title:"Package Library",description:"API reference for library of DBOS Optional Packages"},sidebar:"tutorialSidebar",previous:{title:"Workflow Handles",permalink:"/typescript/reference/workflow-handles"},next:{title:"Static Analysis",permalink:"/typescript/reference/static-analysis"}},o={},l=[{value:"Background",id:"background",level:2},{value:"Usage",id:"usage",level:2},{value:"<code>BcryptStep</code>",id:"bcryptstep",level:2},{value:"<code>bcryptGenSalt(saltRounds?:number)</code>",id:"bcryptgensaltsaltroundsnumber",level:3},{value:"<code>bcryptHash(txt: string, saltRounds?:number)</code>",id:"bcrypthashtxt-string-saltroundsnumber",level:3},{value:"<code>CurrentTimeStep</code>",id:"currenttimestep",level:2},{value:"<code>getCurrentDate()</code>",id:"getcurrentdate",level:3},{value:"<code>getCurrentTime()</code>",id:"getcurrenttime",level:3},{value:"<code>RandomStep</code>",id:"randomstep",level:2},{value:"<code>random()</code>",id:"random",level:3},{value:"Amazon Web Services (AWS) Integation Libraries",id:"amazon-web-services-aws-integation-libraries",level:2},{value:"AWS Configuration",id:"aws-configuration",level:3},{value:"Simple Email Service (SES)",id:"simple-email-service-ses",level:3},{value:"Simple Storage Service (S3)",id:"simple-storage-service-s3",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,i.jsx)(n.p,{children:"In DBOS, steps and event handlers represent interfaces to external systems, or wrap nondeterministic functions, and are often reusable.\nDBOS comes with several libraries for common purposes."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,i.jsxs)(n.p,{children:["To use a package from the library, first install it with ",(0,i.jsx)(n.code,{children:"npm"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"npm install --save @dbos-inc/communicator-datetime\n"})}),"\n",(0,i.jsx)(n.p,{children:"Import the functions and/or classes into your TypeScript code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { CurrentTimeStep } from '@dbos-inc/communicator-datetime';\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Invoke the step from a ",(0,i.jsx)(n.code,{children:"WorkflowContext"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const curDate = await wfCtx.invoke(CurrentTimeStep).getCurrentDate();\n"})}),"\n",(0,i.jsx)(n.p,{children:"When using the DBOS testing runtime, if you are explicitly providing the list of classes to register, it will be necessary to register any library classes also:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'  testRuntime = await createTestingRuntime(); // No explicit registration, classes referenced by test will be registered\n  testRuntime = await createTestingRuntime([Operations, CurrentTimeStep], "dbos-config.yaml"); // Specify everything\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"bcryptstep",children:(0,i.jsx)(n.code,{children:"BcryptStep"})}),"\n",(0,i.jsxs)(n.p,{children:["The functions in the ",(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/bcryptjs",children:(0,i.jsx)(n.code,{children:"bcryptjs"})})," package are non-deterministic because the salt is generated randomly.  To ensure consistent workflow behavior, bcrypt should therefore be run in a step so that the output can be recorded."]}),"\n",(0,i.jsxs)(n.p,{children:["This step is provided in the ",(0,i.jsx)(n.code,{children:"@dbos-inc/communicator-bcrypt"})," package."]}),"\n",(0,i.jsx)(n.h3,{id:"bcryptgensaltsaltroundsnumber",children:(0,i.jsx)(n.code,{children:"bcryptGenSalt(saltRounds?:number)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"bcryptGenSalt"})," produces a random salt.  Optional parameter is the number of rounds."]}),"\n",(0,i.jsx)(n.h3,{id:"bcrypthashtxt-string-saltroundsnumber",children:(0,i.jsx)(n.code,{children:"bcryptHash(txt: string, saltRounds?:number)"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"bcryptHash"})," generates a random salt and uses it to create a hash of ",(0,i.jsx)(n.code,{children:"txt"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"currenttimestep",children:(0,i.jsx)(n.code,{children:"CurrentTimeStep"})}),"\n",(0,i.jsx)(n.p,{children:"For workflows to make consistent decisions based on time, reading the current time should be done via a step so that the value can be recorded and is available for workflow restart or replay."}),"\n",(0,i.jsxs)(n.p,{children:["This step is provided in the ",(0,i.jsx)(n.code,{children:"@dbos-inc/communicator-datetime"})," package."]}),"\n",(0,i.jsx)(n.h3,{id:"getcurrentdate",children:(0,i.jsx)(n.code,{children:"getCurrentDate()"})}),"\n",(0,i.jsxs)(n.p,{children:["This function returns a ",(0,i.jsx)(n.code,{children:"Date"})," object representing the current clock time."]}),"\n",(0,i.jsx)(n.h3,{id:"getcurrenttime",children:(0,i.jsx)(n.code,{children:"getCurrentTime()"})}),"\n",(0,i.jsxs)(n.p,{children:["This function returns a ",(0,i.jsx)(n.code,{children:"number"})," of milliseconds since January 1, 1970, UTC, in the same manner as ",(0,i.jsx)(n.code,{children:"new Date().getTime()"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"randomstep",children:(0,i.jsx)(n.code,{children:"RandomStep"})}),"\n",(0,i.jsx)(n.p,{children:"For consistent workflow execution, the results of anything random should be recorded by running the logic in a step."}),"\n",(0,i.jsxs)(n.p,{children:["This step is provided in the ",(0,i.jsx)(n.code,{children:"@dbos-inc/communicator-random"})," package."]}),"\n",(0,i.jsx)(n.h3,{id:"random",children:(0,i.jsx)(n.code,{children:"random()"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"random"})," is a wrapper for ",(0,i.jsx)(n.code,{children:"Math.random()"})," and similarly produces a ",(0,i.jsx)(n.code,{children:"number"})," in the range from 0 to 1."]}),"\n",(0,i.jsx)(n.h2,{id:"amazon-web-services-aws-integation-libraries",children:"Amazon Web Services (AWS) Integation Libraries"}),"\n",(0,i.jsx)(n.h3,{id:"aws-configuration",children:"AWS Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Configuration of AWS services typically relies on access keys, which are needed by the application to make service API calls, but also are to be kept secret."}),"\n",(0,i.jsx)(n.p,{children:"There are multiple strategies used in AWS deployments, including the following:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Use one access key for the whole application; this generally is the key for an IAM role that is authorized to use all APIs that the application requires"}),"\n",(0,i.jsx)(n.li,{children:"Use one access key for each service used by the application"}),"\n",(0,i.jsx)(n.li,{children:"Use multiple access keys for each service, potentially with different permissions for roles within the application"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"DBOS Transact is designed to make configuration with a single access key straightforward, while allowing more flexible configurations."}),"\n",(0,i.jsxs)(n.p,{children:["First, AWS configuration sections are added to the ",(0,i.jsx)(n.code,{children:"application"})," part of ",(0,i.jsx)(n.code,{children:"dbos-config.yaml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"application:\n  aws_config:\n    aws_region: ${AWS_REGION}\n    aws_access_key_id: ${AWS_ACCESS_KEY_ID}\n    aws_secret_access_key: ${AWS_SECRET_ACCESS_KEY}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The default configuration section of ",(0,i.jsx)(n.code,{children:"application.aws_config"})," is used for any library that has not been specifically configured."]}),"\n",(0,i.jsxs)(n.p,{children:["Individual AWS services can override this, for example the SES package uses ",(0,i.jsx)(n.code,{children:"aws_ses_configuration"})," to specify the configuration(s) for use by SES:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"application:\n  aws_ses_configuration: aws_config_ses\n  aws_config_ses:\n    aws_region: ${AWS_REGION}\n    aws_access_key_id: ${AWS_ACCESS_KEY_ID_SES}\n    aws_secret_access_key: ${AWS_SECRET_ACCESS_KEY_SES}\n"})}),"\n",(0,i.jsx)(n.p,{children:"In the event that there are multiple access keys for the same service, the application must be involved in determining the number and purpose of the configurations."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"application:\n  aws_config_ses_user:\n    aws_region: ${AWS_REGION}\n    aws_access_key_id: ${AWS_ACCESS_KEY_ID_SES_U}\n    aws_secret_access_key: ${AWS_SECRET_ACCESS_KEY_SES_U}\n  aws_config_ses_admin:\n    aws_region: ${AWS_REGION}\n    aws_access_key_id: ${AWS_ACCESS_KEY_ID_SES_A}\n    aws_secret_access_key: ${AWS_SECRET_ACCESS_KEY_SES_A}\n"})}),"\n",(0,i.jsx)(n.p,{children:"The application code will then have to specify which configuration to use when initializing the step:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"    // Initialize once per config used...\n    const sesDef = configureInstance(SendEmailStep, 'default'});\n    const userSES = configureInstance(SendEmailStep, 'userSES', {awscfgname: 'aws_config_ses_user'});\n    const adminSES = configureInstance(SendEmailStep, 'adminSES', {awscfgname: 'aws_config_ses_admin'});\n    // Use configured object ...\n    const msgid = await worflowCtx.invoke(userSES).sendTemplatedEmail(\n        mailMsg,\n    );\n"})}),"\n",(0,i.jsx)(n.h3,{id:"simple-email-service-ses",children:"Simple Email Service (SES)"}),"\n",(0,i.jsxs)(n.p,{children:["DBOS provides a step for sending email using AWS SES.  This library is for sending email, with or without a template.  For details of the functionality, see the documentation accompanying the ",(0,i.jsx)(n.a,{href:"https://github.com/dbos-inc/dbos-transact/tree/main/packages/communicator-email-ses",children:"@dbos-inc/communicator-email-ses"})," package."]}),"\n",(0,i.jsx)(n.h2,{id:"simple-storage-service-s3",children:"Simple Storage Service (S3)"}),"\n",(0,i.jsxs)(n.p,{children:["DBOS provides steps for working with S3, and transactional workflows for keeping a database table in sync with an S3 bucket.  For details of the functionality, see the documentation accompanying the ",(0,i.jsx)(n.a,{href:"https://github.com/dbos-inc/dbos-transact/tree/main/packages/component-aws-s3",children:"@dbos-inc/component-aws-s3"})," package."]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var i=s(6540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);