"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[7435],{5901:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>d});var t=r(5893),i=r(1151);const a={sidebar_position:4,title:"Decorators",description:"API reference for DBOS decorators."},s="DBOS Decorators",o={id:"api-reference/decorators",title:"Decorators",description:"API reference for DBOS decorators.",source:"@site/docs/api-reference/decorators.md",sourceDirName:"api-reference",slug:"/api-reference/decorators",permalink:"/api-reference/decorators",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"Decorators",description:"API reference for DBOS decorators."},sidebar:"tutorialSidebar",previous:{title:"DBOS Contexts",permalink:"/api-reference/contexts"},next:{title:"Testing Runtime",permalink:"/api-reference/testing-runtime"}},c={},d=[{value:"Background",id:"background",level:2},{value:"Enabling Decorators",id:"enabling-decorators",level:3},{value:"Decorator Locations",id:"decorator-locations",level:2},{value:"Class Decorators",id:"class-decorators",level:3},{value:"Function Decorators",id:"function-decorators",level:3},{value:"Parameter Decorators",id:"parameter-decorators",level:3},{value:"Decorators Reference",id:"decorators-reference",level:2},{value:"DBOS Typescript Decorators",id:"dbos-typescript-decorators",level:3},{value:"<code>@Workflow</code>",id:"workflow",level:4},{value:"<code>@Transaction</code>",id:"transaction",level:4},{value:"<code>@StoredProcedure</code>",id:"storedprocedure",level:4},{value:"<code>@Communicator</code>",id:"communicator",level:4},{value:"HTTP API Registration Decorators",id:"http-api-registration-decorators",level:3},{value:"<code>@GetApi</code>",id:"getapi",level:4},{value:"<code>@PostApi</code>",id:"postapi",level:4},{value:"<code>@PutApi</code>",id:"putapi",level:4},{value:"<code>@PatchApi</code>",id:"patchapi",level:4},{value:"<code>@DeleteApi</code>",id:"deleteapi",level:4},{value:"<code>@ArgSource</code>",id:"argsource",level:4},{value:"<code>@Authentication</code>",id:"authentication",level:4},{value:"<code>@KoaBodyParser</code>",id:"koabodyparser",level:4},{value:"<code>@KoaCors</code>",id:"koacors",level:4},{value:"<code>@KoaMiddleware</code>",id:"koamiddleware",level:4},{value:"Declarative Security Decorators",id:"declarative-security-decorators",level:3},{value:"<code>@RequiredRole</code>",id:"requiredrole",level:4},{value:"<code>@DefaultRequiredRole</code>",id:"defaultrequiredrole",level:4},{value:"Input Validation Decorators",id:"input-validation-decorators",level:3},{value:"<code>@ArgRequired</code>",id:"argrequired",level:4},{value:"<code>@DefaultArgRequired</code>",id:"defaultargrequired",level:4},{value:"<code>@ArgOptional</code>",id:"argoptional",level:4},{value:"<code>@DefaultArgOptional</code>",id:"defaultargoptional",level:4},{value:"<code>@ArgName</code>",id:"argname",level:4},{value:"<code>@ArgDate</code>",id:"argdate",level:4},{value:"<code>@ArgVarchar</code>",id:"argvarchar",level:4},{value:"Logging and Tracing Decorators",id:"logging-and-tracing-decorators",level:3},{value:"<code>@SkipLogging</code>",id:"skiplogging",level:4},{value:"<code>@LogMask</code>",id:"logmask",level:4},{value:"Hook Functions",id:"hook-functions",level:3},{value:"<code>@DBOSInitializer</code>",id:"dbosinitializer",level:4},{value:"Kafka Integration Decorators",id:"kafka-integration-decorators",level:3},{value:"<code>@Kafka(kafkaConfig: KafkaConfig)</code>",id:"kafka",level:4},{value:"<code>@KafkaConsume(topic: string | RegExp | Array&lt;string | RegExp&gt;, consumerConfig?: ConsumerConfig)</code>",id:"kafka-consume",level:4},{value:"Scheduled Workflow Decorators",id:"scheduled-workflow-decorators",level:3},{value:"<code>@Scheduled(schedulerConfig: SchedulerConfig)</code>",id:"scheduled",level:4},{value:"<code>crontab</code> Specification",id:"crontab-specification",level:4},{value:"Second Field Format",id:"second-field-format",level:4},{value:"Minute Field Format:",id:"minute-field-format",level:4},{value:"Hour Field Format:",id:"hour-field-format",level:4},{value:"Day Of Month Field Format",id:"day-of-month-field-format",level:4},{value:"Month Field Format",id:"month-field-format",level:4},{value:"Day Of Week Field Format",id:"day-of-week-field-format",level:4},{value:"Matching",id:"matching",level:4},{value:"OpenAPI Decorators",id:"openapi-decorators",level:3},{value:"<code>@OpenApiSecurityScheme</code>",id:"openapisecurityscheme",level:4},{value:"Other Decorators",id:"other-decorators",level:3},{value:"TypeORM Decorators",id:"typeorm-decorators",level:4},{value:"<code>@OrmEntities</code>",id:"ormentities",level:5}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"dbos-decorators",children:"DBOS Decorators"}),"\n",(0,t.jsx)(n.h2,{id:"background",children:"Background"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/decorators.html",children:"Decorators"})," in TypeScript are a way to declaratively alter classes, functions, and parameters. Decorators precede the decorated class, function, or parameter, and begin with ",(0,t.jsx)(n.code,{children:"@"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"  @Decorated\n  class decorated {\n  ...\n  }\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Decorators may or may not take arguments in parentheses ",(0,t.jsx)(n.code,{children:"()"}),".  However, each specific decorator either requires or refuses parentheses. In the following, adding ",(0,t.jsx)(n.code,{children:"()"})," after ",(0,t.jsx)(n.code,{children:"@Required"})," will lead to an error, as will omitting ",(0,t.jsx)(n.code,{children:"()"})," after ",(0,t.jsx)(n.code,{children:"@LogMask"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"@Required @LogMask(LogMasks.HASH) password: string\n"})}),"\n",(0,t.jsx)(n.p,{children:"While, in general, the order in which decorators are listed can affect the behavior, all decorators in the DBOS API are order-independent.  So this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'  @Transaction()\n  @PostApi("/follow")\n  static async hello(ctx: TransactionContext) {\n  ...\n  }\n'})}),"\n",(0,t.jsx)(n.p,{children:"is the same as this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'  @PostApi("/follow")\n  @Transaction()\n  static async hello(ctx: TransactionContext) {\n  ...\n  }\n'})}),"\n",(0,t.jsx)(n.h3,{id:"enabling-decorators",children:"Enabling Decorators"}),"\n",(0,t.jsxs)(n.p,{children:["DBOS uses ",(0,t.jsx)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/decorators.html",children:'Typescript "Stage 2" decorators'}),".\nIf you initialize your project with ",(0,t.jsx)(n.a,{href:"/api-reference/cli#npx-dbos-inccreate",children:(0,t.jsx)(n.code,{children:"npx -y @dbos-inc/create"})}),", these are automatically enabled.\nOtherwise, you must enable them by supplying the following configuration to the Typescript compiler (usually via the file ",(0,t.jsx)(n.code,{children:"tsconfig.json"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "compilerOptions": {\n    "experimentalDecorators": true,\n    "emitDecoratorMetadata": true,\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"decorator-locations",children:"Decorator Locations"}),"\n",(0,t.jsx)(n.p,{children:"DBOS currently uses decorators at the class, function, or function parameter level.  (Typescript also supports decorators at the property or accessor level, but DBOS currently doesn't use them.)"}),"\n",(0,t.jsx)(n.h3,{id:"class-decorators",children:"Class Decorators"}),"\n",(0,t.jsxs)(n.p,{children:["Class decorators are affixed to a class, just before the keyword ",(0,t.jsx)(n.code,{children:"class"}),".  Such decorators will be applied to all functions in the class."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#authentication",children:(0,t.jsx)(n.code,{children:"@Authentication"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#defaultrequiredrole",children:(0,t.jsx)(n.code,{children:"@DefaultRequiredRole"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#koabodyparser",children:(0,t.jsx)(n.code,{children:"@KoaBodyParser"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#koacors",children:(0,t.jsx)(n.code,{children:"@KoaCors"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#koamiddleware",children:(0,t.jsx)(n.code,{children:"@KoaMiddleware"})})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"function-decorators",children:"Function Decorators"}),"\n",(0,t.jsxs)(n.p,{children:["Function decorators are affixed to a function, just before its name and modifiers (such as ",(0,t.jsx)(n.code,{children:"async"})," or ",(0,t.jsx)(n.code,{children:"static"}),").  Function decorators apply to the decorated function and its parameters.  Examples of function-level decorators:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#workflow",children:(0,t.jsx)(n.code,{children:"@Workflow"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#transaction",children:(0,t.jsx)(n.code,{children:"@Transaction"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#communicator",children:(0,t.jsx)(n.code,{children:"@Communicator"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#requiredrole",children:(0,t.jsx)(n.code,{children:"@RequiredRole"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#getapi",children:(0,t.jsx)(n.code,{children:"@GetApi"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#postapi",children:(0,t.jsx)(n.code,{children:"@PostApi"})})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"parameter-decorators",children:"Parameter Decorators"}),"\n",(0,t.jsx)(n.p,{children:"Parameter decorators are affixed to a function parameter, just before its name.  Parameter decorators apply to the treatment of the parameter, and may affect how values are validated or logged.  Examples of parameter-level decorators:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#argname",children:(0,t.jsx)(n.code,{children:"@ArgName"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#argdate",children:(0,t.jsx)(n.code,{children:"@ArgDate"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#skiplogging",children:(0,t.jsx)(n.code,{children:"@SkipLogging"})})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#logmask",children:(0,t.jsx)(n.code,{children:"@LogMask"})})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"decorators-reference",children:"Decorators Reference"}),"\n",(0,t.jsx)(n.h3,{id:"dbos-typescript-decorators",children:"DBOS Typescript Decorators"}),"\n",(0,t.jsx)(n.h4,{id:"workflow",children:(0,t.jsx)(n.code,{children:"@Workflow"})}),"\n",(0,t.jsx)(n.p,{children:"Registers a function as a DBOS workflow."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@Workflow()\nstatic async processWorkflow(wfCtxt: WorkflowContext, value: string) {\n  ...\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The first argument to a workflow function must be a ",(0,t.jsx)(n.a,{href:"/api-reference/contexts#workflowcontext",children:(0,t.jsx)(n.code,{children:"WorkflowContext"})}),".  This context can be used to invoke transactions and communicators, send and receive messages, and get other contextual information such as the authenticated user."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"@Workflow()"})," takes an optional ",(0,t.jsx)(n.code,{children:"WorkflowConfig"})," object:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface WorkflowConfig {\n  maxRecoveryAttempts?: number; // The maximum number of times the workflow may be automatically recovered. Defaults to 50.\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"transaction",children:(0,t.jsx)(n.code,{children:"@Transaction"})}),"\n",(0,t.jsxs)(n.p,{children:["Registers a function as a ",(0,t.jsx)(n.a,{href:"/tutorials/transaction-tutorial",children:"DBOS transaction"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The first argument of the decorated function must be a ",(0,t.jsx)(n.a,{href:"/api-reference/contexts#transactioncontextt",children:(0,t.jsx)(n.code,{children:"TransactionContext"})}),", which provides access to the database transaction."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@Transaction({readOnly: true})\nstatic async doLogin(ctx: TransactionContext, username: string) {\n  ...\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"@Transaction()"})," takes an optional ",(0,t.jsx)(n.code,{children:"TransactionConfig"})," object:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface TransactionConfig {\n  isolationLevel?: IsolationLevel;\n  readOnly?: boolean;\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["DBOS supports declaration of the following values for ",(0,t.jsx)(n.code,{children:"IsolationLevel"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"READ UNCOMMITTED"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"READ COMMITTED"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"REPEATABLE READ"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"SERIALIZABLE"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The transaction semantics of these levels are defined for PostgreSQL ",(0,t.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/transaction-iso.html",children:"here"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"You should mark a transaction function as read-only if it doesn't contain any database writes.\nA read-only transaction runs faster than a standard read-write transaction because it doesn't require synchronized disk writes."}),"\n",(0,t.jsxs)(n.p,{children:["If you mark a transaction function as ",(0,t.jsx)(n.code,{children:"readOnly: true"})," but it contains database writes, it will throw an error (for example ",(0,t.jsx)(n.code,{children:"ERROR:  cannot execute INSERT in a read-only transaction"}),")."]}),"\n",(0,t.jsx)(n.h4,{id:"storedprocedure",children:(0,t.jsx)(n.code,{children:"@StoredProcedure"})}),"\n",(0,t.jsxs)(n.p,{children:["Registers a function as a ",(0,t.jsx)(n.a,{href:"/tutorials/stored-proc-tutorial",children:"DBOS stored procedure"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The first argument of the decorated function must be a ",(0,t.jsx)(n.a,{href:"contexts#storedprocedurecontext",children:(0,t.jsx)(n.code,{children:"StoredProcedureContext"})}),", which provides access to the database."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@StoredProcedure({readOnly: true})\nstatic async doLogin(ctx: StoredProcedureContext, username: string) {\n  ...\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"@StoredProcedure()"})," takes an optional ",(0,t.jsx)(n.code,{children:"StoredProcedureConfig"})," object:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface StoredProcedureConfig {\n  isolationLevel?: IsolationLevel;\n  readOnly?: boolean;\n  executeLocally?: boolean\n} \n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"readOnly"})," and ",(0,t.jsx)(n.code,{children:"isolationLevel"})," config fields behave the same as their ",(0,t.jsx)(n.a,{href:"#transaction",children:"TransactionConfig"})," counterparts."]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"executeLocally"})," config field is used to control where the stored procedure logic is executed.\nBy default, stored procedures functions are executed by invoking the generated stored procedure that has been deployed to the database.\nHowever, for debugging scenarios, it can be helpful to step through the procedure's logic like you can with the rest of your application code.\nWhen ",(0,t.jsx)(n.code,{children:"executeLocally"})," is set to true, the stored procedure function gets executed locally on the application server, similar to transaction functions."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"executeLocally"})," field can be changed without redeploying the application with the ",(0,t.jsx)(n.a,{href:"/api-reference/dbos-compiler",children:"DBOS Compiler"}),".\nDBOS Compiler will deploy all ",(0,t.jsx)(n.code,{children:"@StoredProcedure()"})," functions, even those marked with ",(0,t.jsx)(n.code,{children:"executeLocally"})," set to true."]})}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["Note, when running locally, DBOS uses the ",(0,t.jsx)(n.a,{href:"https://node-postgres.com/",children:(0,t.jsx)(n.code,{children:"node-postgres"})})," package to connect to the application database.\nThere can be slight differences between the query results returned by PLV8 and ",(0,t.jsx)(n.code,{children:"node-postgres"}),", in particular when querying for floating point values."]})}),"\n",(0,t.jsx)(n.h4,{id:"communicator",children:(0,t.jsx)(n.code,{children:"@Communicator"})}),"\n",(0,t.jsxs)(n.p,{children:["Registers a function as a ",(0,t.jsx)(n.a,{href:"/tutorials/communicator-tutorial",children:"DBOS communicator"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@Communicator()\nstatic async doComms(commCtxt: CommunicatorContext) {\n  ...\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The first argument to a communicator function must be a ",(0,t.jsx)(n.a,{href:"/api-reference/contexts#communicatorcontext",children:(0,t.jsx)(n.code,{children:"CommunicatorContext"})}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"@Communicator()"})," takes an optional ",(0,t.jsx)(n.code,{children:"CommunicatorConfig"}),", which allows a number of communicator properties to be specified:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export interface CommunicatorConfig {\n  retriesAllowed?: boolean; // Should failures be retried? (default true)\n  intervalSeconds?: number; // Seconds to wait before the first retry attempt (default 1).\n  maxAttempts?: number;     // Maximum number of retry attempts (default 3). If errors occur more times than this, throw an exception.\n  backoffRate?: number;     // Multiplier by which the retry interval increases after a retry attempt (default 2).\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"http-api-registration-decorators",children:"HTTP API Registration Decorators"}),"\n",(0,t.jsx)(n.h4,{id:"getapi",children:(0,t.jsx)(n.code,{children:"@GetApi"})}),"\n",(0,t.jsx)(n.p,{children:"Associates a function with an HTTP URL accessed via GET."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@GetApi("/hello")\nstatic async hello(_ctx: HandlerContext) {\n  return { message: "hello!" };\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"@GetApi"})," decorator can be combined with ",(0,t.jsx)(n.a,{href:"#transaction",children:(0,t.jsx)(n.code,{children:"@Transaction"})}),", ",(0,t.jsx)(n.a,{href:"#workflow",children:(0,t.jsx)(n.code,{children:"@Workflow"})}),", or ",(0,t.jsx)(n.a,{href:"#communicator",children:(0,t.jsx)(n.code,{children:"@Communicator"})})," to serve those operations via HTTP.\nIt can also be used by itself in a ",(0,t.jsx)(n.a,{href:"/tutorials/http-serving-tutorial#handlers",children:"DBOS handler function"}),".\nThe first argument to a handler function must be a ",(0,t.jsx)(n.a,{href:"/api-reference/contexts#handlercontext",children:(0,t.jsx)(n.code,{children:"HandlerContext"})}),", which contains more details about the incoming request and allows invoking workflows, transactions, and communicators."]}),"\n",(0,t.jsxs)(n.p,{children:["Endpoint paths may have placeholders, which are parts of the URL mapped to function arguments.\nThese are represented by a section of the path prefixed with a ",(0,t.jsx)(n.code,{children:":"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@GetApi("/:id")\nstatic async exampleGet(ctxt: TransactionContext, id: string) {\n  ctxt.logger.info(`${id} is parsed from the URL path parameter`)\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"postapi",children:(0,t.jsx)(n.code,{children:"@PostApi"})}),"\n",(0,t.jsxs)(n.p,{children:["Associates a function with an HTTP URL accessed via POST. Analogous to ",(0,t.jsx)(n.a,{href:"#getapi",children:(0,t.jsx)(n.code,{children:"@GetApi"})}),", but may parse arguments from a request body."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@PostApi("/:id")\n  static async examplePost(ctxt: HandlerContext, id: string, name: string) {\n  ctxt.logger.info(`${id} is parsed from the URL path parameter, ${name} is parsed from the request body`)\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"putapi",children:(0,t.jsx)(n.code,{children:"@PutApi"})}),"\n",(0,t.jsxs)(n.p,{children:["Associates a function with an HTTP URL accessed via PUT. Analogous to ",(0,t.jsx)(n.a,{href:"#getapi",children:(0,t.jsx)(n.code,{children:"@GetApi"})}),", but may parse arguments from a request body."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@PutApi("/:id")\n  static async examplePut(ctxt: HandlerContext, id: string, name: string) {\n  ctxt.logger.info(`${id} is parsed from the URL path parameter, ${name} is parsed from the request body`)\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"patchapi",children:(0,t.jsx)(n.code,{children:"@PatchApi"})}),"\n",(0,t.jsxs)(n.p,{children:["Associates a function with an HTTP URL accessed via PATCH. Analogous to ",(0,t.jsx)(n.a,{href:"#getapi",children:(0,t.jsx)(n.code,{children:"@GetApi"})}),", but may parse arguments from a request body."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@PatchApi("/:id")\n  static async examplePatch(ctxt: HandlerContext, id: string, name: string) {\n  ctxt.logger.info(`${id} is parsed from the URL path parameter, ${name} is parsed from the request body`)\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"deleteapi",children:(0,t.jsx)(n.code,{children:"@DeleteApi"})}),"\n",(0,t.jsxs)(n.p,{children:["Associates a function with an HTTP URL accessed via DELETE. Analogous to ",(0,t.jsx)(n.a,{href:"#getapi",children:(0,t.jsx)(n.code,{children:"@GetApi"})}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@DeleteApi("/:id")\nstatic async exampleDelete(ctxt: TransactionContext, id: string) {\n  ctxt.logger.info(`${id} is parsed from the URL path parameter`)\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"argsource",children:(0,t.jsx)(n.code,{children:"@ArgSource"})}),"\n",(0,t.jsx)(n.p,{children:"Indicates where a function argument is to be sourced, when it could come from more than one place."}),"\n",(0,t.jsxs)(n.p,{children:["In the example below, ",(0,t.jsx)(n.code,{children:"@ArgSource"})," is used to indicate that the ",(0,t.jsx)(n.code,{children:"name"})," argument comes from the URL query string, rather than the posted message body."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@PostApi("/workflow")\n@Workflow()\nstatic async testWorkflow(wfCtxt: WorkflowContext, @ArgSource(ArgSources.QUERY) name: string) {\n  const res = await wfCtxt.invoke(TestEndpoints).testTranscation(name);\n  return res;\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"@ArgSource"})," decorator takes one of the following values of ",(0,t.jsx)(n.code,{children:"ArgSources"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"DEFAULT"}),": The default value. For GET requests, this means searching for query parameters; for POST requests, searching the request body."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"BODY"}),": Indicates to search the parameter in the request body."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"QUERY"}),": Indicates to search the parameter in the URL query string."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"URL"}),": Indicates to search the parameter in the endpoint path (requires a path placeholder)."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Arguments sourced from an HTTP request generally get the name given in the code for the function.  However, if the name in the HTTP query string or body is different, ",(0,t.jsx)(n.a,{href:"#argname",children:(0,t.jsx)(n.code,{children:"@ArgName"})})," may be used."]}),"\n",(0,t.jsx)(n.h4,{id:"authentication",children:(0,t.jsx)(n.code,{children:"@Authentication"})}),"\n",(0,t.jsxs)(n.p,{children:["Configures the DBOS HTTP server to perform authentication. All functions in the decorated class will use the provided function to act as an authentication middleware.\nThis middleware will make users' identity available to ",(0,t.jsx)(n.a,{href:"/api-reference/contexts",children:"DBOS Contexts"}),". Here is an example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"async function exampleAuthMiddleware (ctx: MiddlewareContext) {\n  if (ctx.requiredRole.length > 0) {\n    const { userid } = ctx.koaContext.request.query;\n    const uid = userid?.toString();\n\n    if (!uid || uid.length === 0) {\n      const err = new DBOSNotAuthorizedError(\"Not logged in.\", 401);\n      throw err;\n    }\n    else {\n      if (uid === 'bad_person') {\n        throw new DBOSNotAuthorizedError(\"Go away.\", 401);\n      }\n      return {\n        authenticatedUser: uid,\n        authenticatedRoles: (uid === 'a_real_user' ? ['user'] : ['other'])\n      };\n    }\n  }\n}\n\n@Authentication(exampleAuthMiddleware)\nclass OperationEndpoints {\n  @GetApi(\"/requireduser\")\n  @RequiredRole(['user'])\n  static async checkAuth(ctxt: HandlerContext) {\n    return `Please say hello to ${ctxt.authenticatedUser}`;\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"The interface for the authentication middleware is:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"/**\n * Authentication middleware executing before requests reach functions.\n * Can implement arbitrary authentication and authorization logic.\n * Should throw an error or return an instance of `DBOSHttpAuthReturn`\n */\nexport type DBOSHttpAuthMiddleware = (ctx: MiddlewareContext) => Promise<DBOSHttpAuthReturn | void>;\n\nexport interface DBOSHttpAuthReturn {\n  authenticatedUser: string;\n  authenticatedRoles: string[];\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The authentication function is provided with a ",(0,t.jsx)(n.a,{href:"/api-reference/contexts#middlewarecontext",children:"'MiddlewareContext'"}),", which allows access to the request, system configuration, logging, and database access services."]}),"\n",(0,t.jsx)(n.h4,{id:"koabodyparser",children:(0,t.jsx)(n.code,{children:"@KoaBodyParser"})}),"\n",(0,t.jsxs)(n.p,{children:["By default, the DBOS HTTP server uses a ",(0,t.jsx)(n.a,{href:"https://github.com/koajs/bodyparser",children:(0,t.jsx)(n.code,{children:"@koa/bodyparser"})})," middleware for parsing JSON message bodies.\nTo specify a different middleware for the body parser, use the ",(0,t.jsx)(n.code,{children:"@KoaBodyParser"})," decorator at the class level."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { bodyParser } from "@koa/bodyparser";\n\n@KoaBodyParser(bodyParser({\n  extendTypes: {\n    json: ["application/json", "application/custom-content-type"],\n  },\n  encoding: "utf-8"\n}))\nclass OperationEndpoints {\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"koacors",children:(0,t.jsx)(n.code,{children:"@KoaCors"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS",children:"Cross-Origin Resource Sharing (CORS)"})," is an integral part of security in web browsers and similar clients."]}),"\n",(0,t.jsxs)(n.p,{children:["By default, DBOS uses ",(0,t.jsx)(n.a,{href:"https://github.com/koajs/cors",children:(0,t.jsx)(n.code,{children:"@koa/cors"})})," middleware with a configuration from ",(0,t.jsx)(n.a,{href:"../api-reference/configuration#http",children:(0,t.jsx)(n.code,{children:"dbos-config.yaml"})}),".  (The defaults in this file are, in turn, extremely permissive, allowing all cross-origin requests, including those with credentials.)  If your application needs only a coarse configuration of CORS, such as disabling CORS, or enabling CORS only on whitelisted origins, the config file offers a simple option."]}),"\n",(0,t.jsxs)(n.p,{children:["If more complex logic is needed, or if the CORS configuration differs between operation classes, the ",(0,t.jsx)(n.code,{children:"@KoaCors"})," class-level decorator can be used to specify the CORS middleware in full."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import cors from \"@koa/cors\";\n\n@KoaCors(cors({\n  credentials: true,\n  origin:\n    (o: Context)=>{\n      const whitelist = ['https://us.com','https://partner.com'];\n      const origin = o.request.header.origin ?? '*';\n      return (whitelist.includes(origin) ? origin : '');\n    }\n}))\nclass EndpointsWithSpecialCORS {\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"koamiddleware",children:(0,t.jsx)(n.code,{children:"@KoaMiddleware"})}),"\n",(0,t.jsx)(n.p,{children:"Configures the DBOS HTTP server allow insertion of arbitrary Koa middlewares. All functions in the decorated class will use the provided middleware list."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const exampleMiddleware: Koa.Middleware = async (ctx, next) => {\n  await next();\n};\n\n@KoaMiddleware(exampleMiddleware)\nclass OperationEndpoints{\n  ...\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"declarative-security-decorators",children:"Declarative Security Decorators"}),"\n",(0,t.jsxs)(n.p,{children:["DBOS supports declarative, role-based security. Functions can be decorated with a list of roles (as strings) and execution of the function is forbidden unless the authenticated user has at least one role in the list. A list of roles can also be provided as a class-level default with ",(0,t.jsx)(n.code,{children:"@DefaultRequiredRole()"}),", in which case it applies to any DBOS function in the class. Functions can override the defaults with ",(0,t.jsx)(n.code,{children:"@RequiredRole()"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"requiredrole",children:(0,t.jsx)(n.code,{children:"@RequiredRole"})}),"\n",(0,t.jsx)(n.p,{children:"List the required roles for the decorated function. In order to execute the function, the authenticated user must have at least one role on the specified list."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@RequiredRole(['user','guest'])\n@GetApi(\"/hello\")\nstatic async helloUser(_ctx: HandlerContext) {\n  return { message: \"hello registered user or guest!\" };\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"defaultrequiredrole",children:(0,t.jsx)(n.code,{children:"@DefaultRequiredRole"})}),"\n",(0,t.jsxs)(n.p,{children:["List default required roles for all functions in the class. This can be overridden at the function level with ",(0,t.jsx)(n.code,{children:"@RequiredRole"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@DefaultRequiredRole([\'user\'])\nclass OperationEndpoints {\n\n  // Authentication / authorization not required for this function\n  @RequiredRole([])\n  @GetApi("/hello")\n  static async hello(_ctx: HandlerContext) {\n    return { message: "hello!" };\n  }\n\n  // Role with elevated permissions required for this function\n  @RequiredRole([\'admin\'])\n  @GetApi("/helloadmin")\n  static async helloadmin(_ctx: HandlerContext) {\n    return { message: "hello admin!" };\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"input-validation-decorators",children:"Input Validation Decorators"}),"\n",(0,t.jsx)(n.p,{children:"A combination of function and parameter decorators automatically provides rudimentary argument validation."}),"\n",(0,t.jsxs)(n.p,{children:["While the typescript compiler does some compile-time checks, it is possible (and likely) for programmers to pass user input directly through their code through the ",(0,t.jsx)(n.code,{children:"any"})," type or a series of poorly-validated casts.  The DBOS function argument validation logic is able to check arguments exist and are of the right data types (or are close enough to be coerced through reasonable means)."]}),"\n",(0,t.jsx)(n.p,{children:"Note that this validation is basic, and is not a substitute for the kind of input validation that conforms to your business logic.  For example, a policy that user passwords should be 8 characters, and contain at least an uppercase, lowercase, and numeric character should be implemented in the web UI (for immediate feedback) and double-checked in your backend code (for security), whereas the DBOS decorators will simply ensure that a password string was provided prior to function entry."}),"\n",(0,t.jsx)(n.p,{children:"These decorators also serve a second purpose, which is to make the type information available to DBOS.  Uses of this include creating a per-function schema for tracing logs, or automatically producing a description of the function for integration purposes."}),"\n",(0,t.jsxs)(n.p,{children:["In simple cases (such as ",(0,t.jsx)(n.code,{children:"string"})," or ",(0,t.jsx)(n.code,{children:"number"})," arguments), the programmer need not do any decorating to get the functionality.  However, where the data types have some options, such as maximum length, precision, etc., there are decorators to control the behavior."]}),"\n",(0,t.jsx)(n.h4,{id:"argrequired",children:(0,t.jsx)(n.code,{children:"@ArgRequired"})}),"\n",(0,t.jsxs)(n.p,{children:["Ensures that the decorated function argument has a suitable value.  This is generally a default behavior, but see ",(0,t.jsx)(n.a,{href:"#defaultargrequired",children:(0,t.jsx)(n.code,{children:"@DefaultArgRequired"})})," and ",(0,t.jsx)(n.a,{href:"#defaultargoptional",children:(0,t.jsx)(n.code,{children:"@DefaultArgOptional"})}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@GetApi("/string")\nstatic async checkStringG(_ctx: HandlerContext, @ArgRequired v: string) {\n  ...\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"defaultargrequired",children:(0,t.jsx)(n.code,{children:"@DefaultArgRequired"})}),"\n",(0,t.jsxs)(n.p,{children:["Sets as the default policy that each argument of each registered function in the decorated class has a suitable value.  This is generally a default behavior, but see ",(0,t.jsx)(n.a,{href:"#argrequired",children:(0,t.jsx)(n.code,{children:"@ArgRequired"})}),", ",(0,t.jsx)(n.a,{href:"#argoptional",children:(0,t.jsx)(n.code,{children:"@ArgOptional"})})," and ",(0,t.jsx)(n.a,{href:"#defaultargoptional",children:(0,t.jsx)(n.code,{children:"@DefaultArgOptional"})}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@DefaultArgRequired\nexport class User {}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"argoptional",children:(0,t.jsx)(n.code,{children:"@ArgOptional"})}),"\n",(0,t.jsxs)(n.p,{children:["Allows the argument to have an undefined value.  See also ",(0,t.jsx)(n.a,{href:"#defaultargrequired",children:(0,t.jsx)(n.code,{children:"@DefaultArgRequired"})})," and ",(0,t.jsx)(n.a,{href:"#defaultargoptional",children:(0,t.jsx)(n.code,{children:"@DefaultArgOptional"})}),"."]}),"\n",(0,t.jsx)(n.admonition,{title:"note",type:"info",children:(0,t.jsxs)(n.p,{children:["TypeScript/Javascript makes a distinction between ",(0,t.jsx)(n.code,{children:"undefined"})," and ",(0,t.jsx)(n.code,{children:"null"}),".  Databases and serializers often support only one way to represent an undefined/unknown value.  For this reason, DBOS converts all ",(0,t.jsx)(n.code,{children:"null"})," values to ",(0,t.jsx)(n.code,{children:"undefined"})," prior to entry to the user function.  (",(0,t.jsx)(n.code,{children:"undefined"})," was chosen over ",(0,t.jsx)(n.code,{children:"null"})," because it is much easier to work with in TypeScript.)"]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@GetApi("/string")\nstatic async checkStringG(_ctx: HandlerContext, @ArgOptional v?: string) {\n  ...\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"defaultargoptional",children:(0,t.jsx)(n.code,{children:"@DefaultArgOptional"})}),"\n",(0,t.jsxs)(n.p,{children:["Sets as the default policy that each argument of each registered function in the decorated class may have undefined value.  See also ",(0,t.jsx)(n.a,{href:"#argrequired",children:(0,t.jsx)(n.code,{children:"@ArgRequired"})}),", ",(0,t.jsx)(n.a,{href:"#argoptional",children:(0,t.jsx)(n.code,{children:"@ArgOptional"})})," and ",(0,t.jsx)(n.a,{href:"#defaultargrequired",children:(0,t.jsx)(n.code,{children:"@DefaultArgRequired"})}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@DefaultArgOptional\nexport class User {}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"argname",children:(0,t.jsx)(n.code,{children:"@ArgName"})}),"\n",(0,t.jsx)(n.p,{children:"Assigns a name to the decorated parameter.  The name of an argument is, by default, taken from the code, but if there is a reason for a disparity (perhaps the function was refactored but the external name used in HTTP requests is to be kept consistent), the name can be overriden with this parameter decorator."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@GetApi(\"/string\")\nstatic async checkStringG(_ctx: HandlerContext, @ArgName('call_me_maybe') internal_name: string) {\n  ...\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"argdate",children:(0,t.jsx)(n.code,{children:"@ArgDate"})}),"\n",(0,t.jsx)(n.p,{children:"Ensures that a Date argument has a suitable value.  This decorator currently accepts no configuration, but may be altered in the future to indicate whether it is a timestamp or plain date."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@GetApi("/date")\nstatic async checkDateG(_ctx: HandlerContext, @ArgDate() v: Date) {\n  ...\n}\n'})}),"\n",(0,t.jsx)(n.h4,{id:"argvarchar",children:(0,t.jsx)(n.code,{children:"@ArgVarchar"})}),"\n",(0,t.jsx)(n.p,{children:"Ensures that a string argument has a suitable length.  This decorator requires a length parameter."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'@GetApi("/string")\nstatic async checkStringG(_ctx: HandlerContext, @ArgVarchar(10) v: string) {\n  ...\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"logging-and-tracing-decorators",children:"Logging and Tracing Decorators"}),"\n",(0,t.jsx)(n.h4,{id:"skiplogging",children:(0,t.jsx)(n.code,{children:"@SkipLogging"})}),"\n",(0,t.jsxs)(n.p,{children:["Prevents a function argument from being recorded in traces. This could be used if the argument is an opaque object, context, connection, service, or of sensitive nature. See also ",(0,t.jsx)(n.a,{href:"#logmask",children:(0,t.jsx)(n.code,{children:"@LogMask"})}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export class Operations\n{\n  @Transaction()\n  static async doOperation(ctx: TransactionContext, @SkipLogging notToBeRecorded: unknown) {\n    ...\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"logmask",children:(0,t.jsx)(n.code,{children:"@LogMask"})}),"\n",(0,t.jsxs)(n.p,{children:["Prevents an argument from being recorded in traces in plain text. This could be used if the argument is sensitive in nature, but may be useful for debugging or tracing. See also ",(0,t.jsx)(n.a,{href:"#skiplogging",children:(0,t.jsx)(n.code,{children:"@SkipLogging"})}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export class Operations\n{\n  @Transaction()\n  static async doOperation(ctx: TransactionContext, @LogMask(LogMasks.HASH) toBeHashed: string) {\n    ...\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Values of ",(0,t.jsx)(n.code,{children:"LogMasks"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"NONE"}),": No masking."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"HASH"}),": When logging the value, substitute its (not cryptographically secure) hash."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"SKIP"}),": Do not include the parameter in the log.  See ",(0,t.jsx)(n.a,{href:"#skiplogging",children:(0,t.jsx)(n.code,{children:"@SkipLogging"})}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"hook-functions",children:"Hook Functions"}),"\n",(0,t.jsx)(n.p,{children:"DBOS allows applications to supply functions to be invoked at points in the application initialization process."}),"\n",(0,t.jsx)(n.h4,{id:"dbosinitializer",children:(0,t.jsx)(n.code,{children:"@DBOSInitializer"})}),"\n",(0,t.jsxs)(n.p,{children:["This decorator is used to specify functions to be run at application instance initialization time.\n",(0,t.jsx)(n.code,{children:"@DBOSInitializer"})," is intended for uses such as validating configuration, establishing connections to external (non-database) services, and so on.\nIt is not a good place for database schema migration, for that see our ",(0,t.jsx)(n.a,{href:"/api-reference/cli#npx-dbos-migrate",children:"migration commands"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["The argument to ",(0,t.jsx)(n.code,{children:"@DBOSInitializer"})," should be of type ",(0,t.jsx)(n.a,{href:"/api-reference/contexts#initcontext",children:(0,t.jsx)(n.code,{children:"InitContext"})}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"\n  @DBOSInitializer()\n  static async init(ctx: InitContext) {\n     // Use functions and config from ctx, report anything interesting with ctx.log\n  }\n"})}),"\n",(0,t.jsx)(n.h3,{id:"kafka-integration-decorators",children:"Kafka Integration Decorators"}),"\n",(0,t.jsx)(n.h4,{id:"kafka",children:(0,t.jsx)(n.code,{children:"@Kafka(kafkaConfig: KafkaConfig)"})}),"\n",(0,t.jsxs)(n.p,{children:["Class-level decorator defining a Kafka configuration to use in all class methods.\nTakes in a ",(0,t.jsx)(n.a,{href:"https://kafka.js.org/docs/configuration",children:"KafkaJS configuration object"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"kafka-consume",children:(0,t.jsx)(n.code,{children:"@KafkaConsume(topic: string | RegExp | Array<string | RegExp>, consumerConfig?: ConsumerConfig)"})}),"\n",(0,t.jsxs)(n.p,{children:["Runs a transaction or workflow exactly-once for each message received on the specified topic(s).\nTakes in a Kafka topic or list of Kafka topics (required) and a ",(0,t.jsx)(n.a,{href:"https://kafka.js.org/docs/consuming#options",children:"KafkaJS consumer configuration"})," (optional).\nRequires class to be decorated with ",(0,t.jsx)(n.a,{href:"#kafka",children:(0,t.jsx)(n.code,{children:"@Kafka"})}),".\nThe decorated method must take as input a Kafka topic, partition, and message as in the example below:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'import { KafkaConfig, KafkaMessage} from "kafkajs";\nimport { Kafka, KafkaConsume, Workflow, WorkflowContext } from "@dbos-inc/dbos-sdk";\n\nconst kafkaConfig: KafkaConfig = {\n    brokers: [\'localhost:9092\']\n}\n\n@Kafka(kafkaConfig)\nclass KafkaExample{\n\n  @KafkaConsume("example-topic")\n  @Workflow()\n  static async kafkaWorkflow(ctxt: WorkflowContext, topic: string, partition: number, message: KafkaMessage) {\n    // This workflow executes exactly once for each message sent to "example-topic".\n    // All methods annotated with Kafka decorators must take in the topic, partition, and message as inputs just like this method.\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"scheduled-workflow-decorators",children:"Scheduled Workflow Decorators"}),"\n",(0,t.jsx)(n.h4,{id:"scheduled",children:(0,t.jsx)(n.code,{children:"@Scheduled(schedulerConfig: SchedulerConfig)"})}),"\n",(0,t.jsx)(n.p,{children:"Runs a workflow function on a specified schedule, with guarantees such as executing exactly once per scheduled interval."}),"\n",(0,t.jsx)(n.p,{children:"By default, the workflow is executed exactly once per scheduled interval.  This means executions might be started concurrently and can overlap, and that if the application is taken down and restarted, makeup work will be performed.  A workflow idempotency key (consisting of the workflow function name and scheduled time) is used to deduplicate any workflows that may inadvertently be initiated by the scheduler."}),"\n",(0,t.jsxs)(n.p,{children:["The schedule is specified in a format similar to a traditional ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Cron",children:(0,t.jsx)(n.code,{children:"crontab"})}),", with the following notes:\n. The 5- and 6-field versions are supported, if the optional 6th field is prepended it indicates second-level granularity, otherwise it is minute-level.\n. ',' is supported to indicate a list of values, so '0 0,12 * * *' executes at midnight and noon every day.\n. '/' is supported to indicate divisibility, so '*/5 * * * *' indicates every 5 minutes.\n. '-' is supported to indicate ranges, so '0 9-17 * * *' indicates every hour (on the hour) from 9am to 5pm.\n. Long and short month and weekday names are supported (in English)."]}),"\n",(0,t.jsx)(n.p,{children:"Two scheduling modes are currently supported:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"SchedulerMode.ExactlyOncePerInterval"}),": The workflow execution schedule begins when the decorated function is first deployed and activated.  If the application is deactivated, missed executions will be started when the application is reactivated, such that the workflow is executed exactly once per scheduled interval (starting from when the function is first deployed)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.em,{children:"SchedulerMode.ExactlyOncePerIntervalWhenActive"}),": Similar to ",(0,t.jsx)(n.code,{children:"ExactlyOncePerInterval"}),", except that any workflow executions that would have occurred when the application is inactive are not made up."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"@Scheduled"})," decorator's configuration object is:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export class SchedulerConfig {\n    crontab : string = '* * * * *'; // Every minute by default\n    mode ?: SchedulerMode = SchedulerMode.ExactlyOncePerInterval; // How to treat intervals\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"The decorated method must take a Workflow context argument, and the following additional parameters:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The time that the run was scheduled (as a ",(0,t.jsx)(n.code,{children:"Date"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["The time that the run was actually started (as a ",(0,t.jsx)(n.code,{children:"Date"}),").  This can be used to tell if an exactly-once workflow is was started behind schedule."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { Scheduled } from \"@dbos-inc/dbos-sdk\";\n\nclass ScheduledExample{\n  @Scheduled({crontab: '*/5 * * * * *', mode: SchedulerMode.ExactlyOncePerIntervalWhenActive})\n  @Workflow()\n  static async scheduledFunc(ctxt: WorkflowContext, schedTime: Date, startTime: Date) {\n    ctxt.logger.info(`\n        Running a workflow every 5 seconds -\n          scheduled time: ${schedTime.toISOString()} /\n          actual start time: ${startTime.toISOString()}\n    `);\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"crontab-specification",children:[(0,t.jsx)(n.code,{children:"crontab"})," Specification"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"crontab"})," format is based on the well-known format used in the ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Cron",children:(0,t.jsx)(n.code,{children:"cron"})})," scheduler."]}),"\n",(0,t.jsx)(n.p,{children:"The crontab field contains 5 or 6 items, separated by spaces:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:" \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 second (optional)\n \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute\n \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour\n \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of month\n \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500 month\n \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500 day of week\n \u2502 \u2502 \u2502 \u2502 \u2502 \u2502\n \u2502 \u2502 \u2502 \u2502 \u2502 \u2502\n * * * * * *\n"})}),"\n",(0,t.jsx)(n.h4,{id:"second-field-format",children:"Second Field Format"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,t.jsx)(n.p,{children:"Each 'number' is in the range [0-59].  The range of 'divisor' is [2-59]."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"*"})," is interpreted as [0-59]."]}),"\n",(0,t.jsx)(n.h4,{id:"minute-field-format",children:"Minute Field Format:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,t.jsx)(n.p,{children:"Each 'number' is in the range [0-59].  The range of 'divisor' is [2-59]."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"*"})," is interpreted as [0-59]."]}),"\n",(0,t.jsx)(n.h4,{id:"hour-field-format",children:"Hour Field Format:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,t.jsx)(n.p,{children:"Each 'number' is in the range [0-23].  The range of 'divisor' is [2-23]."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"*"})," is interpreted as [0-23]."]}),"\n",(0,t.jsx)(n.h4,{id:"day-of-month-field-format",children:"Day Of Month Field Format"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,t.jsx)(n.p,{children:"Each 'number' is in the range [1-31].  The range of 'divisor' is [2-31]."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"*"})," is interpreted as [1-31]."]}),"\n",(0,t.jsx)(n.h4,{id:"month-field-format",children:"Month Field Format"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,t.jsx)(n.p,{children:"Each 'number' is in the range [1-12].  The range of 'divisor' is [2-12]."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"*"})," is interpreted as [1-12]."]}),"\n",(0,t.jsx)(n.p,{children:"The following symbolic names can be placed instead of numbers, and are case-insensitive:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"'january',   'jan' -> 1\n'february',  'feb' -> 2\n'march',     'mar' -> 3\n'april',     'apr' -> 4\n'may',       'may' -> 5\n'june',      'jun' -> 6\n'july',      'jul' -> 7\n'august',    'aug' -> 8\n'september', 'sep' -> 9\n'october',   'oct' -> 10\n'november',  'nov' -> 11\n'december',  'dec' -> 12\n"})}),"\n",(0,t.jsx)(n.h4,{id:"day-of-week-field-format",children:"Day Of Week Field Format"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,t.jsx)(n.p,{children:"Each 'number' is in the range [0-7], with 0 and 7 both corresponding to Sunday.  The range of 'divisor' is [2-7]."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"*"})," is interpreted as [0-6]."]}),"\n",(0,t.jsx)(n.p,{children:"The following symbolic names can be placed instead of numbers, and are case-insensitive:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"'sunday',    'sun' -> 0\n'monday',    'mon' -> 1\n'tuesday',   'tue' -> 2\n'wednesday', 'wed' -> 3\n'thursday',  'thu' -> 4\n'friday',    'fri' -> 5\n'saturday'   'sat' -> 6\n"})}),"\n",(0,t.jsx)(n.h4,{id:"matching",children:"Matching"}),"\n",(0,t.jsx)(n.p,{children:"For a scheduled workflow to run at a given time, the time must match the crontab pattern.\nA time matches the pattern if all fields of the time match the pattern.\nEach field matches the pattern if its numerical value is within any of the inclusive ranges provided in the field, and is also divisible by the divisor."}),"\n",(0,t.jsx)(n.h3,{id:"openapi-decorators",children:"OpenAPI Decorators"}),"\n",(0,t.jsxs)(n.p,{children:["DBOS can generate an ",(0,t.jsx)(n.a,{href:"https://spec.openapis.org/oas/v3.0.3",children:"OpenAPI 3.0.3"})," interface description for an application."]}),"\n",(0,t.jsx)(n.h4,{id:"openapisecurityscheme",children:(0,t.jsx)(n.code,{children:"@OpenApiSecurityScheme"})}),"\n",(0,t.jsxs)(n.p,{children:["This decorator is used to declare an ",(0,t.jsx)(n.a,{href:"https://spec.openapis.org/oas/v3.0.3#security-scheme-object",children:"OpenAPI security scheme"})," for the handler functions in a class.\nThis decorator takes a single parameter defining the security scheme as per the OpenAPI specification.\nThis decorator is purely declarative for the purpose of inclusion in the generated interface description.\nYou still need to implement authentication as per the ",(0,t.jsx)(n.a,{href:"../tutorials/authentication-authorization",children:"Authentication and Authorization tutorial"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["DBOS does not support the ",(0,t.jsx)(n.code,{children:"oauth2"})," OpenAPI security scheme at this time."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@OpenApiSecurityScheme({ type: 'http', scheme: 'bearer' })\n@Authentication(authMiddleware)\nexport class Operations {\n  @GetApi(\"/post/:id\")\n  static async getPost(ctx: TransactionContext, @ArgSource(ArgSources.URL) id: string) {\n    ...\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"other-decorators",children:"Other Decorators"}),"\n",(0,t.jsx)(n.h4,{id:"typeorm-decorators",children:"TypeORM Decorators"}),"\n",(0,t.jsx)(n.h5,{id:"ormentities",children:(0,t.jsx)(n.code,{children:"@OrmEntities"})}),"\n",(0,t.jsxs)(n.p,{children:["Marks a class as using ORM entity classes.   (Currently this is used for ",(0,t.jsx)(n.a,{href:"https://typeorm.io",children:"TypeORM"})," integration only.)"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@OrmEntities([OrmEntity1, OrmEntity2])\nexport class User {}\n"})}),"\n",(0,t.jsx)(n.p,{children:"This code will ensure that the TypeORM entity manager and repository knows about the entities in the list."})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>o,a:()=>s});var t=r(7294);const i={},a=t.createContext(i);function s(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);