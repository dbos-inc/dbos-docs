"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[919],{452:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var r=n(5893),s=n(1151);const a={sidebar_position:2,title:"Programming Quickstart - Part 1"},o=void 0,i={id:"getting-started/quickstart-programming-1",title:"Programming Quickstart - Part 1",description:"Now that we have an application up and running, let's learn how to program in DBOS!",source:"@site/docs/getting-started/quickstart-programming-1.md",sourceDirName:"getting-started",slug:"/getting-started/quickstart-programming-1",permalink:"/getting-started/quickstart-programming-1",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Programming Quickstart - Part 1"},sidebar:"tutorialSidebar",previous:{title:"DBOS SDK Quickstart",permalink:"/getting-started/quickstart"},next:{title:"Programming Quickstart - Part 2",permalink:"/getting-started/quickstart-programming-2"}},c={},l=[{value:"Hello, Database!",id:"hello-database",level:3},{value:"Adding Another Function",id:"adding-another-function",level:3},{value:"Trying it Out",id:"trying-it-out",level:3}];function d(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"Now that we have an application up and running, let's learn how to program in DBOS!"}),"\n",(0,r.jsx)(t.h3,{id:"hello-database",children:"Hello, Database!"}),"\n",(0,r.jsxs)(t.p,{children:["Let's look at the code we have so far (in ",(0,r.jsx)(t.code,{children:"src/operations.ts"}),').\nThis "Hello, Database!" program greets users and tracks the count of greetings per user:']}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"import { TransactionContext, Transaction, GetApi, ArgSource, ArgSources } from '@dbos-inc/dbos-sdk'\nimport { Knex } from 'knex';\n\n// The schema of the database table used in this example.\nexport interface dbos_hello {\n  name: string;\n  greet_count: number;\n}\n\nexport class Hello {\n\n  @GetApi('/greeting/:user') // Serve this function from HTTP GET requests to the /greeting endpoint with 'user' as a path parameter\n  @Transaction()  // Run this function as a database transaction\n  static async helloTransaction(ctxt: TransactionContext<Knex>, @ArgSource(ArgSources.URL) user: string) {\n    // Retrieve and increment the number of times this user has been greeted.\n    const query = \"INSERT INTO dbos_hello (name, greet_count) VALUES (?, 1) ON CONFLICT (name) DO UPDATE SET greet_count = dbos_hello.greet_count + 1 RETURNING greet_count;\"\n    const { rows } = await ctxt.client.raw(query, [user]) as { rows: dbos_hello[] };\n    const greet_count = rows[0].greet_count;\n    return `Hello, ${user}! You have been greeted ${greet_count} times.\\n`;\n  }\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["This starter code has a single function, ",(0,r.jsx)(t.code,{children:"helloTransaction"}),", which retrieves and updates a user's greeting count.\nThis function is annotated with three ",(0,r.jsx)(t.em,{children:"decorators"}),": the method decorators ",(0,r.jsx)(t.a,{href:"../api-reference/decorators#getapi",children:(0,r.jsx)(t.code,{children:"@GetApi"})})," and  ",(0,r.jsx)(t.a,{href:"../api-reference/decorators#transaction",children:(0,r.jsx)(t.code,{children:"@Transaction"})}),", and the parameter decorator ",(0,r.jsx)(t.a,{href:"../api-reference/decorators#argsource",children:(0,r.jsx)(t.code,{children:"@ArgSource(ArgSources.URL)"})}),".\nDecorators tell DBOS to give a function or parameter special properties:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"@Transaction()"})," tells DBOS to run this function as a ",(0,r.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Database_transaction",children:"database transaction"}),".\nDBOS supplies transactions with a ",(0,r.jsx)(t.a,{href:"../api-reference/contexts#transactioncontextt",children:(0,r.jsx)(t.code,{children:"TransactionContext"})}),", which exposes a database client.\nTo learn more about database operations and transactions in DBOS, see ",(0,r.jsx)(t.a,{href:"../tutorials/transaction-tutorial",children:"our guide"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"@GetApi('/greeting/:user')"})," tells DBOS to serve this function from HTTP GET requests to the ",(0,r.jsx)(t.code,{children:"/greeting"})," endpoint."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"@ArgSource(ArgSources.URL)"})," tells DBOS to parse this function's ",(0,r.jsx)(t.code,{children:"user"})," parameter from the ",(0,r.jsx)(t.code,{children:":user"})," path parameter in the URL."]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["To learn more about HTTP endpoints and handlers, see ",(0,r.jsx)(t.a,{href:"../tutorials/http-serving-tutorial",children:"our guide"}),"."]}),"\n",(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsxs)(t.p,{children:["In this quickstart, we write our database operations in raw SQL (using ",(0,r.jsx)(t.a,{href:"https://knexjs.org/guide/raw.html",children:"knex.raw"}),") to make them easy to follow, but we also support ",(0,r.jsx)(t.a,{href:"https://knexjs.org/guide/query-builder.html",children:"knex's query builder"})," and the popular TypeScript ORMs ",(0,r.jsx)(t.a,{href:"https://www.prisma.io/",children:"Prisma"})," and ",(0,r.jsx)(t.a,{href:"https://typeorm.io/",children:"TypeORM"}),"."]})}),"\n",(0,r.jsx)(t.h3,{id:"adding-another-function",children:"Adding Another Function"}),"\n",(0,r.jsx)(t.p,{children:"Let's add a new function that lets users clear their greeting count.\nWe'll write another function and annotate it with decorators:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"import { PostApi } from '@dbos-inc/dbos-sdk' // Add this to your imports.\n\n@PostApi('/clear/:user') // Serve this function from HTTP POST requests to the /clear endpoint with 'user' as a path parameter\n@Transaction() // Run this function as a database transaction\nstatic async clearTransaction(ctxt: TransactionContext<Knex>, @ArgSource(ArgSources.URL) user: string) {\n  // Delete the database entry for a user.\n  await ctxt.client.raw(\"DELETE FROM dbos_hello WHERE NAME = ?\", [user]);\n  return `Cleared greet_count for ${user}!\\n`;\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Add this function as a method of the ",(0,r.jsx)(t.code,{children:"Hello"})," class.\nThis new function works similarly to ",(0,r.jsx)(t.code,{children:"helloTransaction"}),".\nThe  ",(0,r.jsx)(t.a,{href:"../api-reference/decorators#transaction",children:(0,r.jsx)(t.code,{children:"@Transaction"})})," decorator tells DBOS to run it as a database transaction.\nThe ",(0,r.jsx)(t.a,{href:"../api-reference/decorators#postapi",children:(0,r.jsx)(t.code,{children:"@PostApi"})})," decorator tells DBOS to serve this function from HTTP POST requests to the ",(0,r.jsx)(t.code,{children:"/clear"})," endpoint."]}),"\n",(0,r.jsxs)(t.admonition,{type:"tip",children:[(0,r.jsxs)(t.p,{children:["It is not necessary to put all DBOS functions in one ",(0,r.jsx)(t.code,{children:"operations.ts"})," file; it is also possible to export them:"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"// Placed in operations.ts:\nexport { OperationClass1, OperationClass2 } from './FileA';\nexport { OperationClass3 } from './operations/FileB';\n"})})]}),"\n",(0,r.jsx)(t.h3,{id:"trying-it-out",children:"Trying it Out"}),"\n",(0,r.jsx)(t.p,{children:"Now, let's see if this works!\nFirst, build and start the application:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"npm run build\nnpx dbos-sdk start\n"})}),"\n",(0,r.jsx)(t.p,{children:"With the application running, we can query it and observe the greeting count being incremented with each query:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"curl http://localhost:3000/greeting/dbos\n"})}),"\n",(0,r.jsx)(t.p,{children:"Then, clear the greeting count and ask for another greeting:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"curl -X POST http://localhost:3000/clear/dbos\ncurl http://localhost:3000/greeting/dbos\n"})}),"\n",(0,r.jsx)(t.p,{children:"The greeting count should reset back to 1."}),"\n",(0,r.jsx)(t.p,{children:"If you've gotten this far, congratulations on writing your first DBOS function!\nMove on to the next part to learn how to use more complex DBOS features, like reliable workflows."})]})}function h(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>i,a:()=>o});var r=n(7294);const s={},a=r.createContext(s);function o(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);