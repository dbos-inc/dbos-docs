"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[455],{1459:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"typescript/tutorials/scheduled-workflows","title":"Scheduling Workflows","description":"You can schedule DBOS workflows to run on a cron schedule.","source":"@site/docs/typescript/tutorials/scheduled-workflows.md","sourceDirName":"typescript/tutorials","slug":"/typescript/tutorials/scheduled-workflows","permalink":"/typescript/tutorials/scheduled-workflows","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":60,"frontMatter":{"sidebar_position":60,"title":"Scheduling Workflows"},"sidebar":"tutorialSidebar","previous":{"title":"Workflow Management","permalink":"/typescript/tutorials/workflow-management"},"next":{"title":"Kafka & SQS Integration","permalink":"/typescript/tutorials/externalmessages"}}');var c=s(4848),r=s(8453);const o={sidebar_position:60,title:"Scheduling Workflows"},a=void 0,i={},l=[{value:"Managing Schedules",id:"managing-schedules",level:3},{value:"Backfilling and Triggering",id:"backfilling-and-triggering",level:3},{value:"Managing Schedules from Another Application",id:"managing-schedules-from-another-application",level:3},{value:"How Scheduling Works",id:"how-scheduling-works",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.p,{children:["You can schedule DBOS ",(0,c.jsx)(n.a,{href:"/typescript/tutorials/workflow-tutorial",children:"workflows"})," to run on a cron schedule.\nSchedules are stored in the database and can be created, paused, resumed, and deleted at runtime."]}),"\n",(0,c.jsxs)(n.p,{children:["To schedule a workflow, first define a workflow that takes two arguments: a ",(0,c.jsx)(n.code,{children:"Date"})," (the scheduled execution time) and a context object:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"async function myPeriodicTask(scheduledTime: Date, context: unknown) {\n    DBOS.logger.info(`Running task scheduled for ${scheduledTime} with context ${context}`);\n}\nconst myPeriodicTaskWorkflow = DBOS.registerWorkflow(myPeriodicTask);\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Then, create a schedule for it using ",(0,c.jsx)(n.a,{href:"/typescript/reference/methods#dboscreateschedule",children:(0,c.jsx)(n.code,{children:"DBOS.createSchedule"})})," with a ",(0,c.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Cron",children:"crontab"})," expression:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'await DBOS.createSchedule({\n    scheduleName: "my-task-schedule", // The schedule name is a unique identifier of the schedule\n    workflowFn: myPeriodicTaskWorkflow,\n    schedule: "*/5 * * * *",  // Every 5 minutes\n    context: "my context", // The context is passed into every iteration of the workflow\n});\n'})}),"\n",(0,c.jsxs)(n.p,{children:["Note that ",(0,c.jsx)(n.code,{children:"DBOS.createSchedule"})," will fail if the schedule already exists.\nIf you're defining a set of static schedules to be created on program start, you can instead use ",(0,c.jsx)(n.code,{children:"DBOS.applySchedules"})," to create them atomically, updating them if they already exist:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'await DBOS.applySchedules([\n    {\n        scheduleName: "schedule-a",\n        workflowFn: workflowA,\n        schedule: "*/10 * * * *",  // Every 10 minutes\n        context: "context-a",\n    },\n    {\n        scheduleName: "schedule-b",\n        workflowFn: workflowB,\n        schedule: "0 0 * * *",  // Every day at midnight\n        context: "context-b",\n    },\n]);\n'})}),"\n",(0,c.jsxs)(n.p,{children:["To learn more about crontab syntax, see ",(0,c.jsx)(n.a,{href:"https://docs.gitlab.com/ee/topics/cron/",children:"this guide"})," or ",(0,c.jsx)(n.a,{href:"https://crontab.guru/",children:"this crontab editor"}),".\nValid cron schedules contain 5 or 6 items, separated by spaces:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:" \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 second (optional)\n \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute\n \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour\n \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of month\n \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500 month\n \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500 day of week\n \u2502 \u2502 \u2502 \u2502 \u2502 \u2502\n \u2502 \u2502 \u2502 \u2502 \u2502 \u2502\n * * * * * *\n"})}),"\n",(0,c.jsx)(n.p,{children:"You can dynamically create many schedules for the same workflow.\nFor example, if you want to perform certain actions periodically for each of your customers, you can create one schedule per customer, using customer ID as context so each workflow knows which customer to act on:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'async function customerWorkflow(scheduledTime: Date, customerId: string) {\n    // ...\n}\nconst customerWorkflowFn = DBOS.registerWorkflow(customerWorkflow);\n\nasync function onCustomerRegistration(customerId: string) {\n    await DBOS.createSchedule({\n        scheduleName: `customer-${customerId}-sync`,\n        workflowFn: customerWorkflowFn,\n        schedule: "0 * * * *",  // Every hour\n        context: customerId,\n    });\n}\n'})}),"\n",(0,c.jsxs)(n.p,{children:["Note that scheduling is not supported for workflows that are methods on ",(0,c.jsx)(n.a,{href:"/typescript/tutorials/instantiated-objects",children:"instantiated objects"}),". Scheduled workflows should be free functions or static class methods."]}),"\n",(0,c.jsx)(n.h3,{id:"managing-schedules",children:"Managing Schedules"}),"\n",(0,c.jsx)(n.p,{children:"You can pause, resume, and delete schedules at runtime:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'// Pause a schedule so it stops firing\nawait DBOS.pauseSchedule("my-task-schedule");\n\n// Resume a paused schedule\nawait DBOS.resumeSchedule("my-task-schedule");\n\n// Delete a schedule\nawait DBOS.deleteSchedule("my-task-schedule");\n'})}),"\n",(0,c.jsx)(n.p,{children:"You can also list and inspect schedules:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'// List all active schedules\nconst schedules = await DBOS.listSchedules({ status: "ACTIVE" });\n\n// Get a specific schedule by name\nconst schedule = await DBOS.getSchedule("my-task-schedule");\n'})}),"\n",(0,c.jsx)(n.h3,{id:"backfilling-and-triggering",children:"Backfilling and Triggering"}),"\n",(0,c.jsxs)(n.p,{children:["If a schedule was paused or your application was offline, you can backfill missed executions using ",(0,c.jsx)(n.a,{href:"/typescript/reference/methods#dbosbackfillschedule",children:(0,c.jsx)(n.code,{children:"DBOS.backfillSchedule"})}),".\nAlready-executed times are automatically skipped:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'await DBOS.backfillSchedule(\n    "my-task-schedule",\n    new Date("2025-01-01T00:00:00Z"),\n    new Date("2025-01-02T00:00:00Z"),\n);\n'})}),"\n",(0,c.jsxs)(n.p,{children:["You can also immediately trigger a schedule using ",(0,c.jsx)(n.a,{href:"/typescript/reference/methods#dbostriggerschedule",children:(0,c.jsx)(n.code,{children:"DBOS.triggerSchedule"})}),":"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'const handle = await DBOS.triggerSchedule("my-task-schedule");\n'})}),"\n",(0,c.jsx)(n.h3,{id:"managing-schedules-from-another-application",children:"Managing Schedules from Another Application"}),"\n",(0,c.jsxs)(n.p,{children:["You can manage schedules from outside your DBOS application using the ",(0,c.jsx)(n.a,{href:"/typescript/reference/client#workflow-schedules",children:"DBOS Client"}),".\nThe client accepts workflow names as strings instead of function references:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:'import { DBOSClient } from "@dbos-inc/dbos-sdk";\n\nconst client = await DBOSClient.create({ systemDatabaseUrl: process.env.DBOS_SYSTEM_DATABASE_URL });\n\nawait client.createSchedule({\n    scheduleName: "my-task-schedule",\n    workflowName: "myPeriodicTask",\n    schedule: "*/5 * * * *",\n    context: "my context",\n});\n'})}),"\n",(0,c.jsx)(n.h3,{id:"how-scheduling-works",children:"How Scheduling Works"}),"\n",(0,c.jsxs)(n.p,{children:["Under the hood, DBOS constructs an ",(0,c.jsx)(n.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"idempotency key"})," for each scheduled workflow execution.\nThe key is a concatenation of the schedule name and the scheduled time, ensuring each scheduled invocation occurs exactly once while your application is active."]}),"\n",(0,c.jsxs)(n.p,{children:["For the full API reference, see ",(0,c.jsx)(n.a,{href:"/typescript/reference/methods#workflow-schedules",children:"Workflow Schedules"}),"."]}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h1,{id:"static-scheduling-deprecated",children:"Static Scheduling (Deprecated)"}),"\n",(0,c.jsxs)(n.p,{children:["You can use the ",(0,c.jsx)(n.a,{href:"/typescript/reference/workflows-steps#dbosregisterscheduled",children:(0,c.jsx)(n.code,{children:"DBOS.registerScheduled"})})," method or the ",(0,c.jsx)(n.a,{href:"/typescript/reference/workflows-steps#dbosscheduled",children:(0,c.jsx)(n.code,{children:"DBOS.scheduled"})})," decorator, specifying a schedule in ",(0,c.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Cron",children:"crontab"})," syntax, to schedule a workflow to run exactly once per time interval."]}),"\n",(0,c.jsx)(n.p,{children:"For example:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"async function scheduledFunction(schedTime: Date, startTime: Date) {\n    DBOS.logger.info(`I am a workflow scheduled to run every 30 seconds`);\n}\n\nconst scheduledWorkflow = DBOS.registerWorkflow(scheduledFunction);\nDBOS.registerScheduled(scheduledWorkflow, {crontab: '*/30 * * * * *'});\n"})}),"\n",(0,c.jsx)(n.p,{children:"Or using decorators:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"class ScheduledExample{\n  @DBOS.workflow()\n  @DBOS.scheduled({crontab: '*/30 * * * * *'})\n  static async scheduledWorkflow(schedTime: Date, startTime: Date) {\n    DBOS.logger.info(`I am a workflow scheduled to run every 30 seconds`);\n  }\n}\n"})}),"\n",(0,c.jsxs)(n.p,{children:["Scheduled workflows must take in exactly two arguments: the time that the run was scheduled (as a ",(0,c.jsx)(n.code,{children:"Date"}),") and the time the run was actually started (as a ",(0,c.jsx)(n.code,{children:"Date"}),")."]}),"\n",(0,c.jsxs)(n.p,{children:["Sometimes, you may require a scheduled workflow run ",(0,c.jsx)(n.strong,{children:"exactly once"})," per interval, even if the application was offline when it should have run.\nFor example, if your workflow is supposed to run every Friday at 9 PM UTC, but your application is offline for maintenance one Friday, you may want the workflow to launch as soon as your application is restarted.\nYou can configure this behavior in the ",(0,c.jsx)(n.code,{children:"DBOS.scheduled"})," decorator:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-typescript",children:"    @DBOS.scheduled({mode: SchedulerMode.ExactlyOncePerInterval, crontab: '...'})\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(6540);const c={},r=t.createContext(c);function o(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);