"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[8109],{488:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"self-hosting/self-hosting","title":"Self-Hosting DBOS Apps","description":"Because DBOS is implemented in lightweight TypeScript and Python libraries, you can run your DBOS application anywhere as long as it has a Postgres server to connect to.","source":"@site/docs/self-hosting/self-hosting.md","sourceDirName":"self-hosting","slug":"/self-hosting/","permalink":"/self-hosting/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Self-Hosting DBOS Apps"},"sidebar":"tutorialSidebar","previous":{"title":"Cloud CLI Reference","permalink":"/cloud-tutorials/cloud-cli"},"next":{"title":"Supabase","permalink":"/integrations/supabase"}}');var r=s(4848),i=s(8453);const t={sidebar_position:1,title:"Self-Hosting DBOS Apps"},l=void 0,a={},c=[{value:"Self-Hosting On A Single Server",id:"self-hosting-on-a-single-server",level:2},{value:"Self-Hosting on Multiple Servers",id:"self-hosting-on-multiple-servers",level:2},{value:"Managing Application versions",id:"managing-application-versions",level:2},{value:"Admin API Reference",id:"admin-api-reference",level:2},{value:"Health Check",id:"health-check",level:3},{value:"Workflow Recovery",id:"workflow-recovery",level:3},{value:"Deactivate",id:"deactivate",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Because DBOS is implemented in lightweight TypeScript and Python libraries, you can ",(0,r.jsx)(n.strong,{children:"run your DBOS application anywhere"})," as long as it has a Postgres server to connect to.\nDBOS runs entirely inside your process, executing your workflows and recording their state in Postgres.\nBy default, when your process restarts, DBOS recovers all its pending workflows.\nHowever, care must be taken when upgrading your application's code or when managing many DBOS processes at scale to ensure all your workflows are efficiently recovered."]}),"\n",(0,r.jsx)(n.p,{children:"This guide will describe best practices for self-hosting an application that uses the open-source DBOS libraries, explaining how to manage workflow recovery both when operating on a single server and when operating at scale."}),"\n",(0,r.jsx)(n.h2,{id:"self-hosting-on-a-single-server",children:"Self-Hosting On A Single Server"}),"\n",(0,r.jsxs)(n.p,{children:["Self-hosting a DBOS application on a single server is simple: each time you restart your application's process, it recovers all workflows that were executing before the restart (all ",(0,r.jsx)(n.code,{children:"PENDING"})," workflows)."]}),"\n",(0,r.jsx)(n.h2,{id:"self-hosting-on-multiple-servers",children:"Self-Hosting on Multiple Servers"}),"\n",(0,r.jsxs)(n.p,{children:["When self-hosting in a distributed setting, it is important to manage workflow recovery so that when an executor crashes, restarts, or is shut down, its workflows are recovered.\nYou should assign each executor running a DBOS application an executor ID by setting the ",(0,r.jsx)(n.code,{children:"DBOS__VMID"})," environment variable.\nEach workflow is tagged with the ID of the executor that started it.\nWhen an application with an executor ID restarts, it only recovers pending workflows assigned to that executor ID.\nYou can also instruct your executor to recover workflows assigned to other executor IDs through the ",(0,r.jsx)(n.a,{href:"#workflow-recovery",children:"workflow recovery endpoint of the admin API"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"managing-application-versions",children:"Managing Application versions"}),"\n",(0,r.jsxs)(n.p,{children:["When self-hosting, it is important to be careful when upgrading your application's code.\nWhen DBOS is launched, it computes an \"application version\" from a checksum of the code in your application's workflows (you can override this version through the ",(0,r.jsx)(n.code,{children:"DBOS__APPVERSION"})," environment variable).\nEach workflow is tagged with the version of the application that started it.\nTo prevent code compatibility issues, DBOS does not attempt to recover workflows tagged with a different application version."]}),"\n",(0,r.jsxs)(n.p,{children:["To safely recover workflows started on an older version of your code, you should start a process running that code version.\nIf self-hosting on a single server, that process will automatically recover all pending workflows of that code version.\nIf self-hosting in a distributed setting, you should use the ",(0,r.jsx)(n.a,{href:"#workflow-recovery",children:"workflow recovery endpoint of the admin API"})," to instruct that process to recover workflows belonging to executors that ran old code versions."]}),"\n",(0,r.jsx)(n.h2,{id:"admin-api-reference",children:"Admin API Reference"}),"\n",(0,r.jsx)(n.p,{children:"DBOS applications expose an admin API on port 3001.\nIt provides the following endpoints:"}),"\n",(0,r.jsx)(n.h3,{id:"health-check",children:"Health Check"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Endpoint"}),": ",(0,r.jsx)(n.code,{children:"/dbos-healthz"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"HTTP Method"}),": GET"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Description"}),": Performs a health check on the application."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Response"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status Code"}),": 200 OK if the system is healthy; otherwise, appropriate error codes."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"workflow-recovery",children:"Workflow Recovery"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Endpoint"}),": ",(0,r.jsx)(n.code,{children:"/dbos-workflow-recovery"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Method"}),": POST"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Description"}),": Recover all pending workflows associated with input ",(0,r.jsx)(n.a,{href:"#self-hosting-on-multiple-servers",children:"executor IDs"}),". Returns the IDs of all workflows queued for recovery."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Request Body Format"}),": JSON list of executors whose pending workflows to recover.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Example"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'["executor-id-1", "executor-id-2", "..."]\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Response"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status Code"}),": 200 OK on successful recovery initiation; otherwise, appropriate error codes."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Body Format"}),": JSON list of the IDs of workflows queued for recovery."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Example"}),":","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'["workflow-uuid-1", "workflow-uuid-2", "..."]\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"deactivate",children:"Deactivate"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Endpoint"}),": ",(0,r.jsx)(n.code,{children:"/deactivate"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Method"}),": GET"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Description"}),": Deactivate an executor. A deactivated executor may complete active workflows and recover ",(0,r.jsx)(n.code,{children:"PENDING"})," workflows, but may not start new workflows or dequeue workflows."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Response"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Status Code"}),": 200 OK if the request succeeeded; otherwise, appropriate error codes."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var o=s(6540);const r={},i=o.createContext(r);function t(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);