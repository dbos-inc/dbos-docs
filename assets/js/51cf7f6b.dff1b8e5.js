"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[2179],{8835:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var r=t(5893),o=t(1151);const s={sidebar_position:1,title:"Application Structure",description:"Learn about the structure of a DBOS application"},i=void 0,a={id:"explanations/application-structure-explanation",title:"Application Structure",description:"Learn about the structure of a DBOS application",source:"@site/docs/explanations/application-structure-explanation.md",sourceDirName:"explanations",slug:"/explanations/application-structure-explanation",permalink:"/explanations/application-structure-explanation",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Application Structure",description:"Learn about the structure of a DBOS application"},sidebar:"tutorialSidebar",previous:{title:"Concepts and Explanations",permalink:"/category/concepts-and-explanations"},next:{title:"DBOS Transact Core Concepts",permalink:"/explanations/core-concepts"}},c={},l=[{value:"Directory Structure",id:"directory-structure",level:3},{value:"Code Structure",id:"code-structure",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"In this guide, you'll learn about the structure of a DBOS application."}),"\n",(0,r.jsx)(n.h3,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,r.jsxs)(n.p,{children:["When you initialize a DBOS project with ",(0,r.jsx)(n.code,{children:"npx @dbos-inc/create"}),", it has the following structure:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"dbos-hello-app/\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 dbos-config.yaml\n\u251c\u2500\u2500 jest.config.js\n\u251c\u2500\u2500 knexfile.js\n\u251c\u2500\u2500 migrations/\n\u251c\u2500\u2500 node_modules/\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 package-lock.json\n\u251c\u2500\u2500 src/\n\u2502   |\u2500\u2500 operations.ts\n\u2502   \u2514\u2500\u2500 operations.test.ts\n\u251c\u2500\u2500 start_postgres_docker.sh\n\u2514\u2500\u2500 tsconfig.json\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The two most important files in a DBOS project are ",(0,r.jsx)(n.code,{children:"dbos-config.yaml"})," and ",(0,r.jsx)(n.code,{children:"src/operations.ts"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"dbos-config.yaml"})," defines the configuration of a DBOS project, including database connection information, migration configuration, and global logging configuration.\nAll options are documented in our ",(0,r.jsx)(n.a,{href:"../api-reference/configuration",children:"configuration reference"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"src/operations.ts"})," is the ",(0,r.jsx)(n.em,{children:"entrypoint"}),", where DBOS looks for your code.\nAt startup, the DBOS runtime automatically loads all classes exported from this file, serving their endpoints and registering their decorated functions.\nMore precisely, DBOS assumes your compiled code is exported from ",(0,r.jsx)(n.code,{children:"dist/operations.js"}),", the default location to which ",(0,r.jsx)(n.code,{children:"src/operations.ts"})," is compiled.\nIf you're writing a small application, you can write all your code directly in this file.\nIn a larger application, you can write your code wherever you want, but should use ",(0,r.jsx)(n.code,{children:"src/operations.ts"})," as an index file, exporting code written elsewhere:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Placed in operations.ts:\nexport { OperationClass1, OperationClass2 } from './FileA';\nexport { OperationClass3 } from './operations/FileB';\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can also configure a list of entrypoints using the ",(0,r.jsx)(n.code,{children:"runtimeConfig"})," section of the ",(0,r.jsx)(n.a,{href:"../api-reference/configuration#runtime",children:"configuration"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"As for the rest of the directory:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"src/operations.test.ts"})," contains example unit tests written with ",(0,r.jsx)(n.a,{href:"https://jestjs.io/",children:"Jest"})," and our ",(0,r.jsx)(n.a,{href:"/tutorials/testing-tutorial",children:"testing runtime"}),". ",(0,r.jsx)(n.code,{children:"jest.config.js"})," contains Jest configuration."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"knexfile.js"})," is a configuration file for ",(0,r.jsx)(n.a,{href:"https://knexjs.org",children:"Knex"}),", which we use as a query builder and migration tool."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"migrations"})," is initialized with a Knex database migration used in the ",(0,r.jsx)(n.a,{href:"../getting-started/quickstart",children:"quickstart guide"}),".  You can replace this with your own migration files."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"node_modules"}),", ",(0,r.jsx)(n.code,{children:"package.json"}),", ",(0,r.jsx)(n.code,{children:"package-lock.json"}),", and ",(0,r.jsx)(n.code,{children:"tsconfig.json"})," are needed by all Node/Typescript projects."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"start_postgres_docker.sh"})," is a convenience script that initializes a Docker Postgres container for use in the ",(0,r.jsx)(n.a,{href:"../getting-started/quickstart",children:"quickstart"}),". You can modify this script if you want to use Docker-hosted Postgres for local development."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"code-structure",children:"Code Structure"}),"\n",(0,r.jsxs)(n.p,{children:["Here's the initial source code generated by ",(0,r.jsx)(n.code,{children:"npx @dbos-inc/create"})," (in ",(0,r.jsx)(n.code,{children:"src/operations.ts"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"import { TransactionContext, Transaction, GetApi, ArgSource, ArgSources } from '@dbos-inc/dbos-sdk';\nimport { Knex } from 'knex';\n\n// The schema of the database table used in this example.\nexport interface dbos_hello {\n  name: string;\n  greet_count: number;\n}\n\nexport class Hello {\n\n  @GetApi('/greeting/:user') // Serve this function from HTTP GET requests to the /greeting endpoint with 'user' as a path parameter\n  @Transaction()  // Run this function as a database transaction\n  static async helloTransaction(ctxt: TransactionContext<Knex>, @ArgSource(ArgSources.URL) user: string) {\n    // Retrieve and increment the number of times this user has been greeted.\n    const query = \"INSERT INTO dbos_hello (name, greet_count) VALUES (?, 1) ON CONFLICT (name) DO UPDATE SET greet_count = dbos_hello.greet_count + 1 RETURNING greet_count;\";\n    const { rows } = await ctxt.client.raw(query, [user]) as { rows: dbos_hello[] };\n    const greet_count = rows[0].greet_count;\n    return `Hello, ${user}! You have been greeted ${greet_count} times.\\n`;\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["An application like this one is made up of classes encapsulating ",(0,r.jsx)(n.em,{children:"functions"}),", written as decorated static class methods.\nThere are four basic types of functions.\nThis example contains two of them:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../tutorials/transaction-tutorial",children:(0,r.jsx)(n.strong,{children:"Transactions"})}),", like ",(0,r.jsx)(n.code,{children:"helloTransaction"})," perform database operations."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../tutorials/http-serving-tutorial",children:(0,r.jsx)(n.strong,{children:"Handlers"})})," serve HTTP requests. Here, ",(0,r.jsx)(n.code,{children:"helloTransaction"})," also acts as a handler, serving HTTP requests from the ",(0,r.jsx)(n.code,{children:"greeting/:user"})," endpoint."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"There are two more:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../tutorials/communicator-tutorial",children:(0,r.jsx)(n.strong,{children:"Communicators"})})," manage communication with external services and APIs."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../tutorials/workflow-tutorial",children:(0,r.jsx)(n.strong,{children:"Workflows"})})," reliably orchestrate other functions."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"A function needs to follow a few rules:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["It must be a static class method.  For DBOS to find it, that class must be exported from ",(0,r.jsx)(n.code,{children:"src/operations.ts"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["It must have a decorator telling the framework what kind of function it is: ",(0,r.jsx)(n.a,{href:"../api-reference/decorators#transaction",children:(0,r.jsx)(n.code,{children:"@Transaction"})})," for transactions, ",(0,r.jsx)(n.a,{href:"../api-reference/decorators#communicator",children:(0,r.jsx)(n.code,{children:"@Communicator"})})," for communicators, ",(0,r.jsx)(n.a,{href:"../api-reference/decorators#workflow",children:(0,r.jsx)(n.code,{children:"@Workflow"})})," for workflows, or ",(0,r.jsx)(n.a,{href:"../api-reference/decorators#getapi",children:(0,r.jsx)(n.code,{children:"GetApi"})})," or ",(0,r.jsx)(n.a,{href:"../api-reference/decorators#postapi",children:(0,r.jsx)(n.code,{children:"PostApi"})})," for HTTP handlers."]}),"\n",(0,r.jsxs)(n.li,{children:["Its first argument must be the appropriate kind of ",(0,r.jsx)(n.a,{href:"../api-reference/contexts",children:"context"}),". Contexts provide useful methods, such as access to a database client for transactions."]}),"\n",(0,r.jsx)(n.li,{children:"Its input and return types must be serializable to JSON."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Once you've written your functions, there are two basic ways to call them:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Any function (not just handlers) can be called from HTTP if it's annotated with the ",(0,r.jsx)(n.a,{href:"../api-reference/decorators#getapi",children:(0,r.jsx)(n.code,{children:"GetApi"})})," or ",(0,r.jsx)(n.a,{href:"../api-reference/decorators#postapi",children:(0,r.jsx)(n.code,{children:"PostApi"})})," decorators.  See our ",(0,r.jsx)(n.a,{href:"../tutorials/http-serving-tutorial",children:"HTTP serving tutorial"})," for details."]}),"\n",(0,r.jsxs)(n.li,{children:["Handlers and workflows can invoke other functions via their contexts' ",(0,r.jsx)(n.code,{children:"invoke"})," (",(0,r.jsx)(n.a,{href:"../api-reference/contexts#workflowctxtinvoke",children:"workflow"}),", ",(0,r.jsx)(n.a,{href:"../api-reference/contexts#handlerctxtinvoke",children:"handler"}),") method."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["To learn more about each individual type of function and what it can do, see our ",(0,r.jsx)(n.a,{href:"../category/dbos-transact-tutorials/",children:"tutorials"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>i});var r=t(7294);const o={},s=r.createContext(o);function i(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);