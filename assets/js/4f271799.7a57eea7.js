"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[3197],{7424:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var i=s(5893),t=s(1151);const r={sidebar_position:2,title:"Configuration",description:"DBOS configuration reference"},o=void 0,a={id:"api-reference/configuration",title:"Configuration",description:"DBOS configuration reference",source:"@site/docs/api-reference/configuration.md",sourceDirName:"api-reference",slug:"/api-reference/configuration",permalink:"/api-reference/configuration",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Configuration",description:"DBOS configuration reference"},sidebar:"tutorialSidebar",previous:{title:"DBOS Compiler",permalink:"/api-reference/dbos-compiler"},next:{title:"DBOS Contexts",permalink:"/api-reference/contexts"}},l={},c=[{value:"Fields",id:"fields",level:3},{value:"Database",id:"database",level:3},{value:"Runtime",id:"runtime",level:3},{value:"HTTP",id:"http",level:3},{value:"Application",id:"application",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Telemetry",id:"telemetry",level:3},{value:"Logs",id:"logs",level:4},{value:"OTLPExporter",id:"otlpexporter",level:4},{value:"Configuration Schema File",id:"configuration-schema-file",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"You can configure the DBOS Transact runtime with a configuration file.\nValid configuration files must be:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Named ",(0,i.jsx)(n.code,{children:"dbos-config.yaml"})]}),"\n",(0,i.jsx)(n.li,{children:"Located at the application package root."}),"\n",(0,i.jsxs)(n.li,{children:["Valid ",(0,i.jsx)(n.a,{href:"https://yaml.org/",children:"YAML"})," conforming to the schema described below."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["You can use environment variables for configuration values through the syntax ",(0,i.jsx)(n.code,{children:"key: ${VALUE}"}),". They are expanded during ",(0,i.jsx)(n.code,{children:"npx dbos start"})," or ",(0,i.jsx)(n.code,{children:"npx dbos-cloud app deploy"})," and passed to the app securely. We strongly recommend using environment variables for secrets like the database password, as demonstrated below."]})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"fields",children:"Fields"}),"\n",(0,i.jsxs)(n.p,{children:["Each ",(0,i.jsx)(n.code,{children:"dbos-config.yaml"})," file has the following fields and sections:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"language"}),": The application language field. Must be set to ",(0,i.jsx)(n.code,{children:"node"})," for TypeScript applications."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"database"}),": The ",(0,i.jsx)(n.a,{href:"#database",children:"database"})," section."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"runtimeConfig"}),": The ",(0,i.jsx)(n.a,{href:"#runtime",children:"runtime"})," section."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"http"}),": The ",(0,i.jsx)(n.a,{href:"#http",children:"HTTP"})," section."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"application"}),": The ",(0,i.jsx)(n.a,{href:"#application",children:"application configuration"})," section."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"env"}),": The ",(0,i.jsx)(n.a,{href:"#environment-variables",children:"environment variables"})," section."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"telemetry"}),": The ",(0,i.jsx)(n.a,{href:"#telemetry",children:"telemetry"})," section."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"database",children:"Database"}),"\n",(0,i.jsx)(n.p,{children:"The database section is used to set up the connection to the database.\nDBOS currently only supports Postgres-compatible databases.\nEvery field is required unless otherwise specified."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"hostname"}),": Database server hostname. For local deployment only, not used in DBOS Cloud."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"port"}),": Database server port. For local deployment only, not used in DBOS Cloud."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"username"}),": Username with which to connect to the database server. For local deployment only, not used in DBOS Cloud."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"password"}),": Password with which to connect to the database server.  We recommend using an environment variable for this field, instead of plain text. For local deployment only, not used in DBOS Cloud."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"app_db_name"}),": Name of the application database."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"sys_db_name"})," (optional): Name of the system database in which DBOS stores internal state. Defaults to ",(0,i.jsx)(n.code,{children:"{app_db_name}_dbos_sys"}),".  For local deployment only, not used in DBOS Cloud."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"app_db_client"})," (optional): Client to use for connecting to the application database. Must be one of ",(0,i.jsx)(n.code,{children:"knex"}),", ",(0,i.jsx)(n.code,{children:"drizzle"}),", ",(0,i.jsx)(n.code,{children:"typeorm"}),", or ",(0,i.jsx)(n.code,{children:"prisma"}),".  Defaults to ",(0,i.jsx)(n.code,{children:"knex"}),".  The client specified here is the one used in ",(0,i.jsx)(n.a,{href:"../api-reference/contexts#transactioncontextt",children:(0,i.jsx)(n.code,{children:"TransactionContext"})}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ssl_ca"})," (optional): If using SSL/TLS to securely connect to a database, path to an SSL root certificate file.  Equivalent to the ",(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/libpq-ssl.html",children:(0,i.jsx)(n.code,{children:"sslrootcert"})})," connection parameter in ",(0,i.jsx)(n.code,{children:"psql"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"connectionTimeoutMillis"})," (optional): Database connection timeout in milliseconds. Defaults to ",(0,i.jsx)(n.code,{children:"3000"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"migrate"})," (optional): A list of commands to run to apply your application's schema to the database. We recommend using a Typescript-based migration tool like ",(0,i.jsx)(n.a,{href:"/tutorials/using-knex#schema-management",children:"Knex"}),", ",(0,i.jsx)(n.a,{href:"/tutorials/using-drizzle#schema-management",children:"Drizzle"}),", ",(0,i.jsx)(n.a,{href:"/tutorials/using-typeorm#schema-management",children:"TypeORM"}),", or ",(0,i.jsx)(n.a,{href:"/tutorials/using-prisma#schema-management",children:"Prisma"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"rollback"})," (optional) A list of commands to run to roll back the last batch of schema migrations."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"database:\n  hostname: 'localhost'\n  port: 5432\n  username: 'postgres'\n  password: ${PGPASSWORD}\n  app_db_name: 'hello'\n  app_db_client: 'knex'\n  migrate: ['npx knex migrate:latest']\n  rollback: ['npx knex migrate:rollback']\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["The role with which DBOS connects to Postgres must have ",(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/ddl-priv.html#DDL-PRIV-CREATE",children:(0,i.jsx)(n.code,{children:"CREATE"})})," privileges on both the application database and system database if they already exist.\nIf either does not exist, the Postgres role must have the ",(0,i.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/sql-createdatabase.html",children:(0,i.jsx)(n.code,{children:"CREATEDB"})})," privilege to create them."]})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"runtime",children:"Runtime"}),"\n",(0,i.jsx)(n.p,{children:"This section is used to specify DBOS runtime parameters."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"port"})," (optional): The port from which to serve your functions. Defaults to ",(0,i.jsx)(n.code,{children:"3000"}),". Using ",(0,i.jsx)(n.a,{href:"./cli#npx-dbos-start",children:(0,i.jsx)(n.code,{children:"npx dbos start -p <port>"})})," overrides this config parameter."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"entrypoints"})," (optional): The compiled Javascript files where DBOS looks for your application's code. At startup, the DBOS runtime automatically loads all classes exported from these files, serving their endpoints and registering their decorated functions. Defaults to ",(0,i.jsx)(n.code,{children:"[dist/operations.js]"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"runtimeConfig:\n  port: 3000 # (default)\n  entrypoints:\n    - 'dist/operations.js' # (default)\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"http",children:"HTTP"}),"\n",(0,i.jsx)(n.p,{children:"This section is used to specify DBOS HTTP parameters."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"cors_middleware"})," (optional): Whether to allow cross-origin requests (via CORS middleware).  Default is ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"credentials"})," (optional): If ",(0,i.jsx)(n.code,{children:"cors_middleware"})," is enabled, whether to allow cross-origin requests that include credentials.  Default is ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"allowed_origins"})," (optional): If ",(0,i.jsx)(n.code,{children:"cors_middleware"})," is enabled, a list of origins/domains that are permitted to make cross-origin requests.  Default is to allow any origin."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"http:\n  cors_middleware: true\n  credentials: true\n  allowed_origins:\n    - 'https://partner.com'\n    - 'https://app.internal.com'\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"application",children:"Application"}),"\n",(0,i.jsxs)(n.p,{children:["Applications can optionally use the application configuration to define custom properties as key-value pairs.\nThese properties can be retrieved from any ",(0,i.jsx)(n.a,{href:"./contexts",children:"context"})," via the ",(0,i.jsx)(n.a,{href:"../api-reference/contexts#ctxtgetconfig",children:(0,i.jsx)(n.code,{children:"getConfig"})})," method."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"application:\n  PAYMENTS_SERVICE: 'https://stripe.com/payment'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsxs)(n.p,{children:["Applications can optionally use the ",(0,i.jsx)(n.code,{children:"env"})," configuration to define environment variables.\nThese are set in your application before its code is initialized and can be retrieved from ",(0,i.jsx)(n.code,{children:"process.env"})," like any other environment variables.\nFor example, the ",(0,i.jsx)(n.code,{children:"WEB_PORTAL"})," variable set below could be retrieved from an application as ",(0,i.jsx)(n.code,{children:"process.env.WEB_PORTAL"}),".\nEnvironment variables configured here are automatically exported to and set in DBOS Cloud."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"env:\n  WEB_PORTAL: 'https://example.com'\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"telemetry",children:"Telemetry"}),"\n",(0,i.jsx)(n.p,{children:"You can use the configuration file to tune the behavior of DBOS logging facility.\nNote all options in this section are optional and will, if not specified, use the default values indicated in the example below."}),"\n",(0,i.jsx)(n.h4,{id:"logs",children:"Logs"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"logLevel"}),": Filters, by severity, what logs should be printed. Defaults to ",(0,i.jsx)(n.code,{children:"'info'"}),". Using ",(0,i.jsx)(n.a,{href:"./cli#npx-dbos-start",children:(0,i.jsx)(n.code,{children:"npx dbos start -l <logLevel>"})})," overrides this config parameter."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"addContextMetadata"}),": Enables the addition of contextual information, such as workflow identity UUID, to each log entry. Defaults to ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"silent"}),": Silences the logger. Defaults to ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"telemetry:\n  logs:\n    logLevel: 'info' # info (default) | debug | warn | emerg | alert | crit | error\n    addContextMetadata: true # true (default) | false\n    silent: false # false (default) | true\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h4,{id:"otlpexporter",children:"OTLPExporter"}),"\n",(0,i.jsx)(n.p,{children:"Configures the Transact OpenTelemetry exporter."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"logsEndpoint"}),": The endpoint to which logs are sent."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"tracesEndpoint"}),": The endpoint to which traces are sent."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The Transact exporter uses ",(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/@opentelemetry/exporter-trace-otlp-proto",children:"protobuf over HTTP"}),". An example configuration for a local Jaeger instance with default configuration is shown below."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Example"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"telemetry:\n  OTLPExporter:\n    logsEndpoint: 'http://localhost:4318'\n    tracesEndpoint: 'http://localhost:4318'\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configuration-schema-file",children:"Configuration Schema File"}),"\n",(0,i.jsxs)(n.p,{children:["There is a schema file available for the DBOS configuration file schema ",(0,i.jsx)(n.a,{href:"https://raw.githubusercontent.com/dbos-inc/dbos-ts/main/dbos-config.schema.json",children:"in our GitHub repo"}),".\nThis schema file can be used to provide an improved YAML editing experience for developer tools that leverage it.\nFor example, the Visual Studio Code ",(0,i.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml",children:"RedHat YAML extension"})," provides tooltips, statement completion and real-time validation for editing DBOS config files.\nThis extension provides ",(0,i.jsx)(n.a,{href:"https://github.com/redhat-developer/vscode-yaml#associating-schemas",children:"multiple ways"})," to associate a YAML file with its schema.\nThe easiest is to simply add a comment with a link to the schema at the top of the config file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# yaml-language-server: $schema=https://raw.githubusercontent.com/dbos-inc/dbos-ts/main/dbos-config.schema.json\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>o});var i=s(7294);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);