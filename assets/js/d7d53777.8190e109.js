"use strict";(self.webpackChunkoperon_docs=self.webpackChunkoperon_docs||[]).push([[919],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),l=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(p.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=l(n),m=a,g=u["".concat(p,".").concat(m)]||u[m]||d[m]||o;return n?r.createElement(g,i(i({ref:t},c),{},{components:n})):r.createElement(g,i({ref:t},c))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[u]="string"==typeof e?e:a,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2833:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const o={sidebar_position:2,title:"Programming Quickstart - Part 1"},i=void 0,s={unversionedId:"getting-started/quickstart-programming-1",id:"getting-started/quickstart-programming-1",title:"Programming Quickstart - Part 1",description:"Now that we have an application up and running, let's learn how to program in Operon!",source:"@site/docs/getting-started/quickstart-programming-1.md",sourceDirName:"getting-started",slug:"/getting-started/quickstart-programming-1",permalink:"/getting-started/quickstart-programming-1",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Programming Quickstart - Part 1"},sidebar:"tutorialSidebar",previous:{title:"Operon Quickstart",permalink:"/getting-started/quickstart"},next:{title:"Programming Quickstart - Part 2",permalink:"/getting-started/quickstart-programming-2"}},p={},l=[{value:"Hello, Database!",id:"hello-database",level:3},{value:"Adding Another Function",id:"adding-another-function",level:3},{value:"Trying it Out",id:"trying-it-out",level:3}],c={toc:l},u="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(u,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Now that we have an application up and running, let's learn how to program in Operon!"),(0,a.kt)("h3",{id:"hello-database"},"Hello, Database!"),(0,a.kt)("p",null,"Let's look at the code we have so far (in ",(0,a.kt)("inlineCode",{parentName:"p"},"src/operations.ts"),').\nThis "Hello, Database!" program greets users and tracks the count of greetings per user:'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { TransactionContext, OperonTransaction, GetApi } from '@dbos-inc/operon'\nimport { Knex } from 'knex';\n\n// The schema of the database table used in this example.\nexport interface operon_hello {\n  name: string;\n  greet_count: number;\n}\n\nexport class Hello {\n\n  @GetApi('/greeting/:user') // Serve this function from HTTP GET requests to the /greeting endpoint with 'user' as a path parameter\n  @OperonTransaction()  // Run this function as a database transaction\n  static async helloTransaction(ctxt: TransactionContext<Knex>, user: string) {\n    // Retrieve and increment the number of times this user has been greeted.\n    const query = \"INSERT INTO operon_hello (name, greet_count) VALUES (?, 1) ON CONFLICT (name) DO UPDATE SET greet_count = operon_hello.greet_count + 1 RETURNING greet_count;\"\n    const { rows } = await ctxt.client.raw(query, [user]) as { rows: operon_hello[] };\n    const greet_count = rows[0].greet_count;\n    return `Hello, ${user}! You have been greeted ${greet_count} times.\\n`;\n  }\n}\n")),(0,a.kt)("p",null,"This starter code has a single function, ",(0,a.kt)("inlineCode",{parentName:"p"},"helloTransaction"),", which retrieves and updates a user's greeting count.\nThis function is annotated with two ",(0,a.kt)("em",{parentName:"p"},"decorators"),", ",(0,a.kt)("a",{parentName:"p",href:"../api-reference/decorators#getapi"},(0,a.kt)("inlineCode",{parentName:"a"},"@GetApi"))," and ",(0,a.kt)("a",{parentName:"p",href:"../api-reference/decorators#operontransaction"},(0,a.kt)("inlineCode",{parentName:"a"},"@OperonTransaction")),".\nDecorators tell Operon to give a function special properties."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"@OperonTransaction()")," tells Operon to run this function as a ",(0,a.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Database_transaction"},"database transaction"),".\nOperon supplies transactions with a ",(0,a.kt)("a",{parentName:"li",href:"../api-reference/contexts#transactioncontextt"},(0,a.kt)("inlineCode",{parentName:"a"},"TransactionContext")),", which exposes a database client.\nTo learn more about database operations and transactions in Operon, see ",(0,a.kt)("a",{parentName:"li",href:"../tutorials/transaction-tutorial"},"our guide"),"."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"@GetApi('/greeting/:user')")," tells Operon to serve this function from HTTP GET requests to the ",(0,a.kt)("inlineCode",{parentName:"li"},"/greeting")," endpoint.\nThe ",(0,a.kt)("inlineCode",{parentName:"li"},":user")," syntax tells Operon to use the ",(0,a.kt)("inlineCode",{parentName:"li"},"user")," path parameter from the URL as a parameter to the function.\nTo learn more about HTTP endpoints and handlers in Operon, see ",(0,a.kt)("a",{parentName:"li",href:"../tutorials/http-serving-tutorial"},"our guide"),".")),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"In this quickstart, we write our database operations in raw SQL (using ",(0,a.kt)("a",{parentName:"p",href:"https://knexjs.org/guide/raw.html"},"knex.raw"),") to make them easy to follow, but we also support ",(0,a.kt)("a",{parentName:"p",href:"https://knexjs.org/guide/query-builder.html"},"knex's query builder")," and the popular TypeScript ORMs ",(0,a.kt)("a",{parentName:"p",href:"https://www.prisma.io/"},"Prisma")," and ",(0,a.kt)("a",{parentName:"p",href:"https://typeorm.io/"},"TypeORM"),".")),(0,a.kt)("h3",{id:"adding-another-function"},"Adding Another Function"),(0,a.kt)("p",null,"Let's add a new function that lets users clear their greeting count.\nWe'll write another function and annotate it with decorators:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { PostApi } from '@dbos-inc/operon' // Add this to your imports.\n\n@PostApi('/clear/:user') // Serve this function from HTTP POST requests to the /clear endpoint with 'user' as a path parameter\n@OperonTransaction() // Run this function as a database transaction\nstatic async clearTransaction(ctxt: TransactionContext<Knex>, user: string) {\n  // Delete the database entry for a user.\n  await ctxt.client.raw(\"DELETE FROM operon_hello WHERE NAME = ?\", [user]);\n  return `Cleared greet_count for ${user}!\\n`;\n}\n")),(0,a.kt)("p",null,"Add this function as a method of the ",(0,a.kt)("inlineCode",{parentName:"p"},"Hello")," class.\nThis new function works similarly to ",(0,a.kt)("inlineCode",{parentName:"p"},"helloTransaction"),".\nThe  ",(0,a.kt)("a",{parentName:"p",href:"../api-reference/decorators#operontransaction"},(0,a.kt)("inlineCode",{parentName:"a"},"@OperonTransaction"))," decorator tells Operon to run it as a database transaction.\nThe ",(0,a.kt)("a",{parentName:"p",href:"../api-reference/decorators#postapi"},(0,a.kt)("inlineCode",{parentName:"a"},"@PostApi"))," decorator tells Operon to serve this function from HTTP POST requests to the ",(0,a.kt)("inlineCode",{parentName:"p"},"/clear")," endpoint."),(0,a.kt)("h3",{id:"trying-it-out"},"Trying it Out"),(0,a.kt)("p",null,"Now, let's see if this works!\nFirst, build and start the application:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm run build\nnpx operon start\n")),(0,a.kt)("p",null,"With the application running, we can query it and observe the greeting count being incremented with each query:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:3000/greeting/operon\n")),(0,a.kt)("p",null,"Then, clear the greeting count and ask for another greeting:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"curl -X POST http://localhost:3000/clear/operon\ncurl http://localhost:3000/greeting/operon\n")),(0,a.kt)("p",null,"The greeting count should reset back to 1."),(0,a.kt)("p",null,"If you've gotten this far, congratulations on writing your first Operon function!\nMove on to the next part to learn how to use more complex Operon features, like reliable workflows."))}d.isMDXComponent=!0}}]);