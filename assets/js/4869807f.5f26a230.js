"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[6927],{8540:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"python/tutorials/transaction-tutorial","title":"Transactions","description":"Learn how to perform database operations","source":"@site/docs/python/tutorials/transaction-tutorial.md","sourceDirName":"python/tutorials","slug":"/python/tutorials/transaction-tutorial","permalink":"/python/tutorials/transaction-tutorial","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Transactions","description":"Learn how to perform database operations"},"sidebar":"tutorialSidebar","previous":{"title":"Steps","permalink":"/python/tutorials/step-tutorial"},"next":{"title":"Queues & Concurrency","permalink":"/python/tutorials/queue-tutorial"}}');var s=n(4848),o=n(8453);const r={sidebar_position:3,title:"Transactions",description:"Learn how to perform database operations"},i=void 0,c={},l=[];function d(e){const t={a:"a",admonition:"admonition",code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components},{TabItem:n,Tabs:a}=t;return n||u("TabItem",!0),a||u("Tabs",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["Transactions are a special type of ",(0,s.jsx)(t.a,{href:"/python/tutorials/step-tutorial",children:"step"})," that are optimized for database accesses.\nThey execute as a single ",(0,s.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Database_transaction",children:"database transaction"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["To make a Python function a transaction, annotate it with the ",(0,s.jsx)(t.a,{href:"/python/reference/decorators#transaction",children:(0,s.jsx)(t.code,{children:"@DBOS.transaction"})})," decorator.\nThen, access the database using the ",(0,s.jsx)(t.a,{href:"/python/reference/contexts#sql_session",children:(0,s.jsx)(t.code,{children:"DBOS.sql_session"})})," client, which is a ",(0,s.jsx)(t.a,{href:"https://www.sqlalchemy.org/",children:"SQLAlchemy"})," client DBOS automatically connects to your database.\nHere are some examples:"]}),"\n",(0,s.jsxs)(a,{groupId:"database-clients",children:[(0,s.jsx)(n,{value:"sqlalchemy",label:"SQLAlchemy",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'greetings = Table(\n    "greetings", \n    MetaData(), \n    Column("name", String), \n    Column("note", String)\n)\n\n@DBOS.transaction()\ndef example_insert(name: str, note: str) -> None:\n    # Insert a new greeting into the database\n    DBOS.sql_session.execute(greetings.insert().values(name=name, note=note))\n\n@DBOS.transaction()\ndef example_select(name: str) -> Optional[str]:\n    # Select the first greeting to a particular name\n    row = DBOS.sql_session.execute(\n        select(greetings.c.note).where(greetings.c.name == name)\n    ).first()\n    return row[0] if row else None\n'})})}),(0,s.jsx)(n,{value:"raw",label:"Raw SQL",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'@DBOS.transaction()\ndef example_insert(name: str, note: str) -> None:\n    # Insert a new greeting into the database\n    sql = text("INSERT INTO greetings (name, note) VALUES (:name, :note)")\n    DBOS.sql_session.execute(sql, {"name": name, "note": note})\n\n\n@DBOS.transaction()\ndef example_select(name: str) -> Optional[str]:\n    # Select the first greeting to a particular name\n    sql = text("SELECT note FROM greetings WHERE name = :name LIMIT 1")\n    row = DBOS.sql_session.execute(sql, {"name": name}).first()\n    return row[0] if row else None\n'})})})]}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsxs)(t.p,{children:["At this time, DBOS does not support coroutine transactions.\nDecorating an ",(0,s.jsx)(t.code,{children:"async def"})," function with ",(0,s.jsx)(t.code,{children:"@DBOS.transaction"})," will raise an error at runtime."]})})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}function u(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>i});var a=n(6540);const s={},o=a.createContext(s);function r(e){const t=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(o.Provider,{value:t},e.children)}}}]);