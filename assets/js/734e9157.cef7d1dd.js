"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[9418],{6794:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"typescript/reference/transactapi/dbos-class","title":"DBOS Class","description":"API reference for DBOS","source":"@site/docs/typescript/reference/transactapi/dbos-class.md","sourceDirName":"typescript/reference/transactapi","slug":"/typescript/reference/transactapi/dbos-class","permalink":"/typescript/reference/transactapi/dbos-class","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"title":"DBOS Class","description":"API reference for DBOS"},"sidebar":"tutorialSidebar","previous":{"title":"Static Analysis","permalink":"/typescript/tutorials/development/static-analysis"},"next":{"title":"Workflow Handles","permalink":"/typescript/reference/transactapi/workflow-handles"}}');var r=s(4848),t=s(8453);const o={sidebar_position:10,title:"DBOS Class",description:"API reference for DBOS"},a="DBOS Class",l={},c=[{value:"Decorating Workflows, Transactions, and Steps",id:"decorating-workflows-transactions-and-steps",level:2},{value:"<code>@DBOS.workflow</code>",id:"dbosworkflow",level:3},{value:"Decorating Static Methods",id:"decorating-static-methods",level:4},{value:"Decorating Instance Methods",id:"decorating-instance-methods",level:4},{value:"Workflow Examples",id:"workflow-examples",level:4},{value:"Calling Workflow Functions",id:"calling-workflow-functions",level:4},{value:"Starting Background Workflows",id:"starting-background-workflows",level:5},{value:"Using Workflow Queues",id:"using-workflow-queues",level:5},{value:"Assigning workflow IDs",id:"assigning-workflow-ids",level:5},{value:"Workflow Configuration",id:"workflow-configuration",level:4},{value:"<code>@DBOS.transaction</code>",id:"dbostransaction",level:3},{value:"Accesing SQL Database Clients",id:"accesing-sql-database-clients",level:4},{value:"<code>@DBOS.step</code>",id:"dbosstep",level:3},{value:"Durable Sleep",id:"durable-sleep",level:2},{value:"Interacting With Workflows",id:"interacting-with-workflows",level:2},{value:"Sending And Receiving Messages",id:"sending-and-receiving-messages",level:3},{value:"<code>DBOS.send</code>",id:"dbossend",level:4},{value:"<code>DBOS.recv</code>",id:"dbosrecv",level:4},{value:"Reliability Guarantees",id:"reliability-guarantees",level:4},{value:"Setting and Getting Events",id:"setting-and-getting-events",level:3},{value:"<code>DBOS.setEvent</code>",id:"dbossetevent",level:4},{value:"<code>DBOS.getEvent</code>",id:"dbosgetevent",level:4},{value:"Reliability Guarantees",id:"reliability-guarantees-1",level:4},{value:"Finding and Retrieving Workflows",id:"finding-and-retrieving-workflows",level:2},{value:"<code>DBOS.getWorkflowStatus</code>",id:"dbosgetworkflowstatus",level:3},{value:"<code>DBOS.retrieveWorkflow</code>",id:"dbosretrieveworkflow",level:3},{value:"<code>DBOS.getWorkflows</code>",id:"dbosgetworkflows",level:3},{value:"<code>DBOS.getWorkflowQueue</code>",id:"dbosgetworkflowqueue",level:3},{value:"Accessing Configuration, Logging, and Tracing Facilities",id:"accessing-configuration-logging-and-tracing-facilities",level:2},{value:"<code>DBOS.getConfig</code>",id:"dbosgetconfig",level:3},{value:"Accessing Logging",id:"accessing-logging",level:3},{value:"Accessing The Tracing Span",id:"accessing-the-tracing-span",level:3},{value:"Checking Function Context",id:"checking-function-context",level:2},{value:"HTTP Handling",id:"http-handling",level:2},{value:"<code>@DBOS.getApi</code>",id:"dbosgetapi",level:3},{value:"<code>@DBOS.postApi</code>",id:"dbospostapi",level:4},{value:"<code>@DBOS.putApi</code>",id:"dbosputapi",level:4},{value:"<code>@DBOS.patchApi</code>",id:"dbospatchapi",level:4},{value:"<code>@DBOS.deleteApi</code>",id:"dbosdeleteapi",level:4},{value:"Accessing HTTP Context",id:"accessing-http-context",level:3},{value:"Middleware",id:"middleware",level:3},{value:"HTTP Testing",id:"http-testing",level:3},{value:"Declarative Role-Based Security",id:"declarative-role-based-security",level:2},{value:"<code>@DBOS.requiredRole</code>",id:"dbosrequiredrole",level:3},{value:"<code>@DBOS.DefaultRequiredRole</code>",id:"dbosdefaultrequiredrole",level:3},{value:"Retrieving The Authenticated User and Roles",id:"retrieving-the-authenticated-user-and-roles",level:3},{value:"Scheduled Workflows",id:"scheduled-workflows",level:2},{value:"Concurrency and Rate Limiting",id:"concurrency-and-rate-limiting",level:3},{value:"<code>crontab</code> Specification",id:"crontab-specification",level:3},{value:"Second Field Format",id:"second-field-format",level:4},{value:"Minute Field Format:",id:"minute-field-format",level:4},{value:"Hour Field Format:",id:"hour-field-format",level:4},{value:"Day Of Month Field Format",id:"day-of-month-field-format",level:4},{value:"Month Field Format",id:"month-field-format",level:4},{value:"Day Of Week Field Format",id:"day-of-week-field-format",level:4},{value:"Matching",id:"matching",level:4},{value:"Application Lifecycle",id:"application-lifecycle",level:2},{value:"Setting The Application Configuration",id:"setting-the-application-configuration",level:3},{value:"Loading Classes",id:"loading-classes",level:3},{value:"Launching DBOS",id:"launching-dbos",level:3},{value:"Starting HTTP Handler Services",id:"starting-http-handler-services",level:3},{value:"Shutting Down DBOS",id:"shutting-down-dbos",level:3},{value:"Recovering Workflows",id:"recovering-workflows",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"dbos-class",children:"DBOS Class"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"DBOS"})," static utility class is the heart of the DBOS Transact programming API.  ",(0,r.jsx)(n.code,{children:"DBOS"})," provides decorators to identify key application functions, and static access to context-dependent state.  ",(0,r.jsx)(n.code,{children:"DBOS"})," has no instance members and is not to be instantiated."]}),"\n",(0,r.jsx)(n.h2,{id:"decorating-workflows-transactions-and-steps",children:"Decorating Workflows, Transactions, and Steps"}),"\n",(0,r.jsxs)(n.p,{children:["DBOS provides reliability guarantees for programs that are ",(0,r.jsx)(n.a,{href:"/typescript/programming-guide",children:"written as workflows comprised of steps, transactions, and child workflows"}),".  The workflow, transaction, and step functions are marked with decorators."]}),"\n",(0,r.jsx)(n.h3,{id:"dbosworkflow",children:(0,r.jsx)(n.code,{children:"@DBOS.workflow"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@DBOS.workflow"})," registers a function as a DBOS workflow."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.workflow(config?: WorkflowConfig)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["When called, ",(0,r.jsx)(n.code,{children:"workflow"})," functions are wrapped such that they will be ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"run to completion exactly once"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@DBOS.workflow()"})," takes an optional ",(0,r.jsx)(n.a,{href:"#workflow-configuration",children:(0,r.jsx)(n.code,{children:"WorkflowConfig"})})," object."]}),"\n",(0,r.jsx)(n.h4,{id:"decorating-static-methods",children:"Decorating Static Methods"}),"\n",(0,r.jsxs)(n.p,{children:["Workflow functions must be class members, and may be ",(0,r.jsx)(n.code,{children:"static"}),".  To mark a ",(0,r.jsx)(n.code,{children:"static"})," member function as a workflow, simply place the ",(0,r.jsx)(n.code,{children:"@DBOS.workflow()"})," decorator above it."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { DBOS } from '@dbos-inc/dbos-sdk';\n\nclass Workflows\n{\n  // Mark a static method as a DBOS workflow\n  @DBOS.workflow()\n  static async processWorkflow(value: string) {\n    ...\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"decorating-instance-methods",children:"Decorating Instance Methods"}),"\n",(0,r.jsx)(n.p,{children:"Workflow functions may also be instance methods."}),"\n",(0,r.jsx)(n.p,{children:"For instance methods to work, the class must extend from the following abstract class:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export abstract class ConfiguredInstance {\n  readonly name: string;\n  constructor(name: string) {\n    this.name = name;\n    // ... registration occurs ...\n  }\n  initialize(): Promise<void> {} // override if desired\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"ConfiguredInstance"})," base class constructor registers the instance under the given ",(0,r.jsx)(n.code,{children:"name"}),".   The ",(0,r.jsx)(n.code,{children:"initialize"})," function will be called on each registered instance after the DBOS runtime has started, but before workflow processing commences."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { DBOS, ConfiguredInstance } from '@dbos-inc/dbos-sdk';\n\nclass MyClass extends ConfiguredInstance\n{\n  constructor(name: string, args: string[]) {\n    super(name);\n  }\n\n  override async initialize() {\n    // Do initialization work; `DBOS` is available\n    return Promise.resolve();\n  }\n\n  // Define workflows, transactions, steps, ...\n}\n\nconst myObj = new MyClass('myname', []);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Note that while this will create and register the ",(0,r.jsx)(n.code,{children:"myObj"})," object instance, initialization via the object's ",(0,r.jsx)(n.code,{children:"initialize()"})," method will be deferred until later, after database connections have been established."]}),"\n",(0,r.jsx)(n.h4,{id:"workflow-examples",children:"Workflow Examples"}),"\n",(0,r.jsx)(n.p,{children:"The following example workflow will be used in the sections below:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { DBOS, ConfiguredInstance, WorkflowQueue } from '@dbos-inc/dbos-sdk';\n\nclass Workflows extends ConfiguredInstance\n{\n  // Mark a static method as a DBOS workflow (see above)\n  @DBOS.workflow()\n  static async processWorkflow(value: string) {\n    ...\n  }\n\n  // Mark an instance method as a DBOS workflow\n  @DBOS.workflow()\n  processInstanceWorkflow(value: string) {\n    ...\n  }\n\n  // Needed to assign an instance name, see \"Instance Methods\" below\n  constructor(name: string) {\n    super(name);\n  }\n\n  // Initialize an instance, see \"Instance Methods\" below\n  override async initialize() {\n    return Promise.resolve();\n  }\n}\n\n// Create and register an object instance for executing workflows\nconst workflowInstance = new(Workflows, 'InstanceA');\n"})}),"\n",(0,r.jsx)(n.h4,{id:"calling-workflow-functions",children:"Calling Workflow Functions"}),"\n",(0,r.jsxs)(n.p,{children:["Functions that are registered as workflows with ",(0,r.jsx)(n.code,{children:"@DBOS.workflow"})," can be called directly like regular async functions, but will receive DBOS execution guarantees."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// Run functions directly\nconst result1 = await Workflows.processWorkflow("value1");\nconst result2 = await workflowsInstance.processInstanceWorkflow("value2");\n'})}),"\n",(0,r.jsx)(n.h5,{id:"starting-background-workflows",children:"Starting Background Workflows"}),"\n",(0,r.jsxs)(n.p,{children:["Workflow functions can also be started asynchronously using ",(0,r.jsx)(n.code,{children:"DBOS.startWorkflow"}),".  When run with ",(0,r.jsx)(n.code,{children:"DBOS.startWorkflow"}),", the function will run in the background, and a ",(0,r.jsx)(n.code,{children:"WorkflowHandle"})," is returned from ",(0,r.jsx)(n.code,{children:"DBOS"}),".  This ",(0,r.jsx)(n.a,{href:"/typescript/reference/transactapi/workflow-handles",children:"handle"})," can be used to ",(0,r.jsx)(n.a,{href:"#interacting-with-workflows",children:"interact with the workflow"})," or await its result with ",(0,r.jsx)(n.code,{children:"getResult()"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.startWorkflow<T extends ConfiguredInstance>(targetInstance: T, params?: StartWorkflowParams): InvokeFunctionsAsyncInst<T>;\nDBOS.startWorkflow<T extends object>(targetClass: T, params?: StartWorkflowParams): InvokeFunctionsAsync<T>;\n\ninterface StartWorkflowParams {\n  workflowID?: string;\n  queueName?: string;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The optional ",(0,r.jsx)(n.code,{children:"StartWorkflowParams"})," parameter allows the following to be controlled:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["workflowID: The ",(0,r.jsx)(n.a,{href:"#assigning-workflow-ids",children:"workflow ID"})," for the started workflow"]}),"\n",(0,r.jsxs)(n.li,{children:["queueName: The name of the ",(0,r.jsx)(n.a,{href:"#using-workflow-queues",children:"workflow queue"})," for the workflow"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Examples:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// Run static functions asynchronously and get the result later\nconst handle3 = await DBOS.startWorkflow(Workflows).processWorkflow("value3");\n// ...\nconst result3 = await handle3.getResult();\n\n// Run instance functions asynchronously and get the result later\nconst handle4 = await DBOS.startWorkflow(workflowInstance).processInstanceWorkflow("value4");\n// ...\nconst result4 = await handle4.getResult();\n\n// Run static functions asynchronously on a queue, with an assigned ID, and get the result later\nconst handle5 = await DBOS.startWorkflow(Workflows, {workflowID: \'unique wf id\', queueName: wfq.name})\n  .processWorkflow("value5");\n// ...\nconst result5 = await handle3.getResult();\n\n'})}),"\n",(0,r.jsx)(n.h5,{id:"using-workflow-queues",children:"Using Workflow Queues"}),"\n",(0,r.jsxs)(n.p,{children:["By default, the ",(0,r.jsx)(n.code,{children:"startWorkflow"})," method ",(0,r.jsx)(n.a,{href:"#starting-background-workflows",children:"described above"})," always starts the target workflow immediately.  If it is desired to control the concurrency or rate of workflow invocations, a ",(0,r.jsx)(n.a,{href:"/typescript/reference/transactapi/workflow-queues",children:(0,r.jsx)(n.code,{children:"queue"})})," can be specified."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.withWorkflowQueue<R>(wfq: string, callback: ()=>Promise<R>) : Promise<R>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"DBOS.withWorkflowQueue"})," function runs the provided ",(0,r.jsx)(n.code,{children:"callback"})," function and returns its result.  Any workflows started within ",(0,r.jsx)(n.code,{children:"callback"})," will be run on the queue named by ",(0,r.jsx)(n.code,{children:"wfq"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// Create a workflow queue for use below\nconst wfq = new WorkflowQueue("example_queue", 10, {limitPerPeriod: 50, periodSec: 30});\n\n// Run a workflow on the queue, and await the result\nconst qres = await DBOS.withWorkflowQueue(wfq.name, async ()=>{\n  return await Workflows.processWorkflow("value q");\n});\n\n// Start a workflow on the queue, and return a handle to the running workflow\nconst qhandle = await DBOS.withWorkflowQueue(wfq.name, async ()=>{\n  return await DBOS.startWorkflow(Workflows).processWorkflow("value q h");\n});\n//...\nconst qhres = await qhandle.getResult();\n'})}),"\n",(0,r.jsx)(n.h5,{id:"assigning-workflow-ids",children:"Assigning workflow IDs"}),"\n",(0,r.jsxs)(n.p,{children:["Specifying a workflow ID is useful if the intent is to start a workflow exactly once for a given circumstance.  Assignment of ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"workflow IDs"})," can be done with ",(0,r.jsx)(n.code,{children:"DBOS.withNextWorkflowID"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.withNextWorkflowID<R>(wfid: string, callback: ()=>Promise<R>) : Promise<R>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"DBOS.withNextWorkflowID"})," function runs the provided ",(0,r.jsx)(n.code,{children:"callback"})," function and returns its result.  The first workflow started within ",(0,r.jsx)(n.code,{children:"callback"})," will be assigned the ID specified by ",(0,r.jsx)(n.code,{children:"wfid"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Assign and idempotency key to the workflow, run syncronously\nconst result5 = await DBOS.withNextWorkflowID('<wfid_value>', async() => {\n  return await workflowInstance.processInstanceWorkflow(\"value5\");\n});\n\n// Assign an idempotency key to the workflow, run asynchronously\nconst handle6 = await DBOS.withNextWorkflowID('<wfid_value>', async() => {\n  return await DBOS.startWorkflow(Workflows).processWorkflow(\"value6\");\n});\n// ...\nconst result6 = await handle6.getResult();\n"})}),"\n",(0,r.jsx)(n.h4,{id:"workflow-configuration",children:"Workflow Configuration"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@DBOS.workflow()"})," takes an optional ",(0,r.jsx)(n.code,{children:"WorkflowConfig"})," object:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface WorkflowConfig {\n  maxRecoveryAttempts?: number; // The maximum number of times the workflow may be automatically recovered. Defaults to 50.\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"max_recovery_attempts"}),": The maximum number of times the workflow may be recovered.\nIf the process executing a workflow terminates without the workflow completing (either by succeeding or by throwing an error), DBOS will automatically recover the workflow from its last completed step.\nFor safety, DBOS only attempts to recover a workflow a set number of times.\nIf a workflow exceeds this limit, its status is set to ",(0,r.jsx)(n.code,{children:"RETRIES_EXCEEDED"})," and it is no longer automatically recovered.\nThis acts as a ",(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Dead_letter_queue",children:"dead letter queue"})," so that a buggy workflow that crashes its application (for example, by running it out of memory) does not do so infinitely."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"dbostransaction",children:(0,r.jsx)(n.code,{children:"@DBOS.transaction"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@DBOS.transaction"})," registers a function as a DBOS transaction.  Such functions will be provided with database access via a ",(0,r.jsx)(n.a,{href:"#accesing-sql-database-clients",children:"SQL client"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.transaction(config?: TransactionConfig)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Functions decorated with ",(0,r.jsx)(n.code,{children:"@DBOS.transaction"})," may be called directly, either inside or outside of workflows.  Functions decorated with ",(0,r.jsx)(n.code,{children:"@DBOS.transaction"})," must be class members, and may be either ",(0,r.jsx)(n.code,{children:"static"})," or ",(0,r.jsx)(n.a,{href:"#decorating-instance-methods",children:"instance methods"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@DBOS.transaction()"})," takes an optional ",(0,r.jsx)(n.code,{children:"TransactionConfig"})," object:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface TransactionConfig {\n  isolationLevel?: IsolationLevel;\n  readOnly?: boolean;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["DBOS supports declaration of the following values for ",(0,r.jsx)(n.code,{children:"IsolationLevel"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"READ UNCOMMITTED"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"READ COMMITTED"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"REPEATABLE READ"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"SERIALIZABLE"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The transaction semantics of these levels are defined for PostgreSQL ",(0,r.jsx)(n.a,{href:"https://www.postgresql.org/docs/current/transaction-iso.html",children:"here"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["A transaction function should be marked as read-only if it doesn't contain any database writes, as it may execute faster, and any inadvertent attempts to write to the database may be caught.  If a transaction function is marked as ",(0,r.jsx)(n.code,{children:"readOnly: true"})," but it contains database writes, it will throw an error at runtime (for example ",(0,r.jsx)(n.code,{children:"ERROR:  cannot execute INSERT in a read-only transaction"}),")."]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.transaction({readOnly: true})\nstatic async doLogin(username: string) {\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"accesing-sql-database-clients",children:"Accesing SQL Database Clients"}),"\n",(0,r.jsxs)(n.p,{children:["Within a transaction function, the following read-only property is available from the ",(0,r.jsx)(n.code,{children:"DBOS"})," class:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.sqlClient: UserDatabaseClient\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The following aliases are also available, depending on the database driver or ORM ",(0,r.jsxs)(n.a,{href:"/typescript/reference/configuration",children:[(0,r.jsx)(n.code,{children:"app_db_client"})," that has been configured"]}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.pgClient: PoolClient\nDBOS.prismaClient: PrismaClient\nDBOS.knexClient: Knex\nDBOS.typeORMClient: TypeORMEntityManager\nDBOS.drizzleClient: DrizzleClient\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For more details, see the ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/transaction-tutorial",children:"transaction tutorial"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"dbosstep",children:(0,r.jsx)(n.code,{children:"@DBOS.step"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@DBOS.step"})," registers a function as a DBOS step.  Such functions are a key building block of DBOS's ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/workflow-tutorial",children:"reliable workflows"}),".\nThe result of each invocation of a function decorated with ",(0,r.jsx)(n.code,{children:"@DBOS.step"})," is stored in the DBOS system database.  This checkpoint of the execution state allows function calls to be skipped during workflow replay, if the step is known to have completed previously."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.step(config?: StepConfig)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Functions decorated with ",(0,r.jsx)(n.code,{children:"@DBOS.step"})," may be called directly, either inside or outside of workflows.  Functions decorated with ",(0,r.jsx)(n.code,{children:"@DBOS.step"})," must be class members, and may be either ",(0,r.jsx)(n.code,{children:"static"})," or ",(0,r.jsx)(n.a,{href:"#decorating-instance-methods",children:"instance methods"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@Step()"})," takes an optional ",(0,r.jsx)(n.code,{children:"StepConfig"}),", which allows a number of step properties to be specified:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export interface StepConfig {\n  retriesAllowed?: boolean; // Should failures be retried? (default false)\n  intervalSeconds?: number; // Seconds to wait before the first retry attempt (default 1).\n  maxAttempts?: number;     // Maximum number of retry attempts (default 3). If errors occur more times than this, throw an exception.\n  backoffRate?: number;     // Multiplier by which the retry interval increases after a retry attempt (default 2).\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.step()\nstatic async sendToServer(valueToSend: string) {\n  ...\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"durable-sleep",children:"Durable Sleep"}),"\n",(0,r.jsx)(n.p,{children:'Within a DBOS workflow, waiting or sleeping should not be done using standard system functions, as these will not be skipped on workflow replay.  Instead, the "durable sleep" functions below should be used.  The wakeup time will be stored in the database when the function is first called, and if the workflow is re-executed, it will not oversleep.'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.sleepms(durationMS: number): Promise<void>\nDBOS.sleepSeconds(durationSec: number): Promise<void>\nDBOS.sleep(durationMS: number): Promise<void>\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["DBOS.sleepms: sleep for ",(0,r.jsx)(n.code,{children:"durationMS"})," milliseconds."]}),"\n",(0,r.jsxs)(n.li,{children:["DBOS.sleepSeconds: sleep for ",(0,r.jsx)(n.code,{children:"durationSec"})," seconds."]}),"\n",(0,r.jsxs)(n.li,{children:["DBOS.sleep: sleep for ",(0,r.jsx)(n.code,{children:"durationMS"})," milliseconds."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"These functions work in any context, and will use the system sleep if no workflow is in progress."}),"\n",(0,r.jsx)(n.h2,{id:"interacting-with-workflows",children:"Interacting With Workflows"}),"\n",(0,r.jsx)(n.h3,{id:"sending-and-receiving-messages",children:"Sending And Receiving Messages"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"DBOS.send"})," and ",(0,r.jsx)(n.code,{children:"DBOS.recv"})," allows the sending of messages to a specific ",(0,r.jsx)(n.a,{href:"../../tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"workflow"}),".  Workflows may wait for the message to be received before proceeding."]}),"\n",(0,r.jsx)(n.h4,{id:"dbossend",children:(0,r.jsx)(n.code,{children:"DBOS.send"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.send<T>(destinationID: string, message: T, topic?: string, idempotencyKey ?: string): Promise<void>\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"DBOS.send()"})," to send a message to a workflow, identified by ",(0,r.jsx)(n.code,{children:"destinationID"}),".  Messages can optionally be associated with a topic and are queued on the receiver per topic.  ",(0,r.jsx)(n.code,{children:"DBOS.send"})," may be called from other workflows, or anywhere else, to pass information to a corresponding ",(0,r.jsx)(n.code,{children:"DBOS.recv"})," call."]}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"DBOS.send()"})," is being called from outside of a workflow, an ",(0,r.jsx)(n.code,{children:"idempotencyKey"})," can be set for exactly-once behavior.  (From within a workflow, exactly-once behavior is guaranteed automatically.)"]}),"\n",(0,r.jsxs)(n.p,{children:["For more information, see our ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/workflow-tutorial#messages-example",children:"messages API tutorial"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"dbosrecv",children:(0,r.jsx)(n.code,{children:"DBOS.recv"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.recv<T>(topic?: string, timeoutSeconds?: number): Promise<T | null>\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"DBOS.recv"})," must be called from within a workflow, and will receive messages sent to the workflow, optionally for a particular topic.\nMessages are dequeued first-in, first-out, from a queue associated with the topic.\nCalls to ",(0,r.jsx)(n.code,{children:"recv()"})," wait for the next message in the queue, returning ",(0,r.jsx)(n.code,{children:"null"})," if the wait times out.\nIf no topic is specified, ",(0,r.jsx)(n.code,{children:"recv"})," can only access messages sent without a topic.\nFor more information, see our ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/workflow-tutorial#messages-example",children:"messages API tutorial"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"reliability-guarantees",children:"Reliability Guarantees"}),"\n",(0,r.jsxs)(n.p,{children:["All messages are persisted to the database, so if ",(0,r.jsx)(n.code,{children:"DBOS.send()"})," completes successfully, the destination workflow is guaranteed to be able to ",(0,r.jsx)(n.code,{children:"DBOS.recv()"})," it.  ",(0,r.jsx)(n.code,{children:"DBOS.recv()"})," consumes the message, but also advances the receiving workflow, so messages are received exactly once.\nIf you're sending a message from within a workflow, we guarantee exactly-once delivery because ",(0,r.jsx)(n.a,{href:"../../tutorials/workflow-tutorial#reliability-guarantees",children:"workflows are reliable"}),".\nIf you're sending a message from outside of a workflow, you can run ",(0,r.jsx)(n.code,{children:"DBOS.send"})," with an ",(0,r.jsx)(n.a,{href:"#assigning-workflow-ids",children:"idempotency key"})," to guarantee exactly-once delivery."]}),"\n",(0,r.jsx)(n.h3,{id:"setting-and-getting-events",children:"Setting and Getting Events"}),"\n",(0,r.jsx)(n.p,{children:"The event API allows workflows to emit events, which may be awaited.  Events are key-value pairs.  Events are useful for publishing information about the state of an active workflow, for example to transmit information to the workflow's caller.  Events must be set from within workflow functions, but may be awaited anywhere."}),"\n",(0,r.jsx)(n.h4,{id:"dbossetevent",children:(0,r.jsx)(n.code,{children:"DBOS.setEvent"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.setEvent<T>(key: string, value: T): Promise<void>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Creates or updates an event named ",(0,r.jsx)(n.code,{children:"key"}),", setting its value to ",(0,r.jsx)(n.code,{children:"value"}),".\nThe event can then be read by calling ",(0,r.jsx)(n.a,{href:"#dbosgetevent",children:(0,r.jsx)(n.code,{children:"DBOS.getEvent"})})," with the workflow's ID, from within another workflow, or elsewhere.\nEvents are mutable.  Attempting to emit an event twice from a given workflow instance will update the value, but care should be taken to ensure that the value is calculated deterministically for consistency when workflows are recovered.\nFor more information, see our ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-events",children:"events API tutorial"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"dbosgetevent",children:(0,r.jsx)(n.code,{children:"DBOS.getEvent"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.getEvent<T>(workflowID: string, key: string, timeoutSeconds?: number): Promise<T | null>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Retrieves an event published by ",(0,r.jsx)(n.code,{children:"workflowID"})," for a given ",(0,r.jsx)(n.code,{children:"key"})," using the ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-events",children:"events API"}),".\n",(0,r.jsx)(n.code,{children:"getEvent()"})," returns a ",(0,r.jsx)(n.code,{children:"Promise"}),".  ",(0,r.jsx)(n.code,{children:"await"}),"ing the promise will retrieve the value once the workflow has set the key, or return ",(0,r.jsx)(n.code,{children:"null"})," if the wait times out."]}),"\n",(0,r.jsx)(n.h4,{id:"reliability-guarantees-1",children:"Reliability Guarantees"}),"\n",(0,r.jsx)(n.p,{children:"All events are persisted to the database, so once an event it set, it is guaranteed to always be retrievable."}),"\n",(0,r.jsx)(n.h2,{id:"finding-and-retrieving-workflows",children:"Finding and Retrieving Workflows"}),"\n",(0,r.jsx)(n.p,{children:"Information about workflows that are either running or have already been completed can be retrieved from the workflow ID.  The workflow history can also be searched by other criteria, such as the user, function, or queue name."}),"\n",(0,r.jsx)(n.h3,{id:"dbosgetworkflowstatus",children:(0,r.jsx)(n.code,{children:"DBOS.getWorkflowStatus"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"DBOS.getWorkflowStatus"})," retrieves the status of a single workflow, given its workflow ID.  If the workflow ID specified has not been used to start a workflow, the returned ",(0,r.jsx)(n.code,{children:"Promise"})," will resolve to ",(0,r.jsx)(n.code,{children:"null"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.getWorkflowStatus(workflowID: string): Promise<WorkflowStatus | null>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"WorkflowStatus"})," returned has the following field definition:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"interface WorkflowStatus {\n  readonly status: string; // The status of the workflow.  One of PENDING, SUCCESS, ERROR, RETRIES_EXCEEDED, ENQUEUED, or CANCELLED.\n  readonly workflowName: string; // The name of the workflow function.\n  readonly workflowClassName: string; // The class name holding the workflow function.\n  readonly workflowConfigName: string; // The name of the configuration, if the class needs configuration\n  readonly queueName?: string; // The name of the queue, if workflow was queued\n  readonly authenticatedUser: string; // The user who ran the workflow. Empty string if not set.\n  readonly assumedRole: string; // The role used to run this workflow.  Empty string if authorization is not required.\n  readonly authenticatedRoles: string[]; // All roles the authenticated user has, if any.\n  readonly request: HTTPRequest; // The parent request for this workflow, if any.\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"dbosretrieveworkflow",children:(0,r.jsx)(n.code,{children:"DBOS.retrieveWorkflow"})}),"\n",(0,r.jsxs)(n.p,{children:["Similar to ",(0,r.jsx)(n.a,{href:"#dbosgetworkflowstatus",children:(0,r.jsx)(n.code,{children:"DBOS.getWorkflowStatus"})}),", ",(0,r.jsx)(n.code,{children:"DBOS.retrieveWorkflow"})," retrieves a single workflow by its id, but returns a ",(0,r.jsx)(n.a,{href:"/typescript/reference/transactapi/workflow-handles",children:(0,r.jsx)(n.code,{children:"WorkflowHandle"})}),".  This handle provides status, but also allows other workflow interactions."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.retrieveWorkflow(workflowID: string)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"dbosgetworkflows",children:(0,r.jsx)(n.code,{children:"DBOS.getWorkflows"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"DBOS.getWorkflows"})," allows querying workflow execution history."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.getWorkflows(input: GetWorkflowsInput): Promise<GetWorkflowsOutput>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Its ",(0,r.jsx)(n.code,{children:"GetWorkflowsInput"})," argument is an object describing which workflows to retrieve (by default, retrieve all workflows):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'interface GetWorkflowsInput {\n  workflowName?: string; // The name of the workflow function\n  authenticatedUser?: string; // The user who ran the workflow.\n  startTime?: string; // Timestamp in RFC 3339 format\n  endTime?: string; // Timestamp in RFC 3339 format\n  status?: "PENDING" | "SUCCESS" | "ERROR" | "RETRIES_EXCEEDED" | "CANCELLED" ; // The status of the workflow.\n  applicationVersion?: string; // The application version that ran this workflow.\n  limit?: number; // Return up to this many workflows IDs. IDs are ordered by workflow creation time.\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"getWorkflows"})," returns as output an object containing a list of the ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"Workflow IDs"})," of all retrieved workflows, ordered by workflow creation time:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export interface GetWorkflowsOutput {\n  workflowUUIDs: string[];\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To obtain further information about a particular workflow, call ",(0,r.jsx)(n.a,{href:"#dbosretrieveworkflow",children:(0,r.jsx)(n.code,{children:"retrieveWorkflow"})})," on its ID to obtain a ",(0,r.jsx)(n.a,{href:"/typescript/reference/transactapi/workflow-handles",children:"handle"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"dbosgetworkflowqueue",children:(0,r.jsx)(n.code,{children:"DBOS.getWorkflowQueue"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"DBOS.getWorkflowQueue"})," allows querying workflow execution history for a given ",(0,r.jsx)(n.a,{href:"/typescript/reference/transactapi/workflow-queues",children:"workflow queue"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.getWorkflowQueue(input: GetWorkflowQueueInput): Promise<GetWorkflowQueueOutput>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Its ",(0,r.jsx)(n.code,{children:"GetWorkflowQueueInput"})," argument is an object describing which workflows to retrieve (by default, retrieve all workflows):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export interface GetWorkflowQueueInput {\n  queueName?: string; // The name of the workflow queue\n  startTime?: string; // Timestamp in ISO 8601 format\n  endTime?: string; // Timestamp in ISO 8601 format\n  limit?: number; // Return up to this many workflows IDs. IDs are ordered by workflow creation time.\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"getWorkflowQueue"})," returns as output an object containing a list of the ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"Workflow IDs"})," of all retrieved workflows, ordered by workflow creation time.  The returned array lists some other details about the workflows also:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export interface GetWorkflowQueueOutput {\n  workflows: {\n    workflowID: string; // Workflow ID\n    queueName: string; // Workflow queue name\n    createdAt: number; // Time that queue entry was created\n    startedAt?: number; // Time that workflow was started, if started\n    completedAt?: number; // Time that workflow completed, if complete\n  }[];\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To obtain further information about a particular workflow, call ",(0,r.jsx)(n.a,{href:"#dbosretrieveworkflow",children:(0,r.jsx)(n.code,{children:"retrieveWorkflow"})})," on its ID to obtain a ",(0,r.jsx)(n.a,{href:"/typescript/reference/transactapi/workflow-handles",children:"handle"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"accessing-configuration-logging-and-tracing-facilities",children:"Accessing Configuration, Logging, and Tracing Facilities"}),"\n",(0,r.jsx)(n.h3,{id:"dbosgetconfig",children:(0,r.jsx)(n.code,{children:"DBOS.getConfig"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.getConfig<T>(key: string): T | undefined\nDBOS.getConfig<T>(key: string, defaultValue: T): T\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Deprecated."}),"  Retrieves an application property specified in the application section of the configuration.\nOptionally accepts a default value, returned when the key cannot be found in the configuration."]}),"\n",(0,r.jsx)(n.h3,{id:"accessing-logging",children:"Accessing Logging"}),"\n",(0,r.jsxs)(n.p,{children:["Using ",(0,r.jsx)(n.code,{children:"DBOS.logger"})," is the preferred logging method, as this will return a context-dependent logger if available, or the global logger otherwise."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.logger: DLogger\n"})}),"\n",(0,r.jsx)(n.h3,{id:"accessing-the-tracing-span",children:"Accessing The Tracing Span"}),"\n",(0,r.jsxs)(n.p,{children:["The current tracing span can be read via ",(0,r.jsx)(n.code,{children:"DBOS.span"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.span: Span | undefined\n"})}),"\n",(0,r.jsx)(n.h2,{id:"checking-function-context",children:"Checking Function Context"}),"\n",(0,r.jsxs)(n.p,{children:["The following properties of the ",(0,r.jsx)(n.code,{children:"DBOS"})," class return information about the current execution state:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.workflowID: string\nDBOS.isInTransaction: boolean\nDBOS.isInStep: boolean\nDBOS.isInWorkflow: boolean\nDBOS.isWithinWorkflow: boolean\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"DBOS.workflowId"}),": Return the ID of the current workflow, if any\n",(0,r.jsx)(n.code,{children:"DBOS.isInTransaction"}),": Returns true if the current context is executing a transaction function\n",(0,r.jsx)(n.code,{children:"DBOS.isInStep"}),": Returns true if the current context is executing a step function\n",(0,r.jsx)(n.code,{children:"DBOS.isInWorkflow"}),": Returns true if the current context is executing a workflow, and not currently in a step or transaction\n",(0,r.jsx)(n.code,{children:"DBOS.isWithinWorkflow"}),": Returns true if the current context is executing a workflow, regardless of whether or not it is currently in a step or transaction"]}),"\n",(0,r.jsx)(n.h2,{id:"http-handling",children:"HTTP Handling"}),"\n",(0,r.jsx)(n.p,{children:"DBOS Transact optionally provides HTTP handling.  This uses a serverless design, based on the Koa framework.  Endpoint functions are simply annotated with HTTP handling decorators."}),"\n",(0,r.jsx)(n.p,{children:"This provides the following features over using Koa directly:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Argument validation"}),"\n",(0,r.jsx)(n.li,{children:"A generated list of endpoint functions and their arguments"}),"\n",(0,r.jsxs)(n.li,{children:["Automatic configuration from ",(0,r.jsx)(n.code,{children:"dbos-config.yaml"})," or the runtime environment"]}),"\n",(0,r.jsx)(n.li,{children:"Automatic network configuration in DBOS Cloud"}),"\n",(0,r.jsxs)(n.li,{children:["Default tracing, parsing, and other middleware, with ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/requestsandevents/http-serving-tutorial#body-parser",children:"additional options"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The following sections describe the decorators that can be used to register methods for HTTP serving.  Note that all decorated methods must be ",(0,r.jsx)(n.code,{children:"static"}),", as there is no mechanism to forward function calls to a specific object instance."]}),"\n",(0,r.jsx)(n.h3,{id:"dbosgetapi",children:(0,r.jsx)(n.code,{children:"@DBOS.getApi"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.getApi(url: string)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Associates a function with an HTTP URL accessed via GET."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'@DBOS.getApi("/hello")\nstatic async hello() {\n  return { message: "hello!" };\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"@DBOS.getApi"})," decorator can be used by itself, but can also be combined with ",(0,r.jsx)(n.a,{href:"#dbostransaction",children:(0,r.jsx)(n.code,{children:"@DBOS.transaction"})}),", ",(0,r.jsx)(n.a,{href:"#dbosworkflow",children:(0,r.jsx)(n.code,{children:"@DBOS.workflow"})}),", or ",(0,r.jsx)(n.a,{href:"#dbosstep",children:(0,r.jsx)(n.code,{children:"@DBOS.step"})})," to serve those operations via HTTP."]}),"\n",(0,r.jsxs)(n.p,{children:["Endpoint paths may have placeholders, which are parts of the URL mapped to function arguments.  These are represented by a section of the path prefixed with a ",(0,r.jsx)(n.code,{children:":"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'@DBOS.getApi("/:id")\nstatic async exampleGet(id: string) {\n  DBOS.logger.info(`${id} is parsed from the URL path parameter`)\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"dbospostapi",children:(0,r.jsx)(n.code,{children:"@DBOS.postApi"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.postApi(url: string)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Associates a function with an HTTP URL accessed via POST. Analogous to ",(0,r.jsx)(n.a,{href:"#dbosgetapi",children:(0,r.jsx)(n.code,{children:"@DBOS.getApi"})}),", but may parse arguments from a request body."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'@DBOS.postApi("/:id")\nstatic async examplePost(id: string, name: string) {\n  DBOS.logger.info(`${id} is parsed from the URL path parameter, ${name} is parsed from the request body`)\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"dbosputapi",children:(0,r.jsx)(n.code,{children:"@DBOS.putApi"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.putApi(url: string)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Associates a function with an HTTP URL accessed via PUT. Analogous to ",(0,r.jsx)(n.a,{href:"#dbosgetapi",children:(0,r.jsx)(n.code,{children:"@DBOS.getApi"})}),", but may parse arguments from a request body."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'@DBOS.putApi("/:id")\nstatic async examplePut(id: string, name: string) {\n  DBOS.logger.info(`${id} is parsed from the URL path parameter, ${name} is parsed from the request body`)\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"dbospatchapi",children:(0,r.jsx)(n.code,{children:"@DBOS.patchApi"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.patchApi(url: string)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Associates a function with an HTTP URL accessed via PATCH. Analogous to ",(0,r.jsx)(n.a,{href:"#dbosgetapi",children:(0,r.jsx)(n.code,{children:"@DBOS.getApi"})}),", but may parse arguments from a request body."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'@DBOS.patchApi("/:id")\nstatic async examplePatch(id: string, name: string) {\n  DBOS.logger.info(`${id} is parsed from the URL path parameter, ${name} is parsed from the request body`)\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"dbosdeleteapi",children:(0,r.jsx)(n.code,{children:"@DBOS.deleteApi"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.deleteApi(url: string)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Associates a function with an HTTP URL accessed via DELETE. Analogous to ",(0,r.jsx)(n.a,{href:"#dbosgetapi",children:(0,r.jsx)(n.code,{children:"@DBOS.getApi"})}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'@DBOS.deleteApi("/:id")\nstatic async exampleDelete(id: string) {\n  DBOS.logger.info(`${id} is parsed from the URL path parameter`)\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"accessing-http-context",children:"Accessing HTTP Context"}),"\n",(0,r.jsxs)(n.p,{children:["Methods decorated as above will be called in response to HTTP requests.  Details of the request, and the Koa context, can be accessed by the following properties of the ",(0,r.jsx)(n.code,{children:"DBOS"})," class:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.request: HTTPRequest // HTTP rquest object\nDBOS.koaContext: Koa.Context // Koa context, including response, any middleware information, and output control\n"})}),"\n",(0,r.jsx)(n.h3,{id:"middleware",children:"Middleware"}),"\n",(0,r.jsxs)(n.p,{children:["For details on middleware, see ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/requestsandevents/http-serving-tutorial#middleware",children:"HTTP Decorators"})," in the ",(0,r.jsx)(n.a,{href:"/typescript/tutorials/requestsandevents/http-serving-tutorial",children:"HTTP Handling Tutorial"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"http-testing",children:"HTTP Testing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.getHTTPHandlersCallback(): (req: IncomingMessage | Http2ServerRequest, res: ServerResponse | Http2ServerResponse) => Promise<void>;\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.a,{href:"https://nodejs.org/api/http.html#httpcreateserveroptions-requestlistener",children:"node-native"})," request handler for DBOS Transact's internal HTTP service can be accessed with ",(0,r.jsx)(n.code,{children:"DBOS.getHTTPHandlersCallback()"}),".  This callback can then be used for testing purposes in frameworks such as ",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/supertest",children:"supertest"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, using  to send a ",(0,r.jsx)(n.code,{children:"GET"})," request to the ",(0,r.jsx)(n.code,{children:"/greeting/dbos"})," URL and verify the response:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import request from "supertest";\n\nconst res = await request(DBOS.getHTTPHandlersCallback()).get(\n  "/greeting/dbos"\n);\nexpect(res.statusCode).toBe(200);\nexpect(res.text).toMatch("Hello, dbos! You have been greeted");\n'})}),"\n",(0,r.jsx)(n.h2,{id:"declarative-role-based-security",children:"Declarative Role-Based Security"}),"\n",(0,r.jsxs)(n.p,{children:["DBOS supports declarative, role-based security. Functions can be decorated with a list of roles (as strings), and execution of the function is forbidden unless the authenticated user has at least one role in the list.  A list of roles can be provided as a class-level default with ",(0,r.jsx)(n.code,{children:"@DBOS.defaultRequiredRole()"}),", in which case it applies to any DBOS function in the class.  Roles for individual functions can be specified with the ",(0,r.jsx)(n.code,{children:"@DBOS.requiredRole()"})," decorator.  The roles listed in a  ",(0,r.jsx)(n.code,{children:"@DBOS.requiredRole()"})," method decorator will override any class-level defaults."]}),"\n",(0,r.jsx)(n.p,{children:"The following decorators configure role-based security:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.defaultRequiredRole(anyOf: string[])\n@DBOS.requiredRole(anyOf: string[])\n"})}),"\n",(0,r.jsx)(n.h3,{id:"dbosrequiredrole",children:(0,r.jsx)(n.code,{children:"@DBOS.requiredRole"})}),"\n",(0,r.jsx)(n.p,{children:"Specify the list of required roles for the decorated method. In order to execute the function, the authenticated user must have at least one role on the specified list."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@RequiredRole(['user','guest'])\n@DBOS.getApi(\"/hello\")\nstatic async helloUser() {\n  return { message: \"hello registered user or guest!\" };\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"dbosdefaultrequiredrole",children:(0,r.jsx)(n.code,{children:"@DBOS.DefaultRequiredRole"})}),"\n",(0,r.jsxs)(n.p,{children:["Specify default required roles for all methods in the class. This can be overridden at the method level with ",(0,r.jsx)(n.code,{children:"@DBOS.requiredRole"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'@DBOS.defaultRequiredRole([\'user\'])\nclass OperationEndpoints {\n  // Authentication / authorization not required for this function\n  @DBOS.requiredRole([])\n  @DBOS.getApi("/hello")\n  static async hello() {\n    return { message: "hello!" };\n  }\n\n  // Role with elevated permissions required for this function\n  @DBOS.requiredRole([\'admin\'])\n  @DBOS.getApi("/helloadmin")\n  static async helloadmin() {\n    return { message: "hello admin!" };\n  }\n\n  // Required role will be \'user\', from DBOS.defaultRequiredRole\n  @DBOS.getApi("/otherfunction")\n  static async otherFunc() {\n    return { message: "hello admin!" };\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"retrieving-the-authenticated-user-and-roles",children:"Retrieving The Authenticated User and Roles"}),"\n",(0,r.jsxs)(n.p,{children:["The following property on ",(0,r.jsx)(n.code,{children:"DBOS"})," retrieves the current authenticated user:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.authenticatedUser: string\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The authentication system can also provide the list of roles that are granted to the user.  This list is accessed via ",(0,r.jsx)(n.code,{children:"DBOS.authenticatedRoles"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.authenticatedRoles: string[]\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If the current DBOS function required authorization, the role assumed to access the function can be retrieved via ",(0,r.jsx)(n.code,{children:"DBOS.assumedRole"}),".  This role will be one of the ",(0,r.jsx)(n.a,{href:"#declarative-role-based-security",children:"required roles"})," for the function, and is taken from the ",(0,r.jsx)(n.code,{children:"DBOS.authenticatedRoles"})," list."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.assumedRole: string\n"})}),"\n",(0,r.jsx)(n.h2,{id:"scheduled-workflows",children:"Scheduled Workflows"}),"\n",(0,r.jsxs)(n.p,{children:["DBOS workflow functions may be executed on a schedule via the ",(0,r.jsx)(n.code,{children:"@DBOS.scheduled"})," decorator:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@DBOS.scheduled(schedulerConfig?: SchedulerConfig)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Workflows decorated with ",(0,r.jsx)(n.code,{children:"@DBOS.scheduled"})," will be run on the specified schedule, with guarantees such as executing exactly once per scheduled interval."]}),"\n",(0,r.jsx)(n.p,{children:"By default, the workflow is executed exactly once per scheduled interval.  This means executions might be started concurrently and can overlap, and that if the application is taken down and restarted, makeup work will be performed.  A workflow idempotency key (consisting of the workflow function name and scheduled time) is used to deduplicate any workflows that may inadvertently be initiated by the scheduler."}),"\n",(0,r.jsxs)(n.p,{children:["The schedule is specified in a format similar to a traditional ",(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Cron",children:(0,r.jsx)(n.code,{children:"crontab"})}),", with the following notes:\n. The 5- and 6-field versions are supported, if the optional 6th field is prepended it indicates second-level granularity, otherwise it is minute-level.\n. ',' is supported to indicate a list of values, so '0 0,12 * * *' executes at midnight and noon every day.\n. '/' is supported to indicate divisibility, so '*/5 * * * *' indicates every 5 minutes.\n. '-' is supported to indicate ranges, so '0 9-17 * * *' indicates every hour (on the hour) from 9am to 5pm.\n. Long and short month and weekday names are supported (in English)."]}),"\n",(0,r.jsx)(n.p,{children:"Two scheduling modes are currently supported:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.em,{children:"SchedulerMode.ExactlyOncePerInterval"}),": The workflow execution schedule begins when the decorated function is first deployed and activated.  If the application is deactivated, missed executions will be started when the application is reactivated, such that the workflow is executed exactly once per scheduled interval (starting from when the function is first deployed)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.em,{children:"SchedulerMode.ExactlyOncePerIntervalWhenActive"}),": Similar to ",(0,r.jsx)(n.code,{children:"ExactlyOncePerInterval"}),", except that any workflow executions that would have occurred when the application is inactive are not made up."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"@DBOS.scheduled"})," decorator's configuration object is:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export class SchedulerConfig {\n    crontab : string = '* * * * *'; // Every minute by default\n    mode ?: SchedulerMode = SchedulerMode.ExactlyOncePerInterval; // How to treat intervals\n    queueName ?: string;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"The decorated method takes the following parameters:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The time that the run was scheduled (as a ",(0,r.jsx)(n.code,{children:"Date"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["The time that the run was actually started (as a ",(0,r.jsx)(n.code,{children:"Date"}),").  This can be used to tell if an exactly-once workflow was started behind schedule."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Example:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { DBOS } from \"@dbos-inc/dbos-sdk\";\n\nclass ScheduledExample{\n  @DBOS.scheduled({crontab: '*/5 * * * * *', mode: SchedulerMode.ExactlyOncePerIntervalWhenActive})\n  @DBOS.workflow()\n  static async scheduledFunc(schedTime: Date, startTime: Date) {\n    DBOS.logger.info(`\n        Running a workflow every 5 seconds -\n          scheduled time: ${schedTime.toISOString()} /\n          actual start time: ${startTime.toISOString()}\n    `);\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"concurrency-and-rate-limiting",children:"Concurrency and Rate Limiting"}),"\n",(0,r.jsxs)(n.p,{children:["By default, ",(0,r.jsx)(n.code,{children:"@DBOS.scheduled"})," workflows are started immediately, including any make-up work identified when a VM starts.  If ",(0,r.jsx)(n.code,{children:"queueName"})," is specified in the ",(0,r.jsx)(n.code,{children:"SchedulerConfig"}),", then the workflow will be enqueued in a ",(0,r.jsx)(n.a,{href:"./workflow-queues",children:"workflow queue"})," and subject to rate limits."]}),"\n",(0,r.jsxs)(n.h3,{id:"crontab-specification",children:[(0,r.jsx)(n.code,{children:"crontab"})," Specification"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"crontab"})," format is based on the well-known format used in the ",(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Cron",children:(0,r.jsx)(n.code,{children:"cron"})})," scheduler."]}),"\n",(0,r.jsx)(n.p,{children:"The crontab field contains 5 or 6 items, separated by spaces:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:" \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 second (optional)\n \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute\n \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour\n \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of month\n \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500 month\n \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500 day of week\n \u2502 \u2502 \u2502 \u2502 \u2502 \u2502\n \u2502 \u2502 \u2502 \u2502 \u2502 \u2502\n * * * * * *\n"})}),"\n",(0,r.jsx)(n.h4,{id:"second-field-format",children:"Second Field Format"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Each 'number' is in the range [0-59].  The range of 'divisor' is [2-59]."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"*"})," is interpreted as [0-59]."]}),"\n",(0,r.jsx)(n.h4,{id:"minute-field-format",children:"Minute Field Format:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Each 'number' is in the range [0-59].  The range of 'divisor' is [2-59]."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"*"})," is interpreted as [0-59]."]}),"\n",(0,r.jsx)(n.h4,{id:"hour-field-format",children:"Hour Field Format:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Each 'number' is in the range [0-23].  The range of 'divisor' is [2-23]."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"*"})," is interpreted as [0-23]."]}),"\n",(0,r.jsx)(n.h4,{id:"day-of-month-field-format",children:"Day Of Month Field Format"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Each 'number' is in the range [1-31].  The range of 'divisor' is [2-31]."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"*"})," is interpreted as [1-31]."]}),"\n",(0,r.jsx)(n.h4,{id:"month-field-format",children:"Month Field Format"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Each 'number' is in the range [1-12].  The range of 'divisor' is [2-12]."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"*"})," is interpreted as [1-12]."]}),"\n",(0,r.jsx)(n.p,{children:"The following symbolic names can be placed instead of numbers, and are case-insensitive:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"'january',   'jan' -> 1\n'february',  'feb' -> 2\n'march',     'mar' -> 3\n'april',     'apr' -> 4\n'may',       'may' -> 5\n'june',      'jun' -> 6\n'july',      'jul' -> 7\n'august',    'aug' -> 8\n'september', 'sep' -> 9\n'october',   'oct' -> 10\n'november',  'nov' -> 11\n'december',  'dec' -> 12\n"})}),"\n",(0,r.jsx)(n.h4,{id:"day-of-week-field-format",children:"Day Of Week Field Format"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"*|number[-number][,number[-number]...][/divisor]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Each 'number' is in the range [0-7], with 0 and 7 both corresponding to Sunday.  The range of 'divisor' is [2-7]."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"*"})," is interpreted as [0-6]."]}),"\n",(0,r.jsx)(n.p,{children:"The following symbolic names can be placed instead of numbers, and are case-insensitive:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"'sunday',    'sun' -> 0\n'monday',    'mon' -> 1\n'tuesday',   'tue' -> 2\n'wednesday', 'wed' -> 3\n'thursday',  'thu' -> 4\n'friday',    'fri' -> 5\n'saturday'   'sat' -> 6\n"})}),"\n",(0,r.jsx)(n.h4,{id:"matching",children:"Matching"}),"\n",(0,r.jsx)(n.p,{children:"For a scheduled workflow to run at a given time, the time must match the crontab pattern.\nA time matches the pattern if all fields of the time match the pattern.\nEach field matches the pattern if its numerical value is within any of the inclusive ranges provided in the field, and is also divisible by the divisor."}),"\n",(0,r.jsx)(n.h2,{id:"application-lifecycle",children:"Application Lifecycle"}),"\n",(0,r.jsx)(n.p,{children:"The steps in a DBOS application's lifecycle are:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#setting-the-application-configuration",children:"Provide DBOS configuration information"}),", if not using ",(0,r.jsx)(n.code,{children:"dbos-config.yaml"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#loading-classes",children:"Load classes with DBOS functions"}),", if they are not already loaded by your program."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#launching-dbos",children:"Launch DBOS"}),".  This will initialize DBOS functions and start workflow recovery, scheduled workflows, etc."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#starting-http-handler-services",children:"Start DBOS internal HTTP request handlers"}),", if used by your application."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#shutting-down-dbos",children:"Shut DBOS down"})," gracefully, if desired."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Note that these steps are handled automatically for DBOS applications using entrypoints specified in ",(0,r.jsx)(n.a,{href:"../configuration",children:(0,r.jsx)(n.code,{children:"dbos-config.yaml"})}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"setting-the-application-configuration",children:"Setting The Application Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["By default, the DBOS configuration is automatically loaded from ",(0,r.jsx)(n.code,{children:"dbos-config.yaml"}),".\nHowever, it may also be provided programatically with ",(0,r.jsx)(n.code,{children:"DBOS.setConfig"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"DBOS.setConfig(config: DBOSConfig, runtimeConfig?: DBOSRuntimeConfig)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"runtimeConfig"})," is provided, the runtime will be started when the app is launched with ",(0,r.jsx)(n.code,{children:"DBOS.launch"}),", including HTTP handling for decorated methods.  If ",(0,r.jsx)(n.code,{children:"runtimeConfig"})," is not provided, this will not occur."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"parseConfigFile"})," can be used to load a configuration file."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { parseConfigFile } from '@dbos-inc/dbos-sdk';\nconst [cfg, rtCfg] = parseConfigFile({configfile: 'my-testing-dbos-config.yaml'});\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Use of ",(0,r.jsx)(n.code,{children:"parseConfigFile"})," allows a file other than ",(0,r.jsx)(n.code,{children:"dbos-config.yaml"})," to be loaded and programmatic modifications or checks to be performed prior to calling ",(0,r.jsx)(n.code,{children:"DBOS.setConfig"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"loading-classes",children:"Loading Classes"}),"\n",(0,r.jsxs)(n.p,{children:["Before a DBOS app is launched, all classes with DBOS methods should be loaded, giving their decorators a chance to run and register the associated functions.  This is generally done automatically, but for advanced situations, it can be performed programatically with ",(0,r.jsx)(n.code,{children:"DBOS.loadClasses"}),".  Note that, similar to those in the application entrypoints, files provided should be the ",(0,r.jsx)(n.code,{children:".js"})," files that are actually loaded by the application."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"await DBOS.loadClasses(['dist/kafka_conumer.js','dist/background_jobs.js']);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"launching-dbos",children:"Launching DBOS"}),"\n",(0,r.jsxs)(n.p,{children:["The DBOS app can be started with ",(0,r.jsx)(n.code,{children:"launch"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"await DBOS.launch();\n"})}),"\n",(0,r.jsx)(n.p,{children:"This starts the DBOS app, or registers it to be started in conjunction with a provided HTTP server.  Launching will initialize all DBOS components, run any application initializers, start workflow recovery, start event processing, and start HTTP services (if so configured)."}),"\n",(0,r.jsx)(n.h3,{id:"starting-http-handler-services",children:"Starting HTTP Handler Services"}),"\n",(0,r.jsxs)(n.p,{children:["If DBOS functions include ",(0,r.jsx)(n.a,{href:"/typescript/reference/transactapi/dbos-class#http-handling",children:"handler decorators"})," such as ",(0,r.jsx)(n.code,{children:"@DBOS.getApi"})," and ",(0,r.jsx)(n.code,{children:"@DBOS.postApi"}),", DBOS HTTP should be started to serve them."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"DBOS.launchAppHTTPServer()"})," sets up routing for all handlers, and creates a server that listens on the port specified in the ",(0,r.jsx)(n.code,{children:"runtimeConfig"})," passed to ",(0,r.jsx)(n.code,{children:"DBOS.setConfig"}),".  If this server is not desired, such as in testing or if DBOS handlers are to be combined with those of another framework, ",(0,r.jsx)(n.code,{children:"DBOS.setUpHandlerCallback()"})," can be used to return the server, without connecting it to a listening socket."]}),"\n",(0,r.jsx)(n.h3,{id:"shutting-down-dbos",children:"Shutting Down DBOS"}),"\n",(0,r.jsxs)(n.p,{children:["DBOS services can be shut down gracefully with ",(0,r.jsx)(n.code,{children:"shutdown"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"await DBOS.shutdown();\n"})}),"\n",(0,r.jsx)(n.p,{children:"This stops the DBOS app.  First, handling of new events and requests is disabled, and then the workflow executor and database connections are destroyed."}),"\n",(0,r.jsx)(n.h3,{id:"recovering-workflows",children:"Recovering Workflows"}),"\n",(0,r.jsx)(n.p,{children:"DBOS generally recovers workflows automatically.  However, this process can be initiated externally."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'DBOS.recoverPendingWorkflows(executorIDs: string[] = ["local"]): Promise<WorkflowHandle<unknown>[]>\nDBOS.executeWorkflowById(workflowId: string, startNewWorkflow: boolean = false): Promise<WorkflowHandle<unknown>>\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DBOS.recoverPendingWorkflows"}),": Retrieves a list of workflows to recover, and starts them, returning their handles"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DBOS.executeWorkflowById"}),": Starts executing a workflow given its ",(0,r.jsx)(n.code,{children:"workflowId"}),".  If ",(0,r.jsx)(n.code,{children:"startNewWorkflow"})," is ",(0,r.jsx)(n.code,{children:"true"}),", the workflow is cloned and assigned a new unique workflow ID."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(6540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);