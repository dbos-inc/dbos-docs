"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[4336],{12:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>u,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"typescript/reference/queues","title":"Queues","description":"Workflow queues allow you to ensure that workflow functions will be run, without starting them immediately.","source":"@site/docs/typescript/reference/queues.md","sourceDirName":"typescript/reference","slug":"/typescript/reference/queues","permalink":"/typescript/reference/queues","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":40,"frontMatter":{"sidebar_position":40,"title":"Queues"},"sidebar":"tutorialSidebar","previous":{"title":"DBOS Methods & Variables","permalink":"/typescript/reference/methods"},"next":{"title":"Transactions & Datasources","permalink":"/typescript/reference/datasource"}}');var t=r(4848),o=r(8453);const i={sidebar_position:40,title:"Queues"},a=void 0,u={},l=[{value:"class WorkflowQueue",id:"class-workflowqueue",level:3},{value:"Enqueueing Workflows",id:"enqueueing-workflows",level:3}];function c(e){const n={a:"a",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Workflow queues allow you to ensure that workflow functions will be run, without starting them immediately.\nQueues are useful for controlling the number of workflows run in parallel, or the rate at which they are started."}),"\n",(0,t.jsxs)(n.p,{children:["All queues should be created before ",(0,t.jsx)(n.code,{children:"DBOS.launch()"})," is called."]}),"\n",(0,t.jsx)(n.h3,{id:"class-workflowqueue",children:"class WorkflowQueue"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"class WorkflowQueue {\n   constructor(name: string, queueParameters: QueueParameters);\n}\n\ninterface QueueParameters {\n  workerConcurrency?: number;\n  concurrency?: number;\n  rateLimit?: QueueRateLimit;\n  priorityEnabled?: boolean;\n}\n\ninterface QueueRateLimit {\n  limitPerPeriod: number;\n  periodSec: number;\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"name"}),": The name of the queue.  Must be unique among all queues in the application."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"workerConcurrency"}),": The maximum number of workflows from this queue that may run concurrently within a single DBOS process. Must be less than or equal to ",(0,t.jsx)(n.code,{children:"concurrency"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"concurrency"}),": The maximum number of workflows from this queue that may run concurrently. Defaults to no limit.\nThis concurrency limit is global across all DBOS processes using this queue."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"rateLimit"}),": A limit on the maximum number of functions which may be started in a given period.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"rateLimit.limitPerPeriod"}),": The number of workflows that may be started within the specified time period."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"rateLimit.periodSec"}),": The time period across which ",(0,t.jsx)(n.code,{children:"limitPerPeriod"})," applies."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"priorityEnabled"}),": Enable setting priority for workflows on this queue."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example syntax:"})}),"\n",(0,t.jsx)(n.p,{children:"This queue may run no more than 5 functions per process and may not start more than 50 functions per 30 seconds:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const queue = new WorkflowQueue(\n    "example_queue",\n    {\n        workerConcurrency: 5,\n        rateLimit: { limitPerPeriod: 50, periodSec: 30 }\n    },\n);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"enqueueing-workflows",children:"Enqueueing Workflows"}),"\n",(0,t.jsxs)(n.p,{children:["Workflows are enqueued by providing a ",(0,t.jsx)(n.code,{children:"queueName"})," argument to ",(0,t.jsx)(n.a,{href:"/typescript/reference/methods#dbosstartworkflow",children:(0,t.jsx)(n.code,{children:"DBOS.startWorkflow"})}),".\nThis enqueues a function for processing and returns a ",(0,t.jsx)(n.a,{href:"/typescript/reference/methods#workflow-handles",children:"handle"})," to it.\nThrough arguments to ",(0,t.jsx)(n.code,{children:"DBOS.startWorkflow"}),", you can optionally provide a custom priority or deduplication ID to an enqueued workflow."]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"DBOS.startWorkflow"})," method durably enqueues your function; after it returns, your function is guaranteed to eventually execute even if your app is interrupted."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example syntax:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { DBOS, WorkflowQueue } from "@dbos-inc/dbos-sdk";\n\nconst queue = new WorkflowQueue("example_queue");\n\nasync function taskFunction(task) {\n    // ...\n}\nconst taskWorkflow = DBOS.registerWorkflow(taskFunction, {"name": "taskWorkflow"});\n\nasync function queueFunction(tasks) {\n  const handles = []\n  \n  // Enqueue each task so all tasks are processed concurrently.\n  for (const task of tasks) {\n    handles.push(await DBOS.startWorkflow(taskWorkflow, { queueName: queue.name })(task))\n  }\n\n  // Wait for each task to complete and retrieve its result.\n  // Return the results of all tasks.\n  const results = []\n  for (const h of handles) {\n    results.push(await h.getResult())\n  }\n  return results\n}\nconst queueWorkflow = DBOS.registerWorkflow(queueFunction, {"name": "taskWorkflow"})\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example syntax using decorated workflows:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'import { DBOS, WorkflowQueue } from "@dbos-inc/dbos-sdk";\n\nconst queue = new WorkflowQueue("example_queue");\n\nclass Tasks {\n  @DBOS.workflow()\n  static async processTask(task) {\n    // ...\n  }\n\n  @DBOS.workflow()\n  static async processTasks(tasks) {\n    const handles = []\n\n    // Enqueue each task so all tasks are processed concurrently.\n    for (const task of tasks) {\n      handles.push(await DBOS.startWorkflow(Tasks, {queueName: queue.name}).processTask(task));\n    }\n\n    // Wait for each task to complete and retrieve its result.\n    // Return the results of all tasks.\n    const results = [];\n    for (const h of handles) {\n      results.push(await h.getResult());\n    }\n    return results;\n  }\n}\n'})})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>a});var s=r(6540);const t={},o=s.createContext(t);function i(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);