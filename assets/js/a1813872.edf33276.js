"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[1666],{1083:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"java/reference/workflows-steps","title":"Workflows & Steps","description":"Annotations","source":"@site/docs/java/reference/workflows-steps.md","sourceDirName":"java/reference","slug":"/java/reference/workflows-steps","permalink":"/java/reference/workflows-steps","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20,"title":"Workflows & Steps","toc_max_heading_level":3},"sidebar":"tutorialSidebar","previous":{"title":"DBOS Lifecycle","permalink":"/java/reference/lifecycle"},"next":{"title":"DBOS Methods & Variables","permalink":"/java/reference/methods"}}');var s=t(4848),r=t(8453);const i={sidebar_position:20,title:"Workflows & Steps",toc_max_heading_level:3},l=void 0,a={},d=[{value:"Annotations",id:"annotations",level:2},{value:"@Workflow",id:"workflow",level:3},{value:"@Scheduled",id:"scheduled",level:3},{value:"Methods",id:"methods",level:2},{value:"registerWorkflows",id:"registerworkflows",level:3},{value:"startWorkflow",id:"startworkflow",level:3},{value:"StartWorkflowOptions",id:"startworkflowoptions",level:4},{value:"runStep",id:"runstep",level:3},{value:"StepOptions",id:"stepoptions",level:4},{value:"WorkflowHandle",id:"workflowhandle",level:3},{value:"WorkflowHandle.getResult",id:"workflowhandlegetresult",level:4},{value:"WorkflowHandle.getStatus",id:"workflowhandlegetstatus",level:4},{value:"WorkflowHandle.workflowId",id:"workflowhandleworkflowid",level:4},{value:"WorkflowOptions",id:"workflowoptions",level:3}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"annotations",children:"Annotations"}),"\n",(0,s.jsx)(n.h3,{id:"workflow",children:"@Workflow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"public @interface Workflow {\n  String name();\n\n  int maxRecoveryAttempts();\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"An annotation that can be applied to a class method to mark it as a durable workflow."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"name"}),": The workflow name. Must be unique."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"maxRecoveryAttempts"}),": Optionally configure the maximum number of times execution of a workflow may be attempted.\nThis acts as a ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Dead_letter_queue",children:"dead letter queue"})," so that a buggy workflow that crashes its application (for example, by running it out of memory) does not do so infinitely.\nIf a workflow exceeds this limit, its status is set to ",(0,s.jsx)(n.code,{children:"MAX_RECOVERY_ATTEMPTS_EXCEEDED"})," and it may no longer be executed."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"scheduled",children:"@Scheduled"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"public @interface Scheduled {\n  String cron();\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"An annotation that can be applied to a workflow to schedule it on a cron schedule."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"cron"}),": The schedule, expressed in ",(0,s.jsx)(n.a,{href:"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/support/CronExpression.html",children:"Spring 5.3+ CronExpression"})," syntax."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,s.jsx)(n.h3,{id:"registerworkflows",children:"registerWorkflows"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"static <T> T registerWorkflows(Class<T> interfaceClass, T implementation)\nstatic <T> T registerWorkflows(Class<T> interfaceClass, T implementation, String instanceName)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Register the workflows in a class, returning a proxy object from which the class methods may be invoked as durable workflows.\nAll workflows must be registered before DBOS is launched."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example Syntax:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'interface Example {\n    public void workflow();\n}\n\nclass ExampleImpl implements Example {\n    @Workflow(name="workflow")\n    public void workflow() {\n        return;\n    }\n}\n\nExample proxy = DBOS.registerWorkflows(Example.class, new ExampleImpl());\nproxy.workflow();\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"interfaceClass"}),": The interface class whose workflows are to be registered."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"implementation"}),": An instance of the class whose workflows to register."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"instanceName"}),": A unique name for this class instance. Use only when you are creating multiple instances of a class and your workflow depends on class instance variables. When DBOS needs to recover a workflow belonging to that class, it looks up the class instance using ",(0,s.jsx)(n.code,{children:"instanceName"})," so it can recover the workflow using the right instance of its class."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"startworkflow",children:"startWorkflow"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"static <T, E extends Exception> WorkflowHandle<T, E> startWorkflow(\n    ThrowingSupplier<T, E> workflow, \n    StartWorkflowOptions options\n)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Start a workflow in the background and return a handle to it.\nOptionally enqueue it on a DBOS queue.\nThe ",(0,s.jsx)(n.code,{children:"startWorkflow"})," method resolves after the workflow is durably started; at this point the workflow is guaranteed to run to completion even if the app is interrupted."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Example Syntax"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'interface Example {\n    public void workflow();\n}\n\nclass ExampleImpl implements Example {\n    @Workflow(name="workflow")\n    public void workflow() {\n        return;\n    }\n}\n\nExample proxy = DBOS.registerWorkflows(Example.class, new ExampleImpl());\nDBOS.startWorkflow(() -> proxy.workflow(), new StartWorkflowOptions());\n'})}),"\n",(0,s.jsx)(n.h4,{id:"startworkflowoptions",children:"StartWorkflowOptions"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"StartWorkflowOptions"})," is a with-based configuration record for parameterizing ",(0,s.jsx)(n.code,{children:"DBOS.startWorkflow"}),". All fields are optional."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Constructors:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"new StartWorkflowOptions()\n"})}),"\n",(0,s.jsx)(n.p,{children:"Create workflow options with all fields set to their defaults."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Methods:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"withWorkflowId(String workflowId)"})})," - Set the workflow ID of this workflow."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"withQueue(Queue queue)"})})," - Instead of starting the workflow directly, enqueue it on this queue."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"withTimeout(Duration timeout)"})})," / ",(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"withTimeout(long value, TimeUnit unit)"})})," - Set a timeout for this workflow. When the timeout expires, the workflow ",(0,s.jsx)(n.strong,{children:"and all its children"})," are cancelled. Cancelling a workflow sets its status to ",(0,s.jsx)(n.code,{children:"CANCELLED"})," and preempts its execution at the beginning of its next step."]}),"\n",(0,s.jsxs)(n.p,{children:["Timeouts are ",(0,s.jsx)(n.strong,{children:"start-to-completion"}),": if a workflow is enqueued, the timeout does not begin until the workflow is dequeued and starts execution. Also, timeouts are ",(0,s.jsx)(n.strong,{children:"durable"}),": they are stored in the database and persist across restarts, so workflows can have very long timeouts."]}),"\n",(0,s.jsxs)(n.p,{children:["Timeout deadlines are propagated to child workflows by default, so when a workflow's deadline expires all of its child workflows (and their children, and so on) are also cancelled. If you want to detach a child workflow from its parent's timeout, you can start it with its own explicit timeout (or ",(0,s.jsx)(n.code,{children:"Timeout.none()"}),") to override the propagated timeout."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"withDeadline(Instant deadline)"})})," - Set a deadline for this workflow. If the workflow is executing at the time of the deadline, the workflow ",(0,s.jsx)(n.strong,{children:"and all its children"})," are cancelled. Cancelling a workflow sets its status to ",(0,s.jsx)(n.code,{children:"CANCELLED"})," and preempts its execution at the beginning of its next step."]}),"\n",(0,s.jsxs)(n.p,{children:["Deadlines are ",(0,s.jsx)(n.strong,{children:"durable"}),": they are stored in the database and persist across restarts."]}),"\n",(0,s.jsx)(n.p,{children:"Deadlines are propagated to child workflows by default, so when a workflow's deadline expires all of its child workflows (and their children, and so on) are also cancelled. If you want to detach a child workflow from its parent's deadline, you can start it with a different explicit deadline."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"withDeduplicationId(String deduplicationId)"})})," - May only be used when enqueuing. At any given time, only one workflow with a specific deduplication ID can be enqueued in the specified queue. If a workflow with a deduplication ID is currently enqueued or actively executing (status ",(0,s.jsx)(n.code,{children:"ENQUEUED"})," or ",(0,s.jsx)(n.code,{children:"PENDING"}),"), subsequent workflow enqueue attempts with the same deduplication ID in the same queue will raise an exception."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"withPriority(int priority)"})})," - May only be used when enqueuing. The priority of the enqueued workflow in the specified queue. Workflows with the same priority are dequeued in FIFO (first in, first out) order. Priority values can range from ",(0,s.jsx)(n.code,{children:"1"})," to ",(0,s.jsx)(n.code,{children:"2,147,483,647"}),", where a low number indicates a higher priority. Workflows without assigned priorities have the highest priority and are dequeued before workflows with assigned priorities."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"runstep",children:"runStep"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"static <T, E extends Exception> T runStep(\n    ThrowingSupplier<T, E> stepfunc, \n    StepOptions opts\n) throws E\n\nstatic <T, E extends Exception> T runStep(\n    ThrowingSupplier<T, E> stepfunc, \n    String stepName\n) throws E\n\nstatic <E extends Exception> void runStep(\n    ThrowingRunnable<E> stepfunc, \n    StepOptions opts\n) throws E\n\nstatic <E extends Exception> runStep(\n    ThrowingRunnable<E> stepfunc, \n    String stepName\n) throws E\n"})}),"\n",(0,s.jsx)(n.p,{children:"Run a function as a step.  If called from within a workflow, the result is durably stored.\nReturns the output of the step."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Example Syntax:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'class ExampleImpl implements Example {\n\n    private void stepOne() {\n        System.out.println("Step one completed!");\n    }\n\n    private void stepTwo() {\n        System.out.println("Step two completed!");\n    }\n\n    @Workflow(name="workflow")\n    public void workflow() throws InterruptedException {\n        DBOS.runStep(() -> stepOne(), "stepOne");\n        DBOS.runStep(() -> stepTwo(), new StepOptions("stepTwo").withRetriesAllowed(false));\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h4,{id:"stepoptions",children:"StepOptions"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"StepOptions"})," is a with-based configuration record for parameterizing ",(0,s.jsx)(n.code,{children:"DBOS.runStep"}),". All fields except step name are optional."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Constructors:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"new StepOptions(String name)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Create step options and provide a name for this step."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Methods:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"withRetriesAllowed(boolean b)"})})," - Whether to retry the step if it throws an exception. Defaults to false."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"withMaxAttempts(int n)"})})," - How many times to retry a step that is throwing exceptions."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"withIntervalSeconds(double t)"})})," - How long to wait before the initial retry."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"withBackoffRate(double t)"})})," - How much to multiplicatively increase ",(0,s.jsx)(n.code,{children:"intervalSeconds"})," between retries."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"workflowhandle",children:"WorkflowHandle"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"public interface WorkflowHandle<T, E extends Exception> {\n\n  String workflowId();\n\n  T getResult() throws E;\n\n  WorkflowStatus getStatus();\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["WorkflowHandle provides methods to interact with a running or completed workflow.\nThe type parameters ",(0,s.jsx)(n.code,{children:"T"})," and ",(0,s.jsx)(n.code,{children:"E"})," represents the expected return type of the workflow and the checked exceptions it may throw.\nHandles can be used to wait for workflow completion, check status, and retrieve results."]}),"\n",(0,s.jsx)(n.h4,{id:"workflowhandlegetresult",children:"WorkflowHandle.getResult"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"T getResult() throws E;\n"})}),"\n",(0,s.jsx)(n.p,{children:"Wait for the workflow to complete and return its result."}),"\n",(0,s.jsx)(n.h4,{id:"workflowhandlegetstatus",children:"WorkflowHandle.getStatus"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"WorkflowStatus getStatus();\n"})}),"\n",(0,s.jsx)(n.p,{children:"Retrieve the WorkflowStatus of the workflow."}),"\n",(0,s.jsx)(n.h4,{id:"workflowhandleworkflowid",children:"WorkflowHandle.workflowId"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"String workflowId();\n"})}),"\n",(0,s.jsx)(n.p,{children:"Return the ID of the workflow underlying this handle."}),"\n",(0,s.jsx)(n.h3,{id:"workflowoptions",children:"WorkflowOptions"}),"\n",(0,s.jsxs)(n.p,{children:["When DBOS workflows are called directly, without using ",(0,s.jsx)(n.code,{children:"startWorkflow"})," or queues, workflow options are taken from a context kept by the calling thread.  This context is managed by the ",(0,s.jsx)(n.a,{href:"/java/reference/methods#workflowoptions",children:(0,s.jsx)(n.code,{children:"WorkflowOptions"})})," class."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var o=t(6540);const s={},r=o.createContext(s);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);