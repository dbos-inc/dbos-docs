"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[2864],{4614:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"typescript/reference/transactapi/oldapi/contexts","title":"DBOS Contexts","description":"API reference for DBOS contexts","source":"@site/docs/typescript/reference/transactapi/oldapi/contexts.md","sourceDirName":"typescript/reference/transactapi/oldapi","slug":"/typescript/reference/transactapi/oldapi/contexts","permalink":"/typescript/reference/transactapi/oldapi/contexts","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"DBOS Contexts","description":"API reference for DBOS contexts"},"sidebar":"tutorialSidebar","previous":{"title":"Workflow Queues","permalink":"/typescript/reference/transactapi/workflow-queues"},"next":{"title":"Decorators","permalink":"/typescript/reference/transactapi/oldapi/decorators"}}');var o=n(4848),i=n(8453);const s={sidebar_position:3,title:"DBOS Contexts",description:"API reference for DBOS contexts"},c=void 0,l={},d=[{value:"Background",id:"background",level:2},{value:"<code>DBOSContext</code>",id:"dboscontext",level:2},{value:"Properties",id:"properties",level:3},{value:"Methods",id:"methods",level:3},{value:"<code>ctxt.request</code>",id:"ctxtrequest",level:4},{value:"<code>ctxt.workflowUUID</code>",id:"ctxtworkflowuuid",level:4},{value:"<code>ctxt.authenticatedUser</code>",id:"ctxtauthenticateduser",level:4},{value:"<code>ctxt.authenticatedRoles</code>",id:"ctxtauthenticatedroles",level:4},{value:"<code>ctxt.assumedRole</code>",id:"ctxtassumedrole",level:4},{value:"<code>ctxt.logger</code>",id:"ctxtlogger",level:4},{value:"<code>ctxt.span</code>",id:"ctxtspan",level:4},{value:"<code>ctxt.getConfig</code>",id:"ctxtgetconfig",level:4},{value:"<code>HandlerContext</code>",id:"handlercontext",level:2},{value:"Properties",id:"properties-1",level:3},{value:"Methods",id:"methods-1",level:3},{value:"<code>handlerCtxt.koaContext</code>",id:"handlerctxtkoacontext",level:4},{value:"<code>handlerCtxt.invoke</code>",id:"handlerctxtinvoke",level:4},{value:"<code>handlerCtxt.invokeWorkflow</code>",id:"handlerctxtinvokeworkflow",level:4},{value:"<code>handlerCtxt.startWorkflow</code>",id:"handlerctxtstartworkflow",level:4},{value:"<code>handlerCtxt.retrieveWorkflow</code>",id:"handlerctxtretrieveworkflow",level:4},{value:"<code>handlerCtxt.send</code>",id:"handlerctxtsend",level:4},{value:"<code>handlerCtxt.getEvent</code>",id:"handlerctxtgetevent",level:4},{value:"<code>handlerCtxt.getWorkflows</code>",id:"handlerctxtgetworkflows",level:4},{value:"<code>WorkflowContext</code>",id:"workflowcontext",level:2},{value:"Methods",id:"methods-2",level:3},{value:"<code>workflowCtxt.invoke</code>",id:"workflowctxtinvoke",level:4},{value:"<code>workflowCtxt.invokeWorkflow</code>",id:"workflowctxtinvokeworkflow",level:4},{value:"<code>workflowCtxt.startWorkflow</code>",id:"workflowctxtstartworkflow",level:4},{value:"<code>workflowCtxt.invokeChildWorkflow</code>",id:"workflowctxtinvokechildworkflow",level:4},{value:"<code>workflowCtxt.startChildWorkflow</code>",id:"workflowctxtstartchildworkflow",level:4},{value:"<code>workflowCtxt.send</code>",id:"workflowctxtsend",level:4},{value:"<code>workflowCtxt.recv</code>",id:"workflowctxtrecv",level:4},{value:"<code>workflowCtxt.setEvent</code>",id:"workflowctxtsetevent",level:4},{value:"<code>workflowCtxt.getEvent</code>",id:"workflowctxtgetevent",level:4},{value:"<code>workflowCtxt.retrieveWorkflow</code>",id:"workflowctxtretrieveworkflow",level:4},{value:"<code>WorkflowContext.sleep</code>",id:"workflowcontextsleep",level:4},{value:"<code>WorkflowContext.sleepms</code>",id:"workflowcontextsleepms",level:4},{value:"<code>TransactionContext&lt;T&gt;</code>",id:"transactioncontextt",level:2},{value:"Generic Type Parameter",id:"generic-type-parameter",level:3},{value:"Properties",id:"properties-2",level:3},{value:"<code>transactionCtxt.client</code>",id:"transactionctxtclient",level:4},{value:"<code>StoredProcedureContext</code>",id:"storedprocedurecontext",level:2},{value:"Methods",id:"methods-3",level:3},{value:"<code>storedProcCtxt.query</code>",id:"storedprocctxtquery",level:4},{value:"<code>StepContext</code>",id:"stepcontext",level:2},{value:"Properties",id:"properties-3",level:4},{value:"<code>stepCtxt.retriesAllowed</code>",id:"stepctxtretriesallowed",level:4},{value:"<code>stepCtxt.maxAttempts</code>",id:"stepctxtmaxattempts",level:4},{value:"<code>CommunicatorContext</code>",id:"communicatorcontext",level:2},{value:"<code>InitContext</code>",id:"initcontext",level:2},{value:"Properties and Methods",id:"properties-and-methods",level:4},{value:"<code>InitContext.logger</code>",id:"initcontextlogger",level:4},{value:"<code>InitContext.queryUserDB</code>",id:"initcontextqueryuserdb",level:4},{value:"<code>InitContext.getConfig</code>",id:"initcontextgetconfig",level:4},{value:"<code>MiddlewareContext</code>",id:"middlewarecontext",level:2},{value:"Properties and Methods",id:"properties-and-methods-1",level:4},{value:"<code>MiddlewareContext.logger</code>",id:"middlewarecontextlogger",level:4},{value:"<code>MiddlewareContext.span</code>",id:"middlewarecontextspan",level:4},{value:"<code>MiddlewareContext.koaContext</code>",id:"middlewarecontextkoacontext",level:4},{value:"<code>MiddlewareContext.name</code>",id:"middlewarecontextname",level:4},{value:"<code>MiddlewareContext.requiredRole</code>",id:"middlewarecontextrequiredrole",level:4},{value:"<code>MiddlewareContext.getConfig</code>",id:"middlewarecontextgetconfig",level:4},{value:"<code>MiddlewareContext.query</code>",id:"middlewarecontextquery",level:4},{value:"<code>DBOSExecutorContext</code>",id:"dbosexecutorcontext",level:2},{value:"Properties and Methods",id:"properties-and-methods-2",level:3},{value:"<code>DBOSExecutorContext.logger</code>",id:"dbosexecutorcontextlogger",level:4},{value:"<code>DBOSExecutorContext.tracer</code>",id:"dbosexecutorcontexttracer",level:4},{value:"<code>DBOSExecutorContext.getConfig</code>",id:"dbosexecutorcontextgetconfig",level:4},{value:"<code>DBOSExecutorContext.getRegistrationsFor</code>",id:"dbosexecutorcontextgetregistrationsfor",level:4},{value:"<code>DBOSExecutorContext.workflow</code>",id:"dbosexecutorcontextworkflow",level:4},{value:"<code>DBOSExecutorContext.transaction</code>",id:"dbosexecutorcontexttransaction",level:4},{value:"<code>DBOSExecutorContext.external</code>",id:"dbosexecutorcontextexternal",level:4},{value:"<code>DBOSExecutorContext.send</code>",id:"dbosexecutorcontextsend",level:4},{value:"<code>DBOSExecutorContext.getEvent</code>",id:"dbosexecutorcontextgetevent",level:4},{value:"<code>DBOSExecutorContext.retrieveWorkflow</code>",id:"dbosexecutorcontextretrieveworkflow",level:4},{value:"<code>DBOSExecutorContext.upsertEventDispatchState</code>",id:"dbosexecutorcontextupserteventdispatchstate",level:4},{value:"<code>DBOSExecutorContext.getEventDispatchState</code>",id:"dbosexecutorcontextgeteventdispatchstate",level:4},{value:"<code>DBOSExecutorContext.queryUserDB</code>",id:"dbosexecutorcontextqueryuserdb",level:4},{value:"<code>DBOSExecutorContext.userDBListen</code>",id:"dbosexecutorcontextuserdblisten",level:4},{value:"Information Available Outside Of Contexts",id:"information-available-outside-of-contexts",level:2}];function a(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"background",children:"Background"}),"\n",(0,o.jsxs)(t.p,{children:["DBOS automatically supplies a ",(0,o.jsx)(t.em,{children:"context"})," to each registered function.\nA function can use its context to call other DBOS functions, interact with the runtime or the database, and access the logger.\nEach DBOS function has a specific context:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Contexts used within DBOS functions inherit from ",(0,o.jsx)(t.a,{href:"#dboscontext",children:(0,o.jsx)(t.code,{children:"DBOSContext"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["Handlers use ",(0,o.jsx)(t.a,{href:"#handlercontext",children:(0,o.jsx)(t.code,{children:"HandlerContext"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["Workflows use ",(0,o.jsx)(t.a,{href:"#workflowcontext",children:(0,o.jsx)(t.code,{children:"WorkflowContext"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["Transactions use ",(0,o.jsx)(t.a,{href:"#transactioncontextt",children:(0,o.jsx)(t.code,{children:"TransactionContext<T>"})})," with a specific database client type."]}),"\n",(0,o.jsxs)(t.li,{children:["Steps use ",(0,o.jsx)(t.a,{href:"#stepcontext",children:(0,o.jsx)(t.code,{children:"StepContext"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["Initialization functions use ",(0,o.jsx)(t.a,{href:"#initcontext",children:(0,o.jsx)(t.code,{children:"InitContext"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["Middleware functions use ",(0,o.jsx)(t.a,{href:"#middlewarecontext",children:(0,o.jsx)(t.code,{children:"MiddlewareContext"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["Event receivers use ",(0,o.jsx)(t.a,{href:"#dbosexecutorcontext",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext"})}),"."]}),"\n"]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"dboscontext",children:(0,o.jsx)(t.code,{children:"DBOSContext"})}),"\n",(0,o.jsxs)(t.p,{children:["Many contexts inherit from ",(0,o.jsx)(t.code,{children:"DBOSContext"})," and share its properties and methods.   (",(0,o.jsx)(t.code,{children:"InitContext"})," and ",(0,o.jsx)(t.code,{children:"MiddlewareContext"})," are exceptions, as these are applied outside the context of DBOS functions.)"]}),"\n",(0,o.jsx)(t.h3,{id:"properties",children:"Properties"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#ctxtrequest",children:"request"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#ctxtworkflowuuid",children:"workflowUUID"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#ctxtauthenticateduser",children:"authenticatedUser"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#ctxtauthenticatedroles",children:"authenticatedRoles"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#ctxtassumedrole",children:"assumedRole"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#ctxtlogger",children:"logger"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#ctxtspan",children:"span"})}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"methods",children:"Methods"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#ctxtgetconfig",children:"getConfig(key, defaultValue)"})}),"\n"]}),"\n",(0,o.jsx)(t.h4,{id:"ctxtrequest",children:(0,o.jsx)(t.code,{children:"ctxt.request"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly request: HTTPRequest\n"})}),"\n",(0,o.jsx)(t.p,{children:"An object with information about the originating HTTP request that triggered this function (directly or indirectly)."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"interface HTTPRequest {\n  readonly headers?: IncomingHttpHeaders;  // A node's http.IncomingHttpHeaders object.\n  readonly rawHeaders?: string[];          // Raw headers.\n  readonly params?: unknown;               // Parsed path parameters from the URL.\n  readonly body?: unknown;                 // parsed HTTP body as an object.\n  readonly rawBody?: string;               // Unparsed raw HTTP body string.\n  readonly query?: ParsedUrlQuery;         // Parsed query string.\n  readonly querystring?: string;           // Unparsed raw query string.\n  readonly url?: string;                   // Request URL.\n  readonly ip?: string;                    // Request remote address.\n}\n"})}),"\n",(0,o.jsx)(t.h4,{id:"ctxtworkflowuuid",children:(0,o.jsx)(t.code,{children:"ctxt.workflowUUID"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly workflowUUID: string\n"})}),"\n",(0,o.jsxs)(t.p,{children:["The current workflow's ",(0,o.jsx)(t.a,{href:"../../../tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"identity UUID"}),", a string uniquely identifying a workflow execution.\nIn a transaction or step, this field is set to the identity UUID of the calling workflow.\nIn a handler, this field is empty."]}),"\n",(0,o.jsx)(t.h4,{id:"ctxtauthenticateduser",children:(0,o.jsx)(t.code,{children:"ctxt.authenticatedUser"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly authenticatedUser: string\n"})}),"\n",(0,o.jsxs)(t.p,{children:["The identity of the authenticated user who ran this function.\nAuthenticated users are set by ",(0,o.jsx)(t.a,{href:"../../../tutorials/authentication-authorization",children:"authentication middleware"})," and inherited through the calling chain."]}),"\n",(0,o.jsx)(t.h4,{id:"ctxtauthenticatedroles",children:(0,o.jsx)(t.code,{children:"ctxt.authenticatedRoles"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly authenticatedRoles: string[];\n"})}),"\n",(0,o.jsxs)(t.p,{children:["A list of roles the authenticated user has, if any.\nAuthenticated roles are set by ",(0,o.jsx)(t.a,{href:"../../../tutorials/authentication-authorization",children:"authentication middleware"})," and inherited through the calling chain."]}),"\n",(0,o.jsx)(t.h4,{id:"ctxtassumedrole",children:(0,o.jsx)(t.code,{children:"ctxt.assumedRole"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly assumedRole: string;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["The role used to run this function.\nEmpty string if authorization is not required.\nDBOS's ",(0,o.jsx)(t.a,{href:"../../../tutorials/authentication-authorization#authorization-decorators",children:"authorization"})," sets the assumed role right before executing a function and this property is ",(0,o.jsx)(t.em,{children:"not"})," inherited through the calling chain."]}),"\n",(0,o.jsx)(t.h4,{id:"ctxtlogger",children:(0,o.jsx)(t.code,{children:"ctxt.logger"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly logger: DBOSLogger\n"})}),"\n",(0,o.jsxs)(t.p,{children:["A reference to DBOS's logger.\nPlease see our ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/logging",children:"logging tutorial"})," for more information."]}),"\n",(0,o.jsx)(t.h4,{id:"ctxtspan",children:(0,o.jsx)(t.code,{children:"ctxt.span"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly span: Span\n"})}),"\n",(0,o.jsxs)(t.p,{children:["An ",(0,o.jsx)(t.a,{href:"https://opentelemetry.io/docs/concepts/signals/traces/#spans",children:"OpenTelemetry Span"})," associated with this context.\nYou can assign custom trace attributes to this span.\nPlease see the ",(0,o.jsx)(t.a,{href:"https://github.com/open-telemetry/opentelemetry-js/blob/main/api/src/trace/span.ts",children:"Span API"})," for more information."]}),"\n",(0,o.jsx)(t.h4,{id:"ctxtgetconfig",children:(0,o.jsx)(t.code,{children:"ctxt.getConfig"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"getConfig<T>(key: string): T | undefined;\ngetConfig<T>(key: string, defaultValue: T): T;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Retrieves an application property specified in the ",(0,o.jsx)(t.a,{href:"/typescript/reference/configuration#application",children:"application section of the configuration"}),".\nOptionally accepts a default value, returned when the key cannot be found in the configuration."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"handlercontext",children:(0,o.jsx)(t.code,{children:"HandlerContext"})}),"\n",(0,o.jsxs)(t.p,{children:["Handlers use ",(0,o.jsx)(t.code,{children:"HandlerContext"})," to invoke other functions, interact with active workflows, and interact directly with HTTP requests and responses."]}),"\n",(0,o.jsx)(t.h3,{id:"properties-1",children:"Properties"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#handlerctxtkoacontext",children:"koaContext"})}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"methods-1",children:"Methods"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#handlerctxtinvoke",children:"invoke(target)"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#handlerctxtinvokeworkflow",children:"invokeWorkflow(target, [workflowID])"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#handlerctxtstartworkflow",children:"startWorkflow(target, [workflowID], [queue])"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#handlerctxtretrieveworkflow",children:"retrieveWorkflow(workflowID)"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#handlerctxtsend",children:"send(destinationUUID, message, [topic, idempotencyKey])"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#handlerctxtgetevent",children:"getEvent(workflowID, key, [timeoutSeconds])"})}),"\n"]}),"\n",(0,o.jsx)(t.h4,{id:"handlerctxtkoacontext",children:(0,o.jsx)(t.code,{children:"handlerCtxt.koaContext"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"koaContext: Koa.Context;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.a,{href:"https://github.com/koajs/koa/blob/master/docs/api/context.md",children:"Koa Context"})," of the current request, giving handlers access to the raw HTTP request and response."]}),"\n",(0,o.jsx)(t.h4,{id:"handlerctxtinvoke",children:(0,o.jsx)(t.code,{children:"handlerCtxt.invoke"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"invoke<T>(target: T, workflowID?: string): InvokeFuncs<T>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Invoke a transaction or step on the ",(0,o.jsx)(t.code,{children:"target"})," class or configured instance.\nTo invoke workflows, use ",(0,o.jsx)(t.a,{href:"#handlerctxtinvokeworkflow",children:(0,o.jsx)(t.code,{children:"invokeWorkflow"})})," or ",(0,o.jsx)(t.a,{href:"#handlerctxtstartworkflow",children:(0,o.jsx)(t.code,{children:"startWorkflow"})})," instead.\nThe syntax for invoking function ",(0,o.jsx)(t.code,{children:"fn"})," in class ",(0,o.jsx)(t.code,{children:"Cls"})," with argument ",(0,o.jsx)(t.code,{children:"arg"})," is:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"const output = await handlerCtxt.invoke(Cls).fn(arg);\n"})}),"\n",(0,o.jsxs)(t.p,{children:["You don't supply a context to the invoked function\u2014the DBOS Transact runtime does this for you.\nYou can optionally provide an idempotency key to the invoked function.\nFor more information, see our ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"idempotency tutorial"}),"."]}),"\n",(0,o.jsx)(t.h4,{id:"handlerctxtinvokeworkflow",children:(0,o.jsx)(t.code,{children:"handlerCtxt.invokeWorkflow"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"invokeWorkflow<T>(target: T, workflowID?: string): InvokeFuncs<T>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Invoke a workflow and wait for it to complete, returning its result.\nTo start a workflow without waiting for it to complete, use ",(0,o.jsx)(t.a,{href:"#handlerctxtstartworkflow",children:(0,o.jsx)(t.code,{children:"startWorkflow"})}),".\nThe syntax for invoking workflow ",(0,o.jsx)(t.code,{children:"wf"})," in class ",(0,o.jsx)(t.code,{children:"Cls"})," with argument ",(0,o.jsx)(t.code,{children:"arg"})," is:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"const output = await handlerCtxt.invokeWorkflow(Cls).wf(arg);\n"})}),"\n",(0,o.jsx)(t.p,{children:"You don't supply a context to the invoked workflow\u2014the DBOS Transact runtime does this for you."}),"\n",(0,o.jsx)(t.h4,{id:"handlerctxtstartworkflow",children:(0,o.jsx)(t.code,{children:"handlerCtxt.startWorkflow"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"startWorkflow<T>(target: T, workflowID?: string, queue?: WorkflowQueue): InvokeFuncs<T>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Start or enqueue a workflow and return a ",(0,o.jsx)(t.a,{href:"/typescript/reference/transactapi/workflow-handles",children:"handle"})," to it.\nThis does not wait for the workflow to complete, though the resulting handle can be used to wait for the workflow result.\nTo start a workflow and wait for the result, see ",(0,o.jsx)(t.a,{href:"#handlerctxtinvokeworkflow",children:(0,o.jsx)(t.code,{children:"invokeWorkflow"})}),".\nThe ",(0,o.jsx)(t.code,{children:"startWorkflow"})," method resolves after the handle is durably created; at this point the workflow is guaranteed to ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#reliability-guarantees",children:"run to completion"})," even if the handler is interrupted."]}),"\n",(0,o.jsxs)(t.p,{children:["The syntax for starting workflow ",(0,o.jsx)(t.code,{children:"wf"})," in class ",(0,o.jsx)(t.code,{children:"Cls"})," with argument ",(0,o.jsx)(t.code,{children:"arg"})," is:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"const workflowHandle = await handlerCtxt.startWorkflow(Cls).wf(arg);\n"})}),"\n",(0,o.jsxs)(t.p,{children:["If the ",(0,o.jsx)(t.code,{children:"workflowID"})," argument is provided, the workflow will ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"execute exactly once per the specified ID"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["If the ",(0,o.jsx)(t.code,{children:"queue"})," argument is provided, the workflow may not start immediately.  Start of execution will be determined by the ",(0,o.jsx)(t.a,{href:"/typescript/reference/transactapi/workflow-queues#class-workflowqueue",children:"queue"})," and its contents."]}),"\n",(0,o.jsx)(t.p,{children:"You don't supply a context to the newly started workflow\u2014the DBOS Transact runtime does this for you."}),"\n",(0,o.jsx)(t.h4,{id:"handlerctxtretrieveworkflow",children:(0,o.jsx)(t.code,{children:"handlerCtxt.retrieveWorkflow"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"retrieveWorkflow<R>(workflowID: string): WorkflowHandle<R>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Returns a ",(0,o.jsx)(t.a,{href:"/typescript/reference/transactapi/workflow-handles",children:"workflow handle"})," to the workflow with ",(0,o.jsx)(t.a,{href:"../../../tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"identity"})," ",(0,o.jsx)(t.code,{children:"workflowID"}),".\n",(0,o.jsx)(t.code,{children:"R"})," is the return type of the target workflow."]}),"\n",(0,o.jsx)(t.h4,{id:"handlerctxtsend",children:(0,o.jsx)(t.code,{children:"handlerCtxt.send"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"send<T extends NonNullable<any>>(destinationUUID: string, message: T, topic?: string, idempotencyKey?: string): Promise<void>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Sends a message to workflow ",(0,o.jsx)(t.code,{children:"destinationUUID"}),".\nMessages can optionally be associated with a topic.\nYou can provide an optional idempotency key to guarantee only a single message is sent even if ",(0,o.jsx)(t.code,{children:"send"})," is called more than once."]}),"\n",(0,o.jsx)(t.h4,{id:"handlerctxtgetevent",children:(0,o.jsx)(t.code,{children:"handlerCtxt.getEvent"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"getEvent<T extends NonNullable<any>>(workflowID: string, key: string, timeoutSeconds?: number): Promise<T | null>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Retrieves an event published by ",(0,o.jsx)(t.code,{children:"workflowID"})," for a given key using the ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-events",children:"events API"}),".\nAwaiting on the promise returned by ",(0,o.jsx)(t.code,{children:"getEvent()"})," waits for the workflow to publish the key, returning ",(0,o.jsx)(t.code,{children:"null"})," if the wait times out."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h4,{id:"handlerctxtgetworkflows",children:(0,o.jsx)(t.code,{children:"handlerCtxt.getWorkflows"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"getWorkflows(input: GetWorkflowsInput): Promise<GetWorkflowsOutput>\n"})}),"\n",(0,o.jsx)(t.p,{children:"This function allows querying workflow execution history. Its input is an object describing which workflows to retrieve (by default, retrieve all workflows):"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:'export interface GetWorkflowsInput {\n  workflowName?: string; // The name of the workflow function\n  authenticatedUser?: string; // The user who ran the workflow.\n  startTime?: string; // Timestamp in RFC 3339 format\n  endTime?: string; // Timestamp in RFC 3339 format\n  status?: "PENDING" | "SUCCESS" | "ERROR" | "RETRIES_EXCEEDED" | "CANCELLED" ; // The status of the workflow.\n  applicationVersion?: string; // The application version that ran this workflow.\n  limit?: number; // Return up to this many workflows IDs. IDs are ordered by workflow creation time.\n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["It returns as output an object containing a list of the ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"UUIDs"})," of all retrieved workflows, ordered by workflow creation time:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"export interface GetWorkflowsOutput {\n  workflowUUIDs: string[];\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["To obtain further information about a particular workflow, call ",(0,o.jsx)(t.a,{href:"#handlerctxtretrieveworkflow",children:(0,o.jsx)(t.code,{children:"retrieveWorkflow"})})," on its UUID to obtain its ",(0,o.jsx)(t.a,{href:"/typescript/reference/transactapi/workflow-handles",children:"handle"}),"."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"workflowcontext",children:(0,o.jsx)(t.code,{children:"WorkflowContext"})}),"\n",(0,o.jsxs)(t.p,{children:["Workflows use ",(0,o.jsx)(t.code,{children:"WorkflowContext"})," to invoke other functions and interact with other workflows."]}),"\n",(0,o.jsx)(t.h3,{id:"methods-2",children:"Methods"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#workflowctxtinvoke",children:"invoke(target)"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#workflowctxtinvokeworkflow",children:"invokeWorkflow(target)"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#workflowctxtstartworkflow",children:"startWorkflow(target)"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#workflowctxtsend",children:"send(destinationUUID, message, [topic])"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#workflowctxtrecv",children:"recv([topic, timeoutSeconds])"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#workflowctxtsetevent",children:"setEvent(key, value)"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#workflowctxtgetevent",children:"getEvent()"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#workflowctxtretrieveworkflow",children:"retrieveWorkflow(workflowID)"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#workflowcontextsleep",children:"sleep(durationSec)"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#workflowcontextsleepms",children:"sleepms(durationMS)"})}),"\n"]}),"\n",(0,o.jsx)(t.h4,{id:"workflowctxtinvoke",children:(0,o.jsx)(t.code,{children:"workflowCtxt.invoke"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"invoke<T>(target: T, workflowID?: string): InvokeFuncs<T>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Invoke transactions and steps.\nTo invoke other workflows, use ",(0,o.jsx)(t.a,{href:"#workflowctxtinvokeworkflow",children:(0,o.jsx)(t.code,{children:"invokeWorkflow"})})," or ",(0,o.jsx)(t.a,{href:"#workflowctxtstartworkflow",children:(0,o.jsx)(t.code,{children:"startWorkflow"})}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["The syntax for invoking function ",(0,o.jsx)(t.code,{children:"fn"})," in class ",(0,o.jsx)(t.code,{children:"Cls"})," with argument ",(0,o.jsx)(t.code,{children:"arg"})," is:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"const output = await workflowCtxt.invoke(Cls).fn(arg);\n"})}),"\n",(0,o.jsx)(t.p,{children:"You don't supply a context to the invoked function\u2014the DBOS Transact runtime does this for you."}),"\n",(0,o.jsx)(t.h4,{id:"workflowctxtinvokeworkflow",children:(0,o.jsx)(t.code,{children:"workflowCtxt.invokeWorkflow"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"invokeWorkflow<T>(target: T)\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Invoke a child workflow and wait for it to complete, returning its result.\nTo start a workflow without waiting it to complete, use ",(0,o.jsx)(t.a,{href:"#workflowctxtstartworkflow",children:(0,o.jsx)(t.code,{children:"startWorkflow"})}),".\nThe syntax for invoking workflow ",(0,o.jsx)(t.code,{children:"wf"})," in class ",(0,o.jsx)(t.code,{children:"Cls"})," with argument ",(0,o.jsx)(t.code,{children:"arg"})," is:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"const output = await ctxt.invokeWorkflow(Cls).wf(arg);\n"})}),"\n",(0,o.jsx)(t.p,{children:"You don't supply a context to the invoked child workflow\u2014the DBOS Transact runtime does this for you."}),"\n",(0,o.jsx)(t.h4,{id:"workflowctxtstartworkflow",children:(0,o.jsx)(t.code,{children:"workflowCtxt.startWorkflow"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"startWorkflow<T>(target: T, workflowID?: string, queue?: WorkflowQueue).workflowFunction(args)\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Start a child workflow and return a ",(0,o.jsx)(t.a,{href:"/typescript/reference/transactapi/workflow-handles",children:"handle"})," to it but do not wait for the workflow to complete.\nThis method resolves after the handle is durably created; at this point the workflow is guaranteed to ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#reliability-guarantees",children:"run to completion"}),".\nThe syntax for starting workflow ",(0,o.jsx)(t.code,{children:"wf"})," in class ",(0,o.jsx)(t.code,{children:"Cls"})," with argument ",(0,o.jsx)(t.code,{children:"arg"})," is:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"const workflowHandle = await ctxt.startWorkflow(Cls).wf(arg);\n"})}),"\n",(0,o.jsxs)(t.p,{children:["If the ",(0,o.jsx)(t.code,{children:"workflowID"})," argument is provided, the workflow will ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"execute exactly once per the specified ID"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["If the ",(0,o.jsx)(t.code,{children:"queue"})," argument is provided, the workflow may not start immediately.  Start of execution will be determined by the ",(0,o.jsx)(t.a,{href:"/typescript/reference/transactapi/workflow-queues#class-workflowqueue",children:"queue"})," and its contents."]}),"\n",(0,o.jsx)(t.p,{children:"You don't supply a context to the newly started child workflow\u2014the DBOS Transact runtime does this for you."}),"\n",(0,o.jsx)(t.h4,{id:"workflowctxtinvokechildworkflow",children:(0,o.jsx)(t.code,{children:"workflowCtxt.invokeChildWorkflow"})}),"\n",(0,o.jsxs)(t.p,{children:["Deprecated in favor of ",(0,o.jsx)(t.a,{href:"#workflowctxtinvokeworkflow",children:(0,o.jsx)(t.code,{children:"workflowCtxt.invokeWorkflow"})}),", which is equivalent but syntactically simpler."]}),"\n",(0,o.jsx)(t.h4,{id:"workflowctxtstartchildworkflow",children:(0,o.jsx)(t.code,{children:"workflowCtxt.startChildWorkflow"})}),"\n",(0,o.jsxs)(t.p,{children:["Deprecated in favor of ",(0,o.jsx)(t.a,{href:"#workflowctxtstartworkflow",children:(0,o.jsx)(t.code,{children:"workflowCtxt.startWorkflow"})}),", which is equivalent but syntactically simpler."]}),"\n",(0,o.jsx)(t.h4,{id:"workflowctxtsend",children:(0,o.jsx)(t.code,{children:"workflowCtxt.send"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"send<T extends NonNullable<any>>(destinationUUID: string, message: T, topic?: string): Promise<void>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Sends a message to ",(0,o.jsx)(t.code,{children:"destinationUUID"}),".\nMessages can optionally be associated with a topic.\nFor more information, see the ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-messaging-and-notifications",children:"messages API tutorial"}),"."]}),"\n",(0,o.jsx)(t.h4,{id:"workflowctxtrecv",children:(0,o.jsx)(t.code,{children:"workflowCtxt.recv"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"recv<T extends NonNullable<any>>(topic?: string, timeoutSeconds?: number): Promise<T | null>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Receive messages sent to the workflow, optionally for a particular topic.\nMessages are dequeued first-in, first-out, from a queue associated with the topic.\nCalls to ",(0,o.jsx)(t.code,{children:"recv()"})," wait for the next message in the queue, returning ",(0,o.jsx)(t.code,{children:"null"})," if the wait times out.\nIf no topic is specified, ",(0,o.jsx)(t.code,{children:"recv"})," can only access messages sent without a topic.\nFor more information, see the ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-messaging-and-notifications",children:"messages API tutorial"}),"."]}),"\n",(0,o.jsx)(t.h4,{id:"workflowctxtsetevent",children:(0,o.jsx)(t.code,{children:"workflowCtxt.setEvent"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"setEvent<T extends NonNullable<any>>(key: string, value: T): Promise<void>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Creates or updates an event named ",(0,o.jsx)(t.code,{children:"key"})," with value ",(0,o.jsx)(t.code,{children:"value"}),".\nWorkflows and HTTP handlers can read events by calling ",(0,o.jsx)(t.a,{href:"#handlerctxtgetevent",children:(0,o.jsx)(t.code,{children:"getEvent"})})," with the workflow's UUID.\nEvents are mutable.  Attempting to emit an event twice from a given workflow instance will update the value, but care should be taken to ensure that the value is calculated deterministically for consistency when workflows are recovered.\nFor more information, see the ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-events",children:"events API tutorial"}),"."]}),"\n",(0,o.jsx)(t.h4,{id:"workflowctxtgetevent",children:(0,o.jsx)(t.code,{children:"workflowCtxt.getEvent"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"getEvent<T extends NonNullable<any>>(workflowID: string, key: string, timeoutSeconds?: number): Promise<T | null>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Retrieves an event published by ",(0,o.jsx)(t.code,{children:"workflowID"})," for a given key using the ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-events",children:"events API"}),".\nAwaiting on the promise returned by ",(0,o.jsx)(t.code,{children:"getEvent()"})," waits for the workflow to set the key, returning ",(0,o.jsx)(t.code,{children:"null"})," if the wait times out."]}),"\n",(0,o.jsx)(t.h4,{id:"workflowctxtretrieveworkflow",children:(0,o.jsx)(t.code,{children:"workflowCtxt.retrieveWorkflow"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"retrieveWorkflow<R>(workflowID: string): WorkflowHandle<R>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Returns a ",(0,o.jsx)(t.a,{href:"/typescript/reference/transactapi/workflow-handles",children:"workflow handle"})," to the workflow with ",(0,o.jsx)(t.a,{href:"../../../tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"identity"})," ",(0,o.jsx)(t.em,{children:"workflowID"}),".\n",(0,o.jsx)(t.code,{children:"R"})," is the return type of the target workflow."]}),"\n",(0,o.jsx)(t.h4,{id:"workflowcontextsleep",children:(0,o.jsx)(t.code,{children:"WorkflowContext.sleep"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"sleep(durationSec: number): Promise<void>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Sleep for ",(0,o.jsx)(t.code,{children:"durationSec"})," seconds.\nThe wakeup time is set in the database when the function is first called, so if the workflow is re-executed, it will not oversleep."]}),"\n",(0,o.jsxs)(t.p,{children:["Alternatively, ",(0,o.jsx)(t.a,{href:"#workflowcontextsleepms",children:(0,o.jsx)(t.code,{children:"sleepms"})})," is more precise."]}),"\n",(0,o.jsx)(t.h4,{id:"workflowcontextsleepms",children:(0,o.jsx)(t.code,{children:"WorkflowContext.sleepms"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"sleepms(durationMS: number): Promise<void>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Sleep for ",(0,o.jsx)(t.code,{children:"durationMS"})," milliseconds.\nThe wakeup time is set in the database when the function is first called, so if the workflow is re-executed, it will not oversleep."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"transactioncontextt",children:(0,o.jsx)(t.code,{children:"TransactionContext<T>"})}),"\n",(0,o.jsxs)(t.p,{children:["Transactions use ",(0,o.jsx)(t.code,{children:"TransactionContext"})," to interact with the database."]}),"\n",(0,o.jsx)(t.h3,{id:"generic-type-parameter",children:"Generic Type Parameter"}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"TransactionContext"})," is typed generically based on the application database client in use.\nThe application database client is configurable in a project's ",(0,o.jsx)(t.a,{href:"../../configuration",children:"configuration file"})," (",(0,o.jsx)(t.code,{children:"app_db_client"}),").\nDBOS currently supports the following clients:"]}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.a,{href:"/typescript/tutorials/orms/using-knex",children:"Knex"})})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:'import { Knex } from "knex";\nstatic async exampleTransaction(ctxt: TransactionContext<Knex>, ...)\n'})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.a,{href:"/typescript/tutorials/orms/using-typeorm",children:"TypeORM"})})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:'import { EntityManager } from "typeorm";\nstatic async exampleTransaction(ctxt: TransactionContext<EntityManager>, ...)\n'})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.a,{href:"/typescript/tutorials/orms/using-prisma",children:"Prisma"})})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:'import { PrismaClient } from "@prisma/client";\nstatic async exampleTransaction(ctxt: TransactionContext<PrismaClient>, ...)\n'})}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.a,{href:"/typescript/tutorials/orms/using-drizzle",children:"Drizzle"})})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"import { NodePgDatabase } from 'drizzle-orm/node-postgres';\nstatic async exampleTransaction(ctxt: TransactionContext<NodePgDatabase>, ...)\n"})}),"\n",(0,o.jsx)(t.h3,{id:"properties-2",children:"Properties"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#transactionctxtclient",children:"client"})}),"\n"]}),"\n",(0,o.jsx)(t.h4,{id:"transactionctxtclient",children:(0,o.jsx)(t.code,{children:"transactionCtxt.client"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"client: T; // One of [Knex, EntityManager, PrismaClient, NodePgDatabase]\n"})}),"\n",(0,o.jsx)(t.p,{children:"Provides access to the chosen application database client.\nA transaction function should only interact with the application database using this client."}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"storedprocedurecontext",children:(0,o.jsx)(t.code,{children:"StoredProcedureContext"})}),"\n",(0,o.jsx)(t.p,{children:"Stored procedures use StoredProcedureContext to interact with the database."}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#storedprocctxtquery",children:"query"})}),"\n"]}),"\n",(0,o.jsx)(t.admonition,{type:"warning",children:(0,o.jsxs)(t.p,{children:["While ",(0,o.jsx)(t.code,{children:"StoredProcedureContext"})," supports most of the ",(0,o.jsx)(t.a,{href:"#dboscontext",children:(0,o.jsx)(t.code,{children:"DBOSContext"})})," methods, it does not support\neither the ",(0,o.jsx)(t.a,{href:"#ctxtspan",children:(0,o.jsx)(t.code,{children:"span"})})," property or the ",(0,o.jsx)(t.a,{href:"#ctxtgetconfig",children:(0,o.jsx)(t.code,{children:"getConfig<T>"})})," method."]})}),"\n",(0,o.jsx)(t.h3,{id:"methods-3",children:"Methods"}),"\n",(0,o.jsx)(t.h4,{id:"storedprocctxtquery",children:(0,o.jsx)(t.code,{children:"storedProcCtxt.query"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"type QueryResult<TRow> = {\n  rowCount: number;\n  rows?: TRow[];\n}\n\nquery<TRow>(sql: string, ...params: unknown[]): Promise<QueryResult<TRow>>;\n"})}),"\n",(0,o.jsx)(t.p,{children:"Execute a query against the database.\nReturns an object with query result rows (if any) and the number of rows affected by the query."}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"stepcontext",children:(0,o.jsx)(t.code,{children:"StepContext"})}),"\n",(0,o.jsxs)(t.p,{children:["Steps use ",(0,o.jsx)(t.code,{children:"StepContext"})," to retrieve configuration information."]}),"\n",(0,o.jsx)(t.h4,{id:"properties-3",children:"Properties"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#stepctxtretriesallowed",children:"retriesAllowed"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#stepctxtmaxattempts",children:"maxAttempts"})}),"\n"]}),"\n",(0,o.jsx)(t.h4,{id:"stepctxtretriesallowed",children:(0,o.jsx)(t.code,{children:"stepCtxt.retriesAllowed"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly retriesAllowed: boolean;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Whether the step is automatically retried on failure.\nConfigurable through the ",(0,o.jsx)(t.a,{href:"./decorators#step",children:(0,o.jsx)(t.code,{children:"@Step"})})," decorator."]}),"\n",(0,o.jsx)(t.h4,{id:"stepctxtmaxattempts",children:(0,o.jsx)(t.code,{children:"stepCtxt.maxAttempts"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly maxAttempts: number;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Maximum number of retries for the step.\nConfigurable through the ",(0,o.jsx)(t.a,{href:"./decorators#step",children:(0,o.jsx)(t.code,{children:"@Step"})})," decorator."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"communicatorcontext",children:(0,o.jsx)(t.code,{children:"CommunicatorContext"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"CommunicatorContext"})," is a historical synonym for ",(0,o.jsx)(t.a,{href:"#stepcontext",children:(0,o.jsx)(t.code,{children:"StepContext"})}),", as steps are frequently used to communicate with external systems."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"initcontext",children:(0,o.jsx)(t.code,{children:"InitContext"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"/typescript/reference/transactapi/oldapi/decorators#dbosinitializer",children:"Class initialization functions"})," and instance ",(0,o.jsx)(t.code,{children:"initialize()"})," methods are provided with an ",(0,o.jsx)(t.code,{children:"InitContext"}),", which provides access to configuration information, database access, and a logging facility."]}),"\n",(0,o.jsx)(t.h4,{id:"properties-and-methods",children:"Properties and Methods"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#initcontextlogger",children:"logger"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#initcontextqueryuserdb",children:"queryuserdb"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#initcontextgetconfig",children:"getconfig"})}),"\n"]}),"\n",(0,o.jsx)(t.h4,{id:"initcontextlogger",children:(0,o.jsx)(t.code,{children:"InitContext.logger"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly logger: Logger;\n"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"logger"})," is available to record any interesting successes, failures, or diagnostic information that occur during initialization."]}),"\n",(0,o.jsx)(t.h4,{id:"initcontextqueryuserdb",children:(0,o.jsx)(t.code,{children:"InitContext.queryUserDB"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"queryUserDB<R>(sql: string, ...params: unknown[]): Promise<R[]>;\n"})}),"\n",(0,o.jsx)(t.p,{children:"Accesses the user database directly with SQL.  This approach is to be used with caution, as using a string to represent SQL is not fully database independent and careless formation of the string can lead to SQL injection vulnerabilities."}),"\n",(0,o.jsx)(t.h4,{id:"initcontextgetconfig",children:(0,o.jsx)(t.code,{children:"InitContext.getConfig"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"getConfig<T>(key: string, defaultValue?: T): T | undefined;\n"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"getConfig"})," retrieves configuration information (from .yaml config file / environment).  If ",(0,o.jsx)(t.code,{children:"key"})," is not present in the configuration, ",(0,o.jsx)(t.code,{children:"defaultValue"})," is returned."]}),"\n",(0,o.jsx)(t.hr,{}),"\n",(0,o.jsx)(t.h2,{id:"middlewarecontext",children:(0,o.jsx)(t.code,{children:"MiddlewareContext"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"MiddlewareContext"})," is provided to functions that execute against a request before entry into handler, transaction, and workflow functions.  These middleware functions are generally executed before, or in the process of, user authentication, request validation, etc.  The context is intended to provide read-only database access, logging services, and configuration information."]}),"\n",(0,o.jsx)(t.h4,{id:"properties-and-methods-1",children:"Properties and Methods"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#middlewarecontextlogger",children:"logger"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#middlewarecontextspan",children:"span"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#middlewarecontextkoacontext",children:"koaContext"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#middlewarecontextname",children:"name"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#middlewarecontextrequiredrole",children:"requiredRole"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#middlewarecontextgetconfig",children:"getConfig"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"#middlewarecontextquery",children:"query"})}),"\n"]}),"\n",(0,o.jsx)(t.h4,{id:"middlewarecontextlogger",children:(0,o.jsx)(t.code,{children:"MiddlewareContext.logger"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly logger: DBOSLogger;\n"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"logger"})," is available to record any interesting successes, failures, or diagnostic information that occur during middleware processing."]}),"\n",(0,o.jsx)(t.h4,{id:"middlewarecontextspan",children:(0,o.jsx)(t.code,{children:"MiddlewareContext.span"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly span: Span;\n"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"span"})," is the tracing span in which the middleware is being executed."]}),"\n",(0,o.jsx)(t.h4,{id:"middlewarecontextkoacontext",children:(0,o.jsx)(t.code,{children:"MiddlewareContext.koaContext"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly koaContext: Koa.Context;\n"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"koaContext"})," is the Koa context, which contains the inbound HTTP request associated with the middleware invocation."]}),"\n",(0,o.jsx)(t.h4,{id:"middlewarecontextname",children:(0,o.jsx)(t.code,{children:"MiddlewareContext.name"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly name: string;\n"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"name"})," contains the name of the function (handler, transaction, workflow) to be invoked after successful middleware processing."]}),"\n",(0,o.jsx)(t.h4,{id:"middlewarecontextrequiredrole",children:(0,o.jsx)(t.code,{children:"MiddlewareContext.requiredRole"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly requiredRole: string[];\n"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"requiredRole"})," contains the list of roles required for the invoked operation.  Access to the function will granted if the user has any role on the list.  If the list is empty, it means there are no authorization requirements and may indicate that authentication is not required."]}),"\n",(0,o.jsx)(t.h4,{id:"middlewarecontextgetconfig",children:(0,o.jsx)(t.code,{children:"MiddlewareContext.getConfig"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"getConfig<T>(key: string, deflt: T | undefined) : T | undefined\n"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"getConfig"})," retrieves configuration information (from .yaml config file / environment).  If ",(0,o.jsx)(t.code,{children:"key"})," is not present in the configuration, ",(0,o.jsx)(t.code,{children:"defaultValue"})," is returned."]}),"\n",(0,o.jsx)(t.h4,{id:"middlewarecontextquery",children:(0,o.jsx)(t.code,{children:"MiddlewareContext.query"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"  query<C extends UserDatabaseClient, R, T extends unknown[]>(qry: (dbclient: C, ...args: T) => Promise<R>, ...args: T): Promise<R>;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"query"})," function provides read access to the database.\nTo provide a scoped database connection and to ensure cleanup, the ",(0,o.jsx)(t.code,{children:"query"})," API works via a callback function.\nThe application is to pass in a ",(0,o.jsx)(t.code,{children:"qry"})," function that will be executed in a context with access to the database client ",(0,o.jsx)(t.code,{children:"dbclient"}),".\nThe provided ",(0,o.jsx)(t.code,{children:"dbClient"})," will be a ",(0,o.jsx)(t.code,{children:"Knex"})," or TypeORM ",(0,o.jsx)(t.code,{children:"EntityManager"})," or ",(0,o.jsx)(t.code,{children:"PrismaClient"})," depending on the application's choice of SQL access library.\nThis callback function may take arguments, and return a value."]}),"\n",(0,o.jsx)(t.p,{children:"Example, for Knex:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:'  const u = await ctx.query(\n    // The qry function that takes in a dbClient and a list of arguments (uname in this case)\n    (dbClient: Knex, uname: string) => {\n      return dbClient<UserTable>(userTableName).select("username").where({ username: uname })\n    },\n    userName // Input value for the uname argument\n  );\n'})}),"\n",(0,o.jsx)(t.h2,{id:"dbosexecutorcontext",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext"})}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"DBOSExecutorContext"})," is used by event receivers to get their configuration information and invoke workflows, transactions, or communicators in response to received events."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"export interface DBOSExecutorContext\n{\n  readonly logger: Logger;\n  readonly tracer: Tracer;\n\n  getRegistrationsFor(eri: DBOSEventReceiver) : DBOSEventReceiverRegistration[];\n\n  workflow<T extends unknown[], R>(wf: WorkflowFunction<T, R>, params: WorkflowParams, ...args: T): Promise<WorkflowHandle<R>>;\n  transaction<T extends unknown[], R>(txnFn: TransactionFunction<T, R>, params: WorkflowParams, ...args: T): Promise<R>;\n  external<T extends unknown[], R>(stepFn: StepFunction<T, R>, params: WorkflowParams, ...args: T): Promise<R>;\n\n  send<T>(destinationUUID: string, message: T, topic?: string, idempotencyKey?: string): Promise<void>;\n  getEvent<T>(workflowID: string, key: string, timeoutSeconds: number): Promise<T | null>;\n  retrieveWorkflow<R>(workflowID: string): WorkflowHandle<R>;\n\n  getEventDispatchState(svc: string, wfn: string, key: string): Promise<DBOSEventReceiverState | undefined>;\n  upsertEventDispatchState(state: DBOSEventReceiverState): Promise<DBOSEventReceiverState>;\n\n  queryUserDB(sql: string, params?: unknown[]): Promise<unknown[]>;\n\n  userDBListen(channels: string[], callback: DBNotificationCallback): Promise<DBNotificationListener>;\n}\n"})}),"\n",(0,o.jsx)(t.h3,{id:"properties-and-methods-2",children:"Properties and Methods"}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextlogger",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.logger"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly logger: Logger\n"})}),"\n",(0,o.jsxs)(t.p,{children:["A reference to DBOS's global logger.  Event receivers may log information related to event dispatch to this logger.\nPlease see our ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/logging",children:"logging tutorial"})," for more information."]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontexttracer",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.tracer"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"readonly tracer: Tracer;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["A reference to DBOS's tracer.  Event receivers may initiate or propagate tracing information via ",(0,o.jsx)(t.code,{children:"tracer"}),".\nPlease see our ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/logging",children:"logging tutorial"})," for more information."]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextgetconfig",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.getConfig"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"getConfig<T>(key: string, defaultValue: T | undefined) : T | undefined\n"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"getConfig"})," retrieves configuration information (from .yaml config file / environment).  If ",(0,o.jsx)(t.code,{children:"key"})," is not present in the configuration, ",(0,o.jsx)(t.code,{children:"defaultValue"})," is returned."]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextgetregistrationsfor",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.getRegistrationsFor"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"export interface DBOSEventReceiverRegistration {\n  methodConfig: unknown,\n  classConfig: unknown,\n  methodReg: MethodRegistrationBase\n}\n\ngetRegistrationsFor(eri: DBOSEventReceiver) : DBOSEventReceiverRegistration[];\n"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"getRegistrationsFor"})," provides a list of all method registrations associated with the specified ",(0,o.jsx)(t.code,{children:"DBOSEventReceiver"}),".  Each method registration includes configuration and dispatch information:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"classConfig"}),": Any configuration information collected by class-level decorators"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"methodConfig"}),": Any configuration information collected by method-level decorators"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"methodReg"}),": Reference to the method to be called for each event"]}),"\n"]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextworkflow",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.workflow"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"workflow<T extends unknown[], R>(\n  wf: WorkflowFunction<T, R>, params: WorkflowParams, ...args: T\n) : Promise<WorkflowHandle<R>>;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Invokes the provided ",(0,o.jsx)(t.code,{children:"wf"})," workflow function, with inputs specified by ",(0,o.jsx)(t.code,{children:"args"}),".  The ",(0,o.jsx)(t.code,{children:"WorkflowParams"})," control how the workflow is started:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"WorkflowParams.workflowUUID"}),": Set the workflow ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"idempotency key"}),", for OAOO."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"WorkflowParams.queueName"}),": Indicate that the workflow is to be run in a ",(0,o.jsx)(t.a,{href:"/typescript/reference/transactapi/workflow-queues#class-workflowqueue",children:"queue"}),", with the provided name.  The queue with the provided ",(0,o.jsx)(t.code,{children:"queueName"})," must have been created and registered prior to executing ",(0,o.jsx)(t.code,{children:"workflow"}),", as the queue provides necessary concurrency and rate-limiting information."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["The return value of ",(0,o.jsx)(t.code,{children:"workflow"})," is a ",(0,o.jsx)(t.a,{href:"/typescript/reference/transactapi/workflow-handles",children:(0,o.jsx)(t.code,{children:"WorkflowHandle"})})," for the running or queued workflow."]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontexttransaction",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.transaction"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"transaction<T extends unknown[], R>(\n  txnFn: TransactionFunction<T, R>, params: WorkflowParams, ...args: T\n) : Promise<R>;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Invokes a single-operation workflow consisting of the provided ",(0,o.jsx)(t.code,{children:"txnFn"})," function, with inputs specified by ",(0,o.jsx)(t.code,{children:"args"}),".  For additional information, see ",(0,o.jsx)(t.a,{href:"#dbosexecutorcontextworkflow",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.workflow"})}),"."]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextexternal",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.external"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"external<T extends unknown[], R>(\n  stepFn: StepFunction<T, R>, params: WorkflowParams, ...args: T\n) : Promise<R>;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Invokes a single-operation workflow consisting of the provided ",(0,o.jsx)(t.code,{children:"stepFn"})," function, with inputs specified by ",(0,o.jsx)(t.code,{children:"args"}),".  For additional information on ",(0,o.jsx)(t.code,{children:"WorkflowParams"}),", see ",(0,o.jsx)(t.a,{href:"#dbosexecutorcontextworkflow",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.workflow"})}),"."]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextsend",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.send"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"send<T extends NonNullable<any>>(destinationID: string, message: T, topic?: string, idempotencyKey?: string): Promise<void>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Sends a message to the workflow identified by ",(0,o.jsx)(t.code,{children:"destinationID"}),".\nMessages can optionally be associated with a topic.\nYou can provide an optional idempotency key to guarantee only a single message is sent even if ",(0,o.jsx)(t.code,{children:"send"})," is called more than once.\nFor more information, see the ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-messaging-and-notifications",children:"messages API tutorial"}),"."]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextgetevent",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.getEvent"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"getEvent<T extends NonNullable<any>>(workflowID: string, key: string, timeoutSeconds?: number): Promise<T | null>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Retrieves an event published by ",(0,o.jsx)(t.code,{children:"workflowID"})," for a given key using the ",(0,o.jsx)(t.a,{href:"/typescript/tutorials/workflow-tutorial#workflow-events",children:"events API"}),".\nAwaiting on the promise returned by ",(0,o.jsx)(t.code,{children:"getEvent()"})," waits for the workflow to set the key, returning ",(0,o.jsx)(t.code,{children:"null"})," if the wait times out."]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextretrieveworkflow",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.retrieveWorkflow"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"retrieveWorkflow<R>(workflowID: string): WorkflowHandle<R>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Returns a ",(0,o.jsx)(t.a,{href:"/typescript/reference/transactapi/workflow-handles",children:"workflow handle"})," to the workflow with ",(0,o.jsx)(t.a,{href:"../../../tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"identity"})," ",(0,o.jsx)(t.code,{children:"workflowID"}),".\n",(0,o.jsx)(t.code,{children:"R"})," is the return type of the target workflow."]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextupserteventdispatchstate",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.upsertEventDispatchState"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"upsertEventDispatchState(state: DBOSEventReceiverState): Promise<DBOSEventReceiverState>;\n\nexport interface DBOSEventReceiverState\n{\n  service: string;\n  workflowFnName: string;\n  key: string;\n  value?: string;\n  updateTime?: number;\n  updateSeq?: bigint;\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["An event receiver may keep state in the system database.  This state may be helpful for backfilling events that came in while the event receiver was not running.  This state uses a key/value store design, where the event receiver may use ",(0,o.jsx)(t.code,{children:"upsertEventDispatchState"})," to insert/update the value associated with a key, and retrieve the value associated with a key.  This implementation also supports the notion of an update time or update sequence; updates made with lower sequence numbers or times are discared if the existing entry is marked with a later sequence / time."]}),"\n",(0,o.jsx)(t.p,{children:"The key consists of:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"service"}),": ",(0,o.jsx)(t.code,{children:"service"})," should be unique to the event receiver keeping state, to separate from other table users"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"workflowFnName"}),": ",(0,o.jsx)(t.code,{children:"workflowFnName"})," workflow function name should be the fully qualified / unique function name dispatched, to keep state separate by event function"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"key"}),": The ",(0,o.jsx)(t.code,{children:"key"})," field allows multiple records per service / workflow function"]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["The value stored for each ",(0,o.jsx)(t.code,{children:"service"}),"/",(0,o.jsx)(t.code,{children:"workflowFnName"}),"/",(0,o.jsx)(t.code,{children:"key"})," combination includes:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"value"}),": ",(0,o.jsx)(t.code,{children:"value"})," is a string value.  JSON can be used to encode more complex values."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"updateTime"}),": The time ",(0,o.jsx)(t.code,{children:"value"})," was set.  Upserts of records with an earlier ",(0,o.jsx)(t.code,{children:"updateTime"})," will have no effect on the stored state."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"updateSeq"}),": An integer number indicating when the value was set.  Upserts of records with a smaller ",(0,o.jsx)(t.code,{children:"updateSeq"})," will have no effect on the stored state."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"upsertEventDispatchState"})," inserts a value associated with a key.  If a value is already associated with the specified key, the stored value will be updated, unless ",(0,o.jsx)(t.code,{children:"updateTime"})," or ",(0,o.jsx)(t.code,{children:"updateSeq"})," is provided, and is less that what is already stored in the system database."]}),"\n",(0,o.jsx)(t.p,{children:"The function return value indicates the contents of the system database for the specified key.  This is useful to detect if a more recent record is alreadys stored in the database."}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextgeteventdispatchstate",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.getEventDispatchState"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"getEventDispatchState(service: string, workflowFnName: string, key: string)\n  : Promise<DBOSEventReceiverState | undefined>;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Retrieve the value set for an event receiver's key, as stored by ",(0,o.jsx)(t.a,{href:"#dbosexecutorcontextupserteventdispatchstate",children:(0,o.jsx)(t.code,{children:"upsertEventDispatchState"})})," above.  If no value has been associated with the combination of ",(0,o.jsx)(t.code,{children:"service"}),"/",(0,o.jsx)(t.code,{children:"workflowFnName"}),"/",(0,o.jsx)(t.code,{children:"key"})," above, then ",(0,o.jsx)(t.code,{children:"undefined"})," is returned."]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextqueryuserdb",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.queryUserDB"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"queryUserDB(sql: string, params?: unknown[]): Promise<unknown[]>;\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Executes the provided ",(0,o.jsx)(t.code,{children:"sql"})," template against the default user application database, using ",(0,o.jsx)(t.code,{children:"params"}),"."]}),"\n",(0,o.jsx)(t.h4,{id:"dbosexecutorcontextuserdblisten",children:(0,o.jsx)(t.code,{children:"DBOSExecutorContext.userDBListen"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"interface DBNotification {\n    channel: string;\n    payload?: string;\n}\n\ntype DBNotificationCallback = (n: DBNotification) => void;\n\ninterface DBNotificationListener {\n  close(): Promise<void>;\n}\n\nuserDBListen(channels: string[], callback: DBNotificationCallback): Promise<DBNotificationListener>;\n"})}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"userDBListen"})," listens for notifications within the default user application database:"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"channels"})," is a list of notification channels of interest"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"callback"})," will be executed for each notification received\nThe return value of ",(0,o.jsx)(t.code,{children:"userDBListen"})," is a ",(0,o.jsx)(t.code,{children:"DBNotificationListener"})," which should be used to ",(0,o.jsx)(t.code,{children:"close"})," the listener and stop the listening operation cleanly."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"callback"})," is the function that will be called when notifications arrive; it is provided with a ",(0,o.jsx)(t.code,{children:"DBNotification"})," containing the ",(0,o.jsx)(t.code,{children:"channel"})," and optional ",(0,o.jsx)(t.code,{children:"payload"})," of the received notification."]}),"\n",(0,o.jsx)(t.h2,{id:"information-available-outside-of-contexts",children:"Information Available Outside Of Contexts"}),"\n",(0,o.jsxs)(t.p,{children:["While most code is executed within one of the numerous DBOS contexts, there are a few exceptions, such as the HTTP server, its non-DBOS middleware, or background tasks.  For these cases, it is possible to access the ",(0,o.jsx)(t.code,{children:"globalLogger"})," and ",(0,o.jsx)(t.code,{children:"dbosConfig"})," from a global location:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"import { DBOS } from \"@dbos-inc/dbos-sdk\";\n\nfunction myFunc() {\n  DBOS.globalLogger?.info(`There is no context here, but I need to log something anyway!\n                    My config is '${dbosConfig?.application?.myvalue}'`);\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["The definition of ",(0,o.jsx)(t.code,{children:"DBOS"})," is:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-typescript",children:"class DBOS {\n  static globalLogger?: GlobalLogger; // The global logger\n  static dbosConfig?: DBOSConfig; // The global DBOS configuration\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Note that ",(0,o.jsx)(t.code,{children:"DBOS"})," is not fully available util runtime initialization starts."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>c});var r=n(6540);const o={},i=r.createContext(o);function s(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);