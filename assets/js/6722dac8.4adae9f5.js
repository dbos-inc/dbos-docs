"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[2418],{9652:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"typescript/tutorials/instantiated-objects","title":"Using Typescript Objects","description":"Learn how to make workflows, transactions, and steps reusable and configurable by instantiating objects","source":"@site/docs/typescript/tutorials/instantiated-objects.md","sourceDirName":"typescript/tutorials","slug":"/typescript/tutorials/instantiated-objects","permalink":"/typescript/tutorials/instantiated-objects","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":85,"frontMatter":{"sidebar_position":85,"title":"Using Typescript Objects","description":"Learn how to make workflows, transactions, and steps reusable and configurable by instantiating objects"},"sidebar":"tutorialSidebar","previous":{"title":"Stored Procedures","permalink":"/typescript/tutorials/stored-proc-tutorial"},"next":{"title":"Debugging","permalink":"/typescript/tutorials/debugging"}}');var i=t(4848),o=t(8453);const a={sidebar_position:85,title:"Using Typescript Objects",description:"Learn how to make workflows, transactions, and steps reusable and configurable by instantiating objects"},r=void 0,c={},l=[{value:"Using Configured Class Instances",id:"using-configured-class-instances",level:2},{value:"Writing New Configured Classes",id:"writing-new-configured-classes",level:3},{value:"<code>initialize()</code> Method",id:"initialize-method",level:3},{value:"Notes",id:"notes",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["You can add DBOS workflow, step, and transaction decorators to your TypeScript class instance methods.\nTo add DBOS decorators to your instance methods, their class must inherit from ",(0,i.jsx)(n.code,{children:"ConfiguredInstance"}),", which will take an instance name and register the instance."]}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"class MyClass extends ConfiguredInstance {\n  cfg: MyConfig;\n  constructor(name: string, config: MyConfig) {\n    super(name);\n    this.cfg = cfg;\n  }\n\n  async initialize(_ctx: InitContext) : Promise<void> {\n    // ... Validate this.cfg\n  }\n\n  @DBOS.transaction()\n  async testTransaction() {\n    // ... Operations that use this.cfg\n  }\n\n  @DBOS.step()\n  async testStep() {\n    // ... Operations that use this.cfg\n  }\n\n  @DBOS.workflow()\n  async testWorkflow(p: string): Promise<void> {\n    // ... Operations that use this.cfg\n  }\n}\n\nconst myClassInstance = new MyClass('instanceA');\n"})}),"\n",(0,i.jsxs)(n.p,{children:["When you create a new instance of a DBOS-decorated class, the constructor for the base ",(0,i.jsx)(n.code,{children:"ConfiguredInstance"})," must be called with a ",(0,i.jsx)(n.code,{children:"name"}),". This ",(0,i.jsx)(n.code,{children:"name"})," should be unique among instances of the same class.   Additionally, all ",(0,i.jsx)(n.code,{children:"ConfiguredInstance"})," classes must be instantiated before DBOS.launch() is called."]}),"\n",(0,i.jsxs)(n.p,{children:["The reason for these requirements is to enable workflow recovery.  When you create a new instance of, DBOS stores it in a global registry indexed by ",(0,i.jsx)(n.code,{children:"name"}),".  When DBOS needs to recover a workflow belonging to that class, it looks up the ",(0,i.jsx)(n.code,{children:"name"})," so it can run the workflow using the right class instance.  While names are used by DBOS Transact internally to find the correct object instance across system restarts, they are also potentially useful for monitoring, tracing, and debugging."]}),"\n",(0,i.jsx)(n.h2,{id:"using-configured-class-instances",children:"Using Configured Class Instances"}),"\n",(0,i.jsx)(n.p,{children:"Configured class instances should be created and named when the application starts, before any workflows run.  This ensures that they will all be initialized before any processing begins."}),"\n",(0,i.jsx)(n.h3,{id:"writing-new-configured-classes",children:"Writing New Configured Classes"}),"\n",(0,i.jsx)(n.p,{children:"All configured classes must:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Extend from the ",(0,i.jsx)(n.code,{children:"ConfiguredInstance"})," base class"]}),"\n",(0,i.jsxs)(n.li,{children:["Provide a constructor, which can take any arguments, but must provide a name to the base ",(0,i.jsx)(n.code,{children:"ConfiguredInstance"})," constructor"]}),"\n",(0,i.jsxs)(n.li,{children:["Have an ",(0,i.jsx)(n.code,{children:"initialize(ctx: InitContext)"})," that will be called after all objects have been created, but before request handling commences"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"initialize-method",children:[(0,i.jsx)(n.code,{children:"initialize()"})," Method"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"initialize(ctx: InitContext)"})," method will be called during application initialization, after the code modules have been loaded, but before request and workflow processing commences.  The ",(0,i.jsx)(n.code,{children:"InitContext"})," argument provides configuration file, logging, and database access services, so any validation of connection information (complete with diagnostic logging and reporting of any problems) should be performed in ",(0,i.jsx)(n.code,{children:"initialize()"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,i.jsxs)(n.p,{children:["Event and handler registration decorators such as ",(0,i.jsx)(n.code,{children:"@DBOS.scheduled"}),", ",(0,i.jsx)(n.code,{children:"@KafkaConsume"}),", ",(0,i.jsx)(n.code,{children:"@DBOS.getApi"}),", and ",(0,i.jsx)(n.code,{children:"@DBOS.putApi"})," cannot be applied to instance methods."]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(6540);const i={},o=s.createContext(i);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);