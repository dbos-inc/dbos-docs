"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[5835],{4961:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"golang/reference/client","title":"DBOS Client","description":"Client provides a programmatic way to interact with your DBOS application from external code.","source":"@site/docs/golang/reference/client.md","sourceDirName":"golang/reference","slug":"/golang/reference/client","permalink":"/golang/reference/client","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":50,"frontMatter":{"sidebar_position":50,"title":"DBOS Client"},"sidebar":"tutorialSidebar","previous":{"title":"DBOS CLI","permalink":"/golang/reference/cli"},"next":{"title":"Fault-Tolerant Checkout","permalink":"/golang/examples/widget-store"}}');var i=o(4848),t=o(8453);const s={sidebar_position:50,title:"DBOS Client"},l=void 0,a={},c=[{value:"Constructor",id:"constructor",level:3},{value:"Shutdown",id:"shutdown",level:3},{value:"Workflow Interaction Methods",id:"workflow-interaction-methods",level:2},{value:"Enqueue",id:"enqueue",level:3},{value:"RetrieveWorkflow",id:"retrieveworkflow",level:3},{value:"Send",id:"send",level:3},{value:"GetEvent",id:"getevent",level:3},{value:"Workflow Management Methods",id:"workflow-management-methods",level:2},{value:"ListWorkflows",id:"listworkflows",level:3},{value:"GetWorkflowSteps",id:"getworkflowsteps",level:3},{value:"CancelWorkflow",id:"cancelworkflow",level:3},{value:"ResumeWorkflow",id:"resumeworkflow",level:3},{value:"ForkWorkflow",id:"forkworkflow",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Client"})," provides a programmatic way to interact with your DBOS application from external code.\n",(0,i.jsx)(n.code,{children:"Client"})," includes methods similar to ",(0,i.jsx)(n.a,{href:"/golang/reference/dbos-context",children:(0,i.jsx)(n.code,{children:"DBOSContext"})})," that can be used outside of a DBOS application."]}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.mdxAdmonitionTitle,{}),(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"Client"})," is included in the ",(0,i.jsx)(n.code,{children:"dbos"})," package, the same package that is used by DBOS applications.\nWhere DBOS applications use the ",(0,i.jsxs)(n.a,{href:"/golang/reference/dbos-context",children:[(0,i.jsx)(n.code,{children:"DBOSContext"})," methods"]}),",\nexternal applications use ",(0,i.jsx)(n.code,{children:"Client"})," methods instead."]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"type Client interface {\n    Enqueue(queueName, workflowName string, input any, opts ...EnqueueOption) (WorkflowHandle[any], error)\n    ListWorkflows(opts ...ListWorkflowsOption) ([]WorkflowStatus, error)\n    Send(destinationID string, message any, topic string) error\n    GetEvent(targetWorkflowID, key string, timeout time.Duration) (any, error)\n    RetrieveWorkflow(workflowID string) (WorkflowHandle[any], error)\n    CancelWorkflow(workflowID string) error\n    ResumeWorkflow(workflowID string) (WorkflowHandle[any], error)\n    ForkWorkflow(input ForkWorkflowInput) (WorkflowHandle[any], error)\n    GetWorkflowSteps(workflowID string) ([]StepInfo, error)\n    Shutdown(timeout time.Duration)\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"constructor",children:"Constructor"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"func NewClient(ctx context.Context, config ClientConfig) (Client, error)\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ctx"}),": A context for initialization operations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"config"}),": A ",(0,i.jsx)(n.code,{children:"ClientConfig"})," object with connection and application settings"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'type ClientConfig struct {\n    DatabaseURL        string        // DatabaseURL is a PostgreSQL connection string. Either this or SystemDBPool is required.\n    SystemDBPool       *pgxpool.Pool // SystemDBPool is a custom System Database Pool. It\'s optional and takes precedence over DatabaseURL if both are provided.\n    DatabaseSchema string            // Database schema name (defaults to "dbos")\n    Logger             *slog.Logger  // Optional custom logger\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A new ",(0,i.jsx)(n.code,{children:"Client"})," instance or an error if initialization fails"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example syntax:"})}),"\n",(0,i.jsx)(n.p,{children:"This DBOS client connects to the system database specified in the configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'config := dbos.ClientConfig{\n    DatabaseURL: os.Getenv("DBOS_SYSTEM_DATABASE_URL"),\n}\nclient, err := dbos.NewClient(context.Background(), config)\nif err != nil {\n    log.Fatal(err)\n}\ndefer client.Shutdown(5 * time.Second)\n'})}),"\n",(0,i.jsxs)(n.p,{children:["A client manages a connection pool to the ",(0,i.jsx)(n.a,{href:"/explanations/system-tables",children:"DBOS system database"}),". Calling ",(0,i.jsx)(n.code,{children:"Shutdown"})," on a client will release the connection pool."]}),"\n",(0,i.jsx)(n.h3,{id:"shutdown",children:"Shutdown"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"Shutdown(timeout time.Duration)\n"})}),"\n",(0,i.jsx)(n.p,{children:"Gracefully shuts down the client and releases the system database connection pool."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"timeout"}),": Maximum time to wait for graceful shutdown"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"workflow-interaction-methods",children:"Workflow Interaction Methods"}),"\n",(0,i.jsx)(n.h3,{id:"enqueue",children:"Enqueue"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"func Enqueue[P any, R any](\n    c Client, \n    queueName string,\n    workflowName string, \n    input P, \n    opts ...EnqueueOption\n) (WorkflowHandle[R], error)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Enqueue a workflow for processing and return a handle to it, similar to ",(0,i.jsx)(n.a,{href:"/golang/reference/workflows-steps#withqueue",children:"RunWorkflow with the WithQueue option"}),".\nReturns a ",(0,i.jsx)(n.a,{href:"/golang/reference/workflows-steps#workflowhandle",children:"WorkflowHandle"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["When enqueuing a workflow from the DBOS client, you must specify the name of the workflow to enqueue (rather than passing a workflow function as with ",(0,i.jsx)(n.code,{children:"RunWorkflow"}),".)"]}),"\n",(0,i.jsx)(n.p,{children:"Required parameters:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"c"}),": The DBOS client instance"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"queueName"}),": The name of the ",(0,i.jsx)(n.a,{href:"/golang/reference/queues",children:"queue"})," on which to enqueue the workflow"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"workflowName"}),": The name of the workflow function being enqueued"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"input"}),": The input to pass to the workflow"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Optional configuration via ",(0,i.jsx)(n.code,{children:"EnqueueOption"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WithEnqueueWorkflowID(id string)"}),": The unique ID for the enqueued workflow.\nIf left undefined, DBOS Client will generate a ",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Universally_unique_identifier",children:"UUID"}),".\nPlease see ",(0,i.jsx)(n.a,{href:"/golang/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"Workflow IDs and Idempotency"})," for more information."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WithEnqueueApplicationVersion(version string)"}),": The version of your application that should process this workflow.\nIf left undefined, it will use the current application version."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WithEnqueueTimeout(timeout time.Duration)"}),": Set a timeout for the enqueued workflow. When the timeout expires, the workflow ",(0,i.jsx)(n.strong,{children:"and all its children"})," are cancelled (except if the child's context has been made uncancellable using ",(0,i.jsx)(n.a,{href:"/golang/reference/dbos-context#withoutcancel",children:(0,i.jsx)(n.code,{children:"WithoutCancel"})}),"). The timeout does not begin until the workflow is dequeued and starts execution."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WithEnqueueDeduplicationID(id string)"}),": At any given time, only one workflow with a specific deduplication ID can be enqueued in the specified queue. If a workflow with a deduplication ID is currently enqueued or actively executing (status ",(0,i.jsx)(n.code,{children:"ENQUEUED"})," or ",(0,i.jsx)(n.code,{children:"PENDING"}),"), subsequent workflow enqueue attempts with the same deduplication ID in the same queue will fail."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"WithEnqueuePriority(priority uint)"}),": The priority of the enqueued workflow in the specified queue. Workflows with the same priority are dequeued in ",(0,i.jsx)(n.strong,{children:"FIFO (first in, first out)"})," order. Priority values can range from ",(0,i.jsx)(n.code,{children:"1"})," to ",(0,i.jsx)(n.code,{children:"2,147,483,647"}),", where ",(0,i.jsx)(n.strong,{children:"a low number indicates a higher priority"}),". Workflows without assigned priorities have the highest priority and are dequeued before workflows with assigned priorities."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example syntax:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'type ProcessInput struct {\n    TaskID string\n    Data   string\n}\n\ntype ProcessOutput struct {\n    Result string\n    Status string\n}\n\nhandle, err := dbos.Enqueue[ProcessInput, ProcessOutput](\n    client, \n    "process_queue",\n    "ProcessWorkflow",\n    ProcessInput{TaskID: "task-123", Data: "data"},\n    dbos.WithEnqueueTimeout(30 * time.Minute),\n    dbos.WithEnqueuePriority(5),\n)\nif err != nil {\n    log.Fatal(err)\n}\n\nresult, err := handle.GetResult()\nif err != nil {\n    log.Printf("Workflow failed: %v", err)\n} else {\n    log.Printf("Result: %+v", result)\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"retrieveworkflow",children:"RetrieveWorkflow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"RetrieveWorkflow(workflowID string) (WorkflowHandle[any], error)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Retrieve the ",(0,i.jsx)(n.a,{href:"/golang/reference/workflows-steps#workflowhandle",children:"handle"})," of a workflow with identity ",(0,i.jsx)(n.code,{children:"workflowID"}),".\nSimilar to ",(0,i.jsx)(n.a,{href:"/golang/reference/methods#retrieveworkflow",children:(0,i.jsx)(n.code,{children:"RetrieveWorkflow"})}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"workflowID"}),": The identifier of the workflow whose handle to retrieve"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.a,{href:"/golang/reference/workflows-steps#workflowhandle",children:"WorkflowHandle"})," of the workflow whose ID is ",(0,i.jsx)(n.code,{children:"workflowID"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"send",children:"Send"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"Send(destinationID string, message any, topic string) error\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Sends a message to a specified workflow. Similar to ",(0,i.jsx)(n.a,{href:"/golang/tutorials/workflow-communication#send",children:(0,i.jsx)(n.code,{children:"Send"})}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"destinationID"}),": The workflow to which to send the message"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"message"}),": The message to send. Must be serializable"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"topic"}),": A topic with which to associate the message. Messages are enqueued per-topic on the receiver"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"getevent",children:"GetEvent"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"GetEvent(targetWorkflowID, key string, timeout time.Duration) (any, error)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Retrieve the latest value of an event published by the workflow identified by ",(0,i.jsx)(n.code,{children:"targetWorkflowID"})," to the key ",(0,i.jsx)(n.code,{children:"key"}),".\nIf the event does not yet exist, wait for it to be published, returning an empty string if the wait times out.\nSimilar to ",(0,i.jsx)(n.a,{href:"/golang/tutorials/workflow-communication#getevent",children:(0,i.jsx)(n.code,{children:"GetEvent"})}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"targetWorkflowID"}),": The identifier of the workflow whose events to retrieve"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"key"}),": The key of the event to retrieve"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"timeout"}),": A timeout duration. If the wait times out, return an empty string"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The value of the event published by ",(0,i.jsx)(n.code,{children:"targetWorkflowID"})," with name ",(0,i.jsx)(n.code,{children:"key"}),", or an empty string if the wait times out"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"workflow-management-methods",children:"Workflow Management Methods"}),"\n",(0,i.jsx)(n.h3,{id:"listworkflows",children:"ListWorkflows"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"ListWorkflows(opts ...ListWorkflowsOption) ([]WorkflowStatus, error)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Retrieve a list of ",(0,i.jsx)(n.a,{href:"/golang/reference/methods#workflow-status",children:(0,i.jsx)(n.code,{children:"WorkflowStatus"})})," of all workflows matching specified criteria.\nSimilar to ",(0,i.jsx)(n.a,{href:"/golang/reference/methods#listworkflows",children:(0,i.jsx)(n.code,{children:"ListWorkflows"})}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Options:"}),"\nOptions are provided via ",(0,i.jsx)(n.code,{children:"ListWorkflowsOption"})," functions. See ",(0,i.jsx)(n.a,{href:"/golang/reference/methods#listworkflows",children:(0,i.jsx)(n.code,{children:"ListWorkflows"})})," for available options."]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["The client ",(0,i.jsx)(n.code,{children:"ListWorkflows"})," method does not include workflow inputs and outputs in its results."]})}),"\n",(0,i.jsx)(n.h3,{id:"getworkflowsteps",children:"GetWorkflowSteps"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"GetWorkflowSteps(workflowID string) ([]StepInfo, error)\n"})}),"\n",(0,i.jsx)(n.p,{children:"List the steps of a given workflow. Returned entries do not include step outputs."}),"\n",(0,i.jsx)(n.h3,{id:"cancelworkflow",children:"CancelWorkflow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"CancelWorkflow(workflowID string) error\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Cancel a workflow.\nThis sets its status to ",(0,i.jsx)(n.code,{children:"CANCELLED"}),", removes it from its queue (if it is enqueued) and preempts its execution (interrupting it at the beginning of its next step).\nSimilar to ",(0,i.jsx)(n.a,{href:"/golang/reference/methods#cancelworkflow",children:(0,i.jsx)(n.code,{children:"CancelWorkflow"})}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"resumeworkflow",children:"ResumeWorkflow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"ResumeWorkflow(workflowID string) (WorkflowHandle[any], error)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Resume a workflow.\nThis immediately starts it from its last completed step.\nYou can use this to resume workflows that are cancelled or have exceeded their maximum recovery attempts.\nYou can also use this to start an enqueued workflow immediately, bypassing its queue.\nSimilar to ",(0,i.jsx)(n.a,{href:"/golang/reference/methods#resumeworkflow",children:(0,i.jsx)(n.code,{children:"ResumeWorkflow"})}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"forkworkflow",children:"ForkWorkflow"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"ForkWorkflow(input ForkWorkflowInput) (WorkflowHandle[any], error)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Similar to ",(0,i.jsx)(n.a,{href:"/golang/reference/methods#forkworkflow",children:(0,i.jsx)(n.code,{children:"ForkWorkflow"})}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>s,x:()=>l});var r=o(6540);const i={},t=r.createContext(i);function s(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);