"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[2378],{667:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>u,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>a});var t=r(4848),s=r(8453);const o={sidebar_position:17,title:"Workflow Queues"},i=void 0,l={id:"typescript/reference/workflow-queues",title:"Workflow Queues",description:"Workflow queues allow you to ensure that workflow functions will be run, without starting them immediately.",source:"@site/docs/typescript/reference/workflow-queues.md",sourceDirName:"typescript/reference",slug:"/typescript/reference/workflow-queues",permalink:"/typescript/reference/workflow-queues",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:17,frontMatter:{sidebar_position:17,title:"Workflow Queues"},sidebar:"tutorialSidebar",previous:{title:"Time Travel Debugger",permalink:"/typescript/reference/time-travel-debugger"},next:{title:"Kafka Alert Queue",permalink:"/typescript/examples/kafka-alert-queue"}},u={},a=[{value:"class WorkflowQueue",id:"class-workflowqueue",level:3},{value:"Enqueueing Workflows",id:"enqueueing-workflows",level:3}];function c(e){const n={a:"a",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Workflow queues allow you to ensure that workflow functions will be run, without starting them immediately.\nQueues are useful for controlling the number of workflows run in parallel, or the rate at which they are started."}),"\n",(0,t.jsx)(n.p,{children:"Queues should be created when your application module is loaded.  This ensures that the queue information is available for the DBOS runtime when it is initialized, and begins handling the queued workflow records."}),"\n",(0,t.jsx)(n.h3,{id:"class-workflowqueue",children:"class WorkflowQueue"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface QueueRateLimit {\n    limitPerPeriod: number;\n    periodSec: number;\n}\n\nclass WorkflowQueue {\n    constructor(\n        readonly name: string,\n        readonly concurrency?: number,\n        readonly rateLimit?: QueueRateLimit\n    );\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"name"}),": The name of the queue.  Must be unique among all queues in the application."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"concurrency"}),": The maximum number of workflows from this queue that may run concurrently.\nThis concurrency limit is global across all DBOS processes using this queue.\nIf not provided, any number of functions may run concurrently."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"rateLimit"}),": A limit on the maximum number of functions which may be started in a given period."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"rateLimit.limitPerPeriod"}),": The number of workflows that may be started within the specified time period."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"rateLimit.periodSec"}),": The time period across which ",(0,t.jsx)(n.code,{children:"limitPerPeriod"})," applies."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example syntax:"})}),"\n",(0,t.jsx)(n.p,{children:"This queue may run no more than 10 functions concurrently and may not start more than 50 functions per 30 seconds:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const queue = new WorkflowQueue("example_queue", 10, {limitPerPeriod: 50, periodSec: 30});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"enqueueing-workflows",children:"Enqueueing Workflows"}),"\n",(0,t.jsxs)(n.p,{children:["Workflows are enqueued with the ",(0,t.jsx)(n.code,{children:"startWorkflow"})," family of functions, with an additional ",(0,t.jsx)(n.code,{children:"queue"})," argument:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/typescript/reference/contexts#handlerctxtstartworkflow",children:"HandlerContext.startWorkflow"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/typescript/reference/contexts#workflowctxtstartworkflow",children:"WorkflowContext.startWorkflow"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/typescript/reference/testing-runtime#runtimestartworkflowtarget-workflowuuid-params",children:"TestingRuntime.startWorkflow"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Enqueue a function for processing and return a ",(0,t.jsx)(n.a,{href:"/typescript/reference/workflow-handles",children:"handle"})," to it.\nThe ",(0,t.jsx)(n.code,{children:"startWorkflow"})," method durably enqueues your function; after it returns, your function is guaranteed to eventually execute even if your app is interrupted."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example syntax:"})}),"\n",(0,t.jsxs)(n.p,{children:["In the example below, a ",(0,t.jsx)(n.code,{children:"WorkflowQueue"})," is used to process tasks serially, without concurrency:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { WorkflowQueue } from "@dbos-inc/dbos-sdk";\n\nconst serialqueue = new WorkflowQueue("serialQ", 1);\n\nclass TaskWFs\n{\n    @Workflow()\n    static async processTask(ctx: WorkflowContext, task: MyTask): Promise<MyResult> {\n      // ...\n    }\n}\n\nconst handles: WorkflowHandle<MyResult>[] = []\n\n// Enqueue each task so all tasks are processed sequentially.\nfor (const task of tasks) {\n  handles.push(await ctx.startWorkflow(TaskWFs, undefined, serialqueue).processTask({task:"Do it"}));\n}\n\n// Wait for each task to complete and retrieve its result.\n// Return the results of all tasks.\nconst results: Result[] = [];\nfor (const h of handles) {\n  results.push(await h.getResult());\n}\nreturn results;\n'})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>l});var t=r(6540);const s={},o=t.createContext(s);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);