"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[6405],{30:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var t=n(5893),s=n(1151);const o={sidebar_position:1,title:"Cloud Database Management",description:"Learn how to manage DBOS Cloud database instances"},i=void 0,r={id:"cloud-tutorials/database-management",title:"Cloud Database Management",description:"Learn how to manage DBOS Cloud database instances",source:"@site/docs/cloud-tutorials/database-management.md",sourceDirName:"cloud-tutorials",slug:"/cloud-tutorials/database-management",permalink:"/cloud-tutorials/database-management",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Cloud Database Management",description:"Learn how to manage DBOS Cloud database instances"},sidebar:"tutorialSidebar",previous:{title:"DBOS Cloud Tutorials",permalink:"/category/dbos-cloud-tutorials"},next:{title:"Cloud Application Management",permalink:"/cloud-tutorials/application-management"}},d={},c=[{value:"Preliminaries",id:"preliminaries",level:3},{value:"Provisioning Database Instances",id:"provisioning-database-instances",level:3},{value:"Database Schema Management",id:"database-schema-management",level:3},{value:"Destroying Database Instances",id:"destroying-database-instances",level:3}];function l(e){const a={a:"a",admonition:"admonition",code:"code",h3:"h3",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.p,{children:"In this guide, you'll learn how to manage database instances in DBOS Cloud."}),"\n",(0,t.jsx)(a.h3,{id:"preliminaries",children:"Preliminaries"}),"\n",(0,t.jsx)(a.p,{children:"Before following any of the steps in this guide, make sure you've created and registered a DBOS Cloud account.\nThen, in your application root directory, log in to DBOS Cloud by running:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{children:"npx dbos-cloud login\n"})}),"\n",(0,t.jsx)(a.h3,{id:"provisioning-database-instances",children:"Provisioning Database Instances"}),"\n",(0,t.jsxs)(a.p,{children:["Before you can deploy an application to DBOS Cloud, you must provision a Postgres database instance for it.\nYou should choose a database name and an administrator username and password for your database instance.\nBoth the database instance name and the administrator username must contain only lowercase letters and numbers, dashes (",(0,t.jsx)(a.code,{children:"-"}),"), and underscores (",(0,t.jsx)(a.code,{children:"_"}),").\nTo provision a database instance, run (this takes ~5-7 minutes):"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{children:"npx dbos-cloud database provision <database-name> -a <admin-username> -W <admin-password>\n"})}),"\n",(0,t.jsxs)(a.admonition,{type:"tip",children:[(0,t.jsxs)(a.p,{children:["Each Postgres database instance is a physical server that can host multiple independent Postgres databases for different applications.\nYou can define which Postgres database your application connects to through the ",(0,t.jsx)(a.code,{children:"app_db_name"})," field in its ",(0,t.jsx)(a.a,{href:"/api-reference/configuration#database",children:(0,t.jsx)(a.code,{children:"dbos-config.yaml"})}),"."]}),(0,t.jsxs)(a.p,{children:["However, don't worry about setting the other database connection parameters like ",(0,t.jsx)(a.code,{children:"hostname"})," or ",(0,t.jsx)(a.code,{children:"password"})," for cloud deployment\u2014DBOS automatically takes care of that for you, applying the connection information of your cloud database when you deploy an application."]})]}),"\n",(0,t.jsx)(a.admonition,{type:"tip",children:(0,t.jsxs)(a.p,{children:["Remember your database administrator password! You need it to connect to our ",(0,t.jsx)(a.a,{href:"#",children:"time travel debugger"}),"."]})}),"\n",(0,t.jsx)(a.p,{children:"To see a list of all provisioned instances, run:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{children:"npx dbos-cloud database list\n"})}),"\n",(0,t.jsx)(a.p,{children:"To retrieve the status of a particular instance, run:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{children:"npx dbos-cloud database status <database-name>\n"})}),"\n",(0,t.jsx)(a.h3,{id:"database-schema-management",children:"Database Schema Management"}),"\n",(0,t.jsxs)(a.p,{children:["To manage your applications' database schemas, you must define schema migrations.\nDBOS Cloud is compatible with any schema management tool as long as all its dependencies and assets are stored in your application directory.\nWe recommend using a Typescript-based migration tool like ",(0,t.jsx)(a.a,{href:"https://knexjs.org/guide/migrations.html",children:"Knex"})," or ",(0,t.jsx)(a.a,{href:"https://typeorm.io/migrations",children:"TypeORM"}),"."]}),"\n",(0,t.jsxs)(a.p,{children:["You configure your schema migrations in the ",(0,t.jsx)(a.code,{children:"migrate"})," field of your ",(0,t.jsx)(a.a,{href:"/api-reference/configuration",children:(0,t.jsx)(a.code,{children:"dbos-config.yaml"})}),".\nYou must supply a list of commands to run to migrate to your most recent schema version.\nFor example, if you are using ",(0,t.jsx)(a.a,{href:"https://knexjs.org/guide/migrations.html",children:"Knex"}),", you might use:"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-yaml",children:"database:\n  # Other fields omitted\n  migrate: ['npx knex migrate:latest']\n"})}),"\n",(0,t.jsxs)(a.p,{children:["To run your migrations locally, run ",(0,t.jsx)(a.code,{children:"npx dbos-sdk migrate"}),"."]}),"\n",(0,t.jsxs)(a.p,{children:["When you ",(0,t.jsx)(a.a,{href:"/cloud-tutorials/application-management#registering-and-deploying-applications",children:"deploy"})," an application to DBOS Cloud, it runs ",(0,t.jsx)(a.code,{children:"npx dbos-sdk migrate"})," to apply all schema changes before starting your application."]}),"\n",(0,t.jsx)(a.h3,{id:"destroying-database-instances",children:"Destroying Database Instances"}),"\n",(0,t.jsx)(a.p,{children:"To destroy a database instance, run:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{children:"npx dbos-cloud database destroy <database-name>\n"})}),"\n",(0,t.jsx)(a.p,{children:"Take care\u2014this irreversibly delete all data on the instance."})]})}function u(e={}){const{wrapper:a}={...(0,s.a)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},1151:(e,a,n)=>{n.d(a,{Z:()=>r,a:()=>i});var t=n(7294);const s={},o=t.createContext(s);function i(e){const a=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:a},e.children)}}}]);