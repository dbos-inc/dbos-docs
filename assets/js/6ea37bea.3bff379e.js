"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[517],{9715:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"integrations/nestjs","title":"Nest.js","description":"This guide shows you how to add DBOS durable workflows to your existing Nest.js application to make it resilient to any failure.","source":"@site/docs/integrations/nestjs.md","sourceDirName":"integrations","slug":"/integrations/nestjs","permalink":"/integrations/nestjs","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":60,"frontMatter":{"sidebar_position":60,"title":"Nest.js"},"sidebar":"tutorialSidebar","previous":{"title":"Django","permalink":"/integrations/django"},"next":{"title":"DBOS System Tables","permalink":"/explanations/system-tables"}}');var i=t(4848),o=t(8453);const r={sidebar_position:60,title:"Nest.js"},a="DBOS + Nest.js",c={},l=[{value:"Installation and Requirements",id:"installation-and-requirements",level:2},{value:"Bootstrapping DBOS",id:"bootstrapping-dbos",level:2},{value:"Add Workflows to Services",id:"add-workflows-to-services",level:2},{value:"Configure Service Instantiation",id:"configure-service-instantiation",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"dbos--nestjs",children:"DBOS + Nest.js"})}),"\n",(0,i.jsxs)(n.p,{children:["This guide shows you how to add DBOS durable workflows to your existing ",(0,i.jsx)(n.a,{href:"https://nestjs.com/",children:"Nest.js"})," application to make it resilient to any failure."]}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["This example was bootstrapped with ",(0,i.jsx)(n.code,{children:"nest new"}),"."]}),(0,i.jsxs)(n.p,{children:["You can see its full code on ",(0,i.jsx)(n.a,{href:"https://github.com/dbos-inc/dbos-demo-apps/tree/main/typescript/dbos-nestjs-starter",children:"GitHub"}),"."]})]}),"\n",(0,i.jsx)(n.h2,{id:"installation-and-requirements",children:"Installation and Requirements"}),"\n",(0,i.jsxs)(n.p,{children:["Install the ",(0,i.jsx)(n.a,{href:"https://github.com/dbos-inc/dbos-transact-ts",children:"open-source DBOS TypeScript library"})," with:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"npm install @dbos-inc/dbos-sdk\n"})}),"\n",(0,i.jsx)(n.h2,{id:"bootstrapping-dbos",children:"Bootstrapping DBOS"}),"\n",(0,i.jsx)(n.p,{children:"First, modify your bootstrap function to configure and launch DBOS:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="src/main.ts"',children:"import { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\n// highlight-next-line\nimport { DBOS } from \"@dbos-inc/dbos-sdk\";\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  // highlight-next-line\n  DBOS.setConfig({\n  // highlight-next-line\n    name: 'dbos-nestjs-starter',\n  // highlight-next-line\n    systemDatabaseUrl: process.env.DBOS_SYSTEM_DATABASE_URL,\n  // highlight-next-line\n  });\n  // highlight-next-line\n  await DBOS.launch();\n  await app.listen(process.env.PORT ?? 3000);\n}\nvoid bootstrap();\n"})}),"\n",(0,i.jsx)(n.h2,{id:"add-workflows-to-services",children:"Add Workflows to Services"}),"\n",(0,i.jsxs)(n.p,{children:["Next, you can integrate DBOS workflows into your Nest.js services by annotating or registering service methods.\nTo register a service instance method as a workflow, its class must extend ",(0,i.jsx)(n.a,{href:"/typescript/tutorials/instantiated-objects",children:(0,i.jsx)(n.code,{children:"ConfiguredInstance"})}),".\nBy extending ",(0,i.jsx)(n.code,{children:"ConfiguredInstance"}),", you add your workflow methods to a DBOS internal registry so that if DBOS needs to recover your workflows, it can do so using the appropriate instance of your service."]}),"\n",(0,i.jsx)(n.p,{children:"Here is an example of a Nest.js service implementing a simple two-step workflow:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="src/app.service.ts"',children:"  // highlight-next-line\nimport { ConfiguredInstance, DBOS } from '@dbos-inc/dbos-sdk';\nimport { Injectable } from '@nestjs/common';\n\n@Injectable()\n  // highlight-next-line\nexport class AppService extends ConfiguredInstance {\n  constructor(name: string) {\n    super(name);\n  }\n\n  async stepOne() {\n    console.log('Step one completed!');\n    return Promise.resolve();\n  }\n\n  async stepTwo() {\n    console.log('Step two completed!');\n    return Promise.resolve();\n  }\n\n  // highlight-next-line\n  @DBOS.workflow()\n  async workflow() {\n    await DBOS.runStep(() => this.stepOne(), { name: 'stepOne' });\n    await DBOS.runStep(() => this.stepTwo(), { name: 'stepTwo' });\n    return 'Hello World!';\n  }\n}\n\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configure-service-instantiation",children:"Configure Service Instantiation"}),"\n",(0,i.jsxs)(n.p,{children:["You can instantiate classes containing DBOS workflows during dependency injection just like any other Nest.js class.\nIf you create multiple instances of a class containing DBOS workflows, you should give them distinct names (",(0,i.jsx)(n.code,{children:"dbos-service-instance"})," in this case)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="src/app.modules.ts"',children:"import { Module, Provider } from '@nestjs/common';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\n\nexport const appProvider: Provider = {\n  provide: AppService,\n  useFactory: () => {\n    const service = new AppService('dbos-service-instance');\n    return service;\n  },\n};\n\n@Module({\n  imports: [],\n  controllers: [AppController],\n  providers: [appProvider],\n})\nexport class AppModule {}\n\n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(6540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);