"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[904],{2275:(e,s,n)=>{n.d(s,{Ay:()=>t,RM:()=>l});var o=n(4848),r=n(8453);const l=[];function a(e){const s={a:"a",code:"code",p:"p",pre:"pre",...(0,r.R)(),...e.components},{TabItem:n,Tabs:l}=s;return n||i("TabItem",!0),l||i("Tabs",!0),(0,o.jsxs)(l,{groupId:"operating-systems",className:"small-tabs",children:[(0,o.jsxs)(n,{value:"maclinux",label:"macOS or Linux",children:[(0,o.jsx)(s.p,{children:"Run the following commands in your terminal:"}),(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:'curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.1/install.sh | bash\n\nexport NVM_DIR="$HOME/.nvm"\n[ -s "$NVM_DIR/nvm.sh" ] && \\. "$NVM_DIR/nvm.sh"  # This loads nvm\n\nnvm install 22\nnvm use 22\n'})})]}),(0,o.jsx)(n,{value:"win-ps",label:"Windows",children:(0,o.jsxs)(s.p,{children:["Download Node.js 20 or later from the ",(0,o.jsx)(s.a,{href:"https://nodejs.org/en/download",children:"official Node.js download page"})," and install it.\nAfter installing Node.js, create the following folder: ",(0,o.jsx)(s.code,{children:"C:\\Users\\%user%\\AppData\\Roaming\\npm"}),"\n(",(0,o.jsx)(s.code,{children:"%user%"})," is the Windows user on which you are logged in)."]})})]})}function t(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}function i(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},4262:(e,s,n)=>{n.d(s,{Ay:()=>i,RM:()=>a});var o=n(4848),r=n(8453),l=n(1432);const a=[];function t(e){const s={a:"a",code:"code",p:"p",pre:"pre",...(0,r.R)(),...e.components},{TabItem:n,Tabs:a}=s;return n||c("TabItem",!0),a||c("Tabs",!0),(0,o.jsxs)(a,{groupId:"postgres-or-docker",className:"small-tabs",children:[(0,o.jsxs)(n,{value:"cloud",label:"Use Cloud Postgres",children:[(0,o.jsx)(s.p,{children:"You can connect your local application to a Postgres database hosted in DBOS Cloud."}),(0,o.jsx)(s.p,{children:"First, set a password for your DBOS Cloud database:"}),(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"dbos-cloud db reset-password\n"})}),(0,o.jsx)(s.p,{children:"Then connect your local app to your cloud database.\nWhen prompted, enter the password you just set."}),(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"dbos-cloud db local\n"})})]}),(0,o.jsxs)(n,{value:"docker",label:"Launch Postgres with Docker",children:[(0,o.jsxs)(a,{groupId:"operating-systems",className:"small-tabs",children:[(0,o.jsxs)(n,{value:"mac",label:"macOS",children:[(0,o.jsxs)(s.p,{children:["You can install Docker on macOS through ",(0,o.jsx)(s.a,{href:"https://docs.docker.com/desktop/install/mac-install/",children:"Docker Desktop"}),"."]}),(0,o.jsx)(s.p,{children:"Then, run this script to launch Postgres in a Docker container:"}),(0,o.jsx)(l.A,{language:"bash",children:`export PGPASSWORD=dbos\n# Docker may require sudo -E\n${e.cmd}`})]}),(0,o.jsxs)(n,{value:"linux",label:"Linux",children:[(0,o.jsxs)(s.p,{children:["Follow the ",(0,o.jsx)(s.a,{href:"https://docs.docker.com/engine/install/",children:"Docker Engine installation page"})," to install Docker on several popular Linux distributions."]}),(0,o.jsx)(s.p,{children:"Then, run this script to launch Postgres in a Docker container:"}),(0,o.jsx)(l.A,{language:"bash",children:`export PGPASSWORD=dbos\n# Docker may require sudo -E\n${e.cmd}`})]}),(0,o.jsxs)(n,{value:"win-ps",label:"Windows (PowerShell)",children:[(0,o.jsxs)(s.p,{children:["You can install Docker on Windows through ",(0,o.jsx)(s.a,{href:"https://docs.docker.com/desktop/install/windows-install/",children:"Docker Desktop"}),"."]}),(0,o.jsx)(s.p,{children:"Then, run this script to launch Postgres in a Docker container:"}),(0,o.jsx)(l.A,{language:"bash",children:`$env:PGPASSWORD = "dbos"\n${e.cmd}`})]}),(0,o.jsxs)(n,{value:"win-cmd",label:"Windows (cmd)",children:[(0,o.jsxs)(s.p,{children:["You can install Docker on Windows through ",(0,o.jsx)(s.a,{href:"https://docs.docker.com/desktop/install/windows-install/",children:"Docker Desktop"}),"."]}),(0,o.jsx)(s.p,{children:"Then, run this script to launch Postgres in a Docker container:"}),(0,o.jsx)(l.A,{language:"bash",children:`set PGPASSWORD=dbos\n${e.cmd}`})]})]}),(0,o.jsxs)(s.p,{children:["If successful, the script should print ",(0,o.jsx)(s.code,{children:"Database started successfully!"})]})]}),(0,o.jsx)(n,{value:"postgres",label:"Install Postgres",children:(0,o.jsxs)(a,{groupId:"operating-systems",className:"small-tabs",children:[(0,o.jsxs)(n,{value:"mac",label:"macOS",children:[(0,o.jsxs)(s.p,{children:["Follow ",(0,o.jsx)(s.a,{href:"https://www.postgresql.org/download/macosx/",children:"this guide"})," to install Postgres on macOS."]}),(0,o.jsxs)(s.p,{children:["Then, set the ",(0,o.jsx)(s.code,{children:"PGPASSWORD"})," environment variable to your Postgres password:"]}),(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"export PGPASSWORD=<your-postgres-password>\n"})})]}),(0,o.jsxs)(n,{value:"linux",label:"Linux",children:[(0,o.jsxs)(s.p,{children:["Follow these ",(0,o.jsx)(s.a,{href:"https://www.postgresql.org/download/linux/",children:"guides"})," to install Postgres on popular Linux distributions."]}),(0,o.jsxs)(s.p,{children:["Then, set the ",(0,o.jsx)(s.code,{children:"PGPASSWORD"})," environment variable to your Postgres password:"]}),(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"export PGPASSWORD=<your-postgres-password>\n"})})]}),(0,o.jsxs)(n,{value:"win-ps",label:"Windows (PowerShell)",children:[(0,o.jsxs)(s.p,{children:["Follow ",(0,o.jsx)(s.a,{href:"https://www.postgresql.org/download/windows/",children:"this guide"})," to install Postgres on Windows."]}),(0,o.jsxs)(s.p,{children:["Then, set the ",(0,o.jsx)(s.code,{children:"PGPASSWORD"})," environment variable to your Postgres password:"]}),(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:'$env:PGPASSWORD = "<your-postgres-password>"\n'})})]}),(0,o.jsxs)(n,{value:"win-cmd",label:"Windows (cmd)",children:[(0,o.jsxs)(s.p,{children:["Follow ",(0,o.jsx)(s.a,{href:"https://www.postgresql.org/download/windows/",children:"this guide"})," to install Postgres on Windows."]}),(0,o.jsxs)(s.p,{children:["Then, set the ",(0,o.jsx)(s.code,{children:"PGPASSWORD"})," environment variable to your Postgres password:"]}),(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",children:"set PGPASSWORD=<your-postgres-password>\n"})})]})]})})]})}function i(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(t,{...e})}):t(e)}function c(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8942:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>c,toc:()=>h});var o=n(4848),r=n(8453),l=n(2275),a=n(4262);const t={displayed_sidebar:"examplesSidebar",sidebar_position:11,title:"Cloud Cron Quickstart",hide_table_of_contents:!1},i=void 0,c={id:"python/examples/cron-starter",title:"Cloud Cron Quickstart",description:"Let's say you want to run some code on a schedule.  For example, you want to:",source:"@site/docs/python/examples/cron-starter.md",sourceDirName:"python/examples",slug:"/python/examples/cron-starter",permalink:"/python/examples/cron-starter",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:11,frontMatter:{displayed_sidebar:"examplesSidebar",sidebar_position:11,title:"Cloud Cron Quickstart",hide_table_of_contents:!1},sidebar:"examplesSidebar",previous:{title:"Earthquake Tracker",permalink:"/python/examples/earthquake-tracker"},next:{title:"Kafka Alert Queue",permalink:"/typescript/examples/kafka-alert-queue"}},d={},h=[{value:"Preparation",id:"preparation",level:3},...l.RM,{value:"Scheduling Your Code",id:"scheduling-your-code",level:3},{value:"Next Steps",id:"next-steps",level:3},{value:"Running It Locally",id:"running-it-locally",level:3},...a.RM];function u(e){const s={a:"a",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Details:n,TabItem:t,Tabs:i}=s;return n||x("Details",!0),t||x("TabItem",!0),i||x("Tabs",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(s.p,{children:["Let's say you want to run some code ",(0,o.jsx)(s.strong,{children:"on a schedule"}),".  For example, you want to:"]}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Record a stock's price once a minute."}),"\n",(0,o.jsx)(s.li,{children:"Migrate some data from one database to another once an hour."}),"\n",(0,o.jsx)(s.li,{children:"Send emails to inactive users once a week."}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"This kind of code isn't easy to manage because the server running it has to always be \"on\"\u2014you can't just run it on your laptop."}),"\n",(0,o.jsxs)(s.p,{children:["In this tutorial, we'll show you how to use DBOS to ",(0,o.jsx)(s.strong,{children:"host scheduled jobs on the cloud"})," so you don't have to worry about maintaining them.\nYou'll learn how to write a scheduled (cron) job in ",(0,o.jsx)(s.strong,{children:"just 6 lines of Python code"})," and deploy it to the cloud with ",(0,o.jsx)(s.strong,{children:"a single command"}),"."]}),"\n",(0,o.jsx)(s.h3,{id:"preparation",children:"Preparation"}),"\n",(0,o.jsxs)("section",{className:"row list",children:[(0,o.jsx)("article",{className:"col col--6",children:(0,o.jsx)(s.p,{children:"First, create a folder for your app and activate a virtual environment."})}),(0,o.jsx)("article",{className:"col col--6",children:(0,o.jsxs)(i,{groupId:"operating-systems",className:"small-tabs",children:[(0,o.jsx)(t,{value:"maclinux",label:"macOS/Linux",children:(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-shell",children:"python3 -m venv cron-app/.venv\ncd cron-app\nsource .venv/bin/activate\n"})})}),(0,o.jsx)(t,{value:"win-ps",label:"Windows (PowerShell)",children:(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-shell",children:"python3 -m venv ai-app/.venv\ncd ai-app\n.venv\\Scripts\\activate.ps1\nNew-Item main.py\n"})})}),(0,o.jsx)(t,{value:"win-cmd",label:"Windows (cmd)",children:(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-shell",children:"python3 -m venv ai-app/.venv\ncd ai-app\n.venv\\Scripts\\activate.bat\nTYPE nul > main.py\n"})})})]})}),(0,o.jsx)("article",{className:"col col--6",children:(0,o.jsx)(s.p,{children:"Then, install dependencies and initialize a DBOS config file."})}),(0,o.jsx)("article",{className:"col col--6",children:(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-shell",children:"pip install dbos\ndbos init --config\n"})})}),(0,o.jsx)("article",{className:"col col--6",children:(0,o.jsx)(s.p,{children:"Next, install the DBOS Cloud CLI.\nIt requires Node.js 20 or later."})}),(0,o.jsxs)("article",{className:"col col--6",children:[(0,o.jsxs)(n,{children:[(0,o.jsx)("summary",{children:"Instructions to install Node.js"}),(0,o.jsx)(l.Ay,{})]}),(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-shell",children:"npm i -g @dbos-inc/dbos-cloud@latest\n"})})]})]}),"\n",(0,o.jsx)(s.h3,{id:"scheduling-your-code",children:"Scheduling Your Code"}),"\n",(0,o.jsxs)(s.p,{children:["Now, let's build a scheduled job in just 6 lines of code.\nCreate a ",(0,o.jsx)(s.code,{children:"main.py"})," file and copy the following code into it:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-python",metastring:'showLineNumbers title="main.py"',children:'from dbos import DBOS\nfrom fastapi import FastAPI\n\napp = FastAPI()\nDBOS(fastapi=app)\n\n@DBOS.scheduled("* * * * *")\n@DBOS.workflow()\ndef scheduled_function(scheduled_time, actual_time):\n    DBOS.logger.info(f"I just ran at {scheduled_time}")\n'})}),"\n",(0,o.jsxs)(s.p,{children:["This code runs ",(0,o.jsx)(s.code,{children:"scheduled_function"})," once a minute, every minute (the cron syntax ",(0,o.jsx)(s.code,{children:"* * * * *"}),' means "run every minute").']}),"\n",(0,o.jsx)(s.p,{children:"Now, let's deploy our application to the cloud.\nJust run these two commands:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-shell",children:"pip freeze > requirements.txt\ndbos-cloud app deploy\n"})}),"\n",(0,o.jsxs)(s.p,{children:["Your app is now live in the cloud!\nEvery minute, it will run ",(0,o.jsx)(s.code,{children:"scheduled_function"}),".\nTo view the app's logs, run:"]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-shell",children:"dbos-cloud app logs\n"})}),"\n",(0,o.jsx)(s.p,{children:"You should see one log entry for every minute your application has been alive."}),"\n",(0,o.jsx)(s.h3,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsxs)(s.p,{children:["You can easily adapt this 6-line starter to implement your own scheduled job.\nSimply replace ",(0,o.jsx)(s.code,{children:"scheduled_function"})," with your own function to run it on a schedule!\nSome useful implementation notes:"]}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Schedules are specified in crontab syntax.\nFor example, ",(0,o.jsx)(s.code,{children:"* * * * *"}),' means "run once a minute."\nTo learn more about crontab syntax, see ',(0,o.jsx)(s.a,{href:"https://docs.gitlab.com/ee/topics/cron/",children:"this guide"}),"."]}),"\n",(0,o.jsxs)(s.li,{children:["The two arguments passed into ",(0,o.jsx)(s.code,{children:"scheduled_function"})," are the time the run was scheduled (as a ",(0,o.jsx)(s.code,{children:"datetime"}),") and the time the run was actually started (as a ",(0,o.jsx)(s.code,{children:"datetime"}),")."]}),"\n",(0,o.jsxs)(s.li,{children:["For more information, see our ",(0,o.jsx)(s.a,{href:"/python/tutorials/scheduled-workflows",children:"scheduling documentation"}),"."]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:"Here are two larger examples built with DBOS scheduling:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.a,{href:"/python/examples/hacker-news-bot",children:(0,o.jsx)(s.strong,{children:"Hacker News Slackbot"})}),": Periodically search Hacker News for people commenting about serverless computing and post the comments to Slack."]}),"\n",(0,o.jsxs)(s.li,{children:[(0,o.jsx)(s.a,{href:"/python/examples/earthquake-tracker",children:(0,o.jsx)(s.strong,{children:"Earthquake Tracker"})}),": Use a scheduled job to scrape earthquake data from the USGS, then build a real-time earthquake dashboard over it."]}),"\n"]}),"\n",(0,o.jsx)(s.h3,{id:"running-it-locally",children:"Running It Locally"}),"\n",(0,o.jsx)(s.p,{children:"Of course, you can also run your application locally for development and testing.\nUnder the hood, DBOS uses Postgres for scheduling, so you need to connect your app to a Postgres database\u2014you can use a DBOS Cloud database, a Docker container, or a local Postgres installation:"}),"\n",(0,o.jsxs)(n,{children:[(0,o.jsx)("summary",{children:"Instructions to set up Postgres"}),(0,o.jsx)(a.Ay,{cmd:"python3 start_postgres_docker.py"})]}),"\n",(0,o.jsx)(s.p,{children:"Once your app is connected, you can start it with:"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{children:"dbos start\n"})})]})}function p(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}function x(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);