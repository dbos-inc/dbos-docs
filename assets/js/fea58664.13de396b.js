"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[263],{6602:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>o,toc:()=>l});var i=t(5893),s=t(1151);const a={sidebar_position:10,title:"Using Prisma",description:"Learn how to create and register Prisma entities and perform transactional updates"},r=void 0,o={id:"tutorials/using-prisma",title:"Using Prisma",description:"Learn how to create and register Prisma entities and perform transactional updates",source:"@site/docs/tutorials/using-prisma.md",sourceDirName:"tutorials",slug:"/tutorials/using-prisma",permalink:"/tutorials/using-prisma",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,title:"Using Prisma",description:"Learn how to create and register Prisma entities and perform transactional updates"},sidebar:"tutorialSidebar",previous:{title:"Authentication and Authorization",permalink:"/tutorials/authentication-authorization"},next:{title:"Using TypeORM",permalink:"/tutorials/using-typeorm"}},c={},l=[{value:"Prisma Setup",id:"prisma-setup",level:3},{value:"Configuring DBOS to use Prisma",id:"configuring-dbos-to-use-prisma",level:3},{value:"Coding a Transaction with Prisma",id:"coding-a-transaction-with-prisma",level:3},{value:"Prisma Example",id:"prisma-example",level:3}];function d(e){const n={a:"a",code:"code",h3:"h3",p:"p",pre:"pre",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["In this guide, you'll learn how to build a DBOS application using ",(0,i.jsx)(n.a,{href:"https://www.prisma.io/",children:"Prisma"}),', a popular open-source Typescript ORM.\nWe\'ll show you how to build a "Hello, World!" application using Prisma.\nThe source code for the complete application is ',(0,i.jsx)(n.a,{href:"https://github.com/dbos-inc/dbos-demo-apps/tree/main/hello-prisma",children:"here"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"prisma-setup",children:"Prisma Setup"}),"\n",(0,i.jsxs)(n.p,{children:["Before using Prisma to build an application, you have to set up a schema, generate a primsa client, and run migrations to create database tables.\nFor more information, see ",(0,i.jsx)(n.a,{href:"https://www.prisma.io/docs/getting-started",children:"Prisma's getting started guide"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Here's how to complete these steps for our demo app.\nMake sure you have a running Postgres database, for example from our ",(0,i.jsx)(n.a,{href:"../getting-started/quickstart",children:"quickstart init script"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Create a directory:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"mkdir hello-prisma\n"})}),"\n",(0,i.jsx)(n.p,{children:"Install prisma:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"npm init -y\nnpm install prisma typescript ts-node @types/node --save-dev\nnpx prisma init\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In the .env file, update the database URL if necessary: ",(0,i.jsx)(n.code,{children:'DATABASE_URL="postgresql://postgres:${PGPASSWORD}@localhost:5432/helloprisma?schema=public"'}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["In the file ",(0,i.jsx)(n.code,{children:"prisma/schema.prisma"}),", add a model:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'model DBOSHello {\n  @@map("dboshello")\n  greeting_id Int @id @default(autoincrement())\n  greeting String\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Run this command in the database to create tables:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"npx prisma migrate dev --name init\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configuring-dbos-to-use-prisma",children:"Configuring DBOS to use Prisma"}),"\n",(0,i.jsxs)(n.p,{children:["Next, configure DBOS to use Prisma by setting the ",(0,i.jsx)(n.code,{children:"app_db_client"})," property of the ",(0,i.jsx)(n.a,{href:"../api-reference/configuration",children:"configuration file"}),' to "prisma".\nFor example:']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"database:\n  hostname: 'localhost'\n  port: 5432\n  username: 'postgres'\n  app_db_name: 'helloprisma'\n  password: ${PGPASSWORD}\n  connectionTimeoutMillis: 3000\n  app_db_client: \"prisma\"\n"})}),"\n",(0,i.jsx)(n.h3,{id:"coding-a-transaction-with-prisma",children:"Coding a Transaction with Prisma"}),"\n",(0,i.jsxs)(n.p,{children:["Now, you can write an application that uses Prisma to talk to the database.\nIf you've configured DBOS to use Prisma, you can access the Prisma client from the ",(0,i.jsx)(n.a,{href:"../api-reference/contexts#transactionctxtclient",children:(0,i.jsx)(n.code,{children:".client"})})," property of ",(0,i.jsx)(n.a,{href:"../api-reference/contexts#transactioncontextt",children:(0,i.jsx)(n.code,{children:"TransactionContext"})})," in DBOS ",(0,i.jsx)(n.a,{href:"./transaction-tutorial",children:"transactions"}),".\nHere's an example of a transaction using Prisma to insert a row into the ",(0,i.jsx)(n.code,{children:"dboshello"})," table:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import { TransactionContext, HandlerContext, Transaction, GetApi } from '@dbos-inc/dbos-sdk';\nimport { PrismaClient } from \"@prisma/client\";\n\nexport class Hello {\n\n  @Transaction()\n  static async helloTransaction(txnCtxt: TransactionContext<PrismaClient>, name: string)  {\n    const greeting = `Hello, ${name}!`;\n    console.log(greeting);\n    const p: PrismaClient = txnCtxt.client as PrismaClient;\n    const res = await p.dBOSHello.create({\n        data: {\n        greeting: greeting,\n        },\n    });\n    return `Greeting ${res.greeting_id}: ${greeting}`;\n  };\n\n  @GetApi('/greeting/:name')\n  static async helloHandler(handlerCtxt: HandlerContext, @ArgSource(ArgSources.URL) name: string) {\n    return handlerCtxt.invoke(Hello).helloTransaction(name);\n  }\n\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The complete source code for this example is ",(0,i.jsx)(n.a,{href:"https://github.com/dbos-inc/dbos-demo-apps/tree/main/hello-prisma",children:"here"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"prisma-example",children:"Prisma Example"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.a,{href:"https://github.com/dbos-inc/dbos-demo-apps/tree/main/bank",children:"Bank"})," demo app uses Prisma."]})]})}function p(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>o,a:()=>r});var i=t(7294);const s={},a=i.createContext(s);function r(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);