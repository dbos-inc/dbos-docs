"use strict";(self.webpackChunkoperon_docs=self.webpackChunkoperon_docs||[]).push([[340],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=r.createContext({}),l=function(e){var t=r.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return r.createElement(p.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=l(n),d=a,g=m["".concat(p,".").concat(d)]||m[d]||u[d]||i;return n?r.createElement(g,o(o({ref:t},c),{},{components:n})):r.createElement(g,o({ref:t},c))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[m]="string"==typeof e?e:a,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},764:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const i={sidebar_position:10,title:"Using Prisma",description:"Learn how to create and register Prisma entities and perform transactional updates"},o=void 0,s={unversionedId:"tutorials/using-prisma",id:"tutorials/using-prisma",title:"Using Prisma",description:"Learn how to create and register Prisma entities and perform transactional updates",source:"@site/docs/tutorials/using-prisma.md",sourceDirName:"tutorials",slug:"/tutorials/using-prisma",permalink:"/tutorials/using-prisma",draft:!1,tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,title:"Using Prisma",description:"Learn how to create and register Prisma entities and perform transactional updates"},sidebar:"tutorialSidebar",previous:{title:"Authentication and Authorization",permalink:"/tutorials/authentication-authorization"},next:{title:"Using TypeORM",permalink:"/tutorials/using-typeorm"}},p={},l=[{value:"Prisma Setup",id:"prisma-setup",level:3},{value:"Configuring Operon to use Prisma",id:"configuring-operon-to-use-prisma",level:3},{value:"Coding a Transaction with Prisma",id:"coding-a-transaction-with-prisma",level:3},{value:"Prisma Example",id:"prisma-example",level:3}],c={toc:l},m="wrapper";function u(e){let{components:t,...n}=e;return(0,a.kt)(m,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"In this guide, you'll learn how to build an Operon application using ",(0,a.kt)("a",{parentName:"p",href:"https://www.prisma.io/"},"Prisma"),', a popular open-source Typescript ORM.\nWe\'ll show you how to build a "Hello, World!" application using Prisma.\nThe source code for the complete application is ',(0,a.kt)("a",{parentName:"p",href:"https://github.com/dbos-inc/operon-demo-apps/tree/main/hello-prisma"},"here"),"."),(0,a.kt)("h3",{id:"prisma-setup"},"Prisma Setup"),(0,a.kt)("p",null,"Before using Prisma to build an application, you have to set up a schema, generate a primsa client, and run migrations to create database tables.\nFor more information, see ",(0,a.kt)("a",{parentName:"p",href:"https://www.prisma.io/docs/getting-started"},"Prisma's getting started guide"),"."),(0,a.kt)("p",null,"Here's how to complete these steps for our demo app.\nMake sure you have a running Postgres database, for example from our ",(0,a.kt)("a",{parentName:"p",href:"../getting-started/quickstart"},"quickstart init script"),"."),(0,a.kt)("p",null,"Create a directory:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"mkdir hello-prisma\n")),(0,a.kt)("p",null,"Install prisma:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"npm init -y\nnpm install prisma typescript ts-node @types/node --save-dev\nnpx prisma init\n")),(0,a.kt)("p",null,"In the .env file, update the database URL if necessary: ",(0,a.kt)("inlineCode",{parentName:"p"},'DATABASE_URL="postgresql://postgres:${PGPASSWORD}@localhost:5432/helloprisma?schema=public"'),"."),(0,a.kt)("p",null,"In the file ",(0,a.kt)("inlineCode",{parentName:"p"},"prisma/schema.prisma"),", add a model:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},'model OperonHello {\n  @@map("operonhello")\n  greeting_id Int @id @default(autoincrement())\n  greeting String\n}\n')),(0,a.kt)("p",null,"Run this command in the database to create tables:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"npx prisma migrate dev --name init\n")),(0,a.kt)("h3",{id:"configuring-operon-to-use-prisma"},"Configuring Operon to use Prisma"),(0,a.kt)("p",null,"Next, configure Operon to use Prisma by setting the ",(0,a.kt)("inlineCode",{parentName:"p"},"user_dbclient")," property of the ",(0,a.kt)("a",{parentName:"p",href:"../api-reference/configuration"},"configuration file"),' to "prisma".\nFor example:'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"database:\n  hostname: 'localhost'\n  port: 5432\n  username: 'postgres'\n  user_database: 'helloprisma'\n  password: ${PGPASSWORD}\n  connectionTimeoutMillis: 3000\n  user_dbclient: \"prisma\"\n")),(0,a.kt)("h3",{id:"coding-a-transaction-with-prisma"},"Coding a Transaction with Prisma"),(0,a.kt)("p",null,"Now, you can write an Operon application that uses Prisma to talk to the database.\nIf you've configured Operon to use Prisma, you can access the Prisma client from the ",(0,a.kt)("a",{parentName:"p",href:"../api-reference/contexts#transactionctxtclient"},(0,a.kt)("inlineCode",{parentName:"a"},".client"))," property of ",(0,a.kt)("a",{parentName:"p",href:"../api-reference/contexts#transactioncontextt"},(0,a.kt)("inlineCode",{parentName:"a"},"TransactionContext"))," in Operon ",(0,a.kt)("a",{parentName:"p",href:"./transaction-tutorial"},"transactions"),".\nHere's an example of a transaction using Prisma to insert a row into the ",(0,a.kt)("inlineCode",{parentName:"p"},"operonhello")," table:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { TransactionContext, HandlerContext, OperonTransaction, GetApi } from '@dbos-inc/operon';\nimport { PrismaClient } from \"@prisma/client\";\n\nexport class Hello {\n\n  @OperonTransaction()\n  static async helloTransaction(txnCtxt: TransactionContext<PrismaClient>, name: string)  {\n    const greeting = `Hello, ${name}!`;\n    console.log(greeting);\n    const p: PrismaClient = txnCtxt.client as PrismaClient;\n    const res = await p.operonHello.create({\n        data: {\n        greeting: greeting,\n        },\n    });\n    return `Greeting ${res.greeting_id}: ${greeting}`;\n  };\n\n  @GetApi('/greeting/:name')\n  static async helloHandler(handlerCtxt: HandlerContext, name: string) {\n    return handlerCtxt.invoke(Hello).helloTransaction(name);\n  }\n\n}\n")),(0,a.kt)("p",null,"The complete source code for this example is ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/dbos-inc/operon-demo-apps/tree/main/hello-prisma"},"here"),"."),(0,a.kt)("h3",{id:"prisma-example"},"Prisma Example"),(0,a.kt)("p",null,"The ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/dbos-inc/operon-demo-apps/tree/main/bank"},"Bank")," demo app uses Prisma."))}u.isMDXComponent=!0}}]);