"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[6884],{2101:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"production/alerting","title":"Alerting","description":"If you are using Conductor, you can configure automatic alerts when certain failure conditions are met.","source":"@site/docs/production/alerting.md","sourceDirName":"production","slug":"/production/alerting","permalink":"/production/alerting","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":25,"frontMatter":{"sidebar_position":25,"title":"Alerting","toc_max_heading_level":3},"sidebar":"tutorialSidebar","previous":{"title":"Workflow Management","permalink":"/production/workflow-management"},"next":{"title":"Workflow Retention Policies","permalink":"/production/retention"}}');var s=r(4848),o=r(8453);const i={sidebar_position:25,title:"Alerting",toc_max_heading_level:3},a=void 0,l={},c=[{value:"Creating Alerts",id:"creating-alerts",level:3},{value:"Receiving Alerts",id:"receiving-alerts",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{TabItem:t,Tabs:i}=n;return t||p("TabItem",!0),i||p("Tabs",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["If you are using ",(0,s.jsx)(n.a,{href:"/production/conductor",children:"Conductor"}),", you can configure automatic alerts when certain failure conditions are met."]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["Alerts require at least a ",(0,s.jsx)(n.a,{href:"https://www.dbos.dev/dbos-pricing",children:"DBOS Teams"})," plan."]})}),"\n",(0,s.jsx)(n.h3,{id:"creating-alerts",children:"Creating Alerts"}),"\n",(0,s.jsx)(n.p,{children:'You can create new alerts (or view or update your existing alerts) from your application\'s "Alerting" page on the DBOS Console.'}),"\n",(0,s.jsx)("img",{src:r(7695).A,alt:"Alerts",width:"750",className:"custom-img"}),"\n",(0,s.jsx)(n.p,{children:"Currently, you can create alerts for the following failure conditions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If a certain number of workflows (parameterizable by workflow type) fail in a set period of time."}),"\n",(0,s.jsx)(n.li,{children:"If a workflow remains enqueued for more than a certain period of time (parameterizable by queue name), indicating the queue is overwhelmed or stuck."}),"\n",(0,s.jsx)(n.li,{children:"If an application is unreponsive (no connected executors, or connected but unresponsive executors)."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"You may also specify an application to receive the alert\u2014this does not need to be the same as the application that generated the alert.\nFor some failure conditions (e.g., unresponsive application), the application receiving the alert is required to be different from the one generating it."}),"\n",(0,s.jsx)(n.h3,{id:"receiving-alerts",children:"Receiving Alerts"}),"\n",(0,s.jsx)(n.p,{children:"You can register an alert handler in your application to receive alerts from Conductor.\nYour handler can log the alerts or forward them to another system, such as Slack or PagerDuty."}),"\n",(0,s.jsx)(n.p,{children:"Only one alert handler may be registered per application, and it must be registered before launching DBOS.\nIf no handler is registered, alerts are logged automatically."}),"\n",(0,s.jsx)(n.p,{children:"The handler receives three arguments:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"rule_type"}),": The type of alert rule. One of ",(0,s.jsx)(n.code,{children:"WorkflowFailure"}),", ",(0,s.jsx)(n.code,{children:"SlowQueue"}),", or ",(0,s.jsx)(n.code,{children:"UnresponsiveApplication"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"message"}),": The alert message."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"metadata"}),": Additional key-value string metadata about the alert. The metadata keys depend on the rule type:"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"WorkflowFailure"})}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"workflow_name"}),": The workflow name filter, or ",(0,s.jsx)(n.code,{children:"*"})," for all workflows."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"failed_workflow_count"}),": The number of failed workflows detected in the time window."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"threshold"}),": The configured failure count threshold."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"period_secs"}),": The time window in seconds."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"SlowQueue"})}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"queue_name"}),": The queue name filter, or ",(0,s.jsx)(n.code,{children:"*"})," for all queues."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"stuck_workflow_count"}),": The number of workflows that have been in the queue for longer than the time threshold."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"threshold_secs"}),": The enqueue time threshold in seconds."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"UnresponsiveApplication"})}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"application_name"}),": The application name."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"connected_executor_count"}),": The number of executors currently connected to this application."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i,{groupId:"language",children:[(0,s.jsxs)(t,{value:"python",label:"Python",children:[(0,s.jsx)(n.p,{children:"Example logging alerts:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from dbos import DBOS\n\n@DBOS.alert_handler\ndef handle_alert(rule_type: str, message: str, metadata: dict[str, str]) -> None:\n    DBOS.logger.warning(f"Alert received: {rule_type} - {message}")\n    for key, value in metadata.items():\n        DBOS.logger.warning(f"  {key}: {value}")\n'})}),(0,s.jsxs)(n.p,{children:["Example forwarding alerts to Slack using ",(0,s.jsx)(n.a,{href:"https://docs.slack.dev/messaging/sending-messages-using-incoming-webhooks/",children:"incoming webhooks"})]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'@DBOS.alert_handler\ndef handle_alert(rule_type: str, message: str, metadata: dict[str, str]) -> None:\n    webhook_url = os.environ.get("SLACK_WEBHOOK_URL")\n\n    slack_text = f"*Alert: {rule_type}*\\n{message}\\n" + "\\n".join(f"\u2022 {k}: {v}" for k, v in metadata.items())\n\n    try:\n        resp = requests.post(webhook_url, json={"text": slack_text}, timeout=10)\n        resp.raise_for_status()\n    except requests.RequestException as e:\n        DBOS.logger.error(f"Failed to send Slack alert: {e}")\n'})}),(0,s.jsxs)(n.p,{children:["Example forwarding alerts to PagerDuty using the ",(0,s.jsx)(n.a,{href:"https://developer.pagerduty.com/docs/events-api-v2-overview",children:"Events API"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'@DBOS.alert_handler\ndef handle_alert(rule_type: str, message: str, metadata: dict[str, str]) -> None:\n    routing_key = os.environ.get("PAGERDUTY_ROUTING_KEY")\n\n    payload = {\n        "routing_key": routing_key,\n        "event_action": "trigger",\n        "payload": {\n            "summary": f"{rule_type}: {message}",\n            "severity": "error",\n            "source": "my-app",\n            "custom_details": metadata,\n        },\n    }\n\n    try:\n        resp = requests.post(\n            "https://events.pagerduty.com/v2/enqueue",\n            json=payload,\n            timeout=10,\n        )\n        resp.raise_for_status()\n    except requests.RequestException as e:\n        DBOS.logger.error(f"Failed to send PagerDuty alert: {e}")\n'})}),(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.a,{href:"/python/reference/contexts#alert_handler",children:"Python reference"})," for more details."]})]}),(0,s.jsxs)(t,{value:"typescript",label:"Typescript",children:[(0,s.jsx)(n.p,{children:"Example logging alerts:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"DBOS.setAlertHandler(async (ruleType: string, message: string, metadata: Record<string, string>) => {\n  DBOS.logger.warn(`Alert received: ${ruleType} - ${message}`);\n  for (const [key, value] of Object.entries(metadata)) {\n    DBOS.logger.warn(`  ${key}: ${value}`);\n  }\n});\n"})}),(0,s.jsxs)(n.p,{children:["Example forwarding alerts to Slack using ",(0,s.jsx)(n.a,{href:"https://docs.slack.dev/messaging/sending-messages-using-incoming-webhooks/",children:"incoming webhooks"})]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'DBOS.setAlertHandler(async (ruleType: string, message: string, metadata: Record<string, string>) => {\n  const webhookUrl = process.env.SLACK_WEBHOOK_URL!;\n  const slackText = `*Alert: ${ruleType}*\\n${message}\\n` +\n    Object.entries(metadata).map(([k, v]) => `\u2022 ${k}: ${v}`).join("\\n");\n\n  const resp = await fetch(webhookUrl, {\n    method: "POST",\n    headers: { "Content-Type": "application/json" },\n    body: JSON.stringify({ text: slackText }),\n  });\n  if (!resp.ok) {\n    DBOS.logger.error(`Failed to send Slack alert: ${resp.status}`);\n  }\n});\n'})}),(0,s.jsxs)(n.p,{children:["Example forwarding alerts to PagerDuty using the ",(0,s.jsx)(n.a,{href:"https://developer.pagerduty.com/docs/events-api-v2-overview",children:"Events API"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'DBOS.setAlertHandler(async (ruleType: string, message: string, metadata: Record<string, string>) => {\n  const routingKey = process.env.PAGERDUTY_ROUTING_KEY!;\n  const payload = {\n    routing_key: routingKey,\n    event_action: "trigger",\n    payload: {\n      summary: `${ruleType}: ${message}`,\n      severity: "error",\n      source: "my-app",\n      custom_details: metadata,\n    },\n  };\n\n  const resp = await fetch("https://events.pagerduty.com/v2/enqueue", {\n    method: "POST",\n    headers: { "Content-Type": "application/json" },\n    body: JSON.stringify(payload),\n  });\n  if (!resp.ok) {\n    DBOS.logger.error(`Failed to send PagerDuty alert: ${resp.status}`);\n  }\n});\n'})}),(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.a,{href:"/typescript/reference/methods#dbossetalerthandler",children:"TypeScript reference"})," for more details."]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}function p(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},7695:(e,n,r)=>{r.d(n,{A:()=>t});const t=r.p+"assets/images/alerts-51d4a3b14cda8f4f8fca9d1a7f4b1841.png"},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>a});var t=r(6540);const s={},o=t.createContext(s);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);