"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[3307],{4439:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>u,contentTitle:()=>l,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"golang/reference/queues","title":"Queues","description":"Workflow queues allow you to ensure that workflow functions will be run, without starting them immediately.","source":"@site/docs/golang/reference/queues.md","sourceDirName":"golang/reference","slug":"/golang/reference/queues","permalink":"/golang/reference/queues","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":40,"frontMatter":{"sidebar_position":40,"title":"Queues"},"sidebar":"tutorialSidebar","previous":{"title":"DBOS Methods & Variables","permalink":"/golang/reference/methods"},"next":{"title":"DBOS CLI","permalink":"/golang/reference/cli"}}');var t=i(4848),o=i(8453);const s={sidebar_position:40,title:"Queues"},l=void 0,u={},a=[{value:"NewWorkflowQueue",id:"newworkflowqueue",level:3},{value:"WithWorkerConcurrency",id:"withworkerconcurrency",level:4},{value:"WithGlobalConcurrency",id:"withglobalconcurrency",level:4},{value:"WithMaxTasksPerIteration",id:"withmaxtasksperiteration",level:4},{value:"WithPriorityEnabled",id:"withpriorityenabled",level:4},{value:"WithRateLimiter",id:"withratelimiter",level:4},{value:"WithPartitionQueue",id:"withpartitionqueue",level:4},{value:"WithQueueBasePollingInterval",id:"withqueuebasepollinginterval",level:4},{value:"WithQueueMaxPollingInterval",id:"withqueuemaxpollinginterval",level:4},{value:"ListenQueues",id:"listenqueues",level:3},{value:"Debouncer",id:"debouncer",level:3},{value:"NewDebouncer",id:"newdebouncer",level:4},{value:"WithDebouncerTimeout",id:"withdebouncertimeout",level:4},{value:"Debouncer.Debounce",id:"debouncerdebounce",level:4}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h3:"h3",h4:"h4",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Workflow queues allow you to ensure that workflow functions will be run, without starting them immediately.\nQueues are useful for controlling the number of workflows run in parallel, or the rate at which they are started."}),"\n",(0,t.jsx)(n.p,{children:"All queues should be created before DBOS is launched."}),"\n",(0,t.jsx)(n.h3,{id:"newworkflowqueue",children:"NewWorkflowQueue"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func NewWorkflowQueue(dbosCtx DBOSContext, name string, options ...queueOption) WorkflowQueue\n"})}),"\n",(0,t.jsxs)(n.p,{children:["NewWorkflowQueue creates a new workflow queue with the specified name and configuration options.\nQueues must be created before DBOS is launched.\nYou can enqueue a workflow using the ",(0,t.jsx)(n.a,{href:"/golang/reference/workflows-steps#withqueue",children:(0,t.jsx)(n.code,{children:"WithQueue"})})," parameter of ",(0,t.jsx)(n.a,{href:"/golang/reference/workflows-steps#runworkflow",children:(0,t.jsx)(n.code,{children:"RunWorkflow"})}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"dbosCtx"}),": The DBOSContext."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"name"}),": The name of the queue.  Must be unique among all queues in the application."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"options"}),": Functional options for the queue, documented below."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example Syntax:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'queue := dbos.NewWorkflowQueue(ctx, "email-queue",\n    dbos.WithWorkerConcurrency(5),\n    dbos.WithRateLimiter(&dbos.RateLimiter{\n        Limit:  100,\n        Period: 60 * time.Second, // 100 workflows per minute\n    }),\n    dbos.WithPriorityEnabled(),\n)\n\n// Enqueue workflows to this queue:\nhandle, err := dbos.RunWorkflow(ctx, SendEmailWorkflow, emailData, dbos.WithQueue("email-queue"))\n'})}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"/golang/reference/dbos-context#listregisteredqueues",children:"ListRegisteredQueues"})," for obtaining a list of all registered queues."]}),"\n",(0,t.jsx)(n.h4,{id:"withworkerconcurrency",children:"WithWorkerConcurrency"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func WithWorkerConcurrency(concurrency int) queueOption\n"})}),"\n",(0,t.jsx)(n.p,{children:"Set the maximum number of workflows from this queue that may run concurrently within a single DBOS process."}),"\n",(0,t.jsx)(n.h4,{id:"withglobalconcurrency",children:"WithGlobalConcurrency"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func WithGlobalConcurrency(concurrency int) queueOption\n"})}),"\n",(0,t.jsx)(n.p,{children:"Set the maximum number of workflows from this queue that may run concurrently. Defaults to 0 (no limit).\nThis concurrency limit is global across all DBOS processes using this queue."}),"\n",(0,t.jsx)(n.h4,{id:"withmaxtasksperiteration",children:"WithMaxTasksPerIteration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func WithMaxTasksPerIteration(maxTasks int) queueOption\n"})}),"\n",(0,t.jsx)(n.p,{children:"Sets the maximum number of workflows that can be dequeued in a single iteration.\nThis controls batch sizes for queue processing."}),"\n",(0,t.jsx)(n.h4,{id:"withpriorityenabled",children:"WithPriorityEnabled"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func WithPriorityEnabled() queueOption\n"})}),"\n",(0,t.jsx)(n.p,{children:"Enable setting priority for workflows on this queue."}),"\n",(0,t.jsx)(n.h4,{id:"withratelimiter",children:"WithRateLimiter"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func WithRateLimiter(limiter *RateLimiter) queueOption\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"type RateLimiter struct {\n    Limit  int     // Maximum number of workflows to start within the period\n    Period time.Duration // Time period for the rate limit\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"A limit on the maximum number of functions which may be started in a given period."}),"\n",(0,t.jsx)(n.h4,{id:"withpartitionqueue",children:"WithPartitionQueue"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func WithPartitionQueue() queueOption\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Enable partitioning for this queue.\nWhen enabled, workflows can be enqueued with a partition key using ",(0,t.jsx)(n.a,{href:"/golang/reference/workflows-steps#withqueuepartitionkey",children:(0,t.jsx)(n.code,{children:"WithQueuePartitionKey"})}),", and each partition has its own concurrency limits.\nThis allows distributing work across dynamically created queue partitions."]}),"\n",(0,t.jsx)(n.p,{children:"In partitioned queues, all flow control (including concurrency and rate limits) is applied to individual partitions instead of the queue as a whole.\nFor example, if you create a partitioned queue with a global concurrency of 1, then at most one workflow from each partition can run concurrently (but workflows from different partitions can run in parallel)."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example Syntax:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'// Create a partitioned queue with a global concurrency limit of 1\npartitionedQueue := dbos.NewWorkflowQueue(ctx, "user-tasks",\n    dbos.WithPartitionQueue(),\n    dbos.WithGlobalConcurrency(1),\n)\n\n// Enqueue workflows with different partition keys\n// At most one workflow per user can run at once, but workflows from different users can run concurrently\nhandle1, _ := dbos.RunWorkflow(ctx, ProcessTask, task1,\n    dbos.WithQueue("user-tasks"),\n    dbos.WithQueuePartitionKey("user-123"),\n)\n\nhandle2, _ := dbos.RunWorkflow(ctx, ProcessTask, task2,\n    dbos.WithQueue("user-tasks"),\n    dbos.WithQueuePartitionKey("user-456"),\n)\n'})}),"\n",(0,t.jsx)(n.h4,{id:"withqueuebasepollinginterval",children:"WithQueueBasePollingInterval"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func WithQueueBasePollingInterval(interval time.Duration) QueueOption\n"})}),"\n",(0,t.jsx)(n.p,{children:"Set the base polling interval for this queue. This also acts as the minimum (fastest) interval. Polling intervals are subject to base 2 exponential backoff."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example Syntax:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'queue := dbos.NewWorkflowQueue(ctx, "email-queue", dbos.WithQueueBasePollingInterval(100*time.Millisecond))\n'})}),"\n",(0,t.jsx)(n.h4,{id:"withqueuemaxpollinginterval",children:"WithQueueMaxPollingInterval"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func WithQueueMaxPollingInterval(interval time.Duration) QueueOption\n"})}),"\n",(0,t.jsx)(n.p,{children:"Set the maximum (slowest) polling interval for this queue. Polling intervals are subject to base 2 exponential backoff."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example Syntax:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'queue := dbos.NewWorkflowQueue(ctx, "email-queue", dbos.WithQueueMaxPollingInterval(10*time.Second))\n'})}),"\n",(0,t.jsx)(n.h3,{id:"listenqueues",children:"ListenQueues"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func ListenQueues(ctx DBOSContext, queues ...WorkflowQueue)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Configure which queues the current DBOS process should listen to for workflow execution.\nBy default, all registered queues are listened to.\nWhen ",(0,t.jsx)(n.code,{children:"ListenQueues"})," is called, only the specified queues (and the internal DBOS queue) will be processed by the queue runner."]}),"\n",(0,t.jsx)(n.p,{children:"This allows multiple DBOS processes to share the same queue registry but listen to different subsets of queues."}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"ListenQueues"})," can only be called before ",(0,t.jsx)(n.code,{children:"Launch()"}),". Calling it after launch will panic."]})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"debouncer",children:"Debouncer"}),"\n",(0,t.jsx)(n.p,{children:"A debouncer delays workflow execution until a configurable delay has elapsed since the last invocation.\nEach subsequent call pushes back the start time by the delay amount.\nThis is useful when you want to coalesce rapid successive triggers (e.g., text field edits, sensor data) into a single workflow execution."}),"\n",(0,t.jsxs)(n.p,{children:["See the ",(0,t.jsx)(n.a,{href:"/golang/tutorials/workflow-tutorial#debouncing",children:"debouncing tutorial"})," for usage examples."]}),"\n",(0,t.jsx)(n.h4,{id:"newdebouncer",children:"NewDebouncer"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func NewDebouncer[P any, R any](ctx DBOSContext, workflow Workflow[P, R], opts ...DebouncerOption) *Debouncer[P, R]\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Create a new debouncer for the specified workflow.\nThe workflow must be registered before creating the debouncer.\nDebouncers must be created before ",(0,t.jsx)(n.code,{children:"Launch()"}),".\nMultiple debouncers can be created for the same workflow."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ctx"}),": The DBOSContext."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"workflow"}),": The workflow function to debounce (must be registered)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"opts"}),": Optional configuration, documented below."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"withdebouncertimeout",children:"WithDebouncerTimeout"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func WithDebouncerTimeout(timeout time.Duration) DebouncerOption\n"})}),"\n",(0,t.jsx)(n.p,{children:"Set the maximum time before starting the workflow, measured from the first debounce call for a given key.\nIf the timeout is zero (the default), there is no maximum time limit and calling the workflow can be pushed back indefinitely."}),"\n",(0,t.jsx)(n.h4,{id:"debouncerdebounce",children:"Debouncer.Debounce"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func (d *Debouncer[P, R]) Debounce(ctx DBOSContext, key string, delay time.Duration, input P, opts ...WorkflowOption) (WorkflowHandle[R], error)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Debounce a workflow invocation.\nIf no debouncer is active for the given key, one is started with the specified delay.\nIf a debouncer is already active for the key, the delay is pushed back and the input is updated.\nWhen the delay expires ",(0,t.jsx)(n.em,{children:"or"})," the debouncer preconfigured timeout is reached, the target workflow is executed with the most recent input."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ctx"}),": The DBOSContext."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"key"}),": A unique key to group debounce calls. Calls with the same key are debounced together."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"delay"}),": Time by which to delay workflow execution from this call."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"input"}),": Input parameters to pass to the workflow."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"opts"}),": Optional workflow options (e.g., ",(0,t.jsx)(n.code,{children:"WithWorkflowID"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Returns:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["A ",(0,t.jsx)(n.a,{href:"/golang/reference/workflows-steps#workflowhandle",children:"WorkflowHandle"})," for the target workflow."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["You can also create a debouncer from outside a DBOS application using the ",(0,t.jsx)(n.a,{href:"/golang/reference/client#newdebouncerclient",children:"DBOS Client"}),"."]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var r=i(6540);const t={},o=r.createContext(t);function s(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);