"use strict";(self.webpackChunkoperon_docs=self.webpackChunkoperon_docs||[]).push([[919],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),d=a,m=u["".concat(l,".").concat(d)]||u[d]||g[d]||o;return n?r.createElement(m,i(i({ref:t},c),{},{components:n})):r.createElement(m,i({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2833:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var r=n(7462),a=(n(7294),n(3905));const o={sidebar_position:2,title:"Programming Quickstart - Part 1"},i=void 0,s={unversionedId:"getting-started/quickstart-programming-1",id:"getting-started/quickstart-programming-1",title:"Programming Quickstart - Part 1",description:"Now that we have an application up and running, let's learn how to program in Operon!",source:"@site/docs/getting-started/quickstart-programming-1.md",sourceDirName:"getting-started",slug:"/getting-started/quickstart-programming-1",permalink:"/operon-docs/getting-started/quickstart-programming-1",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Programming Quickstart - Part 1"},sidebar:"tutorialSidebar",previous:{title:"Operon Quickstart",permalink:"/operon-docs/getting-started/quickstart"},next:{title:"Programming Quickstart - Part 2",permalink:"/operon-docs/getting-started/quickstart-programming-2"}},l={},p=[],c={toc:p},u="wrapper";function g(e){let{components:t,...n}=e;return(0,a.kt)(u,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Now that we have an application up and running, let's learn how to program in Operon!"),(0,a.kt)("p",null,"Let's look at the code we have so far (in ",(0,a.kt)("inlineCode",{parentName:"p"},"src/operations.ts"),').\nThis simple "Hello, World!" program greets users and tracks the count of greetings per user:'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { TransactionContext, OperonTransaction, GetApi, HandlerContext } from '@dbos-inc/operon'\nimport { Knex } from 'knex';\n\n// The schema of the database table used in this example.\nexport interface operon_hello {\n  name: string;\n  greet_count: number;\n}\n\nexport class Hello {\n\n  @GetApi('/greeting/:user') // Serve this function from the /greeting endpoint with 'user' as a path parameter\n  static async helloHandler(ctxt: HandlerContext, user: string) {\n    // Invoke helloTransaction to greet the user and track how many times they've been greeted.\n    return ctxt.invoke(Hello).helloTransaction(user);\n  }\n\n  @OperonTransaction()  // Declare this function to be a transaction.\n  static async helloTransaction(ctxt: TransactionContext<Knex>, user: string) {\n    // Retrieve and increment the number of times this user has been greeted.\n    const rows = await ctxt.client<operon_hello>(\"operon_hello\")\n      // Insert greet_count for this user.\n      .insert({ name: user, greet_count: 1 })\n      // If already present, increment it instead.\n      .onConflict(\"name\").merge({ greet_count: ctxt.client.raw('operon_hello.greet_count + 1') })\n      // Return the inserted or incremented value.\n      .returning(\"greet_count\");               \n    const greet_count = rows[0].greet_count;\n    return `Hello, ${user}! You have been greeted ${greet_count} times.\\n`;\n  }\n}\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"helloHandler")," function serves the greeting via an HTTP request to the ",(0,a.kt)("inlineCode",{parentName:"p"},"greeting")," endpoint.\nIt calls the ",(0,a.kt)("inlineCode",{parentName:"p"},"helloTransaction")," function, which transactionally fetches and updates a user's greeting count.\nBoth are registered with Operon via ",(0,a.kt)("em",{parentName:"p"},"decorators"),": ",(0,a.kt)("inlineCode",{parentName:"p"},"@GetApi")," declares an HTTP endpoint and ",(0,a.kt)("inlineCode",{parentName:"p"},"@OperonTransaction")," declares a transaction.\nThe database operations are written using ",(0,a.kt)("a",{parentName:"p",href:"https://knexjs.org/"},"knex.js"),", a popular query builder, but Operon also supports raw SQL and the popular Typescript ORMs ",(0,a.kt)("a",{parentName:"p",href:"https://www.prisma.io/"},"Prisma")," and ",(0,a.kt)("a",{parentName:"p",href:"https://typeorm.io/"},"TypeORM"),"."),(0,a.kt)("p",null,"Let's make this program more interesting by giving users the ability to clear their greeting count.\nFirst, let's write a function clearing the greeting count for a user:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'@OperonTransaction()\nstatic async clearTransaction(ctxt: TransactionContext<Knex>, user: string) {\n  // Delete greet_count for a user.\n  await ctxt.client<operon_hello>("operon_hello")\n    .where({ name: user })\n    .delete()\n  return `Cleared greet_count for ${user}!\\n`\n}\n')),(0,a.kt)("p",null,"Add this function as a method of the ",(0,a.kt)("inlineCode",{parentName:"p"},"Hello")," class.\nLike before, this function is declared a transaction via the ",(0,a.kt)("inlineCode",{parentName:"p"},"@OperonTransaction")," decorator and accesses the database using  ",(0,a.kt)("a",{parentName:"p",href:"https://knexjs.org/"},"knex.js"),".\nTo learn more about database operations and transactions in Operon, see ",(0,a.kt)("a",{parentName:"p",href:"../tutorials/transaction-tutorial"},"our guide"),"."),(0,a.kt)("p",null,"Now, let's add an HTTP endpoint from which to serve this function:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { PostApi } from '@dbos-inc/operon' // Add this to your imports.\n\n// highlight-next-line\n@PostApi('/clear/:user')\n@OperonTransaction()\nstatic async clearTransaction(ctxt: TransactionContext<Knex>, user: string) {\n  // Delete greet_count for a user.\n  await ctxt.client<operon_hello>(\"operon_hello\")\n    .where({ name: user })\n    .delete()\n  return `Cleared greet_count for ${user}!\\n`\n}\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"@PostApi")," decorator we added tells Operon to execute this function in response to HTTP POST requests to the ",(0,a.kt)("inlineCode",{parentName:"p"},"clear")," endpoint.\nThe ",(0,a.kt)("inlineCode",{parentName:"p"},":user")," syntax tells Operon to use the ",(0,a.kt)("inlineCode",{parentName:"p"},"user")," path parameter from the URL as a parameter to the function.\nTo learn more about HTTP endpoints and handlers in Operon, see ",(0,a.kt)("a",{parentName:"p",href:"../tutorials/http-serving-tutorial"},"our guide"),"."),(0,a.kt)("p",null,"Now, let's see if this works!\nFirst, build and start the application:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"npm run build\nnpx operon start\n")),(0,a.kt)("p",null,"With the application running, we can query it and observe the greeting count being incremented with each query:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:3000/greeting/operon\n")),(0,a.kt)("p",null,"Then, clear the greeting count and ask for another greeting:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"curl -X POST http://localhost:3000/clear/operon\ncurl http://localhost:3000/greeting/operon\n")),(0,a.kt)("p",null,"The greeting count should reset back to 1."),(0,a.kt)("p",null,"If you've gotten this far, congratulations on writing your first few Operon functions!\nMove on to the next part to learn how to use more complex Operon features, like reliable workflows."))}g.isMDXComponent=!0}}]);