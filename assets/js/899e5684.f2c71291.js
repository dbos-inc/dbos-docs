"use strict";(self.webpackChunkoperon_docs=self.webpackChunkoperon_docs||[]).push([[602],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(n),k=r,m=u["".concat(s,".").concat(k)]||u[k]||d[k]||o;return n?a.createElement(m,i(i({ref:t},p),{},{components:n})):a.createElement(m,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=k;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},1596:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const o={sidebar_position:3,title:"Operon Contexts",description:"API reference for Operon contexts"},i=void 0,l={unversionedId:"api-reference/contexts",id:"api-reference/contexts",title:"Operon Contexts",description:"API reference for Operon contexts",source:"@site/docs/api-reference/contexts.md",sourceDirName:"api-reference",slug:"/api-reference/contexts",permalink:"/api-reference/contexts",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"Operon Contexts",description:"API reference for Operon contexts"},sidebar:"tutorialSidebar",previous:{title:"Configuration",permalink:"/api-reference/configuration"},next:{title:"Decorators",permalink:"/api-reference/decorators"}},s={},c=[{value:"Background",id:"background",level:2},{value:"<code>OperonContext</code>",id:"operoncontext",level:2},{value:"Properties",id:"properties",level:3},{value:"Methods",id:"methods",level:3},{value:"ctxt.request",id:"ctxtrequest",level:3},{value:"ctxt.workflowUUID",id:"ctxtworkflowuuid",level:3},{value:"ctxt.authenticatedUser",id:"ctxtauthenticateduser",level:3},{value:"ctxt.authenticatedRoles",id:"ctxtauthenticatedroles",level:3},{value:"ctxt.assumedRole",id:"ctxtassumedrole",level:3},{value:"ctxt.logger",id:"ctxtlogger",level:3},{value:"ctxt.span",id:"ctxtspan",level:3},{value:"ctxt.getConfig(key, defaultValue)",id:"ctxtgetconfigkey-defaultvalue",level:3},{value:"<code>HandlerContext</code>",id:"handlercontext",level:2},{value:"Properties",id:"properties-1",level:3},{value:"Methods",id:"methods-1",level:3},{value:"handlerCtxt.koaContext",id:"handlerctxtkoacontext",level:3},{value:"handlerCtxt.invoke(targetClass, [workflowUUID])",id:"handlerctxtinvoketargetclass-workflowuuid",level:3},{value:"handlerCtxt.retrieveWorkflow(workflowUUID)",id:"handlerctxtretrieveworkflowworkflowuuid",level:3},{value:"handlerCtxt.send(destinationUUID, message, [topic, idempotencyKey])",id:"handlerctxtsenddestinationuuid-message-topic-idempotencykey",level:3},{value:"handlerCtxt.getEvent(workflowUUID, key, [timeoutSeconds])",id:"handlerctxtgeteventworkflowuuid-key-timeoutseconds",level:3},{value:"<code>WorkflowContext</code>",id:"workflowcontext",level:2},{value:"Methods",id:"methods-2",level:3},{value:"workflowCtxt.invoke(targetClass)",id:"workflowctxtinvoketargetclass",level:3},{value:"workflowCtxt.childWorkflow(wf, ...args)",id:"workflowctxtchildworkflowwf-args",level:3},{value:"workflowCtxt.send(destinationUUID, message, [topic])",id:"workflowctxtsenddestinationuuid-message-topic",level:3},{value:"workflowCtxt.recv([topic, timeoutSeconds])",id:"workflowctxtrecvtopic-timeoutseconds",level:3},{value:"workflowCtxt.setEvent(key, value)",id:"workflowctxtseteventkey-value",level:3},{value:"<code>TransactionContext&lt;T&gt;</code>",id:"transactioncontextt",level:2},{value:"Generic Type Parameter",id:"generic-type-parameter",level:3},{value:"Properties",id:"properties-2",level:3},{value:"transactionCtxt.client",id:"transactionctxtclient",level:3},{value:"<code>CommunicatorContext</code>",id:"communicatorcontext",level:2},{value:"Properties",id:"properties-3",level:4},{value:"communicatorCtxt.retriesAllowed",id:"communicatorctxtretriesallowed",level:3},{value:"communicatorCtxt.maxAttempts",id:"communicatorctxtmaxattempts",level:3}],p={toc:c},u="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(u,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"background"},"Background"),(0,r.kt)("p",null,"Operon automatically create a ",(0,r.kt)("em",{parentName:"p"},"context")," for each registered function.\nFunctions use their context to call other Operon functions, interact with the runtime or the database, and access the logger.\nEach Operon function has a specific context:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"All contexts inherit ",(0,r.kt)("a",{parentName:"li",href:"#operoncontext"},(0,r.kt)("inlineCode",{parentName:"a"},"OperonContext")),"."),(0,r.kt)("li",{parentName:"ul"},"Handlers use ",(0,r.kt)("a",{parentName:"li",href:"#handlercontext"},(0,r.kt)("inlineCode",{parentName:"a"},"HandlerContext")),"."),(0,r.kt)("li",{parentName:"ul"},"Workflows use ",(0,r.kt)("a",{parentName:"li",href:"#workflowcontext"},(0,r.kt)("inlineCode",{parentName:"a"},"WorkflowContext")),"."),(0,r.kt)("li",{parentName:"ul"},"Transactions use ",(0,r.kt)("a",{parentName:"li",href:"#transactioncontextt"},(0,r.kt)("inlineCode",{parentName:"a"},"TransactionContext<T>"))," with a specific database client type."),(0,r.kt)("li",{parentName:"ul"},"Communicators use ",(0,r.kt)("a",{parentName:"li",href:"#communicatorcontext"},(0,r.kt)("inlineCode",{parentName:"a"},"CommunicatorContext")),".")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"operoncontext"},(0,r.kt)("inlineCode",{parentName:"h2"},"OperonContext")),(0,r.kt)("p",null,"All contexts inherit from ",(0,r.kt)("inlineCode",{parentName:"p"},"OperonContext")," and share its properties and methods."),(0,r.kt)("h3",{id:"properties"},"Properties"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ctxtrequest"},"request")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ctxtworkflowuuid"},"workflowUUID")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ctxtauthenticateduser"},"authenticatedUser")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ctxtauthenticatedroles"},"authenticatedRoles")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ctxtassumedrole"},"assumedRole")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ctxtlogger"},"logger")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ctxtspan"},"span"))),(0,r.kt)("h3",{id:"methods"},"Methods"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ctxtgetconfigkey-defaultvalue"},"getConfig(key, defaultValue)"))),(0,r.kt)("h3",{id:"ctxtrequest"},"ctxt.request"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"readonly request: HTTPRequest\n")),(0,r.kt)("p",null,"An object with information about the originating HTTP request that triggered, directly or not, this function."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"interface HTTPRequest {\n  readonly headers?: IncomingHttpHeaders;  // A node's http.IncomingHttpHeaders object.\n  readonly rawHeaders?: string[];          // Raw headers.\n  readonly params?: unknown;               // Parsed path parameters from the URL.\n  readonly body?: unknown;                 // parsed HTTP body as an object.\n  readonly rawBody?: string;               // Unparsed raw HTTP body string.\n  readonly query?: ParsedUrlQuery;         // Parsed query string.\n  readonly querystring?: string;           // Unparsed raw query string.\n  readonly url?: string;                   // Request URL.\n  readonly ip?: string;                    // Request remote address.\n}\n")),(0,r.kt)("h3",{id:"ctxtworkflowuuid"},"ctxt.workflowUUID"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"readonly workflowUUID: string\n")),(0,r.kt)("p",null,"The current workflow's ",(0,r.kt)("a",{parentName:"p",href:"../tutorials/workflow-tutorial#workflow-identity"},"identity UUID"),", a string uniquely identifying a workflow instance.\nIn a transaction or communicator, this field is set to the identity UUID of the calling workflow.\nIn a handler, this field is empty."),(0,r.kt)("h3",{id:"ctxtauthenticateduser"},"ctxt.authenticatedUser"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"readonly authenticatedUser: string\n")),(0,r.kt)("p",null,"The identity of the authenticated user who ran this function.\nAuthenticated users are set by ",(0,r.kt)("a",{parentName:"p",href:"../tutorials/authentication-authorization"},"authentication middleware")," and inherited through the calling chain."),(0,r.kt)("h3",{id:"ctxtauthenticatedroles"},"ctxt.authenticatedRoles"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"readonly authenticatedRoles: string[];\n")),(0,r.kt)("p",null,"A list of roles the authenticated user has, if any.\nAuthenticated roles are set by ",(0,r.kt)("a",{parentName:"p",href:"../tutorials/authentication-authorization"},"authentication middleware")," and inherited through the calling chain."),(0,r.kt)("h3",{id:"ctxtassumedrole"},"ctxt.assumedRole"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"readonly assumedRole: string;\n")),(0,r.kt)("p",null,"The role used to run this function.\nEmpty string if authorization is not required.\nOperon's ",(0,r.kt)("a",{parentName:"p",href:"../tutorials/authentication-authorization#authorization-decorators"},"authorization")," sets the assumed role right before executing a function and this property is ",(0,r.kt)("em",{parentName:"p"},"not")," inherited through the calling chain."),(0,r.kt)("h3",{id:"ctxtlogger"},"ctxt.logger"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"readonly logger: OperonLogger\n")),(0,r.kt)("p",null,"A reference to Operon's logger.\nPlease see our ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/logging#logging"},"logging tutorial")," for more information."),(0,r.kt)("h3",{id:"ctxtspan"},"ctxt.span"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"readonly span: Span\n")),(0,r.kt)("p",null,"An ",(0,r.kt)("a",{parentName:"p",href:"https://opentelemetry.io/docs/concepts/signals/traces/#spans"},"OpenTelemetry Span")," associated with this function.\nYou can assign custom trace attributes to this span.\nPlease see our ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/logging#tracing"},"tracing tutorial")," for more information."),(0,r.kt)("h3",{id:"ctxtgetconfigkey-defaultvalue"},"ctxt.getConfig(key, defaultValue)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"getConfig<T>(key: string): T | undefined;\ngetConfig<T>(key: string, defaultValue: T): T;\n")),(0,r.kt)("p",null,"Retrieves an application property specified in the ",(0,r.kt)("a",{parentName:"p",href:"/api-reference/configuration#application-configuration"},"application section of the configuration"),".\nOptionally accepts a default value, returned when the key cannot be found in the configuration."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"handlercontext"},(0,r.kt)("inlineCode",{parentName:"h2"},"HandlerContext")),(0,r.kt)("p",null,"Handlers use ",(0,r.kt)("inlineCode",{parentName:"p"},"HandlerContext")," to invoke other functions, interact with active workflows, and interact directly with HTTP requests and responses."),(0,r.kt)("h3",{id:"properties-1"},"Properties"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#handlerctxtkoacontext"},"koaContext"))),(0,r.kt)("h3",{id:"methods-1"},"Methods"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#handlerctxtinvoketargetclass-workflowuuid"},"invoke(targetClass, ","[","workflowUUID","]",")")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#handlerctxtretrieveworkflowworkflowuuid"},"retrieveWorkflow(workflowUUID)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#handlerctxtsenddestinationuuid-message-topic-idempotencykey"},"send(destinationUUID, message, ","[","topic, idempotencyKey","]",")")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#handlerctxtgeteventworkflowuuid-key-timeoutseconds"},"getEvent(workflowUUID, key, ","[","timeoutSeconds","]",")"))),(0,r.kt)("h3",{id:"handlerctxtkoacontext"},"handlerCtxt.koaContext"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"koaContext: Koa.Context;\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/koajs/koa/blob/master/docs/api/context.md"},"Koa Context")," of the current request, giving handlers access to the raw HTTP request and response."),(0,r.kt)("h3",{id:"handlerctxtinvoketargetclass-workflowuuid"},"handlerCtxt.invoke(targetClass, ","[","workflowUUID","]",")"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"invoke<T>(targetClass: T, workflowUUID?: string): InvokeFuncs<T>\n")),(0,r.kt)("p",null,"Used to invoke workflows, transactions, and communicators.\nThe syntax for invoking function ",(0,r.kt)("inlineCode",{parentName:"p"},"foo")," in class ",(0,r.kt)("inlineCode",{parentName:"p"},"Bar")," with argument ",(0,r.kt)("inlineCode",{parentName:"p"},"baz")," is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"handlerCtxt.invoke(Bar).foo(baz)\n")),(0,r.kt)("p",null,"When calling transactions or communicators, ",(0,r.kt)("inlineCode",{parentName:"p"},"invoke()")," asynchronously returns the function's output.\nWhen calling workflows, ",(0,r.kt)("inlineCode",{parentName:"p"},"invoke()")," asynchronously returns a ",(0,r.kt)("a",{parentName:"p",href:"./workflow-handles"},(0,r.kt)("inlineCode",{parentName:"a"},"handle"))," for the workflow."),(0,r.kt)("p",null,"Note Operon runtime will supply the context to invoked functions.\nYou can optionally provide a UUID idempotency key to the invoked function.\nFor more information, see our ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/idempotency-tutorial"},"idempotency tutorial"),"."),(0,r.kt)("h3",{id:"handlerctxtretrieveworkflowworkflowuuid"},"handlerCtxt.retrieveWorkflow(workflowUUID)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"retrieveWorkflow<R>(workflowUUID: string): WorkflowHandle<R>\n")),(0,r.kt)("p",null,"Returns a ",(0,r.kt)("a",{parentName:"p",href:"/api-reference/workflow-handles"},"workflow handle")," to the workflow with ",(0,r.kt)("a",{parentName:"p",href:"../tutorials/workflow-tutorial#workflow-identity"},"identity")," ",(0,r.kt)("em",{parentName:"p"},"workflowUUID"),".\n",(0,r.kt)("inlineCode",{parentName:"p"},"R")," is the return type of the target workflow."),(0,r.kt)("h3",{id:"handlerctxtsenddestinationuuid-message-topic-idempotencykey"},"handlerCtxt.send(destinationUUID, message, ","[","topic, idempotencyKey","]",")"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"send<T extends NonNullable<any>>(destinationUUID: string, message: T, topic?: string, idempotencyKey?: string): Promise<void>\n")),(0,r.kt)("p",null,"Sends a message to workflow ",(0,r.kt)("em",{parentName:"p"},"destinationUUID"),".\nMessages can optionally be associated with a topic.\nYou can provide an optional idempotency key to guarantee only a single message is sent even if ",(0,r.kt)("inlineCode",{parentName:"p"},"send")," is called more than once.\nFor more information, see our ",(0,r.kt)("a",{parentName:"p",href:"../tutorials/workflow-communication-tutorial#messages-api"},"messages API tutorial"),"."),(0,r.kt)("h3",{id:"handlerctxtgeteventworkflowuuid-key-timeoutseconds"},"handlerCtxt.getEvent(workflowUUID, key, ","[","timeoutSeconds","]",")"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"getEvent<T extends NonNullable<any>>(workflowUUID: string, key: string, timeoutSeconds?: number): Promise<T | null>\n")),(0,r.kt)("p",null,"Retrieves an event published by ",(0,r.kt)("em",{parentName:"p"},"workflowUUID")," for a given key using the ",(0,r.kt)("a",{parentName:"p",href:"../tutorials/workflow-communication-tutorial#events-api"},"events API"),".\nA call to ",(0,r.kt)("inlineCode",{parentName:"p"},"getEvent")," waits for the workflow to publish the key, returning ",(0,r.kt)("inlineCode",{parentName:"p"},"null")," if the wait times out:"),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"workflowcontext"},(0,r.kt)("inlineCode",{parentName:"h2"},"WorkflowContext")),(0,r.kt)("p",null,"Workflows use ",(0,r.kt)("inlineCode",{parentName:"p"},"WorkflowContext")," to invoke other functions and interact with other workflows."),(0,r.kt)("h3",{id:"methods-2"},"Methods"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#workflowctxtinvoketargetclass"},"invoke(targetClass)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#workflowctxtchildworkflowwf-args"},"childWorkflow(wf, ...args)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#workflowctxtsenddestinationuuid-message-topic"},"send(destinationUUID, message, ","[","topic","]",")")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#workflowctxtrecvtopic-timeoutseconds"},"recv(","[","topic, timeoutSeconds","]",")")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#workflowctxtseteventkey-value"},"setEvent(key, value)"))),(0,r.kt)("h3",{id:"workflowctxtinvoketargetclass"},"workflowCtxt.invoke(targetClass)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"invoke<T>(targetClass: T, workflowUUID?: string): InvokeFuncs<T>\n")),(0,r.kt)("p",null,"Invoke transactions and communicators.\nTo invoke other workflows, use ",(0,r.kt)("a",{parentName:"p",href:"#workflowctxtchildworkflowwf-args"},(0,r.kt)("inlineCode",{parentName:"a"},"childWorkflow")),"."),(0,r.kt)("p",null,"The syntax for invoking function ",(0,r.kt)("inlineCode",{parentName:"p"},"foo")," in class ",(0,r.kt)("inlineCode",{parentName:"p"},"Bar")," with argument ",(0,r.kt)("inlineCode",{parentName:"p"},"baz")," is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"workflowCtxt.invoke(Bar).foo(baz)\n")),(0,r.kt)("p",null,"Note Operon runtime will supply a context to invoked functions."),(0,r.kt)("h3",{id:"workflowctxtchildworkflowwf-args"},"workflowCtxt.childWorkflow(wf, ...args)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"childWorkflow<T extends any[], R>(wf: OperonWorkflow<T, R>, ...args: T): Promise<WorkflowHandle<R>>\n")),(0,r.kt)("p",null,"Invoke another workflow.\nThis returns a ",(0,r.kt)("a",{parentName:"p",href:"./workflow-handles"},"workflow handle")," for the new workflow."),(0,r.kt)("p",null,"The syntax for invoking workflow ",(0,r.kt)("inlineCode",{parentName:"p"},"foo")," in class ",(0,r.kt)("inlineCode",{parentName:"p"},"Bar")," with argument ",(0,r.kt)("inlineCode",{parentName:"p"},"baz")," is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const workflowHandle = await ctxt.childWorkflow(Bar.foo, baz)\n")),(0,r.kt)("h3",{id:"workflowctxtsenddestinationuuid-message-topic"},"workflowCtxt.send(destinationUUID, message, ","[","topic","]",")"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"send<T extends NonNullable<any>>(destinationUUID: string, message: T, topic?: string): Promise<void>\n")),(0,r.kt)("p",null,"Sends a message to ",(0,r.kt)("em",{parentName:"p"},"destinationUUID"),".\nMessages can optionally be associated with a topic.\nFor more information, see our ",(0,r.kt)("a",{parentName:"p",href:"../tutorials/workflow-communication-tutorial#messages-api"},"messages API tutorial"),"."),(0,r.kt)("h3",{id:"workflowctxtrecvtopic-timeoutseconds"},"workflowCtxt.recv(","[","topic, timeoutSeconds","]",")"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"recv<T extends NonNullable<any>>(topic?: string, timeoutSeconds?: number): Promise<T | null>\n")),(0,r.kt)("p",null,"Receive messages sent to the workflow, optionally for a particular topic.\nMessages are dequeued first-in, first-out, from a queue associated with the topic.\nCalls to ",(0,r.kt)("inlineCode",{parentName:"p"},"recv()")," wait for the next message in the queue, returning ",(0,r.kt)("inlineCode",{parentName:"p"},"null")," if the wait times out.\nIf no topic is specified, ",(0,r.kt)("inlineCode",{parentName:"p"},"recv")," can only access messages sent without a topic.\nFor more information, see our ",(0,r.kt)("a",{parentName:"p",href:"../tutorials/workflow-communication-tutorial#messages-api"},"messages API tutorial"),"."),(0,r.kt)("h3",{id:"workflowctxtseteventkey-value"},"workflowCtxt.setEvent(key, value)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"setEvent<T extends NonNullable<any>>(key: string, value: T): Promise<void>\n")),(0,r.kt)("p",null,"Creates an immutable event named ",(0,r.kt)("inlineCode",{parentName:"p"},"key")," with value ",(0,r.kt)("inlineCode",{parentName:"p"},"value"),".\nHTTP handlers can read events by calling ",(0,r.kt)("a",{parentName:"p",href:"#handlerctxtgeteventworkflowuuid-key-timeoutseconds"},(0,r.kt)("inlineCode",{parentName:"a"},"getEvent"))," with the workflow's UUID.\nEvents are immutable and attempting to emit an event twice from a given workflow instance will result in an error.\nFor more information, see our ",(0,r.kt)("a",{parentName:"p",href:"../tutorials/workflow-communication-tutorial#events-api"},"events API tutorial"),"."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"transactioncontextt"},(0,r.kt)("inlineCode",{parentName:"h2"},"TransactionContext<T>")),(0,r.kt)("p",null,"Transactions use ",(0,r.kt)("inlineCode",{parentName:"p"},"TransactionContext")," to interact with the database."),(0,r.kt)("h3",{id:"generic-type-parameter"},"Generic Type Parameter"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"TransactionContext")," is typed generically based on the application database client in use.\nThe application database client is configurable in a project's ",(0,r.kt)("a",{parentName:"p",href:"./configuration"},"configuration file")," (",(0,r.kt)("inlineCode",{parentName:"p"},"user_dbclient"),").\nOperon currently supports the following clients:"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://knexjs.org/guide/#typescript"},"Knex"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'import { Knex } from "knex";\nstatic async exampleTransaction(ctxt: TransactionContext<Knex>, ...)\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://orkhan.gitbook.io/typeorm/docs/entity-manager-api"},"TypeORM"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'import { EntityManager } from "typeorm";\nstatic async exampleTransaction(ctxt: TransactionContext<EntityManager>, ...)\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://www.prisma.io/docs/concepts/components/prisma-client"},"Prisma"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'import { PrismaClient } from "@prisma/client";\nstatic async exampleTransaction(ctxt: TransactionContext<Prisma>, ...)\n')),(0,r.kt)("h3",{id:"properties-2"},"Properties"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#transactionctxtclient"},"client"))),(0,r.kt)("h3",{id:"transactionctxtclient"},"transactionCtxt.client"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"client: T; // One of [Knex, EntityManager, PrismaClient]\n")),(0,r.kt)("p",null,"Provides access to the chosen application database client.\nA transaction function should only interact with the application database using this client."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"communicatorcontext"},(0,r.kt)("inlineCode",{parentName:"h2"},"CommunicatorContext")),(0,r.kt)("p",null,"Communicators use ",(0,r.kt)("inlineCode",{parentName:"p"},"CommunicatorContext")," to retrieve information on communicator configuration."),(0,r.kt)("h4",{id:"properties-3"},"Properties"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#communicatorctxtretriesallowed"},"retriesAllowed")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#communicatorctxtmaxattempts"},"maxAttempts"))),(0,r.kt)("h3",{id:"communicatorctxtretriesallowed"},"communicatorCtxt.retriesAllowed"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"readonly retriesAllowed: boolean;\n")),(0,r.kt)("p",null,"Whether the communicator is automatically retried on failure.\nConfigurable through the ",(0,r.kt)("a",{parentName:"p",href:"./decorators#operoncommunicator"},(0,r.kt)("inlineCode",{parentName:"a"},"@OperonCommunicator"))," decorator."),(0,r.kt)("h3",{id:"communicatorctxtmaxattempts"},"communicatorCtxt.maxAttempts"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"readonly maxAttempts: number;\n")),(0,r.kt)("p",null,"Maximum number of retries for the communicator.\nConfigurable through the ",(0,r.kt)("a",{parentName:"p",href:"./decorators#operoncommunicator"},(0,r.kt)("inlineCode",{parentName:"a"},"@OperonCommunicator"))," decorator."))}d.isMDXComponent=!0}}]);