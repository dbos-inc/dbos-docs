"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[9025],{5156:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"production/hosting-conductor-with-kubernetes","title":"Self-Hosting Conductor With Kubernetes","description":"Self-hosted Conductor is released under a proprietary license.","source":"@site/docs/production/hosting-conductor-with-kubernetes.md","sourceDirName":"production","slug":"/production/hosting-conductor-with-kubernetes","permalink":"/production/hosting-conductor-with-kubernetes","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":70,"frontMatter":{"sidebar_position":70,"title":"Self-Hosting Conductor With Kubernetes"},"sidebar":"tutorialSidebar","previous":{"title":"DBOS MCP Server","permalink":"/production/mcp"},"next":{"title":"Deploying With Kubernetes","permalink":"/production/hosting-with-kubernetes"}}');var r=s(4848),o=s(8453);const c={sidebar_position:70,title:"Self-Hosting Conductor With Kubernetes"},i=void 0,d={},l=[{value:"Overview",id:"overview",level:2},{value:"Deployments",id:"deployments",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Ingress",id:"ingress",level:2},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"Walkthrough (AWS EKS)",id:"walkthrough-aws-eks",level:2},{value:"Infrastructure",id:"infrastructure",level:3},{value:"Secrets",id:"secrets",level:3},{value:"Ingress",id:"ingress-1",level:3},{value:"Deployments",id:"deployments-1",level:3},{value:"Cleanup",id:"cleanup",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components},{Details:s,TabItem:t,Tabs:c}=n;return s||u("Details",!0),t||u("TabItem",!0),c||u("Tabs",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Self-hosted Conductor is released under a ",(0,r.jsx)(n.a,{href:"https://www.dbos.dev/conductor-license",children:"proprietary license"}),".\nSelf-hosting Conductor for commercial or production use requires a ",(0,r.jsx)(n.a,{href:"/production/hosting-conductor#licensing",children:"license key"}),"."]})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"This guide covers deploying DBOS Conductor on Kubernetes so your applications get durable workflow execution, automatic workflow recovery, workflow management and observability \u2014 all running on infrastructure you control."}),"\n",(0,r.jsx)(n.p,{children:"The Kubernetes manifests are portable to any conformant cluster."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"deployments",children:"Deployments"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Database"})," \u2014 Conductor needs a PostgreSQL database, which we recommend configuring with a dedicated database role."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Conductor"})," \u2014 A stateless, single-container Deployment listening on port 8090.\nAll state lives in PostgreSQL: use a ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/",children:"Deployment"})," and not a ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/",children:"StatefulSet"}),".\nRequired environment variables:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DBOS__CONDUCTOR_DB_URL"})," (connection string to the ",(0,r.jsx)(n.code,{children:"dbos_conductor"})," database)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DBOS_CONDUCTOR_LICENSE_KEY"})," (",(0,r.jsx)(n.a,{href:"/production/hosting-conductor#licensing",children:"obtain a license key"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Conductor is out of the critical path and a single Conductor instance can serve tens of thousands of application servers."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Console"})," \u2014 A stateless, single-container Deployment listening on port 80.\nIt connects to Conductor using the environment variable ",(0,r.jsx)(n.code,{children:"DBOS_CONDUCTOR_URL"}),"."]}),"\n",(0,r.jsx)(n.admonition,{title:"Updating Conductor",type:"info",children:(0,r.jsxs)(n.p,{children:["Conductor is architecturally ",(0,r.jsx)(n.strong,{children:"out-of-band"})," \u2014 it is not on the critical path of your application.\nTo upgrade, update the container image tag in ",(0,r.jsx)(n.code,{children:"conductor.yaml"})," and ",(0,r.jsx)(n.code,{children:"console.yaml"}),", (",(0,r.jsx)(n.code,{children:"latest"})," by default) then ",(0,r.jsx)(n.code,{children:"kubectl rollout restart"}),". Prefer updating both Conductor and the console together.\nApplications seamlessly reconnect to the new Conductor version with no impact on their availability."]})}),"\n",(0,r.jsx)(n.admonition,{title:"Register applications",type:"info",children:(0,r.jsxs)(n.p,{children:["After deploying Conductor and Console, ",(0,r.jsx)(n.a,{href:"/production/conductor#connecting-to-conductor",children:"register your application, and generate an API key"}),".\nThe application connects to Conductor via WebSocket using this API key and the Conductor URL."]})}),"\n",(0,r.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,r.jsxs)(n.p,{children:["Conductor supports OAuth 2.0 with any OIDC-compliant provider. See the ",(0,r.jsx)(n.a,{href:"/production/hosting-conductor#security",children:"authentication setup guide"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"ingress",children:"Ingress"}),"\n",(0,r.jsxs)(n.p,{children:["We recommend setting up a reverse proxy (e.g., ",(0,r.jsx)(n.a,{href:"https://nginx.org/",children:"Nginx"}),") in front of all services. The reverse proxy should perform ",(0,r.jsx)(n.strong,{children:"TLS termination"})," and support ",(0,r.jsx)(n.strong,{children:"WebSockets"}),". You must configure your DBOS applications to point at your load balancer or reverse proxy URL, which should redirect to Conductor."]}),"\n",(0,r.jsx)(n.p,{children:"The DBOS SDK maintains a long-lived WebSocket connection to Conductor, so both the reverse proxy and any cloud load balancer in front of it (e.g., AWS ELB) should have idle timeouts high enough (e.g., 300s) to tolerate network hiccups. The DBOS SDK sends periodic pings to keep the connection alive, but a network hiccup that delays pings past the timeout will cause a disconnect. In case of disconnection, the DBOS SDK will reconnect automatically."}),"\n",(0,r.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Secret management"})," \u2014 Conductor deployments need credentials for PostgreSQL, a license key, and an API key.\nStore these as Kubernetes Secrets and inject them via ",(0,r.jsx)(n.code,{children:"secretKeyRef"}),".\nFor Git-safe storage, encrypt with ",(0,r.jsx)(n.a,{href:"https://github.com/bitnami-labs/sealed-secrets",children:"Sealed Secrets"}),", ",(0,r.jsx)(n.a,{href:"https://github.com/getsops/sops",children:"SOPS"}),", or a cloud-native secrets manager (AWS Secrets Manager, ",(0,r.jsx)(n.a,{href:"https://developer.hashicorp.com/vault/docs/platform/k8s/vso",children:"Vault"}),", etc.)."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Network policies"})," \u2014 Apply a default-deny ingress policy to the namespace, then add explicit allow rules for each pod. If Conductor and Console are co-located, allow HTTPS traffic from the Console to Conductor."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"RBAC"})," \u2014 Restrict which ServiceAccounts can read Secrets in the namespace. Conductor credentials (database URLs, license key, API key) should only be accessible to the pods that need them."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"walkthrough-aws-eks",children:"Walkthrough (AWS EKS)"}),"\n",(0,r.jsx)(c,{groupId:"cloud-provider",children:(0,r.jsxs)(t,{value:"eks",label:"EKS (AWS)",children:[(0,r.jsx)(n.p,{children:"In addition to DBOS Conductor and the DBOS Console, the infrastructure includes the following components:"}),(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Component"}),(0,r.jsx)(n.th,{children:"Role"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"RDS"})}),(0,r.jsx)(n.td,{children:"Database for Conductor operating state"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Reverse Proxy (Nginx Ingress)"})}),(0,r.jsx)(n.td,{children:"TLS termination, path-based routing, WebSocket support"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Sealed Secrets"})}),(0,r.jsx)(n.td,{children:"Encrypts secrets at rest; decrypts them in-cluster"})]})]})]}),(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)("strong",{children:"Set environment variables"})}),(0,r.jsx)(n.p,{children:"Set these variables before proceeding \u2014 replace the placeholder values with your own:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Your AWS account ID (12-digit number)\nAWS_ACCOUNT_ID=123456789012\n\n# AWS region for all resources\nAWS_REGION=us-west-2\n\n# PostgreSQL admin password (used for the RDS master user)\nPOSTGRES_PASSWORD='choose-a-secure-password'\n\n# Password for the Conductor database role\nCONDUCTOR_ROLE_PASSWORD='choose-another-secure-password'\n\n# Conductor license key (from DBOS Console or sales)\nCONDUCTOR_LICENSE_KEY='your-license-key'\n"})})]}),(0,r.jsx)(n.h3,{id:"infrastructure",children:"Infrastructure"}),(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)("strong",{children:"CLI tools required on your workstation"})}),(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Tool"}),(0,r.jsx)(n.th,{children:"Purpose"}),(0,r.jsx)(n.th,{children:"Install"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"AWS CLI"})}),(0,r.jsx)(n.td,{children:"AWS account access"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html",children:"Install guide"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"eksctl"})}),(0,r.jsx)(n.td,{children:"Create and manage EKS clusters"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://eksctl.io/installation/",children:"Install guide"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"kubectl"})}),(0,r.jsx)(n.td,{children:"Interact with Kubernetes"}),(0,r.jsxs)(n.td,{children:["Included with eksctl, or ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tools/",children:"install separately"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Helm"})}),(0,r.jsx)(n.td,{children:"Install cluster add-ons (Ingress, Sealed Secrets)"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"brew install helm"})," or ",(0,r.jsx)(n.a,{href:"https://helm.sh/docs/intro/install/",children:"Install guide"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"kubeseal"})}),(0,r.jsx)(n.td,{children:"Encrypt Kubernetes secrets"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"brew install kubeseal"})," or ",(0,r.jsx)(n.a,{href:"https://github.com/bitnami-labs/sealed-secrets#kubeseal",children:"Install guide"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"openssl"})}),(0,r.jsx)(n.td,{children:"Generate self-signed TLS certificate"}),(0,r.jsx)(n.td,{children:"Pre-installed on macOS/Linux"})]})]})]}),(0,r.jsx)(n.p,{children:"Verify your AWS credentials are configured:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"aws sts get-caller-identity\n"})})]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"DBOS Conductor License Key"})}),(0,r.jsxs)(n.p,{children:["Obtain a development license key from the ",(0,r.jsx)(n.a,{href:"https://console.dbos.dev/settings/license-key",children:"DBOS Console"})," or ",(0,r.jsx)(n.a,{href:"https://www.dbos.dev/contact",children:"contact DBOS sales"})," for a pro license key.\nYou can follow this guide with a development license key for evaluation, but you will be limited to one executor per application."]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create an EKS Cluster"})}),(0,r.jsx)(n.p,{children:"Create a managed EKS cluster with two nodes. This takes approximately 15 minutes."}),(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)("strong",{children:"Create EKS cluster"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"eksctl create cluster \\\n  --name dbos-conductor \\\n  --region $AWS_REGION \\\n  --version 1.31 \\\n  --nodegroup-name default \\\n  --node-type t3.medium \\\n  --nodes 2 \\\n  --managed\n"})}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"eksctl"})," automatically:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Creates a VPC with public and private subnets"}),"\n",(0,r.jsxs)(n.li,{children:["Configures the ",(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/managing-vpc-cni.html",children:"Amazon VPC CNI"}),", which supports NetworkPolicy enforcement"]}),"\n",(0,r.jsxs)(n.li,{children:["Sets up your ",(0,r.jsx)(n.code,{children:"~/.kube/config"})," to point at the new cluster"]}),"\n"]}),(0,r.jsx)(n.p,{children:"Once complete, verify the cluster is ready:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get nodes\n"})}),(0,r.jsxs)(n.p,{children:["You should see two nodes in ",(0,r.jsx)(n.code,{children:"Ready"})," status:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"NAME                                           STATUS   ROLES    AGE   VERSION\nip-192-168-xx-xx.us-west-2.compute.internal    Ready    <none>   2m    v1.31.x\nip-192-168-xx-xx.us-west-2.compute.internal    Ready    <none>   2m    v1.31.x\n"})})]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create a Namespace"})}),(0,r.jsxs)(n.p,{children:["All resources in this guide are deployed to a dedicated ",(0,r.jsx)(n.code,{children:"dbos"})," namespace:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl create namespace dbos\n"})}),(0,r.jsx)("a",{id:"provision-an-rds-postgresql-instance"}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Provision an RDS PostgreSQL Instance"})}),(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)("strong",{children:"RDS provisioning commands"})}),(0,r.jsxs)(n.p,{children:["Find the VPC and private subnets that ",(0,r.jsx)(n.code,{children:"eksctl"})," created:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Get the VPC ID\nVPC_ID=$(aws ec2 describe-vpcs \\\n  --filters "Name=tag:alpha.eksctl.io/cluster-name,Values=dbos-conductor" \\\n  --query "Vpcs[0].VpcId" --output text --region $AWS_REGION)\necho "VPC: $VPC_ID"\n\n# Get the private subnets\nPRIVATE_SUBNETS=($(aws ec2 describe-subnets \\\n  --filters "Name=vpc-id,Values=$VPC_ID" \\\n             "Name=tag:aws:cloudformation:logical-id,Values=SubnetPrivate*" \\\n  --query "Subnets[*].SubnetId" --output text --region $AWS_REGION))\necho "Private subnets: ${PRIVATE_SUBNETS[@]}"\n'})}),(0,r.jsx)(n.p,{children:"Create a DB subnet group from the private subnets:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'aws rds create-db-subnet-group \\\n  --db-subnet-group-name dbos-conductor-db \\\n  --db-subnet-group-description "DBOS Conductor RDS subnets" \\\n  --subnet-ids "${PRIVATE_SUBNETS[@]}" \\\n  --region $AWS_REGION\n'})}),(0,r.jsx)(n.p,{children:"Create a security group that allows PostgreSQL access from the EKS nodes:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Get the EKS cluster security group\nEKS_SG=$(aws ec2 describe-security-groups \\\n  --filters "Name=vpc-id,Values=$VPC_ID" \\\n            "Name=tag:aws:eks:cluster-name,Values=dbos-conductor" \\\n  --query "SecurityGroups[0].GroupId" \\\n  --output text --region $AWS_REGION)\necho "EKS SG: $EKS_SG"\n\n# Create a security group for RDS\nRDS_SG=$(aws ec2 create-security-group \\\n  --group-name dbos-conductor-rds \\\n  --description "Allow PostgreSQL from EKS nodes" \\\n  --vpc-id $VPC_ID \\\n  --query "GroupId" --output text --region $AWS_REGION)\necho "RDS SG: $RDS_SG"\n\n# Allow inbound PostgreSQL from EKS nodes\naws ec2 authorize-security-group-ingress \\\n  --group-id $RDS_SG \\\n  --protocol tcp --port 5432 \\\n  --source-group $EKS_SG \\\n  --region $AWS_REGION\n'})}),(0,r.jsx)(n.p,{children:"Create the RDS instance:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'aws rds create-db-instance \\\n  --db-instance-identifier dbos-conductor-pg \\\n  --db-instance-class db.t4g.micro \\\n  --engine postgres \\\n  --engine-version 16 \\\n  --master-username postgres \\\n  --master-user-password "$POSTGRES_PASSWORD" \\\n  --allocated-storage 20 \\\n  --db-subnet-group-name dbos-conductor-db \\\n  --vpc-security-group-ids $RDS_SG \\\n  --no-publicly-accessible \\\n  --region $AWS_REGION\n'})}),(0,r.jsx)(n.p,{children:"Wait for the instance to become available (this takes a few minutes):"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"aws rds wait db-instance-available \\\n  --db-instance-identifier dbos-conductor-pg \\\n  --region $AWS_REGION\n"})}),(0,r.jsx)(n.p,{children:"Get the RDS endpoint:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'RDS_ENDPOINT=$(aws rds describe-db-instances \\\n  --db-instance-identifier dbos-conductor-pg \\\n  --query "DBInstances[0].Endpoint.Address" \\\n  --output text --region $AWS_REGION)\necho "RDS endpoint: $RDS_ENDPOINT"\n'})})]}),(0,r.jsx)(n.p,{children:"Create the databases and roles from a pod inside the cluster (since the RDS instance is not publicly accessible):"}),(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)("strong",{children:"Create databases and roles"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl run pg-setup --restart=Never \\\n  --namespace dbos \\\n  --image=postgres:16 \\\n  --env=\"PGPASSWORD=$POSTGRES_PASSWORD\" \\\n  --command -- bash -c \"\n    psql -h $RDS_ENDPOINT -U postgres -c 'CREATE DATABASE dbos_conductor;'\n    psql -h $RDS_ENDPOINT -U postgres -c \\\"CREATE ROLE dbos_conductor_role WITH LOGIN PASSWORD '$CONDUCTOR_ROLE_PASSWORD';\\\"\n    psql -h $RDS_ENDPOINT -U postgres -c 'GRANT ALL PRIVILEGES ON DATABASE dbos_conductor TO dbos_conductor_role;'\n    psql -h $RDS_ENDPOINT -U postgres -d dbos_conductor -c 'GRANT ALL ON SCHEMA public TO dbos_conductor_role;'\n  \"\n# Wait for the pod to finish, then clean up\nsleep 15 && kubectl logs pg-setup -n dbos && kubectl delete pod pg-setup -n dbos\n"})}),(0,r.jsx)(n.p,{children:"This creates:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dbos_conductor"})," \u2014 Conductor's internal database (application registry, metadata)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"dbos_conductor_role"})," \u2014 a dedicated role for Conductor's database access"]}),"\n"]})]}),(0,r.jsx)("a",{id:"install-cluster-add-ons"}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Install Cluster Add-ons"})}),(0,r.jsx)(n.p,{children:"We install two Helm charts that the later sections depend on."}),(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)("strong",{children:"Helm installs (Nginx Ingress, Sealed Secrets)"})}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Nginx Ingress Controller"})," \u2014 reverse proxy and TLS termination:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\nhelm repo update\nhelm install ingress-nginx ingress-nginx/ingress-nginx \\\n  --namespace ingress-nginx --create-namespace \\\n  --set controller.service.type=LoadBalancer\n"})}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Sealed Secrets"})," \u2014 encrypt secrets for safe Git storage:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"helm repo add sealed-secrets https://bitnami-labs.github.io/sealed-secrets\nhelm install sealed-secrets sealed-secrets/sealed-secrets \\\n  --namespace kube-system\n"})}),(0,r.jsx)(n.p,{children:"Verify all add-ons are running:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Ingress controller\nkubectl get pods -n ingress-nginx\n\n# Sealed Secrets controller\nkubectl get pods -n kube-system -l app.kubernetes.io/name=sealed-secrets\n"})})]}),(0,r.jsx)("a",{id:"secrets"}),(0,r.jsx)(n.h3,{id:"secrets",children:"Secrets"}),(0,r.jsxs)(n.p,{children:["Several components need sensitive credentials.\nWe use ",(0,r.jsx)(n.a,{href:"https://github.com/bitnami-labs/sealed-secrets",children:"Bitnami Sealed Secrets"}),": create a regular Secret, encrypt it with ",(0,r.jsx)(n.code,{children:"kubeseal"}),", and apply the encrypted ",(0,r.jsx)(n.code,{children:"SealedSecret"})," to the cluster.\nThe controller decrypts it in-cluster into a standard Kubernetes Secret that pods can reference.\nThe encrypted form is safe to commit to Git."]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Secrets Inventory"})}),(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Secret"}),(0,r.jsx)(n.th,{children:"Keys"}),(0,r.jsx)(n.th,{children:"Used by"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"conductor-db"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"database-url"})}),(0,r.jsxs)(n.td,{children:["Conductor \u2014 connection to ",(0,r.jsx)(n.code,{children:"dbos_conductor"})," database"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"conductor-license"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"license-key"})}),(0,r.jsx)(n.td,{children:"Conductor \u2014 production license"})]})]})]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create and Seal Secrets"})}),(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)("strong",{children:"kubeseal commands"})}),(0,r.jsxs)(n.p,{children:["Create each secret, pipe it through ",(0,r.jsx)(n.code,{children:"kubeseal"}),", and save the encrypted form:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# 1. Conductor database credentials (dedicated role)\nkubectl create secret generic conductor-db \\\n  --namespace dbos \\\n  --from-literal=database-url="postgresql://dbos_conductor_role:${CONDUCTOR_ROLE_PASSWORD}@${RDS_ENDPOINT}:5432/dbos_conductor?sslmode=require" \\\n  --dry-run=client -o yaml | \\\n  kubeseal --controller-name=sealed-secrets --controller-namespace=kube-system --format yaml \\\n  > sealed-conductor-db.yaml\n\n# 2. Conductor license key\nkubectl create secret generic conductor-license \\\n  --namespace dbos \\\n  --from-literal=license-key="$CONDUCTOR_LICENSE_KEY" \\\n  --dry-run=client -o yaml | \\\n  kubeseal --controller-name=sealed-secrets --controller-namespace=kube-system --format yaml \\\n  > sealed-conductor-license.yaml\n'})})]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Apply and Verify"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f sealed-conductor-db.yaml\nkubectl apply -f sealed-conductor-license.yaml\n"})}),(0,r.jsx)(n.p,{children:"Verify the controller has decrypted them into regular Kubernetes Secrets:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get secrets -n dbos\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"NAME                TYPE     DATA   AGE\nconductor-db        Opaque   1      10s\nconductor-license   Opaque   1      10s\n"})}),(0,r.jsx)(n.h3,{id:"ingress-1",children:"Ingress"}),(0,r.jsx)(n.p,{children:"With the Nginx Ingress Controller installed, you have a load balancer in front of the cluster.\nThis section creates a TLS certificate and an Ingress resource so that all services are reachable over HTTPS."}),(0,r.jsxs)(n.p,{children:["This walkthrough uses a self-signed certificate on the load balancer's hostname.\nFor production, use ",(0,r.jsx)(n.a,{href:"https://cert-manager.io/",children:"cert-manager"})," with a real domain."]}),(0,r.jsx)(n.p,{children:"Get the load balancer hostname:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ELB_HOSTNAME=$(kubectl get svc -n ingress-nginx ingress-nginx-controller \\\n  -o jsonpath='{.status.loadBalancer.ingress[0].hostname}')\necho $ELB_HOSTNAME\n"})}),(0,r.jsxs)(n.p,{children:["Save this value \u2014 you'll need it throughout the rest of the guide. It looks like ",(0,r.jsx)(n.code,{children:"xxxxxxxx.us-west-2.elb.amazonaws.com"}),"."]}),(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)("strong",{children:"Create a self-signed TLS certificate"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'openssl req -x509 -nodes -days 365 -newkey rsa:2048 \\\n  -keyout tls.key -out tls.crt \\\n  -subj "/CN=dbos-conductor" \\\n  -addext "subjectAltName=DNS:${ELB_HOSTNAME}"\n\nkubectl create secret tls dbos-tls \\\n  --cert=tls.crt --key=tls.key \\\n  --namespace dbos\n'})}),(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["The CN is kept short because OpenSSL's CN field has a 64-character limit \u2014 the actual hostname is covered by the SAN extension.\nYour browser will show a certificate warning for the self-signed cert \u2014 accept it to proceed.\nFor production, use ",(0,r.jsx)(n.a,{href:"https://cert-manager.io/",children:"cert-manager"})," with a real domain."]})})]}),(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)("strong",{children:"ingress.yaml"})}),(0,r.jsxs)(n.p,{children:["The Ingress routes ",(0,r.jsx)(n.code,{children:"/conductor/..."})," to the Conductor service and everything else to the Console.\nA regex rewrite strips the ",(0,r.jsx)(n.code,{children:"/conductor"})," prefix so Conductor sees requests at ",(0,r.jsx)(n.code,{children:"/"}),".\nReplace ",(0,r.jsx)(n.code,{children:"<your-elb-hostname>"})," with the ",(0,r.jsx)(n.code,{children:"$ELB_HOSTNAME"})," value you retrieved above."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: dbos-ingress\n  namespace: dbos\n  annotations:\n    nginx.ingress.kubernetes.io/use-regex: "true"\n    nginx.ingress.kubernetes.io/rewrite-target: /$2\n    nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"\n    nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"\nspec:\n  ingressClassName: nginx\n  tls:\n    - hosts:\n        - <your-elb-hostname>\n      secretName: dbos-tls\n  rules:\n    - host: <your-elb-hostname>\n      http:\n        paths:\n          - path: /conductor(/|$)(.*)\n            pathType: ImplementationSpecific\n            backend:\n              service:\n                name: conductor\n                port:\n                  number: 8090\n          - path: /()(.*)\n            pathType: ImplementationSpecific\n            backend:\n              service:\n                name: console\n                port:\n                  number: 80\n'})}),(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"host"})," in both ",(0,r.jsx)(n.code,{children:"tls"})," and ",(0,r.jsx)(n.code,{children:"rules"})," must match \u2014 without it, Nginx serves its default fake certificate instead of ",(0,r.jsx)(n.code,{children:"dbos-tls"}),"."]}),(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Request path"}),(0,r.jsx)(n.th,{children:"Backend"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/conductor/"})}),(0,r.jsxs)(n.td,{children:["conductor:8090 \u2192 ",(0,r.jsx)(n.code,{children:"/"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/conductor/v1/workflows"})}),(0,r.jsxs)(n.td,{children:["conductor:8090 \u2192 ",(0,r.jsx)(n.code,{children:"/v1/workflows"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/"})}),(0,r.jsx)(n.td,{children:"console:80"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/health"})}),(0,r.jsx)(n.td,{children:"console:80"})]})]})]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"rewrite-target: /$2"})})," \u2014 strips the ",(0,r.jsx)(n.code,{children:"/conductor"})," prefix using the second capture group. The Console catch-all uses ",(0,r.jsx)(n.code,{children:"/()(.*)"}),"  so ",(0,r.jsx)(n.code,{children:"$2"})," passes the full path through unchanged."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:[(0,r.jsx)(n.code,{children:"proxy-read-timeout"})," / ",(0,r.jsx)(n.code,{children:"proxy-send-timeout"})]})," \u2014 set to 3600s to keep Conductor's long-lived WebSocket connections alive."]}),"\n"]})]}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Apply the Ingress"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f ingress.yaml\n"})}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"WebSocket Configuration"})}),(0,r.jsx)(n.p,{children:"The application connects to Conductor via a long-lived WebSocket.\nThree layers must be configured to prevent idle connections from being dropped:"}),(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Layer"}),(0,r.jsx)(n.th,{children:"Setting"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Suggested"}),(0,r.jsx)(n.th,{children:"Why"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Nginx Ingress"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"proxy-read-timeout"})}),(0,r.jsx)(n.td,{children:"60s"}),(0,r.jsx)(n.td,{children:"3600s"}),(0,r.jsx)(n.td,{children:"Prevents Nginx from closing an idle WebSocket"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Nginx Ingress"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"proxy-send-timeout"})}),(0,r.jsx)(n.td,{children:"60s"}),(0,r.jsx)(n.td,{children:"3600s"}),(0,r.jsx)(n.td,{children:"Same, for the send direction"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"AWS ELB"})}),(0,r.jsx)(n.td,{children:"idle timeout"}),(0,r.jsx)(n.td,{children:"60s"}),(0,r.jsx)(n.td,{children:"3600s"}),(0,r.jsx)(n.td,{children:"Prevents the load balancer from closing an idle TCP connection"})]})]})]}),(0,r.jsxs)(n.p,{children:["The Nginx timeouts are already set via the Ingress annotations.\nNginx handles the ",(0,r.jsx)(n.code,{children:"Connection: Upgrade"})," and ",(0,r.jsx)(n.code,{children:"Upgrade: websocket"})," headers automatically \u2014 no additional annotation is needed for the protocol upgrade itself."]}),(0,r.jsxs)(n.p,{children:["The AWS load balancer idle timeout is configured separately on the ",(0,r.jsx)(n.code,{children:"ingress-nginx-controller"})," Service:"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'kubectl patch svc ingress-nginx-controller -n ingress-nginx -p \\\n  \'{"metadata":{"annotations":{"service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout":"3600"}}}\'\n'})}),(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"The DBOS SDK sends periodic ping frames that keep the connection active under normal conditions.\nAlbeit the SDK will reconnect automatically, increasing the ELB idle timeout will prevent network hiccups to drop the connection."})}),(0,r.jsx)(n.h3,{id:"deployments-1",children:"Deployments"}),(0,r.jsx)("a",{id:"conductor-and-console"}),(0,r.jsxs)(n.p,{children:["Conductor is the core service that manages workflow recovery and the application registry.\nIt connects to the ",(0,r.jsx)(n.code,{children:"dbos_conductor"})," database using the ",(0,r.jsx)(n.code,{children:"dbos_conductor_role"})," credentials."]}),(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)("strong",{children:"conductor.yaml"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: conductor\n  namespace: dbos\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: conductor\n  template:\n    metadata:\n      labels:\n        app: conductor\n    spec:\n      containers:\n        - name: conductor\n          image: dbosdev/conductor\n          env:\n            - name: DBOS__CONDUCTOR_DB_URL\n              valueFrom:\n                secretKeyRef:\n                  name: conductor-db\n                  key: database-url\n            - name: DBOS_CONDUCTOR_LICENSE_KEY\n              valueFrom:\n                secretKeyRef:\n                  name: conductor-license\n                  key: license-key\n          ports:\n            - containerPort: 8090\n          readinessProbe:\n            httpGet:\n              path: /healthz\n              port: 8090\n            initialDelaySeconds: 5\n            periodSeconds: 10\n          livenessProbe:\n            httpGet:\n              path: /healthz\n              port: 8090\n            initialDelaySeconds: 15\n            periodSeconds: 30\n          resources:\n            requests:\n              cpu: 250m\n              memory: 256Mi\n            limits:\n              cpu: "1"\n              memory: 512Mi\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: conductor\n  namespace: dbos\nspec:\n  selector:\n    app: conductor\n  ports:\n    - port: 8090\n      targetPort: 8090\n'})}),(0,r.jsxs)(n.p,{children:["Both sensitive values (",(0,r.jsx)(n.code,{children:"DBOS__CONDUCTOR_DB_URL"})," and ",(0,r.jsx)(n.code,{children:"DBOS_CONDUCTOR_LICENSE_KEY"}),") are pulled from the Sealed Secrets created in the ",(0,r.jsx)(n.a,{href:"#secrets",children:"Secrets"})," section."]})]}),(0,r.jsx)(n.p,{children:"The Console is the web UI for managing applications, monitoring workflows, and generating API keys.\nIn this example, it connects to Conductor via internal cluster DNS."}),(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)("strong",{children:"console.yaml"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: console\n  namespace: dbos\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: console\n  template:\n    metadata:\n      labels:\n        app: console\n    spec:\n      containers:\n        - name: console\n          image: dbosdev/console\n          env:\n            - name: DBOS_CONDUCTOR_URL\n              value: "conductor.dbos.svc.cluster.local:8090"\n          ports:\n            - containerPort: 80\n          readinessProbe:\n            httpGet:\n              path: /health\n              port: 80\n            initialDelaySeconds: 5\n            periodSeconds: 10\n          livenessProbe:\n            httpGet:\n              path: /health\n              port: 80\n            initialDelaySeconds: 10\n            periodSeconds: 30\n          resources:\n            requests:\n              cpu: 100m\n              memory: 128Mi\n            limits:\n              cpu: 500m\n              memory: 256Mi\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: console\n  namespace: dbos\nspec:\n  selector:\n    app: console\n  ports:\n    - port: 80\n      targetPort: 80\n'})})]}),(0,r.jsx)(n.p,{children:"Deploy both with:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f conductor.yaml\nkubectl apply -f console.yaml\n"})}),(0,r.jsx)(n.p,{children:"Verify both pods are running:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n dbos\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"NAME                         READY   STATUS    RESTARTS   AGE\nconductor-xxxxxxxxx-xxxxx    1/1     Running   0          2m\nconsole-xxxxxxxxx-xxxxx      1/1     Running   0          30s\n"})}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Access the Console and Generate an API Key"})}),(0,r.jsxs)(n.p,{children:["At this point, your self-hosted Conductor deployment is fully operational! Open ",(0,r.jsx)(n.code,{children:"https://<your-elb-hostname>/"})," in your browser (accept the self-signed cert warning), then follow the ",(0,r.jsx)(n.a,{href:"/production/conductor#connecting-to-conductor",children:"Conductor setup instructions"})," to:"]}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Register your application"}),"\n",(0,r.jsx)(n.li,{children:"Generate an API key"}),"\n"]}),(0,r.jsx)(n.h3,{id:"cleanup",children:"Cleanup"}),(0,r.jsx)(n.p,{children:"To tear down all AWS resources when done:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Delete the EKS cluster (includes VPC, security groups, and node group)\neksctl delete cluster --name dbos-conductor --region $AWS_REGION\n\n# Delete the RDS instance\naws rds delete-db-instance --db-instance-identifier dbos-conductor-pg \\\n  --skip-final-snapshot --region $AWS_REGION\n\n# Delete the RDS security group\nRDS_SG=$(aws ec2 describe-security-groups \\\n  --filters "Name=group-name,Values=dbos-conductor-rds" \\\n  --query "SecurityGroups[0].GroupId" --output text --region $AWS_REGION)\naws ec2 delete-security-group --group-id $RDS_SG --region $AWS_REGION\n\n# Delete the DB subnet group\naws rds delete-db-subnet-group --db-subnet-group-name dbos-conductor-db --region $AWS_REGION\n'})})]})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var t=s(6540);const r={},o=t.createContext(r);function c(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);