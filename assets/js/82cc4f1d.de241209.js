"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[3294],{8599:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"golang/integrating-dbos","title":"Add DBOS To Your App","description":"This guide shows you how to add the open-source DBOS Transact library to your existing application to durably execute it and make it resilient to any failure.","source":"@site/docs/golang/integrating-dbos.md","sourceDirName":"golang","slug":"/golang/integrating-dbos","permalink":"/golang/integrating-dbos","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20,"title":"Add DBOS To Your App"},"sidebar":"tutorialSidebar","previous":{"title":"Learn DBOS Go","permalink":"/golang/programming-guide"},"next":{"title":"Workflows","permalink":"/golang/tutorials/workflow-tutorial"}}');var r=t(4848),s=t(8453);const i={sidebar_position:20,title:"Add DBOS To Your App"},a=void 0,l={},d=[{value:"1. Install DBOS",id:"1-install-dbos",level:3},{value:"2. Add the DBOS Initializer",id:"2-add-the-dbos-initializer",level:3},{value:"3. Start Your Application",id:"3-start-your-application",level:3},{value:"4. Start Building With DBOS",id:"4-start-building-with-dbos",level:3}];function c(e){const n={a:"a",code:"code",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["This guide shows you how to add the open-source ",(0,r.jsx)(n.a,{href:"https://github.com/dbos-inc/dbos-transact-golang",children:"DBOS Transact"})," library to your existing application to ",(0,r.jsx)(n.strong,{children:"durably execute"})," it and make it resilient to any failure."]}),"\n",(0,r.jsx)(n.h3,{id:"1-install-dbos",children:"1. Install DBOS"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"go get"})," DBOS into your application."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"go get github.com/dbos-inc/dbos-transact-golang\n"})}),"\n",(0,r.jsxs)(n.p,{children:["DBOS requires a Postgres database.\nIf you don't already have Postgres, you can install the DBOS Go CLI with ",(0,r.jsx)(n.a,{href:"https://pkg.go.dev/cmd/go#hdr-Compile_and_install_packages_and_dependencies",children:"go install"})," and start Postgres in a Docker container with these commands:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"go install github.com/dbos-inc/dbos-transact-golang/cmd/dbos@latest\ndbos postgres start\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then set the ",(0,r.jsx)(n.code,{children:"DBOS_SYSTEM_DATABASE_URL"})," environment variable to your connection string (later we'll pass that value into DBOS).\nFor example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"export DBOS_SYSTEM_DATABASE_URL=postgres://postgres:dbos@localhost:5432/dbos_starter_go\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-add-the-dbos-initializer",children:"2. Add the DBOS Initializer"}),"\n",(0,r.jsx)(n.p,{children:"Add these lines of code to your program's main function.\nThey initialize a DBOS context when your program starts."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'func main() {\n    dbosContext, err := dbos.NewDBOSContext(context.Background(), dbos.Config{\n        AppName:     "dbos-starter",\n        DatabaseURL: os.Getenv("DBOS_SYSTEM_DATABASE_URL"),\n    })\n    if err != nil {\n        panic(fmt.Sprintf("Initializing DBOS failed: %v", err))\n    }\n\n    err = dbosContext.Launch()\n    if err != nil {\n        panic(fmt.Sprintf("Launching DBOS failed: %v", err))\n    }\n    defer dbosContext.Shutdown(5 * time.Second)\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-start-your-application",children:"3. Start Your Application"}),"\n",(0,r.jsxs)(n.p,{children:["Try starting your application.\nIf everything is set up correctly, your app should run normally and log ",(0,r.jsx)(n.code,{children:"DBOS initialized"})," on startup.\nCongratulations! You've integrated DBOS into your application."]}),"\n",(0,r.jsx)(n.h3,{id:"4-start-building-with-dbos",children:"4. Start Building With DBOS"}),"\n",(0,r.jsxs)(n.p,{children:["DBOS let's you execute your functions as ",(0,r.jsx)(n.a,{href:"/golang/tutorials/workflow-tutorial",children:"workflows"})," of ",(0,r.jsx)(n.a,{href:"/golang/tutorials/step-tutorial",children:"steps"}),". Workflows must be registered with the DBOS context before it is launched, for example:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"dbos.RegisterWorkflow(dbosContext, workflow)\n"})}),"\n",(0,r.jsx)(n.p,{children:"A workflow function must have the following signature:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"type Workflow[P any, R any] func(ctx DBOSContext, input P) (R, error)\n"})}),"\n",(0,r.jsx)(n.p,{children:"And a step this signature:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"type Step[R any] func(ctx context.Context) (R, error)\n"})}),"\n",(0,r.jsx)(n.p,{children:"DBOS durably executes workflows so if they are ever interrupted, upon restart they automatically resume from the last completed step."}),"\n",(0,r.jsx)(n.p,{children:"You can add DBOS to your application incrementally\u2014it won't interfere with code that's already there.\nIt's totally okay for your application to have one DBOS workflow alongside thousands of lines of non-DBOS code."}),"\n",(0,r.jsxs)(n.p,{children:["To learn more about programming with DBOS, check out ",(0,r.jsx)(n.a,{href:"/golang/programming-guide",children:"the guide"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'func workflow(ctx dbos.DBOSContext, _ string) (string, error) {\n    _, err := dbos.RunAsStep(ctx, stepOne)\n    if err != nil {\n        return "failure", err\n    }\n    _, err = dbos.RunAsStep(ctx, stepTwo)\n    if err != nil {\n        return "failure", err\n    }\n    return "success", err\n}\n\nfunc stepOne(ctx context.Context) (string, error) {\n    fmt.Println("Step one completed")\n    return "success", nil\n}\n\nfunc stepTwo(ctx context.Context) (string, error) {\n    fmt.Println("Step two completed")\n    return "success", nil\n}\n'})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var o=t(6540);const r={},s=o.createContext(r);function i(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);