"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[3887],{1955:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"python/tutorials/scheduled-workflows","title":"Scheduling Workflows","description":"You can schedule DBOS workflows to run on a cron schedule.","source":"@site/docs/python/tutorials/scheduled-workflows.md","sourceDirName":"python/tutorials","slug":"/python/tutorials/scheduled-workflows","permalink":"/python/tutorials/scheduled-workflows","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":70,"frontMatter":{"sidebar_position":70,"title":"Scheduling Workflows"},"sidebar":"tutorialSidebar","previous":{"title":"Upgrading Workflow Code","permalink":"/python/tutorials/upgrading-workflows"},"next":{"title":"Logging & Tracing","permalink":"/python/tutorials/logging-and-tracing"}}');var o=s(4848),c=s(8453);const r={sidebar_position:70,title:"Scheduling Workflows"},i=void 0,a={},l=[{value:"Atomically Updating Schedules",id:"atomically-updating-schedules",level:3},{value:"Managing Schedules",id:"managing-schedules",level:3},{value:"Backfilling and Triggering",id:"backfilling-and-triggering",level:3},{value:"Managing Schedules from Another Application",id:"managing-schedules-from-another-application",level:3},{value:"How Scheduling Works",id:"how-scheduling-works",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["You can schedule DBOS ",(0,o.jsx)(n.a,{href:"/python/tutorials/workflow-tutorial",children:"workflows"})," to run on a cron schedule.\nSchedules are stored in the database and can be created, paused, resumed, and deleted at runtime."]}),"\n",(0,o.jsxs)(n.p,{children:["To schedule a workflow, first define a workflow that takes two arguments: a ",(0,o.jsx)(n.code,{children:"datetime"})," (the scheduled execution time) and a context object:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from datetime import datetime\nfrom typing import Any\nfrom dbos import DBOS\n\n@DBOS.workflow()\ndef my_periodic_task(scheduled_time: datetime, context: Any):\n    DBOS.logger.info(f"Running task scheduled for {scheduled_time} with context {context}")\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Then, create a schedule for it using ",(0,o.jsx)(n.a,{href:"/python/reference/contexts#create_schedule",children:(0,o.jsx)(n.code,{children:"DBOS.create_schedule"})})," with a ",(0,o.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Cron",children:"crontab"})," expression:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'DBOS.create_schedule(\n    schedule_name="my-task-schedule", # The schedule name is a unique identifier of the schedule\n    workflow_fn=my_periodic_task,\n    schedule="*/5 * * * *",  # Every 5 minutes\n    context="my context", # The context is passed into every iteration of the workflow\n)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["To learn more about crontab syntax, see ",(0,o.jsx)(n.a,{href:"https://docs.gitlab.com/ee/topics/cron/",children:"this guide"})," or ",(0,o.jsx)(n.a,{href:"https://crontab.guru/",children:"this crontab editor"}),".\nDBOS uses ",(0,o.jsx)(n.a,{href:"https://pypi.org/project/croniter/",children:"croniter"})," to parse cron schedules, using seconds as an optional first field (",(0,o.jsx)(n.a,{href:"https://pypi.org/project/croniter/#about-second-repeats",children:(0,o.jsx)(n.code,{children:"second_at_beginning=True"})}),").\nValid cron schedules contain 5 or 6 items, separated by spaces:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:" \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 second (optional)\n \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute\n \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour\n \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of month\n \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500 month\n \u2502 \u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500 day of week\n \u2502 \u2502 \u2502 \u2502 \u2502 \u2502\n \u2502 \u2502 \u2502 \u2502 \u2502 \u2502\n * * * * * *\n"})}),"\n",(0,o.jsx)(n.p,{children:"You can dynamically create many schedules for the same workflow.\nFor example, if you want to perform certain actions periodically for each of your customers, you can create one schedule per customer, using customer ID as context so each workflow knows which customer to act on:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from datetime import datetime\nfrom dbos import DBOS\n\n@DBOS.workflow()\ndef customer_workflow(scheduled_time: datetime, customer_id: str):\n    # ...\n\ndef on_customer_registration(customer_id: str):\n    DBOS.create_schedule(\n        schedule_name=f"customer-{customer_id}-sync",\n        workflow_fn=customer_workflow,\n        schedule="0 * * * *",  # Every hour\n        context=customer_id,\n    )\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Note that scheduling is not supported for workflows that are methods on ",(0,o.jsx)(n.a,{href:"/python/tutorials/classes",children:"configured instances"}),". Scheduled workflows should be plain functions or ",(0,o.jsx)(n.code,{children:"@staticmethod"})," class members."]}),"\n",(0,o.jsx)(n.h3,{id:"atomically-updating-schedules",children:"Atomically Updating Schedules"}),"\n",(0,o.jsxs)(n.p,{children:["If you need to create or update multiple schedules at once, use ",(0,o.jsx)(n.a,{href:"/python/reference/contexts#apply_schedules",children:(0,o.jsx)(n.code,{children:"DBOS.apply_schedules"})}),".\nThis is useful for declaratively defining all your static schedules in one place:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'DBOS.apply_schedules([\n    {"schedule_name": "schedule-a", "workflow_fn": workflow_a, "schedule": "*/10 * * * *", "context": None},  # Every 10 minutes\n    {"schedule_name": "schedule-b", "workflow_fn": workflow_b, "schedule": "0 0 * * *", "context": None},     # Every day at midnight\n])\n'})}),"\n",(0,o.jsx)(n.h3,{id:"managing-schedules",children:"Managing Schedules"}),"\n",(0,o.jsx)(n.p,{children:"You can pause, resume, and delete schedules at runtime:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# Pause a schedule so it stops firing\nDBOS.pause_schedule("my-task-schedule")\n\n# Resume a paused schedule\nDBOS.resume_schedule("my-task-schedule")\n\n# Delete a schedule\nDBOS.delete_schedule("my-task-schedule")\n'})}),"\n",(0,o.jsx)(n.p,{children:"You can also list and inspect schedules:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'# List all active schedules\nschedules = DBOS.list_schedules(status="ACTIVE")\n\n# Get a specific schedule by name\nschedule = DBOS.get_schedule("my-task-schedule")\n'})}),"\n",(0,o.jsx)(n.h3,{id:"backfilling-and-triggering",children:"Backfilling and Triggering"}),"\n",(0,o.jsxs)(n.p,{children:["If a schedule was paused or your application was offline, you can backfill missed executions using ",(0,o.jsx)(n.a,{href:"/python/reference/contexts#backfill_schedule",children:(0,o.jsx)(n.code,{children:"DBOS.backfill_schedule"})}),".\nAlready-executed times are automatically skipped:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from datetime import datetime, timezone\n\nDBOS.backfill_schedule(\n    "my-task-schedule",\n    start=datetime(2025, 1, 1, tzinfo=timezone.utc),\n    end=datetime(2025, 1, 2, tzinfo=timezone.utc),\n)\n'})}),"\n",(0,o.jsxs)(n.p,{children:["You can also immediately trigger a schedule using ",(0,o.jsx)(n.a,{href:"/python/reference/contexts#trigger_schedule",children:(0,o.jsx)(n.code,{children:"DBOS.trigger_schedule"})}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'handle = DBOS.trigger_schedule("my-task-schedule")\n'})}),"\n",(0,o.jsx)(n.h3,{id:"managing-schedules-from-another-application",children:"Managing Schedules from Another Application"}),"\n",(0,o.jsxs)(n.p,{children:["You can manage schedules from outside your DBOS application using the ",(0,o.jsx)(n.a,{href:"/python/reference/client#workflow-schedules",children:"DBOS Client"}),".\nThe client accepts workflow names as strings instead of function references:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'from dbos import DBOSClient\n\nclient = DBOSClient(system_database_url=os.environ["DBOS_SYSTEM_DATABASE_URL"])\n\nclient.create_schedule(\n    schedule_name="my-task-schedule",\n    workflow_name="my_periodic_task",\n    schedule="*/5 * * * *",\n    context="my context",\n)\n'})}),"\n",(0,o.jsx)(n.h3,{id:"how-scheduling-works",children:"How Scheduling Works"}),"\n",(0,o.jsxs)(n.p,{children:["Under the hood, DBOS constructs an ",(0,o.jsx)(n.a,{href:"/python/tutorials/workflow-tutorial#workflow-ids-and-idempotency",children:"idempotency key"})," for each scheduled workflow execution.\nThe key is a concatenation of the schedule name and the scheduled time, ensuring each scheduled invocation occurs exactly once while your application is active."]}),"\n",(0,o.jsxs)(n.p,{children:["For the full API reference, see ",(0,o.jsx)(n.a,{href:"/python/reference/contexts#workflow-schedules",children:"Workflow Schedules"}),"."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h1,{id:"decorator-based-scheduling-deprecated",children:"Decorator-Based Scheduling (Deprecated)"}),"\n",(0,o.jsxs)(n.p,{children:["You can annotate a workflow with the ",(0,o.jsx)(n.a,{href:"/python/reference/decorators#scheduled",children:(0,o.jsx)(n.code,{children:"@DBOS.scheduled"})})," decorator, specifying a schedule in ",(0,o.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Cron",children:"crontab"})," syntax, to schedule it to run exactly once per time interval."]}),"\n",(0,o.jsx)(n.p,{children:"For example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"@DBOS.scheduled('* * * * *') # crontab syntax to run once every minute\n@DBOS.workflow()\ndef example_scheduled_workflow(scheduled_time: datetime, actual_time: datetime):\n    DBOS.logger.info(\"I am a workflow scheduled to run once a minute. \")\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Workflows scheduled in this way must take in exactly two arguments: the time that the run was scheduled (as a ",(0,o.jsx)(n.code,{children:"datetime"}),") and the time the run was actually started (as a ",(0,o.jsx)(n.code,{children:"datetime"}),").  Note that this means scheduled workflows should either be plain functions, or be ",(0,o.jsx)(n.code,{children:"@staticmethod"})," class members."]}),"\n",(0,o.jsxs)(n.p,{children:["To learn more about crontab syntax, see ",(0,o.jsx)(n.a,{href:"https://docs.gitlab.com/ee/topics/cron/",children:"this guide"})," or ",(0,o.jsx)(n.a,{href:"https://crontab.guru/",children:"this crontab editor"}),". DBOS uses ",(0,o.jsx)(n.a,{href:"https://pypi.org/project/croniter/",children:"croniter"})," to parse cron schedules, which is able to do second repetition and by default we use seconds as the first field.\nThe specification for the DBOS variant can be found in the ",(0,o.jsx)(n.a,{href:"/python/reference/decorators#scheduled",children:"decorator reference"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>i});var t=s(6540);const o={},c=t.createContext(o);function r(e){const n=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);