"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[5135],{7429:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"production/dbos-cloud/application-management","title":"Application Management","description":"Deploying Applications","source":"@site/docs/production/dbos-cloud/application-management.md","sourceDirName":"production/dbos-cloud","slug":"/production/dbos-cloud/application-management","permalink":"/production/dbos-cloud/application-management","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20,"title":"Application Management","pagination_prev":null},"sidebar":"tutorialSidebar","next":{"title":"Workflow Management","permalink":"/production/dbos-cloud/workflow-management"}}');var s=o(4848),a=o(8453);const r={sidebar_position:20,title:"Application Management",pagination_prev:null},l=void 0,t={},c=[{value:"Deploying Applications",id:"deploying-applications",level:3},{value:"Applications Configuration",id:"applications-configuration",level:4},{value:"Dependency Management",id:"dependency-management",level:4},{value:"Customizing MicroVM Setup",id:"customizing-microvm-setup",level:4},{value:"Ignoring files with .dbosignore",id:"ignoring-files-with-dbosignore",level:4},{value:"Monitoring and Debugging Applications",id:"monitoring-and-debugging-applications",level:3},{value:"Managing Application Versions",id:"managing-application-versions",level:3},{value:"MicroVM Termination",id:"microvm-termination",level:3},{value:"Workflow Recovery",id:"workflow-recovery",level:3},{value:"Automatic and Manual Scaling",id:"automatic-and-manual-scaling",level:3},{value:"Updating Applications",id:"updating-applications",level:3},{value:"Deleting Applications",id:"deleting-applications",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components},{TabItem:o,Tabs:i}=n;return o||u("TabItem",!0),i||u("Tabs",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h3,{id:"deploying-applications",children:"Deploying Applications"}),"\n",(0,s.jsx)(n.p,{children:"To deploy your application to DBOS Cloud or update an existing application, run this command in its root directory:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"dbos-cloud app deploy\n"})}),"\n",(0,s.jsx)(n.p,{children:"Each time you deploy an application, the following steps execute:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Upload"}),": An archive of your application folder is created and uploaded to DBOS Cloud. This archive can be up to 500 MB in size."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),": Your application's dependencies ",(0,s.jsx)(n.a,{href:"#dependency-management",children:"are installed"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Migration"}),": If you specify database migrations in your ",(0,s.jsx)(n.code,{children:"dbos-config.yaml"}),", these are run on your cloud database."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Deployment"}),": Your application is deployed to a number of ",(0,s.jsx)(n.a,{href:"https://firecracker-microvm.github.io/",children:"Firecracker microVMs"}),' also referred to as "executors."\nBy default, these have 1 vCPU and 512MB of RAM.\nThe amount of memory allocated to each microVM is ',(0,s.jsx)(n.a,{href:"/production/dbos-cloud/cloud-cli#dbos-cloud-app-update",children:"configurable"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["After an application is deployed, it is assigned a domain of the form ",(0,s.jsx)(n.code,{children:"https://<username>-<app-name>.cloud.dbos.dev/"}),".\nIf your account is part of an ",(0,s.jsx)(n.a,{href:"/production/dbos-cloud/account-management#organization-management",children:"organization"}),", organization name is used instead of username."]}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Applications should serve requests from port 8000 (Python\u2014the default port for FastAPI and Gunicorn) or 3000 (TypeScript\u2014the default port for Express and Koa)."}),"\n",(0,s.jsx)(n.li,{children:"Multiple applications can connect to the same Postgres database server\u2014they are deployed to isolated databases on that server."}),"\n",(0,s.jsxs)(n.li,{children:["To change the database server of a deployed application, use ",(0,s.jsx)(n.code,{children:"dbos-cloud app change-database-instance"}),"."]}),"\n"]})}),"\n",(0,s.jsx)(n.h4,{id:"applications-configuration",children:"Applications Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["You need to provide a valid ",(0,s.jsx)(n.code,{children:"dbos-config.yaml"})," file when deploying an application to DBOS Cloud. The required fields are:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"name"}),": Your application name. This is the name with which your application is registered."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"language"}),": ",(0,s.jsx)(n.code,{children:"node"})," or ",(0,s.jsx)(n.code,{children:"python"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"runtimeConfig.start"}),": the command used to start your application. For example, ",(0,s.jsx)(n.code,{children:"fastapi run"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Note that some fields from dbos-config.yaml will be ",(0,s.jsx)(n.strong,{children:"ignored"})," during cloud deployments:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"database_url"})," and ",(0,s.jsx)(n.strong,{children:"database"})," connection-related fields. DBOS Cloud automatically applies the connection information of your cloud database server."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"runtimeConfig.admin_port"}),": DBOS Cloud communicates with Transact admin port on port 3001."]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"dependency-management",children:"Dependency Management"}),"\n",(0,s.jsxs)(i,{groupId:"database-clients",children:[(0,s.jsx)(o,{value:"python",label:"Python",children:(0,s.jsxs)(n.p,{children:["For Python applications, DBOS Cloud installs all dependencies from your ",(0,s.jsx)(n.code,{children:"requirements.txt"})," file.\nThe maximum size of your application after all dependencies are installed is 2 GB."]})}),(0,s.jsxs)(o,{value:"typescript",label:"TypeScript",children:[(0,s.jsxs)(n.p,{children:["For TypeScript applications, DBOS Cloud installs all dependencies from your ",(0,s.jsx)(n.code,{children:"package-lock.json"})," file (or from ",(0,s.jsx)(n.code,{children:"package.json"})," if no lockfile is provided).\nThe maximum size of your application after all dependencies are installed is 2 GB."]}),(0,s.jsxs)(n.p,{children:["After all dependencies are installed, your application is compiled using ",(0,s.jsx)(n.code,{children:"npm run build"}),"."]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"customizing-microvm-setup",children:"Customizing MicroVM Setup"}),"\n",(0,s.jsxs)(n.p,{children:["DBOS Pro subscribers can provide a ",(0,s.jsx)(n.em,{children:"setup script"})," that runs before their application is configured.\nThis script can customize the runtime environment for your application, for example installing system packages and libraries."]}),"\n",(0,s.jsxs)(n.p,{children:["A setup script must be specified in your ",(0,s.jsx)(n.code,{children:"dbos-config.yaml"})," like so:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="dbos-config.yaml"',children:'runtimeConfig:\n    # Script DBOS Cloud runs to customize your application runtime.\n    # Requires a DBOS Pro subscription.\n    setup:\n        - "./build.sh"\n    # Command DBOS Cloud executes to start your application.\n    start: <your-start-command>\n'})}),"\n",(0,s.jsx)(n.p,{children:"A setup script may install system packages or libraries or otherwise customize the microVM image. For example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",metastring:'title="build.sh"',children:"#!/bin/bash\n\n# Install the traceroute package for use in your application\napt install traceroute\n"})}),"\n",(0,s.jsx)(n.h4,{id:"ignoring-files-with-dbosignore",children:"Ignoring files with .dbosignore"}),"\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.code,{children:".dbosignore"})," file at the root of your project instructs the DBOS Cloud CLI to exclude resources from application deployment.\nThe syntax for this file is similar to ",(0,s.jsx)(n.code,{children:".gitignore"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Patterns are compatible with the ",(0,s.jsx)(n.a,{href:"https://www.npmjs.com/package/fast-glob",children:"fast-glob library"})]}),"\n",(0,s.jsxs)(n.li,{children:["Lines ending with ",(0,s.jsx)(n.code,{children:"/"})," are transformed into a recursive ignore ",(0,s.jsx)(n.code,{children:"/**"})," to exclude everything within a directory."]}),"\n",(0,s.jsxs)(n.li,{children:["Lines starting with ",(0,s.jsx)(n.code,{children:"#"})," are ignored."]}),"\n",(0,s.jsx)(n.li,{children:"Some patterns are automatically excluded:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"**/.dbos/**\n**/node_modules/**\n**/dist/**\n**/.git/**\n**/dbos-config.yaml\n**/venv/**\n**/.venv/**\n**/.python-version\n"})}),"\n",(0,s.jsx)(n.h3,{id:"monitoring-and-debugging-applications",children:"Monitoring and Debugging Applications"}),"\n",(0,s.jsx)(n.p,{children:"Here are some useful tools to monitor and debug applications:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.a,{href:"https://console.dbos.dev",children:"cloud console"})," provides a web UI for viewing your applications and their traces and logs."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["To retrieve the last ",(0,s.jsx)(n.code,{children:"N"})," seconds of your application's logs, run ",(0,s.jsx)(n.a,{href:"/production/dbos-cloud/cloud-cli#dbos-cloud-app-logs",children:(0,s.jsx)(n.code,{children:"dbos-cloud app logs -l <N>"})}),". Note that new log entries take a few seconds to appear."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["To retrieve the status of a particular application, run ",(0,s.jsx)(n.a,{href:"/production/dbos-cloud/cloud-cli#dbos-cloud-app-status",children:(0,s.jsx)(n.code,{children:"dbos-cloud app status <app-name>"})}),". To list all applications, run ",(0,s.jsx)(n.a,{href:"/production/dbos-cloud/cloud-cli#dbos-cloud-app-list",children:(0,s.jsx)(n.code,{children:"dbos-cloud app list"})}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"managing-application-versions",children:"Managing Application Versions"}),"\n",(0,s.jsxs)(n.p,{children:["Each time you deploy an application, it creates a new version with a unique ID.\nYou can view all previous versions of your application from the ",(0,s.jsx)(n.a,{href:"https://console.dbos.dev",children:"cloud console"})," or list them by running:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"dbos-cloud app versions <app-name>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can redeploy a previous version of your application by passing ",(0,s.jsx)(n.code,{children:"--previous-version <version-id>"})," to the ",(0,s.jsx)(n.a,{href:"/production/dbos-cloud/cloud-cli#dbos-cloud-app-deploy",children:(0,s.jsx)(n.code,{children:"app deploy"})})," command."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"dbos-cloud app deploy --previous-version <version-id>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"microvm-termination",children:"MicroVM Termination"}),"\n",(0,s.jsx)(n.p,{children:"DBOS Cloud may, from time to time, stop your microVMs due to a variety of reasons, including app upgrade or scaling down (see below). When a microVM is stopped, DBOS Cloud performs the following steps:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Stops routing new HTTP traffic to the VM."}),"\n",(0,s.jsxs)(n.li,{children:["Sends SIGTERM to the ",(0,s.jsx)(n.code,{children:"dbos"})," process (launched by your start command) and waits up to 10 seconds for it to exit."]}),"\n",(0,s.jsx)(n.li,{children:"If the process is still running, terminates it forcefully."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Any ",(0,s.jsx)(n.code,{children:"PENDING"})," workflows run by the microVM are then recovered on another VM. See below."]}),"\n",(0,s.jsx)(n.h3,{id:"workflow-recovery",children:"Workflow Recovery"}),"\n",(0,s.jsx)(n.p,{children:"When a microVM running in DBOS Cloud stops (either due to a process crash or when scaling down), all of its workflows are automatically recovered to another microVM running the same application version. If no other microVM of that application version exists, DBOS Cloud launches a new one and instructs it to recover the workflows."}),"\n",(0,s.jsxs)(n.p,{children:["When you deploy a new version of your application, DBOS Cloud routes all requests and scheduled workflows to microVMs of the new application version.\nThen, DBOS Cloud attempts to decommission microVMs running the previous application version.\nIf there are still ",(0,s.jsx)(n.code,{children:"PENDING"})," or ",(0,s.jsx)(n.code,{children:"ENQUEUED"})," workflows of that code version, DBOS Cloud leaves some number of microVMs alive to process those workflows until all are complete."]}),"\n",(0,s.jsxs)(n.p,{children:["Periodically, DBOS Cloud checks if there are any ",(0,s.jsx)(n.code,{children:"PENDING"})," or ",(0,s.jsx)(n.code,{children:"ENQUEUED"})," workflows not assigned to any microVM.\nIf any are found, DBOS Cloud recovers them to a microVM of the appropriate application version (starting one if necessary)."]}),"\n",(0,s.jsx)(n.h3,{id:"automatic-and-manual-scaling",children:"Automatic and Manual Scaling"}),"\n",(0,s.jsx)(n.p,{children:"Accounts on the free 30-day trial are limited to 1 microVM per app. Apps for Pro accounts are auto-scaled. Auto-scaling occurs based on CPU or queue utilization."}),"\n",(0,s.jsxs)(n.p,{children:["For the latter, the queue must have ",(0,s.jsx)(n.code,{children:"worker_concurrency"})," (or ",(0,s.jsx)(n.code,{children:"workerConcurrency"}),") set. DBOS Cloud computes the current parallel task capacity  - the number of tasks that can be executed simultaneously - using the product of worker_concurrency and the current number of microVMs: ",(0,s.jsx)(n.code,{children:"capacity = worker_concurrency * num_microvms"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Scaling up occurs when:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"the average microVM CPU utilization exceeds 85% for several seconds, or"}),"\n",(0,s.jsx)(n.li,{children:"the number of enqueued tasks exceeds capacity for at least one of the queues."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Inversely, the app scales down when the average CPU utilization drops below 40% and the number of enqueued tasks drops below capacity for all queues."}),"\n",(0,s.jsxs)(n.p,{children:["To alter the auto-scaling behavior, you can manually set ",(0,s.jsx)(n.code,{children:"min-executors"})," and/or ",(0,s.jsx)(n.code,{children:"max-executors"})," using ",(0,s.jsx)(n.code,{children:"app update"})," (see below)."]}),"\n",(0,s.jsx)(n.h3,{id:"updating-applications",children:"Updating Applications"}),"\n",(0,s.jsx)(n.p,{children:"To change your executor RAM or the default number of microVMs, run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"dbos-cloud app update <app-name> [options]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.a,{href:"/production/dbos-cloud/cloud-cli#dbos-cloud-app-update",children:"DBOS Cloud CLI reference"})," for a list of properties you can update. Note that ",(0,s.jsx)(n.code,{children:"app update"})," does not trigger a redeploy of the code, which you can do with the ",(0,s.jsx)(n.a,{href:"/production/dbos-cloud/cloud-cli#dbos-cloud-app-deploy",children:(0,s.jsx)(n.code,{children:"app deploy"})})," command."]}),"\n",(0,s.jsx)(n.h3,{id:"deleting-applications",children:"Deleting Applications"}),"\n",(0,s.jsx)(n.p,{children:"To delete an application, run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"dbos-cloud app delete <app-name>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You can also drop the application database with the ",(0,s.jsx)(n.code,{children:"--dropdb"})," argument.\nAs each application has its own isolated database, this does not affect your other applications."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"dbos-cloud app delete <app-name> --dropdb\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsx)(n.p,{children:"This is a destructive operation and cannot be undone."})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>l});var i=o(6540);const s={},a=i.createContext(s);function r(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);