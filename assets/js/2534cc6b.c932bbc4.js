"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[4293],{2107:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var t=o(5893),i=o(1151);const s={sidebar_position:18,title:"Scheduled Workflows",description:"Learn how to run DBOS workflows on a schedule."},r=void 0,c={id:"tutorials/scheduled-workflows",title:"Scheduled Workflows",description:"Learn how to run DBOS workflows on a schedule.",source:"@site/docs/tutorials/scheduled-workflows.md",sourceDirName:"tutorials",slug:"/tutorials/scheduled-workflows",permalink:"/tutorials/scheduled-workflows",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:18,frontMatter:{sidebar_position:18,title:"Scheduled Workflows",description:"Learn how to run DBOS workflows on a schedule."},sidebar:"tutorialSidebar",previous:{title:"Integrating with Kafka",permalink:"/tutorials/kafka-integration"},next:{title:"Checkout Workflow Tutorial",permalink:"/tutorials/checkout-tutorial"}},l={},d=[{value:"Defining A Workflow Function For Scheduling",id:"defining-a-workflow-function-for-scheduling",level:3},{value:"Scheduling The Workflow",id:"scheduling-the-workflow",level:3},{value:"How Scheduling Works",id:"how-scheduling-works",level:3},{value:"Skipping Scheduled Workflows",id:"skipping-scheduled-workflows",level:3},{value:"<code>crontab</code> Specification",id:"crontab-specification",level:3}];function a(e){const n={a:"a",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"In this guide, you'll learn how to execute DBOS workflows exactly once per time interval."}),"\n",(0,t.jsx)(n.h3,{id:"defining-a-workflow-function-for-scheduling",children:"Defining A Workflow Function For Scheduling"}),"\n",(0,t.jsx)(n.p,{children:"First, define your workflow.  Its parameters must be:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"WorkflowContext"})]}),"\n",(0,t.jsxs)(n.li,{children:["The time that the run was scheduled (as a ",(0,t.jsx)(n.code,{children:"Date"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["The time that the run was actually started (as a ",(0,t.jsx)(n.code,{children:"Date"}),").  This can be used to tell if an exactly-once workflow was started behind schedule."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { Scheduled, Workflow, WorkflowContext } from '@dbos-inc/dbos-sdk';\n\nclass ScheduledExample{\n  @Workflow()\n  static async scheduledFunc(ctxt: WorkflowContext, schedTime: Date, startTime: Date) {\n    ctxt.logger.info(`\n        Running a workflow every 5 seconds -\n          scheduled time: ${schedTime.toISOString()} /\n          actual start time: ${startTime.toISOString()}\n    `);\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"scheduling-the-workflow",children:"Scheduling The Workflow"}),"\n",(0,t.jsxs)(n.p,{children:["Then, annotate your method with a ",(0,t.jsx)(n.a,{href:"/api-reference/decorators#scheduled",children:(0,t.jsx)(n.code,{children:"@Scheduled"})})," decorator specifiying the schedule in a ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Cron",children:(0,t.jsx)(n.code,{children:"crontab"})}),"-like format, which optionally specifies a constraint for seconds, followed by constraints for minutes, hours, day of month, month of year, and day of week.  For example, the following workflow will run every 30 seconds:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { Scheduled, Workflow, WorkflowContext } from '@dbos-inc/dbos-sdk';\n\nclass ScheduledExample{\n  @Workflow()\n  @Scheduled({crontab: '*/30 * * * * *'})\n  static async scheduledFunc(ctxt: WorkflowContext, schedTime: Date, startTime: Date) {\n    ctxt.logger.info(``);\n  }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"The DBOS crontab format supports some common extensions, as seen in the following examples:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"* * * * *"}),": Every minute of every day"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"* 5 * * 1"}),": Every minute during the hour of 05:00 on Mondays."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"30 * * * * *"}),": 30 seconds after the beginning of every minute"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"0 12 * * Sun"}),": At noon on sundays"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"0 9-17 * * *"}),": At the top of the hour, from 9am to 5pm"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"*/30 * * * * *"}),": Every 30 seconds (seconds is evenly divisible by 30)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"10-19/2 * * January,Feb *"}),": At 10, 12, 14, 16, and 18 minutes into each hour of every day, only in the months of January and February"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"how-scheduling-works",children:"How Scheduling Works"}),"\n",(0,t.jsxs)(n.p,{children:["Under the hood, DBOS constructs an ",(0,t.jsx)(n.a,{href:"./idempotency-tutorial",children:"idempotency key"})," for each workflow invocation.  The key is a concatenation of the function name and the scheduled time, ensuring each scheduled invocation occurs at most once.  The DBOS system database tracks the last time that the workflow was known to have started; this implementation ensures that the workflow is started at least once.  The combination of mechanisms can therefore ensure that the scheduled workflow occurs exactly once per time interval."]}),"\n",(0,t.jsx)(n.h3,{id:"skipping-scheduled-workflows",children:"Skipping Scheduled Workflows"}),"\n",(0,t.jsx)(n.p,{children:'By default, scheduled workflows are executed exactly once per interval.  This means that, if an application is stopped for an extended period, DBOS Transact could initiate a significant number of workflows upon restart.  If it is known by the application developer that "makeup work" should not be scheduled for a given workflow function, the mode for that function should be changed in its configuration:'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"    @Scheduled({mode: SchedulerMode.ExactlyOncePerIntervalWhenActive, crontab: '...'})\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If the mode is set to ",(0,t.jsx)(n.code,{children:"ExactlyOncePerIntervalWhenActive"})," , DBOS Transact will not consult the system database to figure out if scheduled workflows were missed, but will instead start the schedule at the current time."]}),"\n",(0,t.jsxs)(n.h3,{id:"crontab-specification",children:[(0,t.jsx)(n.code,{children:"crontab"})," Specification"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"crontab"})," format is based on the well-known format used in the ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Cron",children:(0,t.jsx)(n.code,{children:"cron"})})," scheduler.  The specification for the DBOS variant can be found in the ",(0,t.jsx)(n.a,{href:"/api-reference/decorators#crontab-specification",children:"decorator reference"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},1151:(e,n,o)=>{o.d(n,{Z:()=>c,a:()=>r});var t=o(7294);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);