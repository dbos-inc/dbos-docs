"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[3543],{7540:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var a=e(5893),r=e(1151);const s={sidebar_position:2,title:"Transactions",description:"Learn how to perform database operations"},i=void 0,o={id:"tutorials/transaction-tutorial",title:"Transactions",description:"Learn how to perform database operations",source:"@site/docs/tutorials/transaction-tutorial.md",sourceDirName:"tutorials",slug:"/tutorials/transaction-tutorial",permalink:"/tutorials/transaction-tutorial",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Transactions",description:"Learn how to perform database operations"},sidebar:"tutorialSidebar",previous:{title:"HTTP Serving",permalink:"/tutorials/http-serving-tutorial"},next:{title:"Communicators",permalink:"/tutorials/communicator-tutorial"}},c={},l=[];function u(t){const n={a:"a",code:"code",em:"em",p:"p",pre:"pre",...(0,r.a)(),...t.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["To perform operations on your application database in DBOS, you use ",(0,a.jsx)(n.em,{children:"transaction functions"}),".\nAs their name implies, these functions execute as ",(0,a.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Database_transaction",children:"database transactions"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Transaction functions must be annotated with the ",(0,a.jsx)(n.a,{href:"../api-reference/decorators#transaction",children:(0,a.jsx)(n.code,{children:"@Transaction"})})," decorator and must have a ",(0,a.jsx)(n.a,{href:"../api-reference/contexts#transactioncontextt",children:(0,a.jsx)(n.code,{children:"TransactionContext"})})," as their first argument.\nAs with other DBOS functions, inputs and outputs must be serializable to JSON."]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.a,{href:"../api-reference/contexts#transactioncontextt",children:(0,a.jsx)(n.code,{children:"TransactionContext"})})," provides a ",(0,a.jsx)(n.code,{children:".client"})," field you can use to transactionally interact with the database, so you don't need to worry about managing database connections.\nBy default, this is a ",(0,a.jsx)(n.a,{href:"/tutorials/using-knex",children:"Knex.js"})," client backed by a connection pool.\nWe like Knex because it's lightweight and helps us write fast and type-safe queries.\nHowever, if you prefer a traditional ORM, we also support ",(0,a.jsx)(n.a,{href:"/tutorials/using-typeorm",children:"TypeORM"})," and ",(0,a.jsx)(n.a,{href:"/tutorials/using-prisma",children:"Prisma"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["Here's an example of a transaction function written using raw SQL (with ",(0,a.jsx)(n.a,{href:"https://knexjs.org/guide/raw.html",children:"knex.raw"}),"):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"export class Greetings {\n  @Transaction()\n  static async InsertGreeting(ctxt: TransactionContext<Knex>, friend: string, note: string) {\n    await ctxt.client.raw('INSERT INTO greetings (name, note) VALUES (?, ?)', [friend, note]);\n  }\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"Here's the same function written using the Knex query builder:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"export class Greetings {\n  @Transaction()\n  static async InsertGreeting(ctxt: TransactionContext<Knex>, friend: string, note: string) {\n    await ctxt.client('greetings').insert({\n      name: friend,\n      note: note\n    });\n  }\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["DBOS supports the full ",(0,a.jsx)(n.a,{href:"https://knexjs.org/guide/query-builder.html",children:"Knex Postgres API"}),", but doesn't allow manually committing or aborting transactions.\nInstead, transactions automatically commit when the function successfully returns and abort and roll back if the function throws an exception.\nIf you need to orchestrate multiple transactions, use a ",(0,a.jsx)(n.a,{href:"./workflow-tutorial",children:"workflow"}),"."]})]})}function d(t={}){const{wrapper:n}={...(0,r.a)(),...t.components};return n?(0,a.jsx)(n,{...t,children:(0,a.jsx)(u,{...t})}):u(t)}},1151:(t,n,e)=>{e.d(n,{Z:()=>o,a:()=>i});var a=e(7294);const r={},s=a.createContext(r);function i(t){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof t?t(n):{...n,...t}}),[n,t])}function o(t){let n;return n=t.disableParentContext?"function"==typeof t.components?t.components(r):t.components||r:i(t.components),a.createElement(s.Provider,{value:n},t.children)}}}]);