"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[2418],{2804:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"typescript/tutorials/instantiated-objects","title":"Using Typescript Objects","description":"You can use class instance methods as workflows and steps.","source":"@site/docs/typescript/tutorials/instantiated-objects.md","sourceDirName":"typescript/tutorials","slug":"/typescript/tutorials/instantiated-objects","permalink":"/typescript/tutorials/instantiated-objects","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":80,"frontMatter":{"sidebar_position":80,"title":"Using Typescript Objects"},"sidebar":"tutorialSidebar","previous":{"title":"Logging & Tracing","permalink":"/typescript/tutorials/logging"},"next":{"title":"Testing & Mocking","permalink":"/typescript/tutorials/testing"}}');var i=s(4848),o=s(8453);const r={sidebar_position:80,title:"Using Typescript Objects"},a=void 0,c={},l=[{value:"Using Configured Class Instances",id:"using-configured-class-instances",level:2},{value:"Writing New Configured Classes",id:"writing-new-configured-classes",level:3},{value:"<code>initialize()</code> Method",id:"initialize-method",level:3},{value:"Notes",id:"notes",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["You can use class instance methods as workflows and steps.\nAny class instance method can be freely used as a step using the ",(0,i.jsx)(n.a,{href:"/typescript/reference/workflows-steps#dbosstep",children:(0,i.jsx)(n.code,{children:"DBOS.step"})})," decorator or ",(0,i.jsx)(n.a,{href:"/typescript/reference/workflows-steps#dbosrunstep",children:(0,i.jsx)(n.code,{children:"DBOS.runStep"})}),"; there are no special requirements.\nTo use a class instance method as a workflow, you must use the ",(0,i.jsx)(n.a,{href:"/typescript/reference/workflows-steps#dbosworkflow",children:(0,i.jsx)(n.code,{children:"DBOS.workflow"})})," decorator and the class must inherit from ",(0,i.jsx)(n.code,{children:"ConfiguredInstance"}),".\nFor example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"class MyClass extends ConfiguredInstance {\n  cfg: MyConfig;\n  constructor(name: string, config: MyConfig) {\n    super(name);\n    this.cfg = cfg;\n  }\n\n  override async initialize() : Promise<void> {\n    // ... Validate this.cfg; will be called at DBOS.launch()\n  }\n\n  @DBOS.workflow()\n  async testWorkflow(p: string): Promise<void> {\n    // ... Operations that use this.cfg\n  }\n}\n\nconst myClassInstance = new MyClass('instanceA');\n"})}),"\n",(0,i.jsxs)(n.p,{children:["When you create a new instance of such a class, the constructor for the base ",(0,i.jsx)(n.code,{children:"ConfiguredInstance"})," must be called with a ",(0,i.jsx)(n.code,{children:"name"}),".\nThis ",(0,i.jsx)(n.code,{children:"name"})," must be unique among instances of the same class.\nAdditionally, all ",(0,i.jsx)(n.code,{children:"ConfiguredInstance"})," classes must be instantiated before DBOS.launch() is called."]}),"\n",(0,i.jsxs)(n.p,{children:["The reason for these requirements is to enable workflow recovery.  When you create a new instance of, DBOS stores it in a global registry indexed by ",(0,i.jsx)(n.code,{children:"name"}),".  When DBOS needs to recover a workflow belonging to that class, it looks up the ",(0,i.jsx)(n.code,{children:"name"})," so it can run the workflow using the right class instance.  While names are used by DBOS Transact internally to find the correct object instance across system restarts, they are also potentially useful for monitoring, tracing, and debugging."]}),"\n",(0,i.jsx)(n.h2,{id:"using-configured-class-instances",children:"Using Configured Class Instances"}),"\n",(0,i.jsx)(n.p,{children:"Configured class instances should be created and named when the application starts, before any workflows run.  This ensures that they will all be initialized before any processing begins."}),"\n",(0,i.jsx)(n.h3,{id:"writing-new-configured-classes",children:"Writing New Configured Classes"}),"\n",(0,i.jsx)(n.p,{children:"All configured classes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Extend from the ",(0,i.jsx)(n.code,{children:"ConfiguredInstance"})," base class"]}),"\n",(0,i.jsxs)(n.li,{children:["Provide a constructor, which can take any arguments, but must provide a name to the base ",(0,i.jsx)(n.code,{children:"ConfiguredInstance"})," constructor"]}),"\n",(0,i.jsxs)(n.li,{children:["May have an ",(0,i.jsx)(n.code,{children:"initialize()"})," method that will be called after all objects have been created, but before request handling commences"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"initialize-method",children:[(0,i.jsx)(n.code,{children:"initialize()"})," Method"]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"initialize()"})," method will be called during application initialization, after the code modules have been loaded, but before request and workflow processing commences.  ",(0,i.jsx)(n.a,{href:"/typescript/reference/dbos-class",children:(0,i.jsx)(n.code,{children:"DBOS"})})," is available during initialize.  Any validation of connection information (complete with diagnostic logging and reporting of any problems) should be performed in ",(0,i.jsx)(n.code,{children:"initialize()"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,i.jsxs)(n.p,{children:["Event registration decorators such as ",(0,i.jsx)(n.code,{children:"@DBOS.scheduled"})," cannot be applied to instance methods."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var t=s(6540);const i={},o=t.createContext(i);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);