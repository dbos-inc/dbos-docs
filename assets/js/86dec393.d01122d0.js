"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[4806],{5308:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"golang/reference/workflows-steps","title":"Workflows & Steps","description":"RegisterWorkflow","source":"@site/docs/golang/reference/workflows-steps.md","sourceDirName":"golang/reference","slug":"/golang/reference/workflows-steps","permalink":"/golang/reference/workflows-steps","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20,"title":"Workflows & Steps"},"sidebar":"tutorialSidebar","previous":{"title":"DBOS Context","permalink":"/golang/reference/dbos-context"},"next":{"title":"DBOS Methods & Variables","permalink":"/golang/reference/methods"}}');var r=t(4848),o=t(8453);const s={sidebar_position:20,title:"Workflows & Steps"},l=void 0,a={},d=[{value:"RegisterWorkflow",id:"registerworkflow",level:3},{value:"WithMaxRetries",id:"withmaxretries",level:4},{value:"WithSchedule",id:"withschedule",level:4},{value:"WithWorkflowName",id:"withworkflowname",level:4},{value:"RunWorkflow",id:"runworkflow",level:3},{value:"WithWorkflowID",id:"withworkflowid",level:4},{value:"WithQueue",id:"withqueue",level:4},{value:"WithDeduplicationID",id:"withdeduplicationid",level:4},{value:"WithPriority",id:"withpriority",level:4},{value:"WithQueuePartitionKey",id:"withqueuepartitionkey",level:4},{value:"WithApplicationVersion",id:"withapplicationversion",level:4},{value:"WithAuthenticatedUser",id:"withauthenticateduser",level:4},{value:"RunAsStep",id:"runasstep",level:3},{value:"WithStepName",id:"withstepname",level:4},{value:"WithStepMaxRetries",id:"withstepmaxretries",level:4},{value:"WithMaxInterval",id:"withmaxinterval",level:4},{value:"WithBackoffFactor",id:"withbackofffactor",level:4},{value:"WithBaseInterval",id:"withbaseinterval",level:4},{value:"WorkflowHandle",id:"workflowhandle",level:3},{value:"WorkflowHandle.GetResult",id:"workflowhandlegetresult",level:4},{value:"WithHandleTimeout",id:"withhandletimeout",level:5},{value:"WorkflowHandle.GetStatus",id:"workflowhandlegetstatus",level:4},{value:"WorkflowHandle.GetWorkflowID",id:"workflowhandlegetworkflowid",level:4}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h3,{id:"registerworkflow",children:"RegisterWorkflow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func RegisterWorkflow[P any, R any](ctx DBOSContext, fn Workflow[P, R], opts ...WorkflowRegistrationOption)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Register a function as a DBOS workflow.\nAll workflows must be registered before the context is launched."}),"\n",(0,r.jsx)(n.p,{children:"Workflow functions must be compatible with the following signature:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"type Workflow[P any, R any] func(ctx DBOSContext, input P) (R, error)\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ctx"}),": The DBOSContext."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fn"}),": The workflow function to register."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"opts"}),": Functional options for workflow registration, documented below."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"withmaxretries",children:"WithMaxRetries"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithMaxRetries(maxRetries int) WorkflowRegistrationOption\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Configure the maximum number of times execution of a workflow may be attempted.\nThis acts as a ",(0,r.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Dead_letter_queue",children:"dead letter queue"})," so that a buggy workflow that crashes its application (for example, by running it out of memory) does not do so infinitely.\nIf a workflow exceeds this limit, its status is set to ",(0,r.jsx)(n.code,{children:"MAX_RECOVERY_ATTEMPTS_EXCEEDED"})," and it may no longer be executed."]}),"\n",(0,r.jsx)(n.h4,{id:"withschedule",children:"WithSchedule"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithSchedule(schedule string) WorkflowRegistrationOption\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Registers the workflow as a scheduled workflow using cron syntax.\nThe schedule string follows standard cron format with second precision.\nScheduled workflows automatically receive a ",(0,r.jsx)(n.code,{children:"time.Time"})," input parameter."]}),"\n",(0,r.jsx)(n.h4,{id:"withworkflowname",children:"WithWorkflowName"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithWorkflowName(name string) WorkflowRegistrationOption\n"})}),"\n",(0,r.jsx)(n.p,{children:"Register a workflow with a custom name.\nIf not provided, the name of the workflow function is used."}),"\n",(0,r.jsx)(n.h3,{id:"runworkflow",children:"RunWorkflow"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func RunWorkflow[P any, R any](ctx DBOSContext, fn Workflow[P, R], input P, opts ...WorkflowOption) (WorkflowHandle[R], error)\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Execute a workflow function.\nThe workflow may execute immediately or be enqueued for later execution based on options.\nReturns a ",(0,r.jsx)(n.a,{href:"#workflowhandle",children:"WorkflowHandle"})," that can be used to check the workflow's status or wait for its completion and retrieve its results."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ctx"}),": The DBOSContext."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fn"}),": The workflow function to execute."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"input"})," The input to the workflow function."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"opts"}),": Functional options for workflow execution, documented below."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Example Syntax"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'func workflow(ctx dbos.DBOSContext, input string) (string, error) {\n    return "success", err\n}\n\nfunc example(input string) error {\n    handle, err := dbos.RunWorkflow(dbosContext, workflow, input)\n    if err != nil {\n        return err\n    }\n    result, err := handle.GetResult()\n    if err != nil {\n        return err\n    }\n    fmt.Println("Workflow result:", result)\n    return nil\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"withworkflowid",children:"WithWorkflowID"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithWorkflowID(id string) WorkflowOption\n"})}),"\n",(0,r.jsx)(n.p,{children:"Run the workflow with a custom workflow ID.\nIf not specified, a UUID workflow ID is generated."}),"\n",(0,r.jsx)(n.h4,{id:"withqueue",children:"WithQueue"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithQueue(queueName string) WorkflowOption\n"})}),"\n",(0,r.jsx)(n.p,{children:"Enqueue the workflow to the specified queue instead of executing it immediately.\nQueued workflows will be dequeued and executed according to the queue's configuration."}),"\n",(0,r.jsx)(n.h4,{id:"withdeduplicationid",children:"WithDeduplicationID"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithDeduplicationID(id string) WorkflowOption\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Set a deduplication ID for this workflow.\nShould be used alongside ",(0,r.jsx)(n.code,{children:"WithQueue"}),".\nAt any given time, only one workflow with a specific deduplication ID can be enqueued in a given queue.\nIf a workflow with a deduplication ID is currently enqueued or actively executing (status ",(0,r.jsx)(n.code,{children:"ENQUEUED"})," or ",(0,r.jsx)(n.code,{children:"PENDING"}),"), subsequent workflow enqueue attempt with the same deduplication ID in the same queue will raise an exception."]}),"\n",(0,r.jsx)(n.h4,{id:"withpriority",children:"WithPriority"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithPriority(priority uint) WorkflowOption\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Set a queue priority for the workflow.\nShould be used alongside ",(0,r.jsx)(n.code,{children:"WithQueue"}),".\nWorkflows with the same priority are dequeued in ",(0,r.jsx)(n.strong,{children:"FIFO (first in, first out)"})," order.\nPriority values can range from ",(0,r.jsx)(n.code,{children:"1"})," to ",(0,r.jsx)(n.code,{children:"2,147,483,647"}),", where ",(0,r.jsx)(n.strong,{children:"a low number indicates a higher priority"}),".\nWorkflows without assigned priorities have the highest priority and are dequeued before workflows with assigned priorities."]}),"\n",(0,r.jsx)(n.h4,{id:"withqueuepartitionkey",children:"WithQueuePartitionKey"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithQueuePartitionKey(partitionKey string) WorkflowOption\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Set a queue partition key for the workflow.\nUse if and only if the queue is partitioned (created with ",(0,r.jsx)(n.a,{href:"/golang/reference/queues#withpartitionqueue",children:(0,r.jsx)(n.code,{children:"WithPartitionQueue"})}),").\nIn partitioned queues, all flow control (including concurrency and rate limits) is applied to individual partitions instead of the queue as a whole."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example Syntax:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'// Create a partitioned queue\npartitionedQueue := dbos.NewWorkflowQueue(ctx, "user-tasks",\n    dbos.WithPartitionQueue(),\n)\n\n// Enqueue workflows with partition keys\n// Each user\'s tasks run with separate concurrency limits\nhandle, err := dbos.RunWorkflow(ctx, ProcessUserTask, taskData,\n    dbos.WithQueue("user-tasks"),\n    dbos.WithQueuePartitionKey(userID),\n)\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Partition keys are required when enqueueing to a partitioned queue."}),"\n",(0,r.jsx)(n.li,{children:"Partition keys cannot be used with non-partitioned queues."}),"\n",(0,r.jsx)(n.li,{children:"Partition keys and deduplication IDs cannot be used together."}),"\n"]})}),"\n",(0,r.jsx)(n.h4,{id:"withapplicationversion",children:"WithApplicationVersion"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithApplicationVersion(version string) WorkflowOption\n"})}),"\n",(0,r.jsx)(n.p,{children:"Set the application version for this workflow, overriding the version in DBOSContext."}),"\n",(0,r.jsx)(n.h4,{id:"withauthenticateduser",children:"WithAuthenticatedUser"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithAuthenticatedUser(user string) WorkflowOption\n"})}),"\n",(0,r.jsx)(n.p,{children:"Associate the workflow execution with a user name. Useful to define workflow identity."}),"\n",(0,r.jsx)(n.h3,{id:"runasstep",children:"RunAsStep"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func RunAsStep[R any](ctx DBOSContext, fn Step[R], opts ...StepOption) (R, error)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Execute a function as a step in a durable workflow."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ctx"}),": The DBOSContext."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"fn"}),": The step to execute, typically wrapped in an anonymous function. Syntax shown below."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"opts"}),": Functional options for step execution, documented below."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Example Syntax:"})}),"\n",(0,r.jsxs)(n.p,{children:["Any Go function can be a step as long as it outputs one ",(0,r.jsx)(n.a,{href:"https://pkg.go.dev/encoding/json",children:"json-encodable"})," value and an error.\nTo pass inputs into a function being called as a step, wrap it in an anonymous function as shown below:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func step(ctx context.Context, input string) (string, error) {\n    output := ...\n    return output\n}\n\nfunc workflow(ctx dbos.DBOSContext, input string) (string, error) {\n    output, err := dbos.RunAsStep(\n        ctx, \n        func(stepCtx context.Context) (string, error) {\n            return step(stepCtx, input)\n        }\n    )\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"withstepname",children:"WithStepName"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithStepName(name string) StepOption\n"})}),"\n",(0,r.jsx)(n.p,{children:"Set a custom name for a step."}),"\n",(0,r.jsx)(n.h4,{id:"withstepmaxretries",children:"WithStepMaxRetries"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithStepMaxRetries(maxRetries int) StepOption\n"})}),"\n",(0,r.jsx)(n.p,{children:"Set the maximum number of times this step is automatically retired on failure.\nA value of 0 (the default) indicates no retries."}),"\n",(0,r.jsx)(n.h4,{id:"withmaxinterval",children:"WithMaxInterval"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithMaxInterval(interval time.Duration) StepOption\n"})}),"\n",(0,r.jsx)(n.p,{children:"WithMaxInterval sets the maximum delay between retries. Default value is 5s."}),"\n",(0,r.jsx)(n.h4,{id:"withbackofffactor",children:"WithBackoffFactor"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithBackoffFactor(factor float64) StepOption\n"})}),"\n",(0,r.jsx)(n.p,{children:"WithBackoffFactor sets the exponential backoff multiplier between retries. Default value is 2.0."}),"\n",(0,r.jsx)(n.h4,{id:"withbaseinterval",children:"WithBaseInterval"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithBaseInterval(interval time.Duration) StepOption\n"})}),"\n",(0,r.jsx)(n.p,{children:"WithBaseInterval sets the initial delay between retries. Default value is 100ms."}),"\n",(0,r.jsx)(n.h3,{id:"workflowhandle",children:"WorkflowHandle"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"type WorkflowHandle[R any] interface {\n    GetResult(opts ...GetResultOption) (R, error)\n    GetStatus() (WorkflowStatus, error)\n    GetWorkflowID() string\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["WorkflowHandle provides methods to interact with a running or completed workflow.\nThe type parameter ",(0,r.jsx)(n.code,{children:"R"})," represents the expected return type of the workflow.\nHandles can be used to wait for workflow completion, check status, and retrieve results."]}),"\n",(0,r.jsx)(n.h4,{id:"workflowhandlegetresult",children:"WorkflowHandle.GetResult"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"WorkflowHandle.GetResult(opts ...GetResultOption) (R, error)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Wait for the workflow to complete and return its result."}),"\n",(0,r.jsx)(n.h5,{id:"withhandletimeout",children:"WithHandleTimeout"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"func WithHandleTimeout(timeout time.Duration) GetResultOption\n"})}),"\n",(0,r.jsx)(n.p,{children:"Specify a timeout for obtaining a workflow result."}),"\n",(0,r.jsx)(n.h4,{id:"workflowhandlegetstatus",children:"WorkflowHandle.GetStatus"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"WorkflowHandle.GetStatus() (WorkflowStatus, error)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Retrieve the WorkflowStatus of the workflow."}),"\n",(0,r.jsx)(n.h4,{id:"workflowhandlegetworkflowid",children:"WorkflowHandle.GetWorkflowID"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"WorkflowHandle.GetWorkflowID() string\n"})}),"\n",(0,r.jsx)(n.p,{children:"Retrieve the ID of the workflow."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>l});var i=t(6540);const r={},o=i.createContext(r);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);