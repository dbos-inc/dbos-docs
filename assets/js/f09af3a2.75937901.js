"use strict";(self.webpackChunkdbos_docs=self.webpackChunkdbos_docs||[]).push([[6077],{9719:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var i=t(5893),a=t(1151);const o={sidebar_position:3,title:"Time Travel Debugging",description:"Learn how to time travel debug DBOS Cloud applications"},s=void 0,r={id:"cloud-tutorials/timetravel-debugging",title:"Time Travel Debugging",description:"Learn how to time travel debug DBOS Cloud applications",source:"@site/docs/cloud-tutorials/timetravel-debugging.md",sourceDirName:"cloud-tutorials",slug:"/cloud-tutorials/timetravel-debugging",permalink:"/cloud-tutorials/timetravel-debugging",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"Time Travel Debugging",description:"Learn how to time travel debug DBOS Cloud applications"},sidebar:"tutorialSidebar",previous:{title:"Cloud Application Management",permalink:"/cloud-tutorials/application-management"},next:{title:"Monitoring Dashboard",permalink:"/cloud-tutorials/monitoring-dashboard"}},d={},l=[{value:"Time Travel with Visual Studio Code",id:"time-travel-with-visual-studio-code",level:2},{value:"Preliminaries",id:"preliminaries",level:3},{value:"Launching a Debug Session",id:"launching-a-debug-session",level:3},{value:"Time Travel Database Queries",id:"time-travel-database-queries",level:3},{value:"Dos and Don&#39;ts",id:"dos-and-donts",level:3},{value:"Configurations",id:"configurations",level:3},{value:"Time Travel with DBOS SDK CLI (Non-VS Code Users)",id:"time-travel-with-dbos-sdk-cli-non-vs-code-users",level:2},{value:"Manual Setup",id:"manual-setup",level:3},{value:"Replay a Workflow",id:"replay-a-workflow",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"In this guide, you'll learn how to time travel debug your production applications deployed on DBOS Cloud."}),"\n",(0,i.jsx)(n.h2,{id:"time-travel-with-visual-studio-code",children:"Time Travel with Visual Studio Code"}),"\n",(0,i.jsx)(n.h3,{id:"preliminaries",children:"Preliminaries"}),"\n",(0,i.jsxs)(n.p,{children:["Before following the steps in this guide, make sure you've ",(0,i.jsx)(n.a,{href:"application-management",children:"deployed an application to DBOS Cloud"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Time travel debugging uses ",(0,i.jsx)(n.a,{href:"https://code.visualstudio.com/",children:"Visual Studio Code"})," and the\n",(0,i.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=dbos-inc.dbos-ttdbg",children:"DBOS Time Travel Debugger Extension"}),".\nThe extension can be installed from the link above or by searching the\n",(0,i.jsx)(n.a,{href:"https://code.visualstudio.com/docs/editor/extension-marketplace",children:"Extension Marketplace"}),'\ninside VS Code for "DBOS"']}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Installing the DBOS Time Travel Extension Screenshot",src:t(1950).Z+"",width:"507",height:"330"})}),"\n",(0,i.jsx)(n.p,{children:"Once installed, the DBOS Time Travel Extension will automatically update as new releases are published to the VS Code Marketplace."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["If you're not a VS Code user, please see the section below on ",(0,i.jsx)(n.a,{href:"#time-travel-with-dbos-sdk-cli-non-vs-code-users",children:"Time Travel Debugging with the DBOS SDK CLI"})," below."]})}),"\n",(0,i.jsx)(n.h3,{id:"launching-a-debug-session",children:"Launching a Debug Session"}),"\n",(0,i.jsxs)(n.p,{children:['Open your DBOS application in VS Code.\nThe DBOS Time Travel Debugger extension inserts a "\u23f3 Time Travel Debug"\n',(0,i.jsx)(n.a,{href:"https://code.visualstudio.com/blogs/2017/02/12/code-lens-roundup",children:"CodeLens"}),"\nto every DBOS ",(0,i.jsx)(n.a,{href:"../tutorials/workflow-tutorial",children:"workflow"}),",\n",(0,i.jsx)(n.a,{href:"../tutorials/transaction-tutorial",children:"transaction"}),"\nand ",(0,i.jsx)(n.a,{href:"../tutorials/communicator-tutorial",children:"communicator"})," function in your DBOS application."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"DBOS Time Travel CodeLens Screenshot",src:t(6785).Z+"",width:"1554",height:"145"})}),"\n",(0,i.jsx)(n.p,{children:"When you click on the Time Travel Debug CodeLens, you are provided with a list of recent executions of that function to debug."}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Time travel debug information is only kept for a few days."})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"DBOS Time Travel Workflow ID picker",src:t(5155).Z+"",width:"778",height:"381"})}),"\n",(0,i.jsxs)(n.p,{children:["After selecting a recent execution of your function, the DBOS Time Travel Debugger will launch the DBOS debug runtime\nand VS Code TypeScript debugger. This allows you to debug your DBOS application against the database as it existed\nat the time the selected workflow originally executed.\nOther than using time travel database state, the debugging experience for your DBOS application is just like debugging any other TypeScript application in VS Code.\nYou can ",(0,i.jsx)(n.a,{href:"https://code.visualstudio.com/docs/editor/debugging#_breakpoints",children:"set breakpoints"}),",\n",(0,i.jsx)(n.a,{href:"https://code.visualstudio.com/docs/editor/debugging#_data-inspection",children:"inspect variables"})," and\n",(0,i.jsx)(n.a,{href:"https://code.visualstudio.com/docs/editor/debugging#_debug-actions",children:"step through your code"})," as you would expect."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"DBOS Time Travel Debugging",src:t(369).Z+"",width:"1920",height:"1126"})}),"\n",(0,i.jsx)(n.h3,{id:"time-travel-database-queries",children:"Time Travel Database Queries"}),"\n",(0,i.jsxs)(n.p,{children:["DBOS ",(0,i.jsx)(n.a,{href:"../explanations/how-workflows-work#reliability-through-recording-and-safe-re-execution",children:"records"})," every step\na DBOS application takes in the database so that it can safely re-execute the application if it is interrupted.\nThe Time Travel Debugger uses this information to project database state as it existed when a selected workflow ran.\nDevelopers can modify or even add database read queries in DBOS application transaction functions.\nWhen these updated applications are run with the time travel debugger, they return results as if they run in the past!"]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Do not add or modify database queries that write to the database such as insert/delete/update SQL statements; otherwise, the query results may be incorrect.\nDBOS will support time travel debugging functions that change how they write database state in the future."})}),"\n",(0,i.jsxs)(n.p,{children:["For example, here is an transaction function from the ",(0,i.jsx)(n.a,{href:"../tutorials/transaction-tutorial",children:"Transactions tutorial"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'export class Hello {\n  @Transaction()  // Run this function as a database transaction\n  static async helloTransaction(ctxt: TransactionContext<Knex>, user: string) {\n    // Retrieve and increment the number of times this user has been greeted.\n    const rows = await ctxt.client<dbos_hello>("dbos_hello")\n      .insert({ name: user, greet_count: 1 })\n      .onConflict("name") // If user is already present, increment greet_count.\n        .merge({ greet_count: ctxt.client.raw(\'dbos_hello.greet_count + 1\') })\n      .returning("greet_count");\n    const greet_count = rows[0].greet_count;\n    return `Hello, ${user}! You have been greeted ${greet_count} times.\\n`;\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"We can add queries to the function to retrieve past database states.\nFor example, the following code block adds queries to retrieve the user's greet count before and after it gets updated."}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Don't forget to rebuild your DBOS application with ",(0,i.jsx)(n.code,{children:"npm run build"})," before running it in the debugger."]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'export class Hello {\n\n  @Transaction()  // Run this function as a database transaction\n  static async helloTransaction(ctxt: TransactionContext<Knex>, user: string) {\n\n    const before = await ctxt.client<dbos_hello>("dbos_hello")\n        .select("greet_count")\n        .where("name", user)\n        .first();\n\n    // Retrieve and increment the number of times this user has been greeted.\n    const rows = await ctxt.client<dbos_hello>("dbos_hello")\n      .insert({ name: user, greet_count: 1 })\n      .onConflict("name") // If user is already present, increment greet_count.\n        .merge({ greet_count: ctxt.client.raw(\'dbos_hello.greet_count + 1\') })\n      .returning("greet_count");\n    const greet_count = rows[0].greet_count;\n\n    const after = await ctxt.client<dbos_hello>("dbos_hello")\n        .select("greet_count")\n        .where("name", user)\n        .first();\n\n    return `Hello, ${user}! You have been greeted ${greet_count} times.\\n`;\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"When this updated code is run in the debugger, we can inspect the new before and after variables to see past database state."}),"\n",(0,i.jsx)(n.h3,{id:"dos-and-donts",children:"Dos and Don'ts"}),"\n",(0,i.jsx)(n.p,{children:"Currently, the time travel debugger supports stepping through any past workflows and most transactions, but has a few limitations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"DBOS uses recorded outputs for communicators instead of stepping through their code, because they may contain unexpected side effects.\nFor example, this guarantees that we don't resend any emails during debugging sessions."}),"\n",(0,i.jsx)(n.li,{children:"DBOS currently uses recorded errors for aborted transactions instead of executing their queries,\nbecause database errors can be caused by non-deterministic factors (e.g., database lock contentions).\nWe will be adding support for replaying many common errors in the future -- stay tuned!"}),"\n",(0,i.jsx)(n.li,{children:"DBOS will compare debug function output to the function's originally recorded output.\nIf they do not match, the debug session will halt with an error."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"configurations",children:"Configurations"}),"\n",(0,i.jsxs)(n.p,{children:["For more information, please read the ",(0,i.jsx)(n.a,{href:"../api-reference/time-travel-debugger",children:"debugger extension reference"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"time-travel-with-dbos-sdk-cli-non-vs-code-users",children:"Time Travel with DBOS SDK CLI (Non-VS Code Users)"}),"\n",(0,i.jsx)(n.p,{children:"For non-VS Code users, you can run the time-travel debugger manually through the DBOS SDK CLI."}),"\n",(0,i.jsx)(n.h3,{id:"manual-setup",children:"Manual Setup"}),"\n",(0,i.jsx)(n.p,{children:'The time travel debugger requires our debug proxy to transform database queries so that it can "travel" back in time.\nYou can download the pre-compiled debug proxy using the following link. Please choose the one based on your operating system and hardware platform:'}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://dbos-releases.s3.us-east-2.amazonaws.com/debug-proxy/0.8.15-preview/debug-proxy-macos-x64-0.8.15-preview.zip",children:"Download for macOS (Intel Chip)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://dbos-releases.s3.us-east-2.amazonaws.com/debug-proxy/0.8.15-preview/debug-proxy-macos-arm64-0.8.15-preview.zip",children:"Download for macOS (Apple Chip)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://dbos-releases.s3.us-east-2.amazonaws.com/debug-proxy/0.8.15-preview/debug-proxy-linux-x64-0.8.15-preview.zip",children:"Download for Linux (x86_64)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://dbos-releases.s3.us-east-2.amazonaws.com/debug-proxy/0.8.15-preview/debug-proxy-linux-arm64-0.8.15-preview.zip",children:"Download for Linux (arm)"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["After downloading the file, unzip it and make the ",(0,i.jsx)(n.code,{children:"debug-proxy"})," file executable:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd <Your Download Folder>/\nchmod +x debug-proxy\n./debug-proxy -db <app database name>_dbos_prov -host <app cloud database hostname>  -password <database password> -user <database username>\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:['For macOS users, you may see a pop-up window: "\u201cdebug-proxy\u201d is an app downloaded from the Internet. Are you sure you want to open it?" Please click ',(0,i.jsx)(n.code,{children:"Open"}),"."]})}),"\n",(0,i.jsx)(n.h3,{id:"replay-a-workflow",children:"Replay a Workflow"}),"\n",(0,i.jsx)(n.p,{children:"Open another terminal window, enter your application folder, compile your code, and replay a workflow using the following commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd <Your App Folder>/\nnpm run build\nnpx dbos-sdk debug -u <workflow UUID>\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Every time you modify your code, you need to recompile it before running the ",(0,i.jsx)(n.code,{children:"dbos-sdk debug"})," command again."]})}),"\n",(0,i.jsxs)(n.p,{children:["For more information on the debug command, please see our ",(0,i.jsx)(n.a,{href:"/api-reference/cli#npx-dbos-sdk-debug",children:"references"})]})]})}function u(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},6785:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/ttdbg-code-lens-ad7bee13871d4d85ea7c5e18860ee411.png"},369:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/ttdbg-debugging-0d4c4b2452fc0693ffc063e6d79b7ccc.png"},1950:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/ttdbg-ext-install-4d4216a95f3f723f4fc17a6cd9c3c475.png"},5155:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/ttdbg-wfid-quick-pick-d8c09145eaa1aaa803831d581123cea7.png"},1151:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>s});var i=t(7294);const a={},o=i.createContext(a);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);