<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-python/prompting" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">AI Model Prompting | DBOS Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.dbos.dev/python/prompting"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AI Model Prompting | DBOS Docs"><meta data-rh="true" name="description" content="You may want assistance from an AI model in building a DBOS application."><meta data-rh="true" property="og:description" content="You may want assistance from an AI model in building a DBOS application."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.dbos.dev/python/prompting"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/python/prompting" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/python/prompting" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UY2VKOMIL2-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"AI Model Prompting","item":"https://docs.dbos.dev/python/prompting"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="DBOS Docs" href="/opensearch.xml">


<link rel="preconnect" href="https://dbosdev.matomo.cloud/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://dbosdev.matomo.cloud/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>

<link rel="preconnect" href="https://d2j9bas80r5yfz.cloudfront.net">
<script>!function(t,e){var o,r,s,a;e.__SV||(window.posthog=e,e._i=[],e.init=function(n,i,p){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(s=t.createElement("script")).type="text/javascript",s.async=!0,s.src=i.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(a=t.getElementsByTagName("script")[0]).parentNode.insertBefore(s,a);var g=e;for(void 0!==p?g=e[p]=[]:p="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==p&&(e+="."+p),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),r=0;r<o.length;r++)c(g,o[r]);e._i.push([n,i,p])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_vKGgPmFevFB3QVyqZdIZeNqcWAPqk3i3mDhwGqwk6nP",{api_host:"https://d2j9bas80r5yfz.cloudfront.net",id:"default"})</script>
<script async defer="defer" id="hs-script-loader" src="//js.hs-scripts.com/45237820.js"></script><link rel="stylesheet" href="/assets/css/styles.8102221d.css">
<script src="/assets/js/runtime~main.575ffd9b.js" defer="defer"></script>
<script src="/assets/js/main.6ff44c17.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://dbos.dev" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/quickstart">Quickstart</a><a class="navbar__item navbar__link" href="/examples">Examples</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://console.dbos.dev/login-redirect" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link dbos-button-blue">DBOS Console</a><a href="https://github.com/dbos-inc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Home</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quickstart">Get Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/why-dbos">Why DBOS?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/architecture">DBOS Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/python/programming-guide">Develop with Python</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/programming-guide">Learn DBOS Python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/integrating-dbos">Add DBOS To Your App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/python/prompting">AI Model Prompting</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/python/tutorials/workflow-tutorial">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/python/reference/dbos-class">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/python/examples/hacker-news-agent">Example Applications</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/typescript/programming-guide">Develop with TypeScript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/golang/programming-guide">Develop with Go</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/production">Deploy To Production</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/integrations/supabase">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/explanations/system-tables">Concepts and Explanations</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq">Troubleshooting &amp; FAQ</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Develop with Python</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">AI Model Prompting</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AI Model Prompting</h1></header><p>You may want assistance from an AI model in building a DBOS application.
To make sure your model has the latest information on how to use DBOS, provide it with this prompt.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-use">How To Use<a href="#how-to-use" class="hash-link" aria-label="Direct link to How To Use" title="Direct link to How To Use">​</a></h2>
<p>First, use the click-to-copy button in the top right of the code block to copy the full prompt to your clipboard.
Then, paste into your AI tool of choice (for example OpenAI&#x27;s ChatGPT or Anthropic&#x27;s Claude).
This adds the prompt to your AI model&#x27;s context, giving it up-to-date instructions on how to build an application with DBOS.</p>
<p>If you are using an AI-powered IDE, you can add this prompt to your project&#x27;s context.
For example:</p>
<ul>
<li>Claude Code: Add the prompt, or a link to it, to your CLAUDE.md file.</li>
<li>Cursor: Add the prompt to <a href="https://docs.cursor.com/context/rules-for-ai" target="_blank" rel="noopener noreferrer">your project rules</a>.</li>
<li>Zed: Copy the prompt to a file in your project, then use the <a href="https://zed.dev/docs/assistant/commands?highlight=%2Ffile#file" target="_blank" rel="noopener noreferrer"><code>/file</code></a> command to add the file to your context.</li>
<li>GitHub Copilot: Create a <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" target="_blank" rel="noopener noreferrer"><code>.github/copilot-instructions.md</code></a> file in your repository and add the prompt to it.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prompt">Prompt<a href="#prompt" class="hash-link" aria-label="Direct link to Prompt" title="Direct link to Prompt">​</a></h2>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token title important punctuation" style="color:#f8f8f2">#</span><span class="token title important"> Build Reliable Applications With DBOS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Guidelines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Respond in a friendly and concise manner</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Ask clarifying questions when requirements are ambiguous</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Generate code in Python using the DBOS library</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> You MUST import all methods and classes used in the code you generate</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> You SHALL keep all code in a single file unless otherwise specified.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> DBOS does NOT stand for anything.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Guidelines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows provide durable execution so you can write programs that are resilient to any failure.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows are comprised of steps, which are ordinary Python functions annotated with @DBOS.step().</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When using DBOS workflows, you should annotate any function that performs complex operations or accesses external APIs or services as a step. </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can turn any Python function into a step by annotating it with the @DBOS.step decorator. The only requirement is that its inputs and outputs should be serializable.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If a workflow is interrupted for any reason (e.g., an executor restarts or crashes), when your program restarts the workflow automatically resumes execution from the last completed step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> If asked to add DBOS to existing code, you MUST ask which function to make a workflow. Do NOT recommend any changes until they have told you what function to make a workflow. Do NOT make a function a workflow unless SPECIFICALLY requested.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> When making a function a workflow, you should make all functions it calls steps. Do NOT change the functions in any way except by adding the @Step annotation.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Do NOT make functions steps unless they are DIRECTLY called by a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> If the workflow function performs a non-deterministic action, you MUST move that action to its own function and make that function a step. Examples of non-deterministic actions include accessing an external API or service, accessing files on disk, generating a random number, of getting the current time.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Do NOT use threads to start workflows or to start steps in workflows. You should instead use DBOS.start_workflow and DBOS queues.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> DBOS workflows and steps should NOT have side effects in memory outside of their own scope. They can access global variables, but they should NOT create or update global variables or variables outside their scope.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Do NOT call DBOS.start_workflow or DBOS.recv from a step</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Do NOT start workflows from inside a step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Do NOT call DBOS.set_event and DBOS.recv from outside a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> DBOS Lifecycle Guidelines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Any DBOS program MUST configure the DBOS constructor at the top and MUST call DBOS.launch() in its main function.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS must always be configured like so, unless otherwise specified:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">import os</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">from dbos import DBOS, DBOSConfig</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">config: DBOSConfig = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;name&quot;: &quot;my-app&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;system_database_url&quot;: os.environ.get(&quot;DBOS_SYSTEM_DATABASE_URL&quot;),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">DBOS(config=config)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">And DBOS.launch() should always be called in the main function like so:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.launch()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">In a FastAPI application, the server should ALWAYS be started explicitly after a DBOS.launch in the main function:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.launch()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    uvicorn.run(app, host=&quot;0.0.0.0&quot;, port=8000)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If an app contains scheduled workflows and NOTHING ELSE (no HTTP server), then the main thread should block forever while the scheduled workflows run like this:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.launch()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    threading.Event().wait()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Or if using asyncio:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">import asyncio</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">from dbos import DBOS, DBOSConfig</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">config: DBOSConfig = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;name&quot;: &quot;dbos-app&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">DBOS(config=config)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">async def main():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.launch()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    await asyncio.Event().wait()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    asyncio.run(main())</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow and Steps Examples</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Simple example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">import os</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">from dbos import DBOS, DBOSConfig</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">config: DBOSConfig = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;name&quot;: &quot;dbos-starter&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;system_database_url&quot;: os.environ.get(&quot;DBOS_SYSTEM_DATABASE_URL&quot;),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">DBOS(config=config)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def step_one():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    print(&quot;Step one completed!&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def step_two():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    print(&quot;Step two completed!&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def dbos_workflow():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    step_one()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    step_two()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.launch()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    dbos_workflow()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example with FastAPI:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">import os</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">from dbos import DBOS, DBOSConfig</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">from fastapi import FastAPI</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">app = FastAPI()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">config: DBOSConfig = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;name&quot;: &quot;dbos-starter&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;system_database_url&quot;: os.environ.get(&quot;DBOS_SYSTEM_DATABASE_URL&quot;),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">DBOS(config=config, fastapi=app)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def step_one():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    print(&quot;Step one completed!&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def step_two():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    print(&quot;Step two completed!&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@app.get(&quot;/&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def dbos_workflow():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    step_one()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    step_two()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.launch()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    uvicorn.run(app, host=&quot;0.0.0.0&quot;, port=8000)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example with queues:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">import os</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">import time</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">from dbos import DBOS, DBOSConfig, Queue</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">from fastapi import FastAPI</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">app = FastAPI()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">config: DBOSConfig = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;name&quot;: &quot;dbos-starter&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;system_database_url&quot;: os.environ.get(&quot;DBOS_SYSTEM_DATABASE_URL&quot;),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">DBOS(config=config, fastapi=app)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">queue = Queue(&quot;example-queue&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def dbos_step(n: int):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    time.sleep(5)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    print(f&quot;Step {n} completed!&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@app.get(&quot;/&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def dbos_workflow():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    print(&quot;Enqueueing steps&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    handles = []</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    for i in range(10):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        handle = queue.enqueue(dbos_step, i)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        handles.append(handle)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    results = [handle.get_result() for handle in handles]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    print(f&quot;Successfully completed {len(results)} steps&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.launch()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    uvicorn.run(app, host=&quot;0.0.0.0&quot;, port=8000)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Scheduled Workflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can schedule DBOS workflows to run exactly once per time interval. To do this, annotate the workflow with the @DBOS.scheduled decorator and specify the schedule in crontab syntax. For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.scheduled(&quot;* * * * *&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def run_every_minute(scheduled_time, actual_time):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    print(f&quot;I am a scheduled workflow. It is currently {scheduled_time}.&quot;)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> A scheduled workflow MUST specify a crontab schedule.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> It MUST take in two arguments, scheduled and actual time. Both are datetime.datetimes of when the workflow started.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Documentation:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token hr punctuation" style="color:#f8f8f2">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">sidebar_position: 10</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">title: Workflows</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important">toc_max_heading_level: 3</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token title important"></span><span class="token title important punctuation" style="color:#f8f8f2">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows provide </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">durable execution</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> so you can write programs that are </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">resilient to any failure</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows help you write fault-tolerant background tasks, data processing pipelines, AI agents, and more.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can make a function a workflow by annotating it with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`@DBOS.workflow()`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows call steps, which are Python functions annotated with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`@DBOS.step()`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If a workflow is interrupted for any reason, DBOS automatically recovers its execution from the last completed step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Here&#x27;s an example of a workflow:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def step_one():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    print(&quot;Step one completed!&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def step_two():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    print(&quot;Step two completed!&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def workflow():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    step_one()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    step_two()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Starting Workflows In The Background</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">One common use-case for workflows is building reliable background tasks that keep running even when the program is interrupted, restarted, or crashes.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.start_workflow`</span><span class="token plain"> to start a workflow in the background.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you start a workflow this way, it returns a workflow handle, from which you can access information about the workflow or wait for it to complete and retrieve its result.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Here&#x27;s an example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def background_task(input):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    return output</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python"># Start the background task</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">handle: WorkflowHandle = DBOS.start_workflow(background_task, input)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python"># Wait for the background task to complete and retrieve its result.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">output = handle.get_result()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">After starting a workflow in the background, you can use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.retrieve_workflow`</span><span class="token plain"> to retrieve a workflow&#x27;s handle from its ID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can also retrieve a workflow&#x27;s handle from outside of your DBOS application with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOSClient.retrieve_workflow`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you need to run many workflows in the background and manage their concurrency or flow control, you can also use DBOS queues.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow IDs and Idempotency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Every time you execute a workflow, that execution is assigned a unique ID, by default a UUID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can access this ID through the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.workflow_id`</span><span class="token plain"> context variable.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflow IDs are useful for communicating with workflows and developing interactive workflows.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set the workflow ID of a workflow with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`SetWorkflowID`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflow IDs must be </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">globally unique</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> for your application.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">An assigned workflow ID acts as an idempotency key: if a workflow is called multiple times with the same ID, it executes only once.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is useful if your operations have side effects like making a payment or sending an email.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def example_workflow():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.logger.info(f&quot;I am a workflow with ID {DBOS.workflow_id}&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">with SetWorkflowID(&quot;very-unique-id&quot;):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    example_workflow()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Determinism</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows are in most respects normal Python functions.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">They can have loops, branches, conditionals, and so on.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">However, a workflow function must be </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">deterministic</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: if called multiple times with the same inputs, it should invoke the same steps with the same inputs in the same order (given the same return values from those steps).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you need to perform a non-deterministic operation like accessing the database, calling a third-party API, generating a random number, or getting the local time, you shouldn&#x27;t do it directly in a workflow function.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Instead, you should do all database operations in transactions and all other non-deterministic operations in steps.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">don&#x27;t do this</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def example_workflow():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    choice = random.randint(0, 1)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    if choice == 0:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        step_one()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    else:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        step_two()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Do this instead:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def generate_choice():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    return random.randint(0, 1)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def example_workflow(friend: str):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    choice = generate_choice()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    if choice == 0:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        step_one()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    else:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        step_two()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Timeouts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set a timeout for a workflow with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`SetWorkflowTimeout`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When the timeout expires, the workflow </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">and all its children</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> are cancelled.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Cancelling a workflow sets its status to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`CANCELLED`</span><span class="token plain"> and preempts its execution at the beginning of its next step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Timeouts are </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">start-to-completion</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: if a workflow is enqueued, the timeout does not begin until the workflow is dequeued and starts execution.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Also, timeouts are </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">durable</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: they are stored in the database and persist across restarts, so workflows can have very long timeouts.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example syntax:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def example_workflow():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python"># If the workflow does not complete within 10 seconds, it times out and is cancelled</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">with SetWorkflowTimeout(10):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    example_workflow()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Durable Sleep</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.sleep()`</span><span class="token plain"> to put your workflow to sleep for any period of time.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This sleep is </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">durable</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token entity named-entity">&amp;mdash;</span><span class="token plain">DBOS saves the wakeup time in the database so that even if the workflow is interrupted and restarted multiple times while sleeping, it still wakes up on schedule.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Sleeping is useful for scheduling a workflow to run in the future (even days, weeks, or months from now).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def schedule_task(time_to_sleep, task):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  # Durably sleep for some time before running the task</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  DBOS.sleep(time_to_sleep)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  run_task(task)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Debouncing Workflows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can create a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`Debouncer`</span><span class="token plain"> to debounce your workflows.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Debouncing delays workflow execution until some time has passed since the workflow has last been called.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is useful for preventing wasted work when a workflow may be triggered multiple times in quick succession.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, if a user is editing an input field, you can debounce their changes to execute a processing workflow only after they haven&#x27;t edited the field for some time:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Debouncer.create</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">Debouncer.create(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow: Callable[P, R],</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    *,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    debounce_timeout_sec: Optional[float] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    queue: Optional[Queue] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; Debouncer[P, R]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Parameters:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#66d9ef">`workflow`</span><span class="token plain">: The workflow to debounce.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debounce_key`</span><span class="token plain">: The debounce key for this debouncer. Used to group workflow executions that will be debounced. For example, if the debounce key is set to customer ID, each customer&#x27;s workflows would be debounced separately.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debounce_timeout_sec`</span><span class="token plain">: After this time elapses since the first time a workflow is submitted from this debouncer, the workflow is started regardless of the debounce period.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#66d9ef">`queue`</span><span class="token plain">: When starting a workflow after debouncing, enqueue it on this queue instead of executing it directly.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> debounce</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">debouncer.debounce(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    debounce_key: str,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    debounce_period_sec: float,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    *args: P.args,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    **kwargs: P.kwargs,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; WorkflowHandle[R]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Submit a workflow for execution but delay it by </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debounce_period_sec`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Returns a handle to the workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The workflow may be debounced again, which further delays its execution (up to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debounce_timeout_sec`</span><span class="token plain">).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When the workflow eventually executes, it uses the </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">last</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> set of inputs passed into </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debounce`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">After the workflow begins execution, the next call to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debounce`</span><span class="token plain"> starts the debouncing process again for a new workflow execution.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Parameters:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debounce_key`</span><span class="token plain">: A key used to group workflow executions that will be debounced together. For example, if the debounce key is set to customer ID, each customer&#x27;s workflows would be debounced separately.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debounce_period_sec`</span><span class="token plain">: Delay this workflow&#x27;s execution by this period.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#66d9ef">`*args`</span><span class="token plain">: Variadic workflow arguments.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#66d9ef">`**kwargs`</span><span class="token plain">: Variadic workflow keyword arguments.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Example Syntax</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def process_input(user_input):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python"># Each time a user submits a new input, debounce the process_input workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python"># The workflow will wait until 60 seconds after the user stops submitting new inputs,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">debouncer = Debouncer.create(process_input)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python"># then process the last input submitted.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def on_user_input_submit(user_id, user_input):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    debounce_key = user_id</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    debounce_period_sec = 60</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    debouncer.debounce(debounce_key, debounce_period_sec, user_input)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Debouncer.create_async</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">Debouncer.create_async(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow: Callable[P, Coroutine[Any, Any, R]],</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    *,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    debounce_timeout_sec: Optional[float] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    queue: Optional[Queue] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; Debouncer[P, R]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Async version of </span><span class="token code-snippet code keyword" style="color:#66d9ef">`Debouncer.create`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> debounce_async</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">debouncer.debounce_async(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    debounce_key: str,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    debounce_period_sec: float,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    *args: P.args,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    **kwargs: P.kwargs,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; WorkflowHandleAsync[R]:</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Async version of </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debouncer.debounce`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Coroutine (Async) Workflows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Coroutinues (functions defined with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`async def`</span><span class="token plain">, also known as async functions) can also be DBOS workflows.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Coroutine workflows may invoke coroutine steps via await expressions.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You should start coroutine workflows using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.start_workflow_async`</span><span class="token plain"> and enqueue them using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`enqueue_async`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Calling a coroutine workflow or starting it with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.start_workflow_async`</span><span class="token plain"> always runs it in the same event loop as its caller, but enqueueing it with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`enqueue_async`</span><span class="token plain"> starts the workflow in a different event loop.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Additionally, coroutine workflows should use the asynchronous versions of the workflow communication context methods.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::tip</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">At this time, DBOS does not support coroutine transactions.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To execute transaction functions without blocking the event loop, use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`asyncio.to_thread`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">async def example_step():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    async with aiohttp.ClientSession() as session:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        async with session.get(&quot;https://example.com&quot;) as response:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">            return await response.text()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">async def example_workflow(friend: str):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    await DBOS.sleep_async(10)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    body = await example_step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    result = await asyncio.to_thread(example_transaction, body)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    return result</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Versioning and Recovery</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Because DBOS recovers workflows by re-executing them using information saved in the database, a workflow cannot safely be recovered if its code has changed since the workflow was started.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To guard against this, DBOS </span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token italic content">versions</span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token plain"> applications and their workflows.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When DBOS is launched, it computes an application version from a hash of the source code of its workflows (this can be overridden through the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`application_version`</span><span class="token plain">) configuration parameter.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">All workflows are tagged with the application version on which they started.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When DBOS tries to recover workflows, it only recovers workflows whose version matches the current application version.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This prevents unsafe recovery of workflows that depend on different code.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You cannot change the version of a workflow, but you can use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.fork_workflow`</span><span class="token plain"> to restart a workflow from a specific step on a specific code version.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Communicating with Workflows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS provides a few different ways to communicate with your workflows.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Send messages to workflows</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Publish events from workflows for clients to read</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Stream values from workflows to clients</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Messaging and Notifications</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can send messages to a specific workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is useful for signaling a workflow or sending notifications to it while it&#x27;s running.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Send</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.send(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    destination_id: str,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    message: Any,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    topic: Optional[str] = None</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; None</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.send()`</span><span class="token plain"> to send a message to a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Messages can optionally be associated with a topic and are queued on the receiver per topic.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can also call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`send`</span><span class="token plain"> from outside of your DBOS application with the DBOS Client.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Recv</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.recv(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    topic: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    timeout_seconds: float = 60,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; Any</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows can call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.recv()`</span><span class="token plain"> to receive messages sent to them, optionally for a particular topic.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Each call to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`recv()`</span><span class="token plain"> waits for and consumes the next message to arrive in the queue for the specified topic, returning </span><span class="token code-snippet code keyword" style="color:#66d9ef">`None`</span><span class="token plain"> if the wait times out.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If the topic is not specified, this method only receives messages sent without a topic.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Messages Example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Messages are especially useful for sending notifications to a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, in the widget store demo, the checkout workflow, after redirecting customers to a payments page, must wait for a notification that the user has paid.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To wait for this notification, the payments workflow uses </span><span class="token code-snippet code keyword" style="color:#66d9ef">`recv()`</span><span class="token plain">, executing failure-handling code if the notification doesn&#x27;t arrive in time:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def checkout_workflow():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  ... # Validate the order, then redirect customers to a payments service.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  payment_status = DBOS.recv(PAYMENT_STATUS)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  if payment_status is not None and payment_status == &quot;paid&quot;:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">      ... # Handle a successful payment.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  else:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">      ... # Handle a failed payment or timeout.</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">An endpoint waits for the payment processor to send the notification, then uses </span><span class="token code-snippet code keyword" style="color:#66d9ef">`send()`</span><span class="token plain"> to forward it to the workflow:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@app.post(&quot;/payment_webhook/{workflow_id}/{payment_status}&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def payment_endpoint(payment_id: str, payment_status: str) -&gt; Response:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # Send the payment status to the checkout workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.send(payment_id, payment_status, PAYMENT_STATUS)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Reliability Guarantees</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">All messages are persisted to the database, so if </span><span class="token code-snippet code keyword" style="color:#66d9ef">`send`</span><span class="token plain"> completes successfully, the destination workflow is guaranteed to be able to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`recv`</span><span class="token plain"> it.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you&#x27;re sending a message from a workflow, DBOS guarantees exactly-once delivery.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you&#x27;re sending a message from normal Python code, you can use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`SetWorkflowID`</span><span class="token plain"> with an idempotency key to guarantee exactly-once delivery.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows can publish </span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token italic content">events</span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token plain">, which are key-value pairs associated with the workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">They are useful for publishing information about the status of a workflow or to send a result to clients while the workflow is running.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> set_event</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.set_event(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    key: str,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    value: Any,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; None</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Any workflow or step can call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.set_event`</span><span class="token plain"> to publish a key-value pair, or update its value if has already been published.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> get_event</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.get_event(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow_id: str,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    key: str,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    timeout_seconds: float = 60,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; None</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.get_event`</span><span class="token plain"> to retrieve the value published by a particular workflow identity for a particular key.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If the event does not yet exist, this call waits for it to be published, returning </span><span class="token code-snippet code keyword" style="color:#66d9ef">`None`</span><span class="token plain"> if the wait times out.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can also call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`get_event`</span><span class="token plain"> from outside of your DBOS application with DBOS Client.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> get_all_events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.get_all_events(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow_id: str</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; Dict[str, Any]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.get_all_events`</span><span class="token plain"> to retrieve the latest values of all events published by a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Events Example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Events are especially useful for writing interactive workflows that communicate information to their caller.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, in the widget store demo, the checkout workflow, after validating an order, needs to send the customer a unique payment ID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To communicate the payment ID to the customer, it uses events.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The payments workflow emits the payment ID using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`set_event()`</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def checkout_workflow():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    payment_id = ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    dbos.set_event(PAYMENT_ID, payment_id)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    ...</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The FastAPI handler that originally started the workflow uses </span><span class="token code-snippet code keyword" style="color:#66d9ef">`get_event()`</span><span class="token plain"> to await this payment ID, then returns it:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@app.post(&quot;/checkout/{idempotency_key}&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def checkout_endpoint(idempotency_key: str) -&gt; Response:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # Idempotently start the checkout workflow in the background.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    with SetWorkflowID(idempotency_key):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        handle = DBOS.start_workflow(checkout_workflow)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # Wait for the checkout workflow to send a payment ID, then return it.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    payment_id = DBOS.get_event(handle.workflow_id, PAYMENT_ID)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    if payment_id is None:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        raise HTTPException(status_code=404, detail=&quot;Checkout failed to start&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    return Response(payment_id)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Reliability Guarantees</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">All events are persisted to the database, so the latest version of an event is always retrievable.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Additionally, if </span><span class="token code-snippet code keyword" style="color:#66d9ef">`get_event`</span><span class="token plain"> is called in a workflow, the retrieved value is persisted in the database so workflow recovery can use that value, even if the event is later updated.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Streaming</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows can stream data in real time to clients.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is useful for streaming results from a long-running workflow or LLM call or for monitoring or progress reporting.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">&lt;img src={require(&#x27;@site/static/img/workflow-communication/workflow-streams.png&#x27;).default} alt=&quot;DBOS Steps&quot; width=&quot;750&quot; className=&quot;custom-img&quot;/&gt;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Writing to Streams</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.write_stream(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    key: str, </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    value: Any</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; None:</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can write values to a stream from a workflow or its steps using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.write_stream`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">A workflow may have any number of streams, each identified by a unique key.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When you are done writing to a stream, you should close it with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.close_stream`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Otherwise, streams are automatically closed when the workflow terminates.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.close_stream(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    key: str</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; None</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS streams are immutable and append-only.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Writes to a stream from a workflow happen exactly-once.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Writes to a stream from a step happen at-least-once; if a step fails and is retried, it may write to the stream multiple times.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Readers will see all values written to the stream from all tries of the step in the order in which they were written.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Example syntax:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def producer_workflow():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.write_stream(example_key, {&quot;step&quot;: 1, &quot;data&quot;: &quot;value1&quot;})</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.write_stream(example_key, {&quot;step&quot;: 2, &quot;data&quot;: &quot;value2&quot;})</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.close_stream(example_key)  # Signal completion</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Reading from Streams</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.read_stream(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow_id: str,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    key: str</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; Generator[Any, Any, None]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can read values from a stream from anywhere using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.read_stream`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This function reads values from a stream identified by a workflow ID and key, yielding each value in order until the stream is closed or the workflow terminates.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can also read from a stream from outside a DBOS application with a DBOS Client.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Example syntax:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">for value in DBOS.read_stream(workflow_id, example_key):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    print(f&quot;Received: {value}&quot;)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Configurable Retries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can optionally configure a step to automatically retry any exception a set number of times with exponential backoff.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is useful for automatically handling transient failures, like making requests to unreliable APIs.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retries are configurable through arguments to the step decorator:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.step(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    retries_allowed: bool = False,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    interval_seconds: float = 1.0,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    max_attempts: int = 3,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    backoff_rate: float = 2.0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, we configure this step to retry exceptions (such as if </span><span class="token code-snippet code keyword" style="color:#66d9ef">`example.com`</span><span class="token plain"> is temporarily down) up to 10 times:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.step(retries_allowed=True, max_attempts=10)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def example_step():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    return requests.get(&quot;https://example.com&quot;).text</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> DBOS Queues</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use queues to run many workflows at once with managed concurrency.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Queues provide </span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token italic content">flow control</span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token plain">, letting you manage how many workflows run at once or how often workflows are started.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To create a queue, specify its name:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">from dbos import Queue</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">queue = Queue(&quot;example_queue&quot;)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can then enqueue any DBOS workflow or step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Enqueuing a function submits it for execution and returns a handle to it.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Queued tasks are started in first-in, first-out (FIFO) order.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">queue = Queue(&quot;example_queue&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def process_task(task):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">task = ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">handle = queue.enqueue(process_task, task)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Queue Example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Here&#x27;s an example of a workflow using a queue to process tasks concurrently:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">from dbos import DBOS, Queue</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">queue = Queue(&quot;example_queue&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def process_task(task):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def process_tasks(tasks):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  task_handles = []</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  # Enqueue each task so all tasks are processed concurrently.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  for task in tasks:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    handle = queue.enqueue(process_task, task)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    task_handles.append(handle)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  # Wait for each task to complete and retrieve its result.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  # Return the results of all tasks.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  return [handle.get_result() for handle in task_handles]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Enqueueing from Another Application</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Often, you want to enqueue a workflow from outside your DBOS application.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, let&#x27;s say you have an API server and a data processing service.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You&#x27;re using DBOS to build a durable data pipeline in the data processing service.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When the API server receives a request, it should enqueue the data pipeline for execution on the data processing service.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use the DBOS Client to enqueue workflows from outside your DBOS application by connecting directly to your DBOS application&#x27;s system database.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Since the DBOS Client is designed to be used from outside your DBOS application, workflow and queue metadata must be specified explicitly.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this code enqueues the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`data_pipeline`</span><span class="token plain"> workflow on the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`pipeline_queue`</span><span class="token plain"> queue with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`task`</span><span class="token plain"> as an argument.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">from dbos import DBOSClient, EnqueueOptions</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">client = DBOSClient(system_database_url=os.environ[&quot;DBOS_SYSTEM_DATABASE_URL&quot;])</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">options: EnqueueOptions = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  &quot;queue_name&quot;: &quot;pipeline_queue&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  &quot;workflow_name&quot;: &quot;data_pipeline&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">handle = client.enqueue(options, task)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">result = handle.get_result()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Managing Concurrency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can control how many workflows from a queue run simultaneously by configuring concurrency limits.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This helps prevent resource exhaustion when workflows consume significant memory or processing power.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> Worker Concurrency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Worker concurrency sets the maximum number of workflows from a queue that can run concurrently on a single DBOS process.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is particularly useful for resource-intensive workflows to avoid exhausting the resources of any process.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this queue has a worker concurrency of 5, so each process will run at most 5 workflows from this queue simultaneously:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">from dbos import Queue</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">queue = Queue(&quot;example_queue&quot;, worker_concurrency=5)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> Global Concurrency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Global concurrency limits the total number of workflows from a queue that can run concurrently across all DBOS processes in your application.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this queue will have a maximum of 10 workflows running simultaneously across your entire application.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::warning</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Worker concurrency limits are recommended for most use cases.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Take care when using a global concurrency limit as any </span><span class="token code-snippet code keyword" style="color:#66d9ef">`PENDING`</span><span class="token plain"> workflow on the queue counts toward the limit, including workflows from previous application versions</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">from dbos import Queue</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">queue = Queue(&quot;example_queue&quot;, concurrency=10)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> In-Order Processing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use a queue with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`concurrency=1`</span><span class="token plain"> to guarantee sequential, in-order processing of events.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Only a single event will be processed at a time.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this app processes events sequentially in the order of their arrival:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"> ```python</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">from fastapi import FastAPI</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">from dbos import DBOS, Queue</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">app = FastAPI()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS(fastapi=app)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">queue = Queue(&quot;in_order_queue&quot;, concurrency=1)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">@DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">def process_event(event: str):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">@app.post(&quot;/events/{event}&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">def event_endpoint(event: str):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    queue.enqueue(process_event, event)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"> ```</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Rate Limiting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set </span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token italic content">rate limits</span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token plain"> for a queue, limiting the number of functions that it can start in a given period.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Rate limits are global across all DBOS processes using this queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this queue has a limit of 50 with a period of 30 seconds, so it may not start more than 50 functions in 30 seconds:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">queue = Queue(&quot;example_queue&quot;, limiter={&quot;limit&quot;: 50, &quot;period&quot;: 30})</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Rate limits are especially useful when working with a rate-limited API, such as many LLM APIs.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Setting Timeouts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set a timeout for an enqueued workflow with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`SetWorkflowTimeout`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When the timeout expires, the workflow </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">and all its children</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> are cancelled.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Cancelling a workflow sets its status to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`CANCELLED`</span><span class="token plain"> and preempts its execution at the beginning of its next step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Timeouts are </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">start-to-completion</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: a workflow&#x27;s timeout does not begin until the workflow is dequeued and starts execution.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Also, timeouts are </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">durable</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: they are stored in the database and persist across restarts, so workflows can have very long timeouts.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example syntax:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def example_workflow():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">queue = Queue(&quot;example-queue&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python"># If the workflow does not complete within 10 seconds after being dequeued, it times out and is cancelled</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">with SetWorkflowTimeout(10):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    queue.enqueue(example_workflow)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Partitioning Queues</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">partition</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> queues to distribute work across dynamically created queue partitions.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When you enqueue a workflow on a partitioned queue, you must supply a queue partition key.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Partitioned queues dequeue workflows and apply flow control limits for individual partitions, not for the entire queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Essentially, you can think of each partition as a &quot;subqueue&quot; you dynamically create by enqueueing a workflow with a partition key.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, suppose you want your users to each be able to run at most one task at a time.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can do this with a partitioned queue with a maximum concurrency limit of 1 where the partition key is user ID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Example Syntax</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">queue = Queue(&quot;partitioned_queue&quot;, partition_queue=True, concurrency=1)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def process_task(task: Task):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def on_user_task_submission(user_id: str, task: Task):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # Partition the task queue by user ID. As the queue has a</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # maximum concurrency of 1, this means that at most one</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # task can run at once per user (but tasks from different</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # users can run concurrently).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    with SetEnqueueOptions(queue_partition_key=user_id):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        queue.enqueue(process_task, task)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Deduplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set a deduplication ID for an enqueued workflow with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`SetEnqueueOptions`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">At any given time, only one workflow with a specific deduplication ID can be enqueued in the specified queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If a workflow with a deduplication ID is currently enqueued or actively executing (status </span><span class="token code-snippet code keyword" style="color:#66d9ef">`ENQUEUED`</span><span class="token plain"> or </span><span class="token code-snippet code keyword" style="color:#66d9ef">`PENDING`</span><span class="token plain">), subsequent workflow enqueue attempt with the same deduplication ID in the same queue will raise a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOSQueueDeduplicatedError`</span><span class="token plain"> exception.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this is useful if you only want to have one workflow active at a time per user</span><span class="token entity named-entity">&amp;mdash;</span><span class="token plain">set the deduplication ID to the user&#x27;s ID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example syntax:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">from dbos import DBOS, Queue, SetEnqueueOptions</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">from dbos import error as dboserror</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">queue = Queue(&quot;example_queue&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">with SetEnqueueOptions(deduplication_id=&quot;my_dedup_id&quot;):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    try:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        handle = queue.enqueue(example_workflow, ...)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    except dboserror.DBOSQueueDeduplicatedError as e:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        # Handle deduplication error</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Priority</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set a priority for an enqueued workflow with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`SetEnqueueOptions`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows with the same priority are dequeued in </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">FIFO (first in, first out)</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> order. Priority values can range from </span><span class="token code-snippet code keyword" style="color:#66d9ef">`1`</span><span class="token plain"> to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`2,147,483,647`</span><span class="token plain">, where </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">a low number indicates a higher priority</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If using priority, you must set </span><span class="token code-snippet code keyword" style="color:#66d9ef">`priority_enabled=True`</span><span class="token plain"> on your queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::tip</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows without assigned priorities have the highest priority and are dequeued before workflows with assigned priorities.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example syntax:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">queue = Queue(&quot;priority_queue&quot;, priority_enabled=True)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">with SetEnqueueOptions(priority=10):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # All workflows are enqueued with priority set to 10</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # They will be dequeued in FIFO order</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    for task in tasks:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        queue.enqueue(task_workflow, task)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python"># first_workflow (priority=1) will be dequeued before all task_workflows (priority=10)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">with SetEnqueueOptions(priority=1):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    queue.enqueue(first_workflow)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Python Classes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can add DBOS decorators to your Python class instance methods.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can add step decorators to any class methods, but to add a workflow decorator to a class method, its class must inherit from </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOSConfiguredInstance`</span><span class="token plain"> and must be decorated with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`@DBOS.dbos_class`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.dbos_class()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">class URLFetcher(DBOSConfiguredInstance):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    def __init__(self, url: str):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        self.url = url</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        super().__init__(config_name=url)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    @DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    def fetch_workflow(self):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        return self.fetch_url()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    @DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    def fetch_url(self):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        return requests.get(self.url).text</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">example_fetcher = URLFetcher(&quot;https://example.com&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">print(example_fetcher.fetch_workflow())</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When you create a new instance of a DBOS class,  </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOSConfiguredInstance`</span><span class="token plain"> must be instantiated with a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`config_name`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This </span><span class="token code-snippet code keyword" style="color:#66d9ef">`config_name`</span><span class="token plain"> should be a unique identifier of the instance.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Additionally, all DBOS-decorated classes must be instantiated before </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.launch()`</span><span class="token plain"> is called.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The reason for these requirements is to enable workflow recovery.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When you create a new instance of a DBOS class, DBOS stores it in a global registry indexed by </span><span class="token code-snippet code keyword" style="color:#66d9ef">`config_name`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When DBOS needs to recover a workflow belonging to that class, it looks up the class instance using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`config_name`</span><span class="token plain"> so it can run the workflow using the right instance of its class.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If </span><span class="token code-snippet code keyword" style="color:#66d9ef">`config_name`</span><span class="token plain"> is not supplied, or if DBOS classes are dynamically instantiated after </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.launch()`</span><span class="token plain">, then DBOS may not find the class instance it needs to recover a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Testing DBOS Functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Unless otherwise specified, recommend testing DBOS applications with pytest.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You MUST use this fixture to reset DBOS between tests:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@pytest.fixture()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def reset_dbos():</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.destroy()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    config: DBOSConfig = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        &quot;name&quot;: &quot;my-app&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        &quot;database_url&quot;: os.environ.get(&quot;TESTING_DATABASE_URL&quot;),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS(config=config)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.reset_system_database()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.launch()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Handle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS.start_workflow, DBOS.retrieve_workflow, and enqueue return workflow handles.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> get_workflow_id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">handle.get_workflow_id() -&gt; str</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retrieve the ID of the workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> get_result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">handle.get_result() -&gt; R</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Wait for the workflow to complete, then return its result.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> get_status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">handle.get_status() -&gt; WorkflowStatus</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Management Methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> list_workflows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">def list_workflows(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    *,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow_ids: Optional[List[str]] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    status: Optional[str | list[str]] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    start_time: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    end_time: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    name: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    app_version: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    user: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    limit: Optional[int] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    offset: Optional[int] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    sort_desc: bool = False,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow_id_prefix: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; List[WorkflowStatus]:</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retrieve a list of </span><span class="token code-snippet code keyword" style="color:#66d9ef">`WorkflowStatus`</span><span class="token plain"> of all workflows matching specified criteria.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Parameters:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">workflow_ids</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows with these IDs.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">workflow_id_prefix</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows whose IDs start with the specified string.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">status</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows with this status (or one of these statuses) (Must be </span><span class="token code-snippet code keyword" style="color:#66d9ef">`ENQUEUED`</span><span class="token plain">, </span><span class="token code-snippet code keyword" style="color:#66d9ef">`PENDING`</span><span class="token plain">, </span><span class="token code-snippet code keyword" style="color:#66d9ef">`SUCCESS`</span><span class="token plain">, </span><span class="token code-snippet code keyword" style="color:#66d9ef">`ERROR`</span><span class="token plain">, </span><span class="token code-snippet code keyword" style="color:#66d9ef">`CANCELLED`</span><span class="token plain">, or </span><span class="token code-snippet code keyword" style="color:#66d9ef">`MAX_RECOVERY_ATTEMPTS_EXCEEDED`</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">start_time</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows started after this (RFC 3339-compliant) timestamp.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">end_time</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows started before this (RFC 3339-compliant) timestamp.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows with this fully-qualified name.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">app_version</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows tagged with this application version.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">user</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows run by this authenticated user.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">limit</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve up to this many workflows.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">offset</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Skip this many workflows from the results returned (for pagination).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">sort_desc</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Whether to sort the results in descending (</span><span class="token code-snippet code keyword" style="color:#66d9ef">`True`</span><span class="token plain">) or ascending (</span><span class="token code-snippet code keyword" style="color:#66d9ef">`False`</span><span class="token plain">) order by workflow start time.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> list_queued_workflows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">def list_queued_workflows(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    *,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    queue_name: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    status: Optional[str | list[str]] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    start_time: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    end_time: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    name: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    limit: Optional[int] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    offset: Optional[int] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    sort_desc: bool = False,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; List[WorkflowStatus]:</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retrieve a list of </span><span class="token code-snippet code keyword" style="color:#66d9ef">`WorkflowStatus`</span><span class="token plain"> of all </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">currently enqueued</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> workflows matching specified criteria.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Parameters:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">queue_name</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows running on this queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">status</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows with this status (or one of these statuses) (Must be </span><span class="token code-snippet code keyword" style="color:#66d9ef">`ENQUEUED`</span><span class="token plain"> or </span><span class="token code-snippet code keyword" style="color:#66d9ef">`PENDING`</span><span class="token plain">)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">start_time</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows enqueued after this (RFC 3339-compliant) timestamp.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">end_time</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows enqueued before this (RFC 3339-compliant) timestamp.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve workflows with this fully-qualified name.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">limit</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Retrieve up to this many workflows.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">offset</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Skip this many workflows from the results returned (for pagination).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> list_workflow_steps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">def list_workflow_steps(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow_id: str,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; List[StepInfo]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retrieve the steps of a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is a list of </span><span class="token code-snippet code keyword" style="color:#66d9ef">`StepInfo`</span><span class="token plain"> objects, with the following structure:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">class StepInfo(TypedDict):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The unique ID of the step in the workflow. One-indexed.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    function_id: int</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The (fully qualified) name of the step</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    function_name: str</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The step&#x27;s output, if any</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    output: Optional[Any]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The error the step threw, if any</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    error: Optional[Exception]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # If the step starts or retrieves the result of a workflow, its ID</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    child_workflow_id: Optional[str]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> cancel_workflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.cancel_workflow(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow_id: str,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; None</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Cancel a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This sets is status to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`CANCELLED`</span><span class="token plain">, removes it from its queue (if it is enqueued) and preempts its execution (interrupting it at the beginning of its next step)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> resume_workflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.resume_workflow(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow_id: str</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; WorkflowHandle[R]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Resume a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This immediately starts it from its last completed step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use this to resume workflows that are cancelled or have exceeded their maximum recovery attempts.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can also use this to start an enqueued workflow immediately, bypassing its queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> fork_workflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">DBOS.fork_workflow(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow_id: str,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    start_step: int,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    *,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    application_version: Optional[str] = None,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">) -&gt; WorkflowHandle[R]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Start a new execution of a workflow from a specific step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The input step ID must match the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`function_id`</span><span class="token plain"> of the step returned by </span><span class="token code-snippet code keyword" style="color:#66d9ef">`list_workflow_steps`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The specified </span><span class="token code-snippet code keyword" style="color:#66d9ef">`start_step`</span><span class="token plain"> is the step from which the new workflow will start, so any steps whose ID is less than </span><span class="token code-snippet code keyword" style="color:#66d9ef">`start_step`</span><span class="token plain"> will not be re-executed.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The forked workflow will have a new workflow ID, which can be set with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`SetWorkflowID`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">It is possible to specify the application version on which the forked workflow will run by setting </span><span class="token code-snippet code keyword" style="color:#66d9ef">`application_version`</span><span class="token plain">, this is useful for &quot;patching&quot; workflows that failed due to a bug in a previous application version.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Workflow Status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Some workflow introspection and management methods return a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`WorkflowStatus`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This object has the following definition:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">class WorkflowStatus:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The workflow ID</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    workflow_id: str</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The workflow status. Must be one of ENQUEUED, PENDING, SUCCESS, ERROR, CANCELLED, or MAX_RECOVERY_ATTEMPTS_EXCEEDED</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    status: str</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The name of the workflow function</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    name: str</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The number of times this workflow has been started</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    recovery_attempts: int</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The name of the workflow&#x27;s class, if any</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    class_name: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The name with which the workflow&#x27;s class instance was configured, if any</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    config_name: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The user who ran the workflow, if specified</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    authenticated_user: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The role with which the workflow ran, if specified</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    assumed_role: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # All roles which the authenticated user could assume</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    authenticated_roles: Optional[list[str]]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The deserialized workflow input object</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    input: Optional[WorkflowInputs]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The workflow&#x27;s output, if any</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    output: Optional[Any]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The error the workflow threw, if any</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    error: Optional[Exception]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # Workflow start time, as a Unix epoch timestamp in ms</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    created_at: Optional[int]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # Last time the workflow status was updated, as a Unix epoch timestamp in ms</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    updated_at: Optional[int]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # If this workflow was enqueued, on which queue</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    queue_name: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The ID of the executor (process) that most recently executed this workflow</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    executor_id: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # The application version on which this workflow was started</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    app_version: Optional[str]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retrieve the workflow status:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Configuring DBOS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To configure DBOS, pass a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOSConfig`</span><span class="token plain"> object to its constructor.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">config: DBOSConfig = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;name&quot;: &quot;dbos-example&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;system_database_url&quot;: os.environ[&quot;DBOS_SYSTEM_DATABASE_URL&quot;],</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">DBOS(config=config)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOSConfig`</span><span class="token plain"> object has the following fields.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">All fields except </span><span class="token code-snippet code keyword" style="color:#66d9ef">`name`</span><span class="token plain"> are optional.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">class DBOSConfig(TypedDict):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    name: str</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    system_database_url: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    application_database_url: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    sys_db_pool_size: Optional[int]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    db_engine_kwargs: Optional[Dict[str, Any]]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    dbos_system_schema: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    system_database_engine: Optional[sqlalchemy.Engine]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    conductor_key: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    enable_otlp: Optional[bool]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    otlp_traces_endpoints: Optional[List[str]]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    otlp_logs_endpoints: Optional[List[str]]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    otlp_attributes: Optional[dict[str, str]]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    log_level: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    run_admin_server: Optional[bool]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    admin_port: Optional[int]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    application_version: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    executor_id: Optional[str]</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    serializer: Optional[Serializer]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Your application&#x27;s name.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">system_database_url</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: A connection string to your system database.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is the database in which DBOS stores workflow and step state.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This may be either Postgres or SQLite, though Postgres is recommended for production.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS uses this connection string, unmodified, to create a SQLAlchemy Engine</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">A valid connection string looks like:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block">postgresql://[username]:[password]@[hostname]:[port]/[database name]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Or with SQLite:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block">sqlite:///[path to database file]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::info</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Passwords in connection strings must be escaped (for example with urllib) if they contain special characters.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If no connection string is provided, DBOS uses a SQLite database:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">shell</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-shell">sqlite:///[application_name].sqlite</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">application_database_url</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: A connection string to your application database.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is the database in which DBOS executes </span><span class="token code-snippet code keyword" style="color:#66d9ef">`@DBOS.transaction`</span><span class="token plain"> functions.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This parameter has the same format and default as </span><span class="token code-snippet code keyword" style="color:#66d9ef">`system_database_url`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you are not using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`@DBOS.transaction`</span><span class="token plain">, you do not need to supply this parameter.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">db_engine_kwargs</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Additional keyword arguments passed to SQLAlchemy’s </span><span class="token code-snippet code keyword" style="color:#66d9ef">`create_engine()`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Defaults to:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">{</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  &quot;pool_size&quot;: 20,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  &quot;max_overflow&quot;: 0,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">  &quot;pool_timeout&quot;: 30,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">sys_db_pool_size</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: The size of the connection pool used for the DBOS system database. Defaults to 20.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">dbos_system_schema</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Postgres schema name for DBOS system tables. Defaults to &quot;dbos&quot;.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">system_database_engine</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: A custom SQLAlchemy engine to use to connect to your system database. If provided, DBOS will not create an engine but use this instead.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">conductor_key</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: An API key for DBOS Conductor. If provided, application is connected to Conductor. API keys can be created from the DBOS console.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">enable_otlp</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Enable DBOS OpenTelemetry tracing and export. Defaults to False.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">otlp_traces_endpoints</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: DBOS operations automatically generate OpenTelemetry Traces. Use this field to declare a list of OTLP-compatible trace receivers. Requires </span><span class="token code-snippet code keyword" style="color:#66d9ef">`enable_otlp`</span><span class="token plain"> to be True.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">otlp_logs_endpoints</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: the DBOS logger can export OTLP-formatted log signals. Use this field to declare a list of OTLP-compatible log receivers. Requires </span><span class="token code-snippet code keyword" style="color:#66d9ef">`enable_otlp`</span><span class="token plain"> to be True.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">otlp_attributes</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: A set of attributes (key-value pairs) to apply to all OTLP-exported logs and traces.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">log_level</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Configure the DBOS logger severity. Defaults to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`INFO`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">run_admin_server</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Whether to run an HTTP admin server for workflow management operations. Defaults to True.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">admin_port</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: The port on which the admin server runs. Defaults to 3001.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">application_version</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: The code version for this application and its workflows. Workflow versioning is documented here.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">executor_id</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Executor ID, used to identify the application instance in distributed environments. It is also useful for distributed workflow recovery</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">serializer</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: A custom serializer for the system database.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> Custom Serialization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS must serialize data such as workflow inputs and outputs and step outputs to store it in the system database.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">By default, data is serialized with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`pickle`</span><span class="token plain"> then Base64-encoded, but you can optionally supply a custom serializer through DBOS configuration.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">A custom serializer must match this interface:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">class Serializer(ABC):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    @abstractmethod</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    def serialize(self, data: Any) -&gt; str:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        pass</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    @abstractmethod</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    def deserialize(cls, serialized_data: str) -&gt; Any:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        pass</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, here is how to configure DBOS to use a JSON serializer:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">from dbos import DBOS, DBOSConfig, Serializer</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">class JsonSerializer(Serializer):</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    def serialize(self, data: Any) -&gt; str:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        return json.dumps(data)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    def deserialize(cls, serialized_data: str) -&gt; Any:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        return json.loads(serialized_data)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">serializer = JsonSerializer()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">config: DBOSConfig = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;name&quot;: &quot;dbos-starter&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;system_database_url&quot;: os.environ.get(&quot;DBOS_SYSTEM_DATABASE_URL&quot;),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;serializer&quot;: serializer</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">DBOS(config=config)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">DBOS.launch()</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Transactions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Transactions are a special type of step that are optimized for database accesses.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">They execute as a single database transaction.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ONLY use transactions if you are SPECIFICALLY requested to perform database operations, DO NOT USE THEM OTHERWISE.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If asked to add DBOS to code that already contains database operations, ALWAYS make it a step, do NOT attempt to make it a transaction unless requested.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ONLY use transactions with a Postgres database.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To access any other database, ALWAYS use steps.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To make a Python function a transaction, annotate it with the DBOS.transaction decorator.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Then, access the database using the DBOS.sql_session client, which is a SQLAlchemy client DBOS automatically connects to your database.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Here are some examples:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> SQLAlchemy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">greetings = Table(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    &quot;greetings&quot;, </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    MetaData(), </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    Column(&quot;name&quot;, String), </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    Column(&quot;note&quot;, String)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.transaction()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def example_insert(name: str, note: str) -&gt; None:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # Insert a new greeting into the database</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.sql_session.execute(greetings.insert().values(name=name, note=note))</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.transaction()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def example_select(name: str) -&gt; Optional[str]:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # Select the first greeting to a particular name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    row = DBOS.sql_session.execute(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">        select(greetings.c.note).where(greetings.c.name == name)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    ).first()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    return row[0] if row else None</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> Raw SQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">python</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-python">@DBOS.transaction()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def example_insert(name: str, note: str) -&gt; None:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # Insert a new greeting into the database</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    sql = text(&quot;INSERT INTO greetings (name, note) VALUES (:name, :note)&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    DBOS.sql_session.execute(sql, {&quot;name&quot;: name, &quot;note&quot;: note})</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">@DBOS.transaction()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">def example_select(name: str) -&gt; Optional[str]:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    # Select the first greeting to a particular name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    sql = text(&quot;SELECT note FROM greetings WHERE name = :name LIMIT 1&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    row = DBOS.sql_session.execute(sql, {&quot;name&quot;: name}).first()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-python">    return row[0] if row else None</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">NEVER async def a transaction.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/python/integrating-dbos"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Add DBOS To Your App</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/python/tutorials/workflow-tutorial"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Workflows</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-to-use" class="table-of-contents__link toc-highlight">How To Use</a></li><li><a href="#prompt" class="table-of-contents__link toc-highlight">Prompt</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Follow Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/dbos-inc/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://bsky.app/profile/dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bluesky<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/DBOS_Inc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter/X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.dbos.dev/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.dbos.dev/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Questions or Comments?</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/fMwQjeW5zg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat with us on Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:contact@dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Write to us at contact@dbos.dev<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://dbos.dev" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="100"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="100"></a></div><div class="footer__copyright">Copyright © 2025 DBOS, Inc. | <a href="https://www.dbos.dev/privacy" target="_blank">Privacy Policy</a></div></div></div></footer></div>
</body>
</html>