<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-typescript/reference/plugins" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">DBOS Plugin Architecture | DBOS Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.dbos.dev/typescript/reference/plugins"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="DBOS Plugin Architecture | DBOS Docs"><meta data-rh="true" name="description" content="Unless you intend to extend the DBOS Transact library, you can ignore this topic."><meta data-rh="true" property="og:description" content="Unless you intend to extend the DBOS Transact library, you can ignore this topic."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.dbos.dev/typescript/reference/plugins"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/typescript/reference/plugins" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/typescript/reference/plugins" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UY2VKOMIL2-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"DBOS Plugin Architecture","item":"https://docs.dbos.dev/typescript/reference/plugins"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="DBOS Docs" href="/opensearch.xml">


<link rel="preconnect" href="https://dbosdev.matomo.cloud/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://dbosdev.matomo.cloud/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>

<link rel="preconnect" href="https://d2j9bas80r5yfz.cloudfront.net">
<script>!function(t,e){var o,r,s,a;e.__SV||(window.posthog=e,e._i=[],e.init=function(n,i,p){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(s=t.createElement("script")).type="text/javascript",s.async=!0,s.src=i.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(a=t.getElementsByTagName("script")[0]).parentNode.insertBefore(s,a);var g=e;for(void 0!==p?g=e[p]=[]:p="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==p&&(e+="."+p),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),r=0;r<o.length;r++)c(g,o[r]);e._i.push([n,i,p])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_vKGgPmFevFB3QVyqZdIZeNqcWAPqk3i3mDhwGqwk6nP",{api_host:"https://d2j9bas80r5yfz.cloudfront.net",id:"default"})</script>
<script async defer="defer" id="hs-script-loader" src="//js.hs-scripts.com/45237820.js"></script><link rel="stylesheet" href="/assets/css/styles.8102221d.css">
<script src="/assets/js/runtime~main.b2164f9c.js" defer="defer"></script>
<script src="/assets/js/main.61ecfb00.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://dbos.dev" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/quickstart">Quickstart</a><a class="navbar__item navbar__link" href="/examples">Examples</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://console.dbos.dev/login-redirect" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link dbos-button-blue">DBOS Console</a><a href="https://github.com/dbos-inc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Home</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quickstart">Get Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/why-dbos">Why DBOS?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/architecture">DBOS Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/python/programming-guide">Develop with Python</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/typescript/programming-guide">Develop with TypeScript</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/programming-guide">Learn DBOS TypeScript</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/integrating-dbos">Add DBOS To Your App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/prompting">AI Model Prompting</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/typescript/tutorials/workflow-tutorial">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/typescript/reference/dbos-class">Reference</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/reference/dbos-class">DBOS Lifecycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/reference/workflows-steps">Workflows &amp; Steps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/reference/methods">DBOS Methods &amp; Variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/reference/queues">Queues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/reference/datasource">Transactions &amp; Datasources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/reference/client">DBOS Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/reference/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/reference/cli">DBOS CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/typescript/reference/plugins">DBOS Plugin Architecture</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/typescript/examples/checkout-tutorial">Example Applications</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/upgrading">Upgrading to TSv3</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/golang/programming-guide">Develop with Go</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/production">Deploy To Production</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/integrations/supabase">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/explanations/system-tables">Concepts and Explanations</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq">Troubleshooting &amp; FAQ</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Develop with TypeScript</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Reference</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">DBOS Plugin Architecture</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>DBOS Plugin Architecture</h1></header>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Unless you intend to extend the DBOS Transact library, you can ignore this topic.</p></div></div>
<p>DBOS Transact for TypeScript currently provides two explicit extension mechanisms:</p>
<ul>
<li><a href="#datasources">Datasources</a> integrate database clients, ORMs, or other resources with the DBOS lifecycle and transaction functions.</li>
<li><a href="#event-receivers">External Event Receivers</a> integrate event receivers (pollers, inbound sockets, timers, etc.) with the DBOS lifecycle, and initiate workflow functions upon receiving events.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="datasources">Datasources<a href="#datasources" class="hash-link" aria-label="Direct link to Datasources" title="Direct link to Datasources">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="method-of-operation">Method Of Operation<a href="#method-of-operation" class="hash-link" aria-label="Direct link to Method Of Operation" title="Direct link to Method Of Operation">​</a></h3>
<p>The principle behind DBOS datasources is that DBOS and the datasource work together to execute functions in a checkpointed, transactional context.</p>
<ol>
<li>App code calls a transaction function (which does not have to be registered in advance).  This call is made to the datasource instance, as it provides full type checking for the transaction configuration.</li>
<li>DBOS runs its step wrapper first, consulting the system database, and skipping the step if it has already run.</li>
<li>If the step should be run, DBOS calls the datasource to start a transaction.</li>
<li>The datasource starts a transaction and calls the transaction function, making the transactional datasource client available to that function via context.</li>
<li>Upon completion of the function, the datasource writes its own completion checkpoint before ending the transaction.  Including this checkpoint in the transaction ensures exactly-once processing of the transaction.</li>
<li>Control returns to the DBOS step wrapper, which writes the step result to the system database and emits tracing information.</li>
<li>The transaction&#x27;s result is returned to the caller.</li>
</ol>
<p>To guarantee exactly-once execution, datasources must maintain a completion checkpoint table in the same database used by the transaction function.  This check may be implemented optimistically (by rolling back the transaction upon a checkpoint write conflict in step 5 above) or pessimistically (by querying the checkpoint table before calling the transaction function in step 4 above).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="datasource-interfaces">Datasource Interfaces<a href="#datasource-interfaces" class="hash-link" aria-label="Direct link to Datasource Interfaces" title="Direct link to Datasource Interfaces">​</a></h3>
<p>Datasource integration is based on 3 key interfaces:</p>
<ul>
<li><code>DBOSDataSource</code>: User-facing datasource API.  Part interface and part guideline, this is technically just a suggestion, but following it ensures a consistent developer experience across datasources.</li>
<li><code>DataSourceTransactionHandler</code>: This interface is provided by the datasource to DBOS, so that DBOS can control transaction scope.</li>
<li><code>@dbos-inc/dbos-sdk/datasource</code>: Exports from this submodule are used by datasources to do register themselves and initiate transactions.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dbosdatasource"><code>DBOSDataSource</code><a href="#dbosdatasource" class="hash-link" aria-label="Direct link to dbosdatasource" title="Direct link to dbosdatasource">​</a></h4>
<p><code>DBOSDataSource</code> is the API for datasources to present to the application developer.  It provides a consistent, type-safe way to register and call transaction functions.
<code>DBOSDataSource</code> is templatized on its <code>Config</code> type, which describes datasource-specific configuration for a transaction function.  <code>Config</code> typically covers transaction isolation, read-write/read-only, and the transaction&#x27;s name.</p>
<ul>
<li><code>runTransaction</code> should run its callback, via the <code>runTransaction</code> function <a href="#dbos-incdbos-sdkdatasource">below</a></li>
<li><code>registerTransaction</code> should register the provided function and return an invocation wrapper via <code>registerTransaction</code> <a href="#dbos-incdbos-sdkdatasource">below</a></li>
<li><code>transaction</code> should be a decorator that registers its target method and installs it via <code>registerTransaction</code> <a href="#dbos-incdbos-sdkdatasource">below</a></li>
</ul>
<p>In addition to implementing the <code>DBOSDataSource</code> interface, datasource classes should also provide:</p>
<ul>
<li>A way to access the transactional client.  The preferred method is with an instance <code>get</code> method: <code>get client(): &lt;client type&gt;;</code>.</li>
<li>A function to install any necessary transaction checkpoint tables, particularly as a helper for use within the test environment.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="datasourcetransactionhandler"><code>DataSourceTransactionHandler</code><a href="#datasourcetransactionhandler" class="hash-link" aria-label="Direct link to datasourcetransactionhandler" title="Direct link to datasourcetransactionhandler">​</a></h4>
<p>A <code>DataSourceTransactionHandler</code> must be provided at datasource registration, and implements the transaction lifecycle using its underlying data access library.</p>
<ul>
<li><code>initialize</code>: This will be called during <code>DBOS.launch()</code>, and should validate that a connection can be established and that any required schemas are installed.  If not, a clear error should be thrown.</li>
<li><code>destroy</code>: This is called during <code>DBOS.shutdown()</code> and should close any connections and perform any other cleanup.</li>
<li><code>invokeTransactionFunction</code>: This should execute the provided function within a datasource transaction.  This is called by DBOS from within its step processing code, which keeps system database records and provides tracing.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dbos-incdbos-sdkdatasource"><code>@dbos-inc/dbos-sdk/datasource</code><a href="#dbos-incdbos-sdkdatasource" class="hash-link" aria-label="Direct link to dbos-incdbos-sdkdatasource" title="Direct link to dbos-incdbos-sdkdatasource">​</a></h4>
<p>The primary purpose of this submodule export is to provide the functions datasources need for registration and transaction invocation.</p>
<ul>
<li><code>registerDataSource</code>: Called by a datasource constructor to self-register the datasource with DBOS.</li>
<li><code>registerTransaction</code>: Called by a datasource to create the transaction wrapper for a transaction function.  The returned function should be called in lieu of the original.  This is used within the datasource&#x27;s <code>registerTransaction</code> method.</li>
<li><code>runTransaction</code>: Called by a datasource implementation of <code>runTransaction</code> to run code within a transaction step wrapper.</li>
</ul>
<p>This export also includes some utilities for datasource implementations based on Postgres:</p>
<ul>
<li><code>PGIsolationLevel</code> and <code>PGTransactionConfig</code>: These types should be used to represent transaction isolation settings in Postgres-based datasources.</li>
<li><code>createTransactionCompletionSchemaPG</code> and <code>createTransactionCompletionTablePG</code>: These strings contain the SQL statements used to create the transaction checkpoint table and its schema.</li>
<li><code>getPGErrorCode</code>: Gets the Postgres code, if any, from an <code>Error</code></li>
<li><code>isPGRetriableTransactionError</code>: Transactions that throw errors are retried by datasources under some circumstances.  This function establishes whether a transaction is eligible to be retried based on the thrown error.</li>
<li><code>isPGKeyConflictError</code>: Indicates if the error is a key conflict.  Such errors, if thrown from the transaction checkpoint insert, indicate that the transaction may already be complete.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="datasource-examples">Datasource Examples<a href="#datasource-examples" class="hash-link" aria-label="Direct link to Datasource Examples" title="Direct link to Datasource Examples">​</a></h3>
<p>The best examples are found in the DBOS <a href="https://github.com/dbos-inc/dbos-transact-ts/tree/main/packages" target="_blank" rel="noopener noreferrer">github repository</a>.  Datasource package names end with <code>-datasource</code>, such as <a href="https://github.com/dbos-inc/dbos-transact-ts/tree/main/packages/knex-datasource" target="_blank" rel="noopener noreferrer"><code>knex-datasource</code></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="event-receivers">Event Receivers<a href="#event-receivers" class="hash-link" aria-label="Direct link to Event Receivers" title="Direct link to Event Receivers">​</a></h2>
<p>Event receivers are a broad category of extensions that run in a DBOS app and handle requests or other outside events.  Examples include:</p>
<ul>
<li>Kafka message consumers</li>
<li>SQS message receivers</li>
<li>Database notification listeners</li>
<li>Clock-based schedulers</li>
<li>HTTP or RPC servers</li>
</ul>
<p>What event receivers have in common is that they run in the background and execute DBOS functions in response to externally-triggered circumstances.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="event-receiver-architecture">Event Receiver Architecture<a href="#event-receiver-architecture" class="hash-link" aria-label="Direct link to Event Receiver Architecture" title="Direct link to Event Receiver Architecture">​</a></h3>
<p>During program initialization, event receivers are constructed and associated with DBOS functions and methods.  Configuration information is collected during initialization, but no actions are taken until <code>DBOS.launch()</code> is called.  Upon <code>launch</code>, event receivers should review their registrations and connect to any outside resources and report clear error messages if this fails.  After any initialization is complete, event receivers should commence processing events and initiating DBOS function calls in response.  Event receivers are also told to deinitialize when DBOS shuts down.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lifecycle">Lifecycle<a href="#lifecycle" class="hash-link" aria-label="Direct link to Lifecycle" title="Direct link to Lifecycle">​</a></h3>
<p>DBOS event receiver objects should implement the <code>DBOSLifecycleCallback</code> interface:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token doc-comment comment" style="color:#8292a2;font-style:italic">/**</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token doc-comment comment" style="color:#8292a2;font-style:italic"> * Interface for integrating into the DBOS startup/shutdown lifecycle</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token doc-comment comment" style="color:#8292a2;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">DBOSLifecycleCallback</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token doc-comment comment" style="color:#8292a2;font-style:italic">/** Called back during DBOS launch */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  initialize</span><span class="token operator" style="color:#66d9ef">?</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">Promise</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token keyword" style="color:#66d9ef">void</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token doc-comment comment" style="color:#8292a2;font-style:italic">/** Called back upon shutdown (usually in tests) to close connections and free resources */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  destroy</span><span class="token operator" style="color:#66d9ef">?</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">Promise</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token keyword" style="color:#66d9ef">void</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token doc-comment comment" style="color:#8292a2;font-style:italic">/** Called at launch; Implementers should emit a diagnostic list of all registrations */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  logRegisteredEndpoints</span><span class="token operator" style="color:#66d9ef">?</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">void</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<p>Upon construction, event receivers should register themselves via <code>DBOS.registerLifecycleCallback</code>.  Upon <code>DBOS.launch()</code>, all registered <code>initialize()</code> methods will be called.  Upon <code>DBOS.shutdown()</code>, all registered <code>destroy()</code> methods will be called.  Event receivers should implement a <code>logRegisteredEndpoints()</code> function, which is a <a href="/typescript/reference/dbos-class#dboslogregisteredendpoints">diagnostic aid</a> that logs all associations between events and functions to <a href="/typescript/tutorials/logging#logging"><code>DBOS.logger</code></a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="associating-information-with-classes-methods-and-parameters">Associating Information With Classes, Methods, And Parameters<a href="#associating-information-with-classes-methods-and-parameters" class="hash-link" aria-label="Direct link to Associating Information With Classes, Methods, And Parameters" title="Direct link to Associating Information With Classes, Methods, And Parameters">​</a></h3>
<p>As program initialization is nonlinear, the DBOS library provides infrastructure to help register the classes, functions, and parameters associated with an event receiver.  A cohesive picture of this registration information is then available during <code>initialize</code>.</p>
<p>The following <code>DBOS.</code> static methods are used to collect registration information during initialization:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#e6db74">associateClassWithInfo</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">external</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> AnyConstructor </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> object </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> cls</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> AnyConstructor </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> object</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token generic-function function" style="color:#e6db74">associateFunctionWithInfo</span><span class="token generic-function generic class-name operator" style="color:#66d9ef">&lt;</span><span class="token generic-function generic class-name" style="color:#e6db74">This</span><span class="token generic-function generic class-name punctuation" style="color:#f8f8f2">,</span><span class="token generic-function generic class-name" style="color:#e6db74"> Args </span><span class="token generic-function generic class-name keyword" style="color:#66d9ef">extends</span><span class="token generic-function generic class-name" style="color:#e6db74"> </span><span class="token generic-function generic class-name builtin" style="color:#e6db74">unknown</span><span class="token generic-function generic class-name punctuation" style="color:#f8f8f2">[</span><span class="token generic-function generic class-name punctuation" style="color:#f8f8f2">]</span><span class="token generic-function generic class-name punctuation" style="color:#f8f8f2">,</span><span class="token generic-function generic class-name" style="color:#e6db74"> Return</span><span class="token generic-function generic class-name operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    external</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> AnyConstructor </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> object </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#e6db74">func</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">this</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> This</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">...</span><span class="token plain">args</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> Args</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">Promise</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain">Return</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    target</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> FunctionName</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> object</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token generic-function function" style="color:#e6db74">associateParamWithInfo</span><span class="token generic-function generic class-name operator" style="color:#66d9ef">&lt;</span><span class="token generic-function generic class-name" style="color:#e6db74">This</span><span class="token generic-function generic class-name punctuation" style="color:#f8f8f2">,</span><span class="token generic-function generic class-name" style="color:#e6db74"> Args </span><span class="token generic-function generic class-name keyword" style="color:#66d9ef">extends</span><span class="token generic-function generic class-name" style="color:#e6db74"> </span><span class="token generic-function generic class-name builtin" style="color:#e6db74">unknown</span><span class="token generic-function generic class-name punctuation" style="color:#f8f8f2">[</span><span class="token generic-function generic class-name punctuation" style="color:#f8f8f2">]</span><span class="token generic-function generic class-name punctuation" style="color:#f8f8f2">,</span><span class="token generic-function generic class-name" style="color:#e6db74"> Return</span><span class="token generic-function generic class-name operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    external</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> AnyConstructor </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> object </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#e6db74">func</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">this</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> This</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">...</span><span class="token plain">args</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> Args</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">Promise</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain">Return</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    target</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> FunctionName </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      param</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">number</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> object </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">undefined</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre></div></div>
<p>The parameters to these functions are:</p>
<ul>
<li><code>external</code>: A key that identifies the event receiver; this can be its constructor, an instance, or a name string.</li>
<li><code>cls</code>: For <code>associateClassWithInfo</code>, the constructor of the class receiving the registration</li>
<li><code>func</code>: For <code>associateFunctionWithInfo</code> and <code>associateParamWithInfo</code>, the function receiving the registration information</li>
<li><code>target</code>: For <code>associateFunctionWithInfo</code> and <code>associateParamWithInfo</code>, this is the name to assign to the function (if it does not already have one).  For <code>associateParamWithInfo</code>, <code>target</code> also specifies <code>param</code>, which is the parameter name or index number</li>
</ul>
<p>Each of these methods returns an <code>object</code> that is specific to the event receiver; this object can be used by the event receiver to store any details.  <code>associateParamWithInfo</code> will return <code>undefined</code> if there is no such parameter.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="finding-and-invoking-registered-methods">Finding And Invoking Registered Methods<a href="#finding-and-invoking-registered-methods" class="hash-link" aria-label="Direct link to Finding And Invoking Registered Methods" title="Direct link to Finding And Invoking Registered Methods">​</a></h3>
<p>At the time its <code>initialize</code> method is called, an event receiver can retrieve all its registration information via <code>DBOS.getAssociatedInfo</code>:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">getAssociatedInfo</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  external</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> AnyConstructor </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> object </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  cls</span><span class="token operator" style="color:#66d9ef">?</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> object </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  funcName</span><span class="token operator" style="color:#66d9ef">?</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">readonly</span><span class="token plain"> ExternalRegistration</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">ExternalRegistration</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  classConfig</span><span class="token operator" style="color:#66d9ef">?</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">unknown</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  methodConfig</span><span class="token operator" style="color:#66d9ef">?</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">unknown</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  paramConfig</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    name</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    index</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">number</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    paramConfig</span><span class="token operator" style="color:#66d9ef">?</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> object</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  methodReg</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> MethodRegistrationBase</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<p>The value of <code>external</code> should match the value provided to <a href="#associating-information-with-classes-methods-and-parameters"><code>associateClassWithInfo</code>, <code>associateFunctionWithInfo</code>, and <code>associateParamWithInfo</code> above</a>.</p>
<p>If <code>cls</code> or <code>funcName</code> are provided, these are used to filter the registrations, otherwise all registrations are retrieved.</p>
<p>The returned <code>ExternalRegistration</code> array contains one entry per retrieved function:</p>
<ul>
<li><code>classConfig</code> is the same <code>object</code> returned by <code>associateClassWithInfo</code></li>
<li><code>methodConfig</code> is the same <code>object</code> returned by <code>associateFunctionWithInfo</code></li>
<li><code>paramConfig</code> is an array of parameter objects, as returned by <code>associateParameterWithInfo</code></li>
<li><code>methodReg</code> is the method registration structure, which allow the target (and any associated wrappers) to be invoked.</li>
</ul>
<p>In response to events, receivers should take one of the following approaches to call the target functions:</p>
<ul>
<li>For synchronous calls, event receivers should call the <code>invoke</code> method of <code>methodReg</code>.  <code>invoke</code> ensures that any DBOS wrappers are executed in addition to the function&#x27;s code.</li>
<li>For starting workflows, event receivers should call <code>DBOS.startWorkflow</code> with <code>methodReg.registeredFunction</code> as the workflow.  The workflow ID, queue, and other parameters may be specified to <code>startWorkflow</code>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="keeping-state-in-the-system-database">Keeping State In The System Database<a href="#keeping-state-in-the-system-database" class="hash-link" aria-label="Direct link to Keeping State In The System Database" title="Direct link to Keeping State In The System Database">​</a></h3>
<p>An event receiver may keep state in the system database.  This state may be helpful for backfilling events that came in while the event receiver was not running.  This state uses a key/value store design, where the event receiver may use <a href="#dbosupserteventdispatchstate"><code>DBOS.upsertEventDispatchState</code></a> to insert/update the value associated with a key, and <a href="#dbosgeteventdispatchstate"><code>getEventDispatchState</code></a> to retrieve the value associated with a key.  This implementation also supports an update time or update sequence; updates made with lower sequence numbers or times are discared if the existing entry is marked with a later sequence / time.</p>
<p>Stored state follows the <code>DBOSExternalState</code> interface:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">interface</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">DBOSExternalState</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token doc-comment comment" style="color:#8292a2;font-style:italic">/** Name of event receiver service */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  service</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token doc-comment comment" style="color:#8292a2;font-style:italic">/** Fully qualified function name for which state is kept */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  workflowFnName</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token doc-comment comment" style="color:#8292a2;font-style:italic">/** subkey within the service+workflowFnName */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  key</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token doc-comment comment" style="color:#8292a2;font-style:italic">/** Value kept for the service+workflowFnName+key combination */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  value</span><span class="token operator" style="color:#66d9ef">?</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token doc-comment comment" style="color:#8292a2;font-style:italic">/** Updated time (used to version the value) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  updateTime</span><span class="token operator" style="color:#66d9ef">?</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">number</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token doc-comment comment" style="color:#8292a2;font-style:italic">/** Updated sequence number (used to version the value) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  updateSeq</span><span class="token operator" style="color:#66d9ef">?</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> bigint</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<p>The key consists of:</p>
<ul>
<li><code>service</code>: <code>service</code> should be unique to the event receiver keeping state, to separate from other table users</li>
<li><code>workflowFnName</code>: <code>workflowFnName</code> workflow function name should be the fully qualified / unique function name dispatched, to keep state separate by event function</li>
<li><code>key</code>: The <code>key</code> field allows multiple records per service / workflow function</li>
</ul>
<p>The value stored for each <code>service</code>/<code>workflowFnName</code>/<code>key</code> combination includes:</p>
<ul>
<li><code>value</code>: <code>value</code> is a string value.  JSON can be used to encode more complex values.</li>
<li><code>updateTime</code>: The time <code>value</code> was set.  Upserts of records with an earlier <code>updateTime</code> will have no effect on the stored state.</li>
<li><code>updateSeq</code>: An integer number indicating when the value was set.  Upserts of records with a smaller <code>updateSeq</code> will have no effect on the stored state.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dbosupserteventdispatchstate"><code>DBOS.upsertEventDispatchState</code><a href="#dbosupserteventdispatchstate" class="hash-link" aria-label="Direct link to dbosupserteventdispatchstate" title="Direct link to dbosupserteventdispatchstate">​</a></h4>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">upsertEventDispatchState</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">state</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> DBOSExternalState</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">Promise</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain">DBOSExternalState</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre></div></div>
<p><code>upsertEventDispatchState</code> inserts a value associated with a key.  If a value is already associated with the specified key, the stored value will be updated, unless <code>updateTime</code> or <code>updateSeq</code> is provided and is less that what is already stored in the system database.</p>
<p>The function return value indicates the contents of the system database for the specified key.  This is useful to detect if a more recent record is already stored in the database.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dbosgeteventdispatchstate"><code>DBOS.getEventDispatchState</code><a href="#dbosgeteventdispatchstate" class="hash-link" aria-label="Direct link to dbosgeteventdispatchstate" title="Direct link to dbosgeteventdispatchstate">​</a></h4>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">getEventDispatchState</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">service</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> workflowFnName</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> key</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">Promise</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain">DBOSExternalState </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">undefined</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre></div></div>
<p>Retrieve the value set for an event receiver&#x27;s key, as stored by <a href="#dbosupserteventdispatchstate"><code>upsertEventDispatchState</code></a> above.  If no value has been associated with the combination of <code>service</code>/<code>workflowFnName</code>/<code>key</code> above, then <code>undefined</code> is returned.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-authenticated-user-and-roles">Setting Authenticated User And Roles<a href="#setting-authenticated-user-and-roles" class="hash-link" aria-label="Direct link to Setting Authenticated User And Roles" title="Direct link to Setting Authenticated User And Roles">​</a></h3>
<p>When dispatching events and requests, it is possible to set the authenticated user and roles using <code>DBOS.withAuthedContext</code>.  This function sets the context for the duration of its <code>callback</code>:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">// Set the authenticated user, and roles allowed by the authentication system for the scope of the callback() function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token constant" style="color:#e6db74">DBOS</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token generic-function function" style="color:#e6db74">withAuthedContext</span><span class="token generic-function generic class-name operator" style="color:#66d9ef">&lt;</span><span class="token generic-function generic class-name constant" style="color:#e6db74">R</span><span class="token generic-function generic class-name operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">authedUser</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> authedRoles</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token function-variable function" style="color:#e6db74">callback</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">Promise</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token constant" style="color:#e6db74">R</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">Promise</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token constant" style="color:#e6db74">R</span><span class="token operator" style="color:#66d9ef">&gt;</span><br></span></code></pre></div></div>
<p>In the following example, the <code>Secured.workflow</code> function is executed for authenticated user &quot;joe&quot;, with role &quot;user&quot;.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> hijoe </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> </span><span class="token constant" style="color:#e6db74">DBOS</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">withAuthedContext</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&#x27;joe&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#a6e22e">&#x27;user&#x27;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">async</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> Secured</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">workflow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&#x27;args go here&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="event-receiver-examples">Event Receiver Examples<a href="#event-receiver-examples" class="hash-link" aria-label="Direct link to Event Receiver Examples" title="Direct link to Event Receiver Examples">​</a></h3>
<p>The best examples are found in the DBOS <a href="https://github.com/dbos-inc/dbos-transact-ts/tree/main/packages" target="_blank" rel="noopener noreferrer">github repository</a>.  Event receiver names end with <code>-receive</code> or <code>-serve</code>, such as <a href="https://github.com/dbos-inc/dbos-transact-ts/tree/main/packages/kafkajs-receive" target="_blank" rel="noopener noreferrer"><code>kafkajs-receive</code></a> and <a href="https://github.com/dbos-inc/dbos-transact-ts/tree/main/packages/koa-serve" target="_blank" rel="noopener noreferrer"><code>koa-serve</code></a></p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/typescript/reference/cli"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">DBOS CLI</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/typescript/examples/checkout-tutorial"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Fault-Tolerant Checkout</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#datasources" class="table-of-contents__link toc-highlight">Datasources</a><ul><li><a href="#method-of-operation" class="table-of-contents__link toc-highlight">Method Of Operation</a></li><li><a href="#datasource-interfaces" class="table-of-contents__link toc-highlight">Datasource Interfaces</a><ul><li><a href="#dbosdatasource" class="table-of-contents__link toc-highlight"><code>DBOSDataSource</code></a></li><li><a href="#datasourcetransactionhandler" class="table-of-contents__link toc-highlight"><code>DataSourceTransactionHandler</code></a></li><li><a href="#dbos-incdbos-sdkdatasource" class="table-of-contents__link toc-highlight"><code>@dbos-inc/dbos-sdk/datasource</code></a></li></ul></li><li><a href="#datasource-examples" class="table-of-contents__link toc-highlight">Datasource Examples</a></li></ul></li><li><a href="#event-receivers" class="table-of-contents__link toc-highlight">Event Receivers</a><ul><li><a href="#event-receiver-architecture" class="table-of-contents__link toc-highlight">Event Receiver Architecture</a></li><li><a href="#lifecycle" class="table-of-contents__link toc-highlight">Lifecycle</a></li><li><a href="#associating-information-with-classes-methods-and-parameters" class="table-of-contents__link toc-highlight">Associating Information With Classes, Methods, And Parameters</a></li><li><a href="#finding-and-invoking-registered-methods" class="table-of-contents__link toc-highlight">Finding And Invoking Registered Methods</a></li><li><a href="#keeping-state-in-the-system-database" class="table-of-contents__link toc-highlight">Keeping State In The System Database</a><ul><li><a href="#dbosupserteventdispatchstate" class="table-of-contents__link toc-highlight"><code>DBOS.upsertEventDispatchState</code></a></li><li><a href="#dbosgeteventdispatchstate" class="table-of-contents__link toc-highlight"><code>DBOS.getEventDispatchState</code></a></li></ul></li><li><a href="#setting-authenticated-user-and-roles" class="table-of-contents__link toc-highlight">Setting Authenticated User And Roles</a></li><li><a href="#event-receiver-examples" class="table-of-contents__link toc-highlight">Event Receiver Examples</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Follow Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/dbos-inc/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://bsky.app/profile/dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bluesky<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/DBOS_Inc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter/X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.dbos.dev/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.dbos.dev/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Questions or Comments?</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/fMwQjeW5zg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat with us on Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:contact@dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Write to us at contact@dbos.dev<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://dbos.dev" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="100"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="100"></a></div><div class="footer__copyright">Copyright © 2025 DBOS, Inc. | <a href="https://www.dbos.dev/privacy" target="_blank">Privacy Policy</a></div></div></div></footer></div>
</body>
</html>