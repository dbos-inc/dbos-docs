<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-typescript/examples/task-scheduler" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">DBOS Task Scheduler | DBOS Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.dbos.dev/typescript/examples/task-scheduler"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="DBOS Task Scheduler | DBOS Docs"><meta data-rh="true" name="description" content="Learn how to combine DBOS + Next.js with this cloud scheduling tool"><meta data-rh="true" property="og:description" content="Learn how to combine DBOS + Next.js with this cloud scheduling tool"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.dbos.dev/typescript/examples/task-scheduler"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/typescript/examples/task-scheduler" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/typescript/examples/task-scheduler" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UY2VKOMIL2-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"DBOS Task Scheduler","item":"https://docs.dbos.dev/typescript/examples/task-scheduler"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="DBOS Docs" href="/opensearch.xml">


<link rel="preconnect" href="https://dbosdev.matomo.cloud/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://dbosdev.matomo.cloud/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>

<link rel="preconnect" href="https://d2j9bas80r5yfz.cloudfront.net">
<script>!function(t,e){var o,r,s,a;e.__SV||(window.posthog=e,e._i=[],e.init=function(n,i,p){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(s=t.createElement("script")).type="text/javascript",s.async=!0,s.src=i.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(a=t.getElementsByTagName("script")[0]).parentNode.insertBefore(s,a);var g=e;for(void 0!==p?g=e[p]=[]:p="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==p&&(e+="."+p),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),r=0;r<o.length;r++)c(g,o[r]);e._i.push([n,i,p])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_vKGgPmFevFB3QVyqZdIZeNqcWAPqk3i3mDhwGqwk6nP",{api_host:"https://d2j9bas80r5yfz.cloudfront.net",id:"default"})</script>
<script async defer="defer" id="hs-script-loader" src="//js.hs-scripts.com/45237820.js"></script><link rel="stylesheet" href="/assets/css/styles.8102221d.css">
<script src="/assets/js/runtime~main.b8436145.js" defer="defer"></script>
<script src="/assets/js/main.d1843b1f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://dbos.dev" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/">Docs</a><a class="navbar__item navbar__link" href="/quickstart">Quickstart</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/examples">Examples</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://console.dbos.dev/login-redirect" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link dbos-button-blue">DBOS Console</a><a href="https://github.com/dbos-inc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/examples">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/python/examples/hacker-news-agent">Python Examples</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/hacker-news-agent">Hacker News Research Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/document-detective">Document Ingestion Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/widget-store">Fault-Tolerant Checkout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/stock-tracker">Stock Tracker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/customer-service">Reliable Customer Service Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/scheduled-reminders">Scheduled Reminders</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/rag-slackbot">AI-Powered Slackbot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/earthquake-tracker">Earthquake Tracker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/python/examples/hacker-news-bot">Hacker News Slackbot</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/typescript/examples/checkout-tutorial">TypeScript Examples</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/examples/checkout-tutorial">Fault-Tolerant Checkout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/examples/hacker-news-agent">Hacker News Research Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/examples/kafka-alert-queue">Kafka Alert Queue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/typescript/examples/task-scheduler">DBOS Task Scheduler</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">TypeScript Examples</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">DBOS Task Scheduler</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>DBOS Task Scheduler</h1></header>
<p>DBOS Task Scheduler is a full-stack app built with <a href="https://nextjs.org/" target="_blank" rel="noopener noreferrer">Next.js</a> and <a href="https://dbos.dev" target="_blank" rel="noopener noreferrer">DBOS</a>.</p>
<p><img decoding="async" loading="lazy" alt="Screen shot of DBOS Task Scheduler" src="/assets/images/dbos-task-scheduler-main-24cb510f61701f15352f92217c7b697d.png" width="3766" height="1154" class="img_ev3q"></p>
<p>If you like the idea of a cloud-based task scheduler with a calendar UI, you can easily <a href="#task-code">customize it with your own tasks</a> and deploy it to <a href="https://www.dbos.dev/dbos-cloud" target="_blank" rel="noopener noreferrer">DBOS Cloud</a> for free.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-dbos-task-scheduler-in-dbos-cloud">Running DBOS Task Scheduler in DBOS Cloud<a href="#running-dbos-task-scheduler-in-dbos-cloud" class="hash-link" aria-label="Direct link to Running DBOS Task Scheduler in DBOS Cloud" title="Direct link to Running DBOS Task Scheduler in DBOS Cloud">​</a></h2>
<p>Provisioning an instance of DBOS Task Scheduler in DBOS Cloud is easy:</p>
<ul>
<li>Go to <a href="https://console.dbos.dev/launch" target="_blank" rel="noopener noreferrer">DBOS Cloud Console</a></li>
<li>Sign Up or Sign In, if you haven&#x27;t already</li>
<li>Select the &quot;TYPESCRIPT&quot; tab</li>
<li>Choose the &quot;DBOS Task Scheduler&quot; template</li>
</ul>
<p>After a bit of launch activity, you will be presented with:</p>
<ul>
<li>A URL for accessing the app</li>
<li>Monitoring dashboards</li>
<li>Management options</li>
<li>Code download</li>
</ul>
<p>You can also set secrets in DBOS Cloud.  Secrets, which are read from environment variables, can be set up to control the email address and SES access keys used by the scheduler to send confirmation emails.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-dbos-task-scheduler-locally">Running DBOS Task Scheduler Locally<a href="#running-dbos-task-scheduler-locally" class="hash-link" aria-label="Direct link to Running DBOS Task Scheduler Locally" title="Direct link to Running DBOS Task Scheduler Locally">​</a></h2>
<p>If you <a href="#running-dbos-task-scheduler-in-dbos-cloud">started out in DBOS Cloud</a>, you can download your code to your development environment.  Or, you can <a href="https://github.com/dbos-inc/dbos-demo-apps" target="_blank" rel="noopener noreferrer">clone the code from the git repository</a> and change to the <code>typescript/nextjs-calendar</code> directory.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-a-database">Setting Up A Database<a href="#setting-up-a-database" class="hash-link" aria-label="Direct link to Setting Up A Database" title="Direct link to Setting Up A Database">​</a></h3>
<p>DBOS requires a Postgres database.
If you already have Postgres, you can set the <code>DBOS_DATABASE_URL</code> environment variable to your connection string.
Otherwise, you can start Postgres in a Docker container with this command:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">npx dbos postgres start</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-in-development">Running In Development<a href="#running-in-development" class="hash-link" aria-label="Direct link to Running In Development" title="Direct link to Running In Development">​</a></h3>
<p>Once you have a local copy of the DBOS Task Scheduler, run the following:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">npm install</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">npm run dev</span><br></span></code></pre></div></div>
<p>When running under <code>npm run dev</code>, any changes to source files will cause the application to reload (if UI components were changed) or restart (if DBOS server components were changed).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="production-builds">Production Builds<a href="#production-builds" class="hash-link" aria-label="Direct link to Production Builds" title="Direct link to Production Builds">​</a></h3>
<p>Instead of <code>npm run dev</code> it is also possible to run the following sequence of commands to launch an optimized &quot;production&quot; build:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">npm install</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">npm run build</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">npx knex migrate:latest</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">npm run start</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dbos-task-schedulers-web-ui">DBOS Task Scheduler&#x27;s Web UI<a href="#dbos-task-schedulers-web-ui" class="hash-link" aria-label="Direct link to DBOS Task Scheduler&#x27;s Web UI" title="Direct link to DBOS Task Scheduler&#x27;s Web UI">​</a></h2>
<p>Once the app is running, open it in a web browser.</p>
<ul>
<li>If the app is running In DBOS Cloud, the URL will be shown <a href="https://console.dbos.dev/applications" target="_blank" rel="noopener noreferrer">in the cloud console</a> under &quot;Visit your app&quot;, and the URL will also be reported in the output of the deploy command.</li>
<li>If running locally, the default will be at <a href="http://localhost:3000/" target="_blank" rel="noopener noreferrer">http://localhost:3000/</a>, but check your startup logs for confirmation.</li>
</ul>
<p>Upon opening the web browser (and perhaps dismissing the help popup), the main screen should be shown:
<img decoding="async" loading="lazy" alt="Screen shot of DBOS Task Scheduler" src="/assets/images/dbos-task-scheduler-main-24cb510f61701f15352f92217c7b697d.png" width="3766" height="1154" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-email-notifications-optional">Setting Up Email Notifications (Optional)<a href="#setting-up-email-notifications-optional" class="hash-link" aria-label="Direct link to Setting Up Email Notifications (Optional)" title="Direct link to Setting Up Email Notifications (Optional)">​</a></h2>
<p>The DBOS Task Scheduler app will <em>optionally</em> send notifications using Amazon Simple Email Service (SES).  To use this, set the following environment variables prior to launching the app:</p>
<ul>
<li>AWS_REGION: The AWS region for SES service</li>
<li>AWS_ACCESS_KEY_ID: The AWS access key provisioned for SES access</li>
<li>AWS_SECRET_ACCESS_KEY: The access secret corresponding to AWS_ACCESS_KEY_ID</li>
<li>REPORT_EMAIL_FROM_ADDRESS: The email address to use as the &quot;from&quot; address for results reports</li>
<li>REPORT_EMAIL_TO_ADDRESS: The email address to use as the &quot;to&quot; address for results reports</li>
</ul>
<p>If these environment variables aren&#x27;t set, email will not be sent.</p>
<h1>Code Tour</h1>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The DBOS Task Scheduler app is somewhat complex, showcasing many features.  For a simpler starting point, see <a href="https://github.com/dbos-inc/dbos-demo-apps/tree/main/typescript/dbos-nextjs-starter#readme" target="_blank" rel="noopener noreferrer">dbos-nextjs-starter</a>.</p></div></div>
<p>This app uses the following:</p>
<ul>
<li>DBOS <a href="/typescript/tutorials/workflow-tutorial">Workflows</a>, <a href="/typescript/tutorials/transaction-tutorial">Transactions</a>, and <a href="/typescript/tutorials/step-tutorial">Steps</a> – Complete actions <a href="/typescript/tutorials/workflow-tutorial#workflow-ids-and-idempotency">exactly once</a>, record the results, and send notifications, without worrying about server disruptions</li>
<li><a href="https://knexjs.org/" target="_blank" rel="noopener noreferrer">Knex</a> – Type-safe database access and schema management</li>
<li><a href="/typescript/tutorials/scheduled-workflows">DBOS Scheduled Workflows</a> – Ensure tasks are run as scheduled</li>
<li>React, with <a href="https://mui.com" target="_blank" rel="noopener noreferrer">Material</a> and <a href="https://github.com/jquense/react-big-calendar" target="_blank" rel="noopener noreferrer">react-big-calendar</a> – Present a calendar of tasks and results</li>
<li>Next.js server actions – Simple interaction between the browser-based client and the server</li>
<li>Next.js API routes and DBOS HTTP endpoints – Allow access to the server logic from clients other than Next.js</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" target="_blank" rel="noopener noreferrer">WebSockets</a> – Send calendar and result updates to the browser with low latency</li>
<li>Database triggers – Listen for database updates made by other VMs</li>
<li><a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">Jest</a> – Unit test backend code</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dbos-and-database-logic">DBOS and Database Logic<a href="#dbos-and-database-logic" class="hash-link" aria-label="Direct link to DBOS and Database Logic" title="Direct link to DBOS and Database Logic">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="task-code">Task Code<a href="#task-code" class="hash-link" aria-label="Direct link to Task Code" title="Direct link to Task Code">​</a></h3>
<p>The list of schedulable tasks is in <code>src/dbos/tasks.ts</code>. The <code>schedulableTasks</code> array contains the available tasks, with information needed for <code>doTaskFetch</code> to execute them.  Tasks can be added by expanding the array with additional entries:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    id</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;fetch_joke&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#8292a2;font-style:italic">// Unique ID for the task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    name</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;Fetch Random Joke&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#8292a2;font-style:italic">// Text label the task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    url</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;https://official-joke-api.appspot.com/random_joke&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#8292a2;font-style:italic">// URL to fetch when the task runs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    type</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;json&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#8292a2;font-style:italic">// Type of result to expect from the task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="main-workflow">Main Workflow<a href="#main-workflow" class="hash-link" aria-label="Direct link to Main Workflow" title="Direct link to Main Workflow">​</a></h3>
<p>The main workflow for executing tasks is in <code>src/dbos/operations.ts</code>, in the <code>SchedulerOps</code> class:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">  @</span><span class="token constant" style="color:#e6db74">DBOS</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">workflow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">async</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">runJob</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sched</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> task</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> time</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> Date</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token constant" style="color:#e6db74">DBOS</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">info</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token template-string template-punctuation string" style="color:#a6e22e">`</span><span class="token template-string string" style="color:#a6e22e">Running </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation">task</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string string" style="color:#a6e22e"> at </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation">time</span><span class="token template-string interpolation punctuation" style="color:#f8f8f2">.</span><span class="token template-string interpolation function" style="color:#e6db74">toString</span><span class="token template-string interpolation punctuation" style="color:#f8f8f2">(</span><span class="token template-string interpolation punctuation" style="color:#f8f8f2">)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string template-punctuation string" style="color:#a6e22e">`</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">let</span><span class="token plain"> resstr </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">let</span><span class="token plain"> errstr </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#8292a2;font-style:italic">// Fetch the result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> res </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> SchedulerOps</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">runTask</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      resstr </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> res</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#8292a2;font-style:italic">// Store result in database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> ScheduleDBOps</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">setResult</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sched</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> time</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> e </span><span class="token keyword" style="color:#66d9ef">as</span><span class="token plain"> Error</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#8292a2;font-style:italic">// Store error in database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> ScheduleDBOps</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">setResult</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sched</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> task</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> time</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">message</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      errstr </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">message</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// Tell attached clients</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    SchedulerOps</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">notifyListeners</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&#x27;result&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// Send notification</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> SchedulerOps</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">sendStatusEmail</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      errstr </span><span class="token operator" style="color:#66d9ef">?</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#a6e22e">`</span><span class="token template-string string" style="color:#a6e22e">Task </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation">task</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string string" style="color:#a6e22e"> failed</span><span class="token template-string template-punctuation string" style="color:#a6e22e">`</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#a6e22e">`</span><span class="token template-string string" style="color:#a6e22e">Task </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation">task</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string string" style="color:#a6e22e"> result</span><span class="token template-string template-punctuation string" style="color:#a6e22e">`</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      errstr </span><span class="token operator" style="color:#66d9ef">||</span><span class="token plain"> resstr</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<p>Because it is a <code>@DBOS.workflow</code>, <code>runJob</code> will be <a href="/typescript/tutorials/workflow-tutorial">executed durably</a>.  That is, if the server crashes after <code>runTask</code> is complete, but the result hasn&#x27;t been recorded in the database with <code>setResult</code>, or if the email hasn&#x27;t been sent by <code>sendStatusEmail</code>, DBOS Transact will finish the workflow during recovery and execute those steps.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scheduling">Scheduling<a href="#scheduling" class="hash-link" aria-label="Direct link to Scheduling" title="Direct link to Scheduling">​</a></h3>
<p>Scheduling a workflow in DBOS is quite simple; simply affix the <a href="https://docs.dbos.dev/typescript/tutorials/scheduled-workflows" target="_blank" rel="noopener noreferrer"><code>@DBOS.scheduled</code> decorator</a>.  The <code>crontab</code> of <code>&#x27;* * * * *&#x27;</code> will cause <code>runSchedule</code> to execute every minute, and <code>runSchedule</code> will check the database for tasks to execute.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">  @</span><span class="token constant" style="color:#e6db74">DBOS</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">scheduled</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">crontab</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;* * * * *&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> mode</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> SchedulerMode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ExactlyOncePerIntervalWhenActive </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  @</span><span class="token constant" style="color:#e6db74">DBOS</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">workflow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">async</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">runSchedule</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">schedTime</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> Date</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> _atTime</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> Date</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// Retrieve schedule from database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> schedule </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> ScheduleDBOps</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">getSchedule</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> sched </span><span class="token keyword" style="color:#66d9ef">of</span><span class="token plain"> schedule</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#8292a2;font-style:italic">// See if this schedule should be triggered now</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> occurrences </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">getOccurrencesAt</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sched</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> schedTime</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> occurrence </span><span class="token keyword" style="color:#66d9ef">of</span><span class="token plain"> occurrences</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token comment" style="color:#8292a2;font-style:italic">// Start each job in the background</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> </span><span class="token constant" style="color:#e6db74">DBOS</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">startWorkflow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">SchedulerOps</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">runJob</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sched</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">id</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> sched</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">task</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> occurrence</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<p>Note that the use of <code>mode: SchedulerMode.ExactlyOncePerIntervalWhenActive</code> means that makeup work will not be performed if DBOS is down at the time that tasks are scheduled.  To make up for missed intervals, ensuring the scheduled workflows run exactly once, use <code>mode: SchedulerMode.ExactlyOncePerInterval</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="database-schema-and-transactions">Database Schema and Transactions<a href="#database-schema-and-transactions" class="hash-link" aria-label="Direct link to Database Schema and Transactions" title="Direct link to Database Schema and Transactions">​</a></h3>
<p>DBOS Task Scheduler stores its schedule and results data in a Postgres database using <a href="https://knexjs.org/" target="_blank" rel="noopener noreferrer">Knex</a>.  The code for the transactions resides in <code>src/dbos/dbtransactions.ts</code>.  For example, the <code>getSchedule</code> method in <code>ScheduleDBOps</code> retrieves the entire schedule from the database:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token decorator at operator" style="color:#66d9ef">@</span><span class="token decorator function" style="color:#e6db74">knexds</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">transaction</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">readOnly</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">async</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">getSchedule</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> knexds</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token generic-function function" style="color:#e6db74">client</span><span class="token generic-function generic class-name operator" style="color:#66d9ef">&lt;</span><span class="token generic-function generic class-name" style="color:#e6db74">ScheduleRecord</span><span class="token generic-function generic class-name operator" style="color:#66d9ef">&gt;</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&#x27;schedule&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">select</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<p>Note that the transaction function is decorated with <a href="https://docs.dbos.dev/typescript/tutorials/transaction-tutorial" target="_blank" rel="noopener noreferrer"><code>@&lt;data source&gt;.transaction</code></a>.  The <code>ScheduleRecord</code> has been defined in <code>src/types/models.ts</code> and is applied to the query for type checking.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ui">UI<a href="#ui" class="hash-link" aria-label="Direct link to UI" title="Direct link to UI">​</a></h2>
<p>The user interface for DBOS Task Scheduler is built on React, with <a href="https://mui.com" target="_blank" rel="noopener noreferrer">Material</a> and <a href="https://github.com/jquense/react-big-calendar" target="_blank" rel="noopener noreferrer">react-big-calendar</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ui-components">UI Components<a href="#ui-components" class="hash-link" aria-label="Direct link to UI Components" title="Direct link to UI Components">​</a></h3>
<p>The app-specific UI components can be found in <code>src/app/components/*.tsx</code>, with the overall layout established in <code>src/app/layout.tsx</code> and <code>src/app/page.tsx</code>.  Nothing in these components is particularly notable; they just use core React/Next.js constructs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="server-actions">Server Actions<a href="#server-actions" class="hash-link" aria-label="Direct link to Server Actions" title="Direct link to Server Actions">​</a></h3>
<p>One of the key benefits of Next.js over straight React is <a href="https://nextjs.org/docs/app/building-your-application/data-fetching/server-actions-and-mutations" target="_blank" rel="noopener noreferrer">server actions</a>.  Server actions provide an easy way for the UI to call code on the server, without specifying the API.</p>
<p>Within DBOS Task Scheduler, server actions are used for updating the calendar tasks, and fetching results.  The action code can be found in <code>src/actions/schedule.ts</code>.  For example, <code>ScheduleForm.tsx</code> calls the <code>addSchedule</code> server action:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">// Add a new schedule item</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">async</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">addSchedule</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">task</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> start</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> Date</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> end</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> Date</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> repeat</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> res </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> ScheduleDBOps</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">addScheduleItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">task</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> start</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> end</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> repeat</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#8292a2;font-style:italic">// Tell attached clients</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  SchedulerOps</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">notifyListeners</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&#x27;schedule&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> res</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<p>This server action will in turn call DBOS.  Note that <code>addSchedule</code> involves a remote method invocation provided by Next.js, as the <code>ScheduleForm</code> is rendered on the client, and <code>addSchedule</code> is processed on the server.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sending-email-with-amazon-ses">Sending Email with Amazon SES<a href="#sending-email-with-amazon-ses" class="hash-link" aria-label="Direct link to Sending Email with Amazon SES" title="Direct link to Sending Email with Amazon SES">​</a></h3>
<p>The optional sending of task results emails is done using Amazon SES, and the <code>@dbos-inc/dbos-email-ses</code> package.</p>
<p>Wrapping the AWS SESv2 library call with a step is quite simple to do, and ensures that the email is sent once.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">  @</span><span class="token constant" style="color:#e6db74">DBOS</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">step</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">async</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">sendStatusEmail</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">subject</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> body</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">!</span><span class="token plain">globalThis</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">reportSes</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">await</span><span class="token plain"> globalThis</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">reportSes</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">sendEmail</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      FromEmailAddress</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> process</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#a6e22e">&#x27;REPORT_EMAIL_FROM_ADDRESS&#x27;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token operator" style="color:#66d9ef">!</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Destination</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> ToAddresses</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">process</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#a6e22e">&#x27;REPORT_EMAIL_TO_ADDRESS&#x27;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token operator" style="color:#66d9ef">!</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Content</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        Simple</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          Subject</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> Data</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> subject </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          Body</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            Text</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> Data</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> body</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> Charset</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;utf-8&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="websockets">WebSockets<a href="#websockets" class="hash-link" aria-label="Direct link to WebSockets" title="Direct link to WebSockets">​</a></h3>
<p>Another thing that is not generally possible in Next.js is real-time updates to the client.  In DBOS Task Scheduler, the client calendar should be updated when new task results arrive, or if another user alters the calendar.  While this can be achieved with polling, we can use WebSockets in DBOS.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">notifyListeners</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">type</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> gss </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> globalThis</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">webSocketClients</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token constant" style="color:#e6db74">DBOS</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">logger</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">debug</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token template-string template-punctuation string" style="color:#a6e22e">`</span><span class="token template-string string" style="color:#a6e22e">WebSockets: Sending update &#x27;</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation keyword" style="color:#66d9ef">type</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string string" style="color:#a6e22e">&#x27; to </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">${</span><span class="token template-string interpolation">gss</span><span class="token template-string interpolation operator" style="color:#66d9ef">?.</span><span class="token template-string interpolation">size</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#f8f8f2">}</span><span class="token template-string string" style="color:#a6e22e"> clients</span><span class="token template-string template-punctuation string" style="color:#a6e22e">`</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    gss</span><span class="token operator" style="color:#66d9ef">?.</span><span class="token function" style="color:#e6db74">forEach</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">client</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">client</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">readyState </span><span class="token operator" style="color:#66d9ef">===</span><span class="token plain"> WebSocket</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token constant" style="color:#e6db74">OPEN</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        client</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">send</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token constant" style="color:#e6db74">JSON</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">stringify</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">type</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="database-notifications">Database Notifications<a href="#database-notifications" class="hash-link" aria-label="Direct link to Database Notifications" title="Direct link to Database Notifications">​</a></h3>
<p>While WebSockets can be used to deliver notifications from DBOS to the client, a challenge arises if the database update was running on another virtual machine in the application group.  To detect this, we can watch for changes in the underlying database table, and use those updates to broadcast notifications to the WebSockets.</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token decorator at operator" style="color:#66d9ef">@</span><span class="token decorator function" style="color:#e6db74">trig</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">trigger</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">tableName</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;schedule&#x27;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> useDBNotifications</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> installDBTrigger</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">static</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">async</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">scheduleListener</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">_operation</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> TriggerOperation</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> _key</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> _record</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">unknown</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    SchedulerOps</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">notifyListeners</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&#x27;schedule&#x27;</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">Promise</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">resolve</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nextjs-custom-server">Next.js Custom Server<a href="#nextjs-custom-server" class="hash-link" aria-label="Direct link to Next.js Custom Server" title="Direct link to Next.js Custom Server">​</a></h3>
<p>While many Next.js applications are &quot;serverless&quot;, several of the features in DBOS Task Scheduler require a &quot;custom server&quot;.  This file, located in <code>src/server.ts</code>, handles the following:</p>
<ul>
<li>Sets up all DBOS application code so that it is all available before serving requests.</li>
<li>Launches DBOS, which starts any necessary workflow recovery.</li>
<li>Creates an HTTP server with the WebSockets extension.</li>
<li>Directs any requests starting with <code>/dbos</code> to DBOS handler logic, allowing DBOS routing to function alongside Next.js</li>
<li>Sets up WebSockets so that the web client hears about new events and results quickly, without polling</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-importance-of-globalthis">The Importance of <code>globalThis</code><a href="#the-importance-of-globalthis" class="hash-link" aria-label="Direct link to the-importance-of-globalthis" title="Direct link to the-importance-of-globalthis">​</a></h4>
<p>Next.js creates multiple &quot;bundles&quot; that contain minimized code for handling each request type.  These bundles have their own copies of what would otherwise be &quot;global&quot; variables.  If you intend to share data across bundles and with the DBOS logic in <code>server.ts</code>, you should use <code>globalThis</code> or a similar construct.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration-files">Configuration Files<a href="#configuration-files" class="hash-link" aria-label="Direct link to Configuration Files" title="Direct link to Configuration Files">​</a></h2>
<p>DBOS Task Scheduler relies on a significant number of configuration files.  While most of these are standard, the following have sections that are specific to this app:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dbos-configyaml"><code>dbos-config.yaml</code><a href="#dbos-configyaml" class="hash-link" aria-label="Direct link to dbos-configyaml" title="Direct link to dbos-configyaml">​</a></h3>
<p><a href="https://docs.dbos.dev/typescript/reference/configuration" target="_blank" rel="noopener noreferrer"><code>dbos-config.yaml</code></a> provides the start command and migrations so that the app runs in DBOS Cloud.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="knexfilets"><code>knexfile.ts</code><a href="#knexfilets" class="hash-link" aria-label="Direct link to knexfilets" title="Direct link to knexfilets">​</a></h3>
<p>This file is used by <code>knex</code> to establish a database connection for running migrations, and uses the DBOS_DATABASE_URL environment variable so the the app will run in DBOS Cloud.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nextconfigts"><code>next.config.ts</code><a href="#nextconfigts" class="hash-link" aria-label="Direct link to nextconfigts" title="Direct link to nextconfigts">​</a></h3>
<p>It is important keep the DBOS library, and any workflow functions or other code used by DBOS, external to Next.js bundles.
This prevents incomplete, duplicate, and incorrect registration of functions.  For this project, we import all DBOS logic with the prefix <code>@dbos/</code>, and ask the bundler to treat such files as external:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function-variable function" style="color:#e6db74">webpack</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> isServer</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dev</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> _dev </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">isServer</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">externals </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token operator" style="color:#66d9ef">...</span><span class="token plain">config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">externals</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token string-property property" style="color:#f92672">&quot;@dbos-inc/dbos-sdk&quot;</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;commonjs @dbos-inc/dbos-sdk&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// Treat @dbos-inc/dbos-sdk as external</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex anchor function" style="color:#e6db74">^</span><span class="token regex regex-source language-regex">@dbos</span><span class="token regex regex-source language-regex escape">\/</span><span class="token regex regex-source language-regex char-set class-name" style="color:#e6db74">.</span><span class="token regex regex-source language-regex quantifier number" style="color:#ae81ff">+</span><span class="token regex regex-source language-regex anchor function" style="color:#e6db74">$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#8292a2;font-style:italic">// Treat ALL `@dbos/*` imports (from src/dbos) as external</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> config</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><br></span></code></pre></div></div>
<p>To allow server actions to work in DBOS Cloud, the following was added:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">  experimental</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    serverActions</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      allowedOrigins</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#a6e22e">&#x27;*.cloud.dbos.dev&#x27;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token comment" style="color:#8292a2;font-style:italic">// Allow DBOS Cloud to call server actions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/typescript/examples/kafka-alert-queue"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Kafka Alert Queue</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#running-dbos-task-scheduler-in-dbos-cloud" class="table-of-contents__link toc-highlight">Running DBOS Task Scheduler in DBOS Cloud</a></li><li><a href="#running-dbos-task-scheduler-locally" class="table-of-contents__link toc-highlight">Running DBOS Task Scheduler Locally</a><ul><li><a href="#setting-up-a-database" class="table-of-contents__link toc-highlight">Setting Up A Database</a></li><li><a href="#running-in-development" class="table-of-contents__link toc-highlight">Running In Development</a></li><li><a href="#production-builds" class="table-of-contents__link toc-highlight">Production Builds</a></li></ul></li><li><a href="#dbos-task-schedulers-web-ui" class="table-of-contents__link toc-highlight">DBOS Task Scheduler&#39;s Web UI</a></li><li><a href="#setting-up-email-notifications-optional" class="table-of-contents__link toc-highlight">Setting Up Email Notifications (Optional)</a></li><li><a href="#dbos-and-database-logic" class="table-of-contents__link toc-highlight">DBOS and Database Logic</a><ul><li><a href="#task-code" class="table-of-contents__link toc-highlight">Task Code</a></li><li><a href="#main-workflow" class="table-of-contents__link toc-highlight">Main Workflow</a></li><li><a href="#scheduling" class="table-of-contents__link toc-highlight">Scheduling</a></li><li><a href="#database-schema-and-transactions" class="table-of-contents__link toc-highlight">Database Schema and Transactions</a></li></ul></li><li><a href="#ui" class="table-of-contents__link toc-highlight">UI</a><ul><li><a href="#ui-components" class="table-of-contents__link toc-highlight">UI Components</a></li><li><a href="#server-actions" class="table-of-contents__link toc-highlight">Server Actions</a></li><li><a href="#sending-email-with-amazon-ses" class="table-of-contents__link toc-highlight">Sending Email with Amazon SES</a></li><li><a href="#websockets" class="table-of-contents__link toc-highlight">WebSockets</a></li><li><a href="#database-notifications" class="table-of-contents__link toc-highlight">Database Notifications</a></li><li><a href="#nextjs-custom-server" class="table-of-contents__link toc-highlight">Next.js Custom Server</a><ul><li><a href="#the-importance-of-globalthis" class="table-of-contents__link toc-highlight">The Importance of <code>globalThis</code></a></li></ul></li></ul></li><li><a href="#configuration-files" class="table-of-contents__link toc-highlight">Configuration Files</a><ul><li><a href="#dbos-configyaml" class="table-of-contents__link toc-highlight"><code>dbos-config.yaml</code></a></li><li><a href="#knexfilets" class="table-of-contents__link toc-highlight"><code>knexfile.ts</code></a></li><li><a href="#nextconfigts" class="table-of-contents__link toc-highlight"><code>next.config.ts</code></a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Follow Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/dbos-inc/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://bsky.app/profile/dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bluesky<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/DBOS_Inc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter/X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.dbos.dev/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.dbos.dev/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Questions or Comments?</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/fMwQjeW5zg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat with us on Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:contact@dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Write to us at contact@dbos.dev<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://dbos.dev" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="100"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="100"></a></div><div class="footer__copyright">Copyright © 2025 DBOS, Inc. | <a href="https://www.dbos.dev/privacy" target="_blank">Privacy Policy</a></div></div></div></footer></div>
</body>
</html>