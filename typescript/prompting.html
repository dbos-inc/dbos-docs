<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-typescript/prompting" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">AI-Assisted Development | DBOS Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.dbos.dev/typescript/prompting"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AI-Assisted Development | DBOS Docs"><meta data-rh="true" name="description" content="If you&#x27;re using an AI coding agent to build a DBOS application, make sure it has the latest information on DBOS by either:"><meta data-rh="true" property="og:description" content="If you&#x27;re using an AI coding agent to build a DBOS application, make sure it has the latest information on DBOS by either:"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.dbos.dev/typescript/prompting"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/typescript/prompting" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/typescript/prompting" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UY2VKOMIL2-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"AI-Assisted Development","item":"https://docs.dbos.dev/typescript/prompting"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="DBOS Docs" href="/opensearch.xml">


<link rel="preconnect" href="https://dbosdev.matomo.cloud/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://dbosdev.matomo.cloud/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>

<link rel="preconnect" href="https://d2j9bas80r5yfz.cloudfront.net">
<script>!function(t,e){var o,r,s,a;e.__SV||(window.posthog=e,e._i=[],e.init=function(n,i,p){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(s=t.createElement("script")).type="text/javascript",s.async=!0,s.src=i.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(a=t.getElementsByTagName("script")[0]).parentNode.insertBefore(s,a);var g=e;for(void 0!==p?g=e[p]=[]:p="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==p&&(e+="."+p),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),r=0;r<o.length;r++)c(g,o[r]);e._i.push([n,i,p])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_vKGgPmFevFB3QVyqZdIZeNqcWAPqk3i3mDhwGqwk6nP",{api_host:"https://d2j9bas80r5yfz.cloudfront.net",id:"default"})</script>
<script async defer="defer" id="hs-script-loader" src="//js.hs-scripts.com/45237820.js"></script>
<script src="/scripts/reo.js"></script><link rel="stylesheet" href="/assets/css/styles.292b392a.css">
<script src="/assets/js/runtime~main.b01611fc.js" defer="defer"></script>
<script src="/assets/js/main.db590a4a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://dbos.dev" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/quickstart">Quickstart</a><a class="navbar__item navbar__link" href="/examples">Examples</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://console.dbos.dev/login-redirect" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link dbos-button-blue">DBOS Console</a><a href="https://github.com/dbos-inc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/"><span title="Home" class="linkLabel_WmDU">Home</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quickstart"><span title="Get Started" class="linkLabel_WmDU">Get Started</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/why-dbos"><span title="Why DBOS?" class="linkLabel_WmDU">Why DBOS?</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/architecture"><span title="DBOS Architecture" class="linkLabel_WmDU">DBOS Architecture</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/python/programming-guide"><span title="Develop with Python" class="categoryLinkLabel_W154">Develop with Python</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/typescript/programming-guide"><span title="Develop with TypeScript" class="categoryLinkLabel_W154">Develop with TypeScript</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/programming-guide"><span title="Learn DBOS TypeScript" class="linkLabel_WmDU">Learn DBOS TypeScript</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/integrating-dbos"><span title="Add DBOS To Your App" class="linkLabel_WmDU">Add DBOS To Your App</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/typescript/prompting"><span title="AI-Assisted Development" class="linkLabel_WmDU">AI-Assisted Development</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/typescript/tutorials/workflow-tutorial"><span title="Tutorials" class="categoryLinkLabel_W154">Tutorials</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/typescript/reference/dbos-class"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/typescript/examples/checkout-tutorial"><span title="Example Applications" class="categoryLinkLabel_W154">Example Applications</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/typescript/upgrading"><span title="Upgrading to TSv3" class="linkLabel_WmDU">Upgrading to TSv3</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/golang/programming-guide"><span title="Develop with Go" class="categoryLinkLabel_W154">Develop with Go</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/java/programming-guide"><span title="Develop with Java" class="categoryLinkLabel_W154">Develop with Java</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/production/checklist"><span title="Deploy To Production" class="categoryLinkLabel_W154">Deploy To Production</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/integrations/supabase"><span title="Integrations" class="categoryLinkLabel_W154">Integrations</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/explanations/system-tables"><span title="Concepts and Explanations" class="categoryLinkLabel_W154">Concepts and Explanations</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq"><span title="Troubleshooting &amp; FAQ" class="linkLabel_WmDU">Troubleshooting &amp; FAQ</span></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Develop with TypeScript</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">AI-Assisted Development</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>AI-Assisted Development</h1></header><p>If you&#x27;re using an AI coding agent to build a DBOS application, make sure it has the latest information on DBOS by either:</p>
<ol>
<li class=""><a href="#dbos-agent-skills" class="">Installing DBOS skills.</a></li>
<li class=""><a href="#dbos-prompt" class="">Providing your agent with a DBOS prompt.</a></li>
</ol>
<p>You may also want to use the <a class="" href="/integrations/mcp">DBOS MCP server</a> so your model can directly access your application&#x27;s workflows and steps.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="dbos-agent-skills">DBOS Agent Skills<a href="#dbos-agent-skills" class="hash-link" aria-label="Direct link to DBOS Agent Skills" title="Direct link to DBOS Agent Skills" translate="no">â€‹</a></h2>
<p><a href="https://agentskills.io/home" target="_blank" rel="noopener noreferrer" class="">Agent Skills</a> help developers use AI agents to add DBOS durable workflows to their applications.
DBOS provides open-source skills you can check out <a href="https://github.com/dbos-inc/agent-skills" target="_blank" rel="noopener noreferrer" class="">here</a>.</p>
<p>To install them into your coding agent, run:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">npx skills add dbos-inc/agent-skills</span><br></span></code></pre></div></div>
<p>The <a href="https://skills.sh/" target="_blank" rel="noopener noreferrer" class="">Skills CLI</a> is compatible with most coding agents, including Claude Code, Codex, Antigravity, and Cursor.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="dbos-prompt">DBOS Prompt<a href="#dbos-prompt" class="hash-link" aria-label="Direct link to DBOS Prompt" title="Direct link to DBOS Prompt" translate="no">â€‹</a></h2>
<p>You can use this prompt to add rich information about DBOS to your AI coding agent&#x27;s context.
You can copy and paste it directly into your context, or follow these directions to add it to your AI-powered IDE or coding agent of choice:</p>
<ul>
<li class="">Claude Code: Add the prompt, or a link to it, to your CLAUDE.md file.</li>
<li class="">Cursor: Add the prompt to <a href="https://docs.cursor.com/context/rules-for-ai" target="_blank" rel="noopener noreferrer" class="">your project rules</a>.</li>
<li class="">GitHub Copilot: Create a <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot" target="_blank" rel="noopener noreferrer" class=""><code>.github/copilot-instructions.md</code></a> file in your repository and add the prompt to it.</li>
</ul>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>DBOS TypeScript Prompt</strong></summary><div><div class="collapsibleContent_i85q"><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token title important punctuation" style="color:#f8f8f2">#</span><span class="token title important"> Build Reliable Applications With DBOS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Guidelines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Respond in a friendly and concise manner</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Ask clarifying questions when requirements are ambiguous</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Generate code in TypeScript using the DBOS library. Make sure to fully type everything.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> You MUST import all methods and classes used in the code you generate</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> You SHALL keep all code in a single file unless otherwise specified.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> You MUST await all promises.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> DBOS does NOT stand for anything.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Guidelines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows provide durable execution so you can write programs that are resilient to any failure.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows are comprised of steps, which are ordinary TypeScript functions called with DBOS.runStep().</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When using DBOS workflows, you should call any function that performs complex operations or accesses external APIs or services as a step using DBOS.runStep.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If a workflow is interrupted for any reason (e.g., an executor restarts or crashes), when your program restarts the workflow automatically resumes execution from the last completed step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> If asked to add DBOS to existing code, you MUST ask which function to make a workflow. Do NOT recommend any changes until they have told you what function to make a workflow. Do NOT make a function a workflow unless SPECIFICALLY requested.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> When making a function a workflow, you should make all functions it calls steps. Do NOT change the functions in any way.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Do NOT make functions steps unless they are DIRECTLY called by a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> If the workflow function performs a non-deterministic action, you MUST move that action to its own function and make that function a step. Examples of non-deterministic actions include accessing an external API or service, accessing files on disk, generating a random number, of getting the current time.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Do NOT use Promise.all() due to the risks posed by multiple rejections.  Using Promise.allSettled() for parallelism is allowed for single-step promises only.  For any complex parallel execution, you should instead use DBOS.startWorkflow and DBOS queues to achieve the parallelism.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> DBOS workflows and steps should NOT have side effects in memory outside of their own scope. They can access global variables, but they should NOT create or update global variables or variables outside their scope.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Do NOT call any DBOS context method (DBOS.send, DBOS.recv, DBOS.startWorkflow, DBOS.sleep, DBOS.setEvent, DBOS.getEvent) from a step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Do NOT start workflows from inside a step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Do NOT call DBOS.setEvent and DBOS.recv from outside a workflow function.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Do NOT use DBOS.getApi, DBOS.postApi, or other DBOS HTTP annotations. These are DEPRECATED. Instead, use Express for HTTP serving by default, unless another web framework is specified.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> DBOS Lifecycle Guidelines</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS should be installed and imported from the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`@dbos-inc/dbos-sdk`</span><span class="token plain"> package.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Due to its internal workflow registry, The DBOS library and DBOS workflows cannot be bundled with JavaScript or TypeScript bundlers (Webpack, Vite, Rollup, esbuild, Parcel, etc.) and must be treated as an external library by these tools.  Configuration for bundlers should be suggested if these tools are in use and cannot be avoided.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS does not support &quot;serverless&quot; frameworks due to its long-running background jobs.  DBOS programs MUST have a starting file (typically &#x27;main.ts&#x27; or &#x27;server.ts&#x27;) that creates all objects and workflow functions during startup.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Any DBOS program MUST call DBOS.setConfig and DBOS.launch in its main function, like so.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You MUST use this default configuration (changing the name as appropriate) unless otherwise specified.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">DBOS.setConfig({</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  &quot;name&quot;: &quot;dbos-node-starter&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  &quot;systemDatabaseUrl&quot;: process.env.DBOS_SYSTEM_DATABASE_URL,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">await DBOS.launch();</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Here is an example main function using Express:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">import { DBOS } from &quot;@dbos-inc/dbos-sdk&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.setConfig({</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    &quot;name&quot;: &quot;dbos-node-starter&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    &quot;systemDatabaseUrl&quot;: process.env.DBOS_SYSTEM_DATABASE_URL,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.launch();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const PORT = 3000;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  app.listen(PORT, () =&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    console.log(`ðŸš€ Server is running on http://localhost:${PORT}`);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">main().catch(console.log);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow and Steps Examples</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Simple example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">import { DBOS } from &quot;@dbos-inc/dbos-sdk&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function stepOne() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.logger.info(&quot;Step one completed!&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function stepTwo() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.logger.info(&quot;Step two completed!&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function exampleFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.runStep(() =&gt; stepOne());</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.runStep(() =&gt; stepTwo());</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const exampleWorkflow = DBOS.registerWorkflow(exampleFunction);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.setConfig({</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    &quot;name&quot;: &quot;dbos-node-starter&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    &quot;systemDatabaseUrl&quot;: process.env.DBOS_SYSTEM_DATABASE_URL,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.launch();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await exampleWorkflow();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.shutdown();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">main().catch(console.log);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example with Express:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">import { DBOS } from &quot;@dbos-inc/dbos-sdk&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">import express from &quot;express&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">export const app = express();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">app.use(express.json());</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function stepOne() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.logger.info(&quot;Step one completed!&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function stepTwo() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.logger.info(&quot;Step two completed!&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function exampleFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.runStep(() =&gt; stepOne());</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.runStep(() =&gt; stepTwo());</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const exampleWorkflow = DBOS.registerWorkflow(exampleFunction);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">app.get(&quot;/&quot;, async (req, res) =&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await exampleWorkflow();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  res.send();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.setConfig({</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    &quot;name&quot;: &quot;dbos-node-starter&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    &quot;systemDatabaseUrl&quot;: process.env.DBOS_SYSTEM_DATABASE_URL,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.launch();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const PORT = 3000;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  app.listen(PORT, () =&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    console.log(`ðŸš€ Server is running on http://localhost:${PORT}`);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">main().catch(console.log);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example with queues:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">import { DBOS, WorkflowQueue } from &quot;@dbos-inc/dbos-sdk&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">import express from &quot;express&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">export const app = express();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">app.use(express.json());</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const queue = new WorkflowQueue(&quot;example_queue&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function taskFunction(n: number) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.sleep(5000);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.logger.info(`Task ${n} completed!`)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const taskWorkflow = DBOS.registerWorkflow(taskFunction);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function queueFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.logger.info(&quot;Enqueueing tasks!&quot;)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const handles = []</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  for (let i = 0; i &lt; 10; i++) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    handles.push(await DBOS.startWorkflow(taskWorkflow, { queueName: queue.name })(i))</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const results = []</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  for (const h of handles) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    results.push(await h.getResult())</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.logger.info(`Successfully completed ${results.length} tasks`)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const queueWorkflow = DBOS.registerWorkflow(queueFunction)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">app.get(&quot;/&quot;, async (req, res) =&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await queueWorkflow();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  res.send();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.setConfig({</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    &quot;name&quot;: &quot;dbos-node-starter&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    &quot;systemDatabaseUrl&quot;: process.env.DBOS_SYSTEM_DATABASE_URL,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.launch();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const PORT = 3000;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  app.listen(PORT, () =&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    console.log(`ðŸš€ Server is running on http://localhost:${PORT}`);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">main().catch(console.log);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Scheduled Workflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can schedule DBOS workflows to run exactly once per time interval.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To do this, use the the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.registerScheduled`</span><span class="token plain"> method or the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.scheduled`</span><span class="token plain"> decorator and specify the schedule in crontab syntax.  For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> A scheduled workflow MUST specify a crontab schedule.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> It MUST take in two arguments, scheduled and actual time. Both are Date of when the workflow started.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">async function scheduledFunction(schedTime: Date, startTime: Date) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    DBOS.logger.info(`I am a workflow scheduled to run every 30 seconds`);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">const scheduledWorkflow = DBOS.registerWorkflow(scheduledFunction);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">DBOS.registerScheduled(scheduledWorkflow, {crontab: &#x27;*/30 * * * * *&#x27;});</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Or using decorators:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">class ScheduledExample{</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  @DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  @DBOS.scheduled({crontab: &#x27;*/30 * * * * *&#x27;})</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  static async scheduledWorkflow(schedTime: Date, startTime: Date) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    DBOS.logger.info(`I am a workflow scheduled to run every 30 seconds`);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Documentation:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows provide </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">durable execution</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> so you can write programs that are </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">resilient to any failure</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows are comprised of steps, which wrap ordinary TypeScript (or JavaScript) functions.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If a workflow is interrupted for any reason (e.g., an executor restarts or crashes), when your program restarts the workflow automatically resumes execution from the last completed step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To write a workflow, register a TypeScript function with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.registerWorkflow`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The function&#x27;s inputs and outputs must be serializable to JSON.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">async function stepOne() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  DBOS.logger.info(&quot;Step one completed!&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">async function stepTwo() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  DBOS.logger.info(&quot;Step two completed!&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">async function workflowFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await DBOS.runStep(() =&gt; stepOne(), {name: &quot;stepOne&quot;});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await DBOS.runStep(() =&gt; stepTwo(), {name: &quot;stepTwo&quot;});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">const workflow = DBOS.registerWorkflow(workflowFunction)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">await workflow();</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Alternatively, you can register workflows and steps with decorators:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">export class Example {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  @DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  static async stepOne() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    DBOS.logger.info(&quot;Step one completed!&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  @DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  static async stepTwo() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    DBOS.logger.info(&quot;Step two completed!&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // Call steps from workflows</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  @DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  static async exampleWorkflow() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    await Toolbox.stepOne();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    await Toolbox.stepTwo();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">await Example.exampleWorkflow();</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Starting Workflows In The Background</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">One common use-case for workflows is building reliable background tasks that keep running even when your program is interrupted, restarted, or crashes.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.startWorkflow`</span><span class="token plain"> to start a workflow in the background.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you start a workflow this way, it returns a workflow handle, from which you can access information about the workflow or wait for it to complete and retrieve its result.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Here&#x27;s an example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">class Example {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    @DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    static async exampleWorkflow(var1: string, var2: string) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">        return var1 + var2;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // Start exampleWorkflow in the background</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    const handle = await DBOS.startWorkflow(Example).exampleWorkflow(&quot;one&quot;, &quot;two&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // Wait for the workflow to complete and return its results</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    const result = await handle.getResult();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">After starting a workflow in the background, you can use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.retrieveWorkflow`</span><span class="token plain"> to retrieve a workflow&#x27;s handle from its ID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can also retrieve a workflow&#x27;s handle from outside of your DBOS application with &#x27;DBOSClient.retrieveWorkflow`.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you need to run many workflows in the background and manage their concurrency or flow control, you can also use DBOS queues.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow IDs and Idempotency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Every time you execute a workflow, that execution is assigned a unique ID, by default a UUID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can access this ID through the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.workflowID`</span><span class="token plain"> context variable.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflow IDs are useful for communicating with workflows and developing interactive workflows.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set the workflow ID of a workflow as an argument to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.startWorkflow()`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflow IDs must be </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">globally unique</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> for your application.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">An assigned workflow ID acts as an idempotency key: if a workflow is called multiple times with the same ID, it executes only once.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is useful if your operations have side effects like making a payment or sending an email.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflow IDs are also useful for communicating with workflows and developing interactive workflows - see Communicating with Workflows for more details.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">class Example {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    @DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    static async exampleWorkflow(var1: string, var2: string) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">        // ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    const myID: string = ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    const handle = await DBOS.startWorkflow(Example, {workflowID: myID}).exampleWorkflow(&quot;one&quot;, &quot;two&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    const result = await handle.getResult();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Determinism</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows are in most respects normal TypeScript functions.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">They can have loops, branches, conditionals, and so on.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">However, a workflow function must be </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">deterministic</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: if called multiple times with the same inputs, it should invoke the same steps with the same inputs in the same order (given the same return values from those steps).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you need to perform a non-deterministic operation like accessing the database, calling a third-party API, generating a random number, or getting the local time, you shouldn&#x27;t do it directly in a workflow function.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Instead, you should do all database operations in transactions and all other non-deterministic operations in steps.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">don&#x27;t do this</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">async function exampleWorkflowFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    const choice = Math.random() &gt; 0.5 ? 1 : 0;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    if (choice === 0) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">        await stepOne();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    } else {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">        await stepTwo();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const exampleWorkflow = DBOS.registerWorkflow(exampleWorkflowFunction);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Do this instead:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">async function exampleWorkflowFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    const choice = await DBOS.runStep(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">        () =&gt; Promise.resolve(Math.random() &gt; 0.5 ? 1 : 0),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">        { name: &quot;generateChoice&quot; }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    );</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    if (choice === 0) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">        await stepOne();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    } else {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">        await stepTwo();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const exampleWorkflow = DBOS.registerWorkflow(exampleWorkflowFunction);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Running Steps In Parallel</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Initiating several concurrent steps in a workflow, followed by awaiting them with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`Promise.allSettled`</span><span class="token plain">, is valid as long as the steps are started in a deterministic order.  For example the following is allowed:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">const results = await Promise.allSettled([</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  step1(&quot;arg1&quot;),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  step2(&quot;arg2&quot;),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  step3(&quot;arg3&quot;),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  step4(&quot;arg4&quot;),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">])</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is allowed because each step is started in a well-defined sequence before awaiting.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">By contrast, the following is not allowed:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">const results = await Promise.allSettled([</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  async () =&gt; { await step1(&quot;arg1&quot;); await step2(&quot;arg3&quot;); },</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  async () =&gt; { await step3(&quot;arg2&quot;); await step4(&quot;arg4&quot;); },</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">]);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Here, </span><span class="token code-snippet code keyword" style="color:#66d9ef">`step2`</span><span class="token plain"> and </span><span class="token code-snippet code keyword" style="color:#66d9ef">`step4`</span><span class="token plain"> may be started in either order since their execution depends on the relative time taken by </span><span class="token code-snippet code keyword" style="color:#66d9ef">`step1`</span><span class="token plain"> and </span><span class="token code-snippet code keyword" style="color:#66d9ef">`step3`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you need to run sequences of operations concurrently, start child workflows with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`startWorkflow`</span><span class="token plain"> and await the results from their </span><span class="token code-snippet code keyword" style="color:#66d9ef">`WorkflowHandle`</span><span class="token plain">s.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Avoid using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`Promise.all`</span><span class="token plain"> because of how it handles errors and rejections.  When any promise rejects, </span><span class="token code-snippet code keyword" style="color:#66d9ef">`Promise.all`</span><span class="token plain"> immediately fails, leaving the other promises unresolved.  If one of those later throws an unhandled exception, it can crash your Node.js process.  Instead, prefer </span><span class="token code-snippet code keyword" style="color:#66d9ef">`Promise.allSettled`</span><span class="token plain">, which safely waits for all promises to complete and reports their outcomes.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Timeouts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set a timeout for a workflow by passing a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`timeoutMS`</span><span class="token plain"> argument to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.startWorkflow`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When the timeout expires, the workflow </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">and all its children</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> are cancelled.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Cancelling a workflow sets its status to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`CANCELLED`</span><span class="token plain"> and preempts its execution at the beginning of its next step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Timeouts are </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">start-to-completion</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: a workflow&#x27;s timeout does not begin until the workflow starts execution.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Also, timeouts are </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">durable</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: they are stored in the database and persist across restarts, so workflows can have very long timeouts.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example syntax:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">async function taskFunction(task) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const taskWorkflow = DBOS.registerWorkflow(taskFunction);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const task = ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const timeout = ... // Timeout in milliseconds</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const handle = await DBOS.startWorkflow(taskWorkflow, {timeoutMS: timeout})(task);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Durable Sleep</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.sleep()`</span><span class="token plain"> to put your workflow to sleep for any period of time.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This sleep is </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">durable</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token entity named-entity">&amp;mdash;</span><span class="token plain">DBOS saves the wakeup time in the database so that even if the workflow is interrupted and restarted multiple times while sleeping, it still wakes up on schedule.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Sleeping is useful for scheduling a workflow to run in the future (even days, weeks, or months from now).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">static async exampleWorkflow(timeToSleep, task) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    await DBOS.sleep(timeToSleep);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    await runTask(task);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Debouncing Workflows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can create a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`Debouncer`</span><span class="token plain"> to debounce your workflows.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Debouncing delays workflow execution until some time has passed since the workflow has last been called.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is useful for preventing wasted work when a workflow may be triggered multiple times in quick succession.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, if a user is editing an input field, you can debounce their changes to execute a processing workflow only after they haven&#x27;t edited the field for some time:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Debouncer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">new Debouncer&lt;Args extends unknown[], Return&gt;(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  params: DebouncerConfig&lt;Args, Return&gt;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">interface DebouncerConfig&lt;Args extends unknown[], Return&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  workflow: (...args: Args) =&gt; Promise&lt;Return&gt;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  startWorkflowParams?: StartWorkflowParams;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  debounceTimeoutMs?: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Parameters:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">workflow</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: The workflow to debounce. Note that workflows from configured instances cannot be debounced.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">startWorkflowParams</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Optional workflow parameters, as in </span><span class="token code-snippet code keyword" style="color:#66d9ef">`startWorkflow`</span><span class="token plain">. Applied to all workflows started from this debouncer.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">debounceTimeoutMs</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: After this time elapses since the first time a workflow is submitted from this debouncer, the workflow is started regardless of the debounce period.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> debouncer.debounce</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">debouncer.debounce(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  debounceKey: string,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  debouncePeriodMs: number,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  ...args: Args</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">): Promise&lt;WorkflowHandle&lt;Return&gt;&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Submit a workflow for execution but delay it by </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debouncePeriodMs`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Returns a handle to the workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The workflow may be debounced again, which further delays its execution (up to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debounceTimeoutMs`</span><span class="token plain">).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When the workflow eventually executes, it uses the </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">last</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> set of inputs passed into </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debounce`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">After the workflow begins execution, the next call to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`debounce`</span><span class="token plain"> starts the debouncing process again for a new workflow execution.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Parameters:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">debounceKey</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: A key used to group workflow executions that will be debounced together. For example, if the debounce key is set to customer ID, each customer&#x27;s workflows would be debounced separately.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">debouncePeriodMs</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Delay this workflow&#x27;s execution by this period in milliseconds.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">...args</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Variadic workflow arguments.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Example Syntax</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">async function processInput(userInput: string) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">const processInputWorkflow = DBOS.registerWorkflow(processInput);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">// Each time a user submits a new input, debounce the processInput workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">// The workflow will wait until 60 seconds after the user stops submitting new inputs,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">// then process the last input submitted.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">const debouncer = new Debouncer({</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  workflow: processInputWorkflow,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">async function onUserInputSubmit(userId: string, userInput: string) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  const debounceKey = userId;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  const debouncePeriodMs = 60000; // 60 seconds</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await debouncer.debounce(debounceKey, debouncePeriodMs, userInput);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Communication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS provides a few different ways to communicate with your workflows.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Send messages to workflows</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Publish events from workflows for clients to read</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> Stream values from workflows to clients</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Messaging and Notifications</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can send messages to a specific workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is useful for signaling a workflow or sending notifications to it while it&#x27;s running.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">&lt;img src={require(&#x27;@site/static/img/workflow-communication/workflow-messages.png&#x27;).default} alt=&quot;DBOS Steps&quot; width=&quot;750&quot; className=&quot;custom-img&quot;/&gt;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Send</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.send&lt;T&gt;(destinationID: string, message: T, topic?: string): Promise&lt;void&gt;;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.send()`</span><span class="token plain"> to send a message to a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Messages can optionally be associated with a topic and are queued on the receiver per topic.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can also call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`send`</span><span class="token plain"> from outside of your DBOS application with the DBOS Client.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Recv</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.recv&lt;T&gt;(topic?: string, timeoutSeconds?: number): Promise&lt;T | null&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows can call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.recv()`</span><span class="token plain"> to receive messages sent to them, optionally for a particular topic.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Each call to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`recv()`</span><span class="token plain"> waits for and consumes the next message to arrive in the queue for the specified topic, returning </span><span class="token code-snippet code keyword" style="color:#66d9ef">`null`</span><span class="token plain"> if the wait times out.  The default timeout is 60 seconds.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If the topic is not specified, this method only receives messages sent without a topic.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Messages Example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Messages are especially useful for sending notifications to a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, in the e-commerce demo, the checkout workflow, after redirecting customers to a secure payments service, must wait for a notification from that service that the payment has finished processing.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To wait for this notification, the payments workflow uses </span><span class="token code-snippet code keyword" style="color:#66d9ef">`recv()`</span><span class="token plain">, executing failure-handling code if the notification doesn&#x27;t arrive in time:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">static async checkoutWorkflow(...): Promise&lt;void&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const notification = await DBOS.recv&lt;string&gt;(PAYMENT_STATUS, timeout);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  if (notification) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">      ... // Handle the notification.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  } else {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">      ... // Handle a timeout.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">A webhook waits for the payment processor to send the notification, then uses </span><span class="token code-snippet code keyword" style="color:#66d9ef">`send()`</span><span class="token plain"> to forward it to the workflow:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">static async paymentWebhook(): Promise&lt;void&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const notificationMessage = ... // Parse the notification.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const workflowID = ... // Retrieve the workflow ID from notification metadata.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.send(workflowID, notificationMessage, PAYMENT_STATUS);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Reliability Guarantees</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">All messages are persisted to the database, so if </span><span class="token code-snippet code keyword" style="color:#66d9ef">`send`</span><span class="token plain"> completes successfully, the destination workflow is guaranteed to be able to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`recv`</span><span class="token plain"> it.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you&#x27;re sending a message from a workflow, DBOS guarantees exactly-once delivery.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you&#x27;re sending a message from normal TypeScript code, you can specify an idempotency key for </span><span class="token code-snippet code keyword" style="color:#66d9ef">`send`</span><span class="token plain"> to guarantee exactly-once delivery.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Events</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows can publish </span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token italic content">events</span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token plain">, which are key-value pairs associated with the workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">They are useful for publishing information about the status of a workflow or to send a result to clients while the workflow is running.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">&lt;img src={require(&#x27;@site/static/img/workflow-communication/workflow-events.png&#x27;).default} alt=&quot;DBOS Steps&quot; width=&quot;750&quot; className=&quot;custom-img&quot;/&gt;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> setEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.setEvent&lt;T&gt;(key: string, value: T): Promise&lt;void&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Any workflow can call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.setEvent`</span><span class="token plain"> to publish a key-value pair, or update its value if has already been published.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> getEvent</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.getEvent&lt;T&gt;(workflowID: string, key: string, timeoutSeconds?: number): Promise&lt;T | null&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.getEvent`</span><span class="token plain"> to retrieve the value published by a particular workflow ID for a particular key.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If the event does not yet exist, this call waits for it to be published, returning </span><span class="token code-snippet code keyword" style="color:#66d9ef">`null`</span><span class="token plain"> if the wait times out.  Default timeout is 60 seconds.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can also call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`getEvent`</span><span class="token plain"> from outside of your DBOS application with DBOS Client.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Events Example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Events are especially useful for writing interactive workflows that communicate information to their caller.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, in the e-commerce demo, the checkout workflow, after validating an order, directs the customer to a secure payments service to handle credit card processing.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To communicate the payments URL to the customer, it uses events.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The checkout workflow emits the payments URL using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`setEvent()`</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">static async checkoutWorkflow(...): Promise&lt;void&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const paymentsURL = ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.setEvent(PAYMENT_URL, paymentsURL);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  ... </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The HTTP handler that originally started the workflow uses </span><span class="token code-snippet code keyword" style="color:#66d9ef">`getEvent()`</span><span class="token plain"> to await this URL, then redirects the customer to it:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">static async webCheckout(...): Promise&lt;void&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const handle = await DBOS.startWorkflow(Shop).checkoutWorkflow(...);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const url = await DBOS.getEvent&lt;string&gt;(handle.workflowID, PAYMENT_URL);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  if (url === null) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    DBOS.koaContext.redirect(`${origin}/checkout/cancel`);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  } else {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    DBOS.koaContext.redirect(url);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Reliability Guarantees</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">All events are persisted to the database, so the latest version of an event is always retrievable.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Additionally, if </span><span class="token code-snippet code keyword" style="color:#66d9ef">`getEvent`</span><span class="token plain"> is called in a workflow, the retrieved value is persisted in the database so workflow recovery can use that value, even if the event is later updated.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Streaming</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows can stream data in real time to clients.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is useful for streaming results from a long-running workflow or LLM call or for monitoring or progress reporting.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">&lt;img src={require(&#x27;@site/static/img/workflow-communication/workflow-streams.png&#x27;).default} alt=&quot;DBOS Steps&quot; width=&quot;750&quot; className=&quot;custom-img&quot;/&gt;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Writing to Streams</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.writeStream&lt;T&gt;(key: string, value: T): Promise&lt;void&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can write values to a stream from a workflow or its steps using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.writeStream`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">A workflow may have any number of streams, each identified by a unique key.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When you are done writing to a stream, you should close it with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.closeStream`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Otherwise, streams are automatically closed when the workflow terminates.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.closeStream(key: string): Promise&lt;void&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS streams are immutable and append-only.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Writes to a stream from a workflow happen exactly-once.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Writes to a stream from a step happen at-least-once; if a step fails and is retried, it may write to the stream multiple times.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Readers will see all values written to the stream from all tries of the step in the order in which they were written.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Example syntax:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">async function producerWorkflowFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await DBOS.writeStream(&quot;example_key&quot;, { step: 1, data: &quot;value1&quot; });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await DBOS.writeStream(&quot;example_key&quot;, { step: 2, data: &quot;value2&quot; });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await DBOS.closeStream(&quot;example_key&quot;); // Signal completion</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">const producerWorkflow = DBOS.registerWorkflow(producerWorkflowFunction);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Reading from Streams</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.readStream&lt;T&gt;(workflowID: string, key: string): AsyncGenerator&lt;T, void, unknown&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can read values from a stream from anywhere using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.readStream`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This function reads values from a stream identified by a workflow ID and key, yielding each value in order until the stream is closed or the workflow terminates.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can also read from a stream from outside a DBOS application with a DBOS Client.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Example syntax:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">for await (const value of DBOS.readStream(workflowID, &quot;example_key&quot;)) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  console.log(`Received: ${JSON.stringify(value)}`);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Steps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When using DBOS workflows, you should call any function that performs complex operations or accesses external APIs or services as a </span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token italic content">step</span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If a workflow is interrupted, upon restart it automatically resumes execution from the </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">last completed step</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.runStep`</span><span class="token plain"> to call a function as a step.  For a function to be used as a step, it should have a return value that can be serialized as JSON, and should not have non-durable side effects. ALWAYS call steps this way unless otherwise specify.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">async function generateRandomNumber() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  return Math.random();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function workflowFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const randomNumber = await DBOS.runStep(() =&gt; generateRandomNumber(), {name: &quot;generateRandomNumber&quot;});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const workflow = DBOS.registerWorkflow(workflowFunction)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Alternatively, you can register a function as a step using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.registerStep`</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">NEVER do this unless specifically asked, ALWAYS use DBOS.runStep instead.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">async function generateRandomNumber() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  return Math.random();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const randomStep = DBOS.registerStep(generateRandomNumber);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function workflowFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const randomNumber = await randomStep();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const workflow = DBOS.registerWorkflow(workflowFunction)</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Or use the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`@DBOS.step()`</span><span class="token plain"> decorator:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">NEVER do this unless specifically asked, ALWAYS use DBOS.runStep instead.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">export class Example {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  @DBOS.step()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  static async generateRandomNumber() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    return Math.random();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  @DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  static async exampleWorkflow() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    await Example.generateRandomNumber();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">cannot</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> call, start, or enqueue workflows from within steps.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">These operations should be performed from workflow functions.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can call one step from another step, but the called step becomes part of the calling step&#x27;s execution rather than functioning as a separate step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Configurable Retries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can optionally configure a step to automatically retry any exception a set number of times with exponential backoff.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is useful for automatically handling transient failures, like making requests to unreliable APIs.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retries are configurable through arguments to the step decorator:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">export interface StepConfig {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  retriesAllowed?: boolean; // Should failures be retried? (default false)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  intervalSeconds?: number; // Seconds to wait before the first retry attempt (default 1).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  maxAttempts?: number;     // Maximum number of retry attempts (default 3). If errors occur more times than this, throw an exception.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  backoffRate?: number;     // Multiplier by which the retry interval increases after a retry attempt (default 2).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, let&#x27;s configure this step to retry exceptions (such as if </span><span class="token code-snippet code keyword" style="color:#66d9ef">`example.com`</span><span class="token plain"> is temporarily down) up to 10 times:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">async function fetchFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    return await fetch(&quot;https://example.com&quot;).then(r =&gt; r.text());</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function workflowFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    const randomNumber = await DBOS.runStep(() =&gt; fetchFunction(), {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">        name: &quot;fetchFunction&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">        retriesAllowed: true,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">        maxAttempts: 10</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Or if registering the step:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">async function fetchFunction() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    return await fetch(&quot;https://example.com&quot;).then(r =&gt; r.text());</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const fetchStep = DBOS.registerStep(fetchFunction, {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    retriesAllowed: true,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    maxAttempts: 10</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">});</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Or if using decorators:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">@DBOS.step({retriesAllowed: true, maxAttempts: 10})</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">static async exampleStep() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  return await fetch(&quot;https://example.com&quot;).then(r =&gt; r.text());</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If a step exhausts all </span><span class="token code-snippet code keyword" style="color:#66d9ef">`maxAttempts`</span><span class="token plain"> retries, it throws a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOSMaxStepRetriesError`</span><span class="token plain"> to the calling workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If that exception is not caught, the workflow terminates.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Queues</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use queues to run many workflows at once with managed concurrency.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Queues provide </span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token italic content">flow control</span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token plain">, letting you manage how many workflows run at once or how often workflows are started.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To create a queue, specify its name:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">import { DBOS, WorkflowQueue } from &quot;@dbos-inc/dbos-sdk&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const queue = new WorkflowQueue(&quot;example_queue&quot;);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can then enqueue any workflow by passing the queue as an argument to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.startWorkflow`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Enqueuing a function submits it for execution and returns a handle to it.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Queued tasks are started in first-in, first-out (FIFO) order.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">const queue = new WorkflowQueue(&quot;example_queue&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">class Tasks {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  @DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  static async processTask(task) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const task = ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const handle = await DBOS.startWorkflow(Tasks, {queueName: queue.name}).processTask(task)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Queue Example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Here&#x27;s an example of a workflow using a queue to process tasks in parallel:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">import { DBOS, WorkflowQueue } from &quot;@dbos-inc/dbos-sdk&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const queue = new WorkflowQueue(&quot;example_queue&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function taskFunction(task) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const taskWorkflow = DBOS.registerWorkflow(taskFunction, {&quot;name&quot;: &quot;taskWorkflow&quot;});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function queueFunction(tasks) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const handles = []</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  </span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  // Enqueue each task so all tasks are processed concurrently.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  for (const task of tasks) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    handles.push(await DBOS.startWorkflow(taskWorkflow, { queueName: queue.name })(task))</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  // Wait for each task to complete and retrieve its result.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  // Return the results of all tasks.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const results = []</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  for (const h of handles) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    results.push(await h.getResult())</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  return results</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const queueWorkflow = DBOS.registerWorkflow(queueFunction, {&quot;name&quot;: &quot;queueWorkflow&quot;})</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Enqueueing from Another Application</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Often, you want to enqueue a workflow from outside your DBOS application.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, let&#x27;s say you have an API server and a data processing service.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You&#x27;re using DBOS to build a durable data pipeline in the data processing service.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When the API server receives a request, it should enqueue the data pipeline for execution on the data processing service.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use the DBOS Client to enqueue workflows from outside your DBOS application by connecting directly to your DBOS application&#x27;s system database.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Since the DBOS Client is designed to be used from outside your DBOS application, workflow and queue metadata must be specified explicitly.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this code enqueues the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`dataPipeline`</span><span class="token plain"> workflow on the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`pipelineQueue`</span><span class="token plain"> queue with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`task`</span><span class="token plain"> as an argument.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">ts</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-ts">import { DBOSClient } from &quot;@dbos-inc/dbos-sdk&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">const client = await DBOSClient.create({systemDatabaseUrl: process.env.DBOS_SYSTEM_DATABASE_URL});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">type ProcessTask = typeof Tasks.processTask;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">await client.enqueue&lt;ProcessTask&gt;(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">        workflowName: &#x27;dataPipeline&#x27;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">        queueName: &#x27;pipelineQueue&#x27;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    },</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    task);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Managing Concurrency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can control how many workflows from a queue run simultaneously by configuring concurrency limits.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This helps prevent resource exhaustion when workflows consume significant memory or processing power.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> Worker Concurrency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Worker concurrency sets the maximum number of workflows from a queue that can run concurrently on a single DBOS process.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is particularly useful for resource-intensive workflows to avoid exhausting the resources of any process.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this queue has a worker concurrency of 5, so each process will run at most 5 workflows from this queue simultaneously:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">import { DBOS, WorkflowQueue } from &quot;@dbos-inc/dbos-sdk&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const queue = new WorkflowQueue(&quot;example_queue&quot;, { workerConcurrency: 5 });</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Note that DBOS uses </span><span class="token code-snippet code keyword" style="color:#66d9ef">`executorID`</span><span class="token plain"> to distinguish processes</span><span class="token entity named-entity">&amp;mdash;</span><span class="token plain">this is set automatically by Conductor and Cloud, but if those are not used it must be set to a unique value for each process through configuration.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> Global Concurrency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Global concurrency limits the total number of workflows from a queue that can run concurrently across all DBOS processes in your application.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this queue will have a maximum of 10 workflows running simultaneously across your entire application.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::warning</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Worker concurrency limits are recommended for most use cases.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Take care when using a global concurrency limit as any </span><span class="token code-snippet code keyword" style="color:#66d9ef">`PENDING`</span><span class="token plain"> workflow on the queue counts toward the limit, including workflows from previous application versions</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">import { DBOS, WorkflowQueue } from &quot;@dbos-inc/dbos-sdk&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const queue = new WorkflowQueue(&quot;example_queue&quot;, { concurrency: 10 });</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> In-Order Processing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use a queue with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`concurrency=1`</span><span class="token plain"> to guarantee sequential, in-order processing of events.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Only a single event will be processed at a time.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this app processes events sequentially in the order of their arrival:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">import { DBOS, WorkflowQueue } from &quot;@dbos-inc/dbos-sdk&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">import express from &quot;express&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const serialQueue = new WorkflowQueue(&quot;in_order_queue&quot;, { concurrency: 1 });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const app = express();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">class Tasks {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  @DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  static async processTask(task){</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // ... process task</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">app.get(&quot;/events/:event&quot;, async (req, res) =&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.startWorkflow(Tasks, {queueName: serialQueue.name}).processTask(req.params);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await res.send(&quot;Workflow Started!&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">// Launch DBOS and start the server</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.launch();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  app.listen(3000, () =&gt; {});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">main().catch(console.log);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Rate Limiting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set </span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token italic content">rate limits</span><span class="token italic punctuation" style="color:#f8f8f2">_</span><span class="token plain"> for a queue, limiting the number of functions that it can start in a given period.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Rate limits are global across all DBOS processes using this queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this queue has a limit of 50 with a period of 30 seconds, so it may not start more than 50 functions in 30 seconds:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">const queue = new WorkflowQueue(&quot;example_queue&quot;, { rateLimit: { limitPerPeriod: 50, periodSec: 30 } });</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Rate limits are especially useful when working with a rate-limited API, such as many LLM APIs.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Setting Timeouts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set a timeout for an enqueued workflow by passing a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`timeoutMS`</span><span class="token plain"> argument to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.startWorkflow`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When the timeout expires, the workflow </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">and all its children</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> are cancelled.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Cancelling a workflow sets its status to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`CANCELLED`</span><span class="token plain"> and preempts its execution at the beginning of its next step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Timeouts are </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">start-to-completion</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: a workflow&#x27;s timeout does not begin until the workflow is dequeued and starts execution.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Also, timeouts are </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">durable</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: they are stored in the database and persist across restarts, so workflows can have very long timeouts.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example syntax:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">const queue = new WorkflowQueue(&quot;example_queue&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function taskFunction(task) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const taskWorkflow = DBOS.registerWorkflow(taskFunction, {&quot;name&quot;: &quot;taskWorkflow&quot;});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const task = ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const timeout = ... // Timeout in milliseconds</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const handle = await DBOS.startWorkflow(taskWorkflow, {queueName: queue.name, timeoutMS: timeout})(task);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Partitioning Queues</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">partition</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> queues to distribute work across dynamically created queue partitions.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When you enqueue a workflow on a partitioned queue, you must supply a queue partition key.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Partitioned queues dequeue workflows and apply flow control limits for individual partitions, not for the entire queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Essentially, you can think of each partition as a &quot;subqueue&quot; you dynamically create by enqueueing a workflow with a partition key.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, suppose you want your users to each be able to run at most one task at a time.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can do this with a partitioned queue with a maximum concurrency limit of 1 where the partition key is user ID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Example Syntax</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">ts</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-ts">const queue = new WorkflowQueue(&quot;example_queue&quot;, { partitionQueue: true, concurrency: 1 });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">async function onUserTaskSubmission(userID: string, task: Task) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // Partition the task queue by user ID. As the queue has a</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // maximum concurrency of 1, this means that at most one</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // task can run at once per user (but tasks from different</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // users can run concurrently).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    await DBOS.startWorkflow(taskWorkflow, {queueName: queue.name, enqueueOptions: {queuePartitionKey: userID}})(task);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Sometimes, you want to apply global or per-worker limits to a partitioned queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can do this with </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">multiple levels of queueing</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Create two queues: a partitioned queue with per-partition limits and a non-partitioned queue with global limits.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Enqueue a &quot;concurrency manager&quot; workflow to the partitioned queue, which then enqueues your actual workflow</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">to the non-partitioned queue and awaits its result.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This ensures both queues&#x27; flow control limits are enforced on your workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">ts</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-ts">// By using two levels of queueing, we enforce both a concurrency limit of 1 on each partition</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">// and a global concurrency limit of 5, meaning that no more than 5 tasks can run concurrently</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">// across all partitions (and at most one task per partition).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">const concurrencyQueue = new WorkflowQueue(&quot;concurrency-queue&quot;, { concurrency: 5 });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">const partitionedQueue = new WorkflowQueue(&quot;partitioned-queue&quot;, { partitionQueue: true, concurrency: 1 });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">async function onUserTaskSubmission(userID: string, task: Task) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // First, enqueue a &quot;concurrency manager&quot; workflow to the partitioned</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // queue to enforce per-partition limits.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    await DBOS.startWorkflow(concurrencyManager, {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">        queueName: partitionedQueue.name,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">        enqueueOptions: { queuePartitionKey: userID }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    })(task);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">async function concurrencyManagerFunc(task: Task) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // The &quot;concurrency manager&quot; workflow enqueues the processTask</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // workflow on the non-partitioned queue and awaits its results</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // to enforce global flow control limits.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    const handle = await DBOS.startWorkflow(processTask, { queueName: concurrencyQueue.name })(task);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    return await handle.getResult();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">const concurrencyManager = DBOS.registerWorkflow(concurrencyManagerFunc, { name: &quot;concurrencyManager&quot; });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">async function processTaskFunc(task: Task) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">const processTask = DBOS.registerWorkflow(processTaskFunc, { name: &quot;processTask&quot; });</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Deduplication</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set a deduplication ID for an enqueued workflow as an argument to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.startWorkflow`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">At any given time, only one workflow with a specific deduplication ID can be enqueued in the specified queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If a workflow with a deduplication ID is currently enqueued or actively executing (status </span><span class="token code-snippet code keyword" style="color:#66d9ef">`ENQUEUED`</span><span class="token plain"> or </span><span class="token code-snippet code keyword" style="color:#66d9ef">`PENDING`</span><span class="token plain">), subsequent workflow enqueue attempt with the same deduplication ID in the same queue will raise a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOSQueueDuplicatedError`</span><span class="token plain"> exception.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, this is useful if you only want to have one workflow active at a time per user</span><span class="token entity named-entity">&amp;mdash;</span><span class="token plain">set the deduplication ID to the user&#x27;s ID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example syntax:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">const queue = new WorkflowQueue(&quot;example_queue&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function taskFunction(task) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const taskWorkflow = DBOS.registerWorkflow(taskFunction, {&quot;name&quot;: &quot;taskWorkflow&quot;});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const task = ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const dedup: string = ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  try {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    const handle = await DBOS.startWorkflow(taskWorkflow, {queueName: queue.name, enqueueOptions: {deduplicationID: dedup}})(task);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  } catch (e) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // Handle DBOSQueueDuplicatedError</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Priority</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can set a priority for an enqueued workflow as an argument to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.startWorkflow`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows with the same priority are dequeued in </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">FIFO (first in, first out)</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> order. Priority values can range from </span><span class="token code-snippet code keyword" style="color:#66d9ef">`1`</span><span class="token plain"> to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`2,147,483,647`</span><span class="token plain">, where </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">a low number indicates a higher priority</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If using priority, you must set </span><span class="token code-snippet code keyword" style="color:#66d9ef">`usePriority: true`</span><span class="token plain"> on your queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::tip</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflows without assigned priorities have the highest priority and are dequeued before workflows with assigned priorities.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">:::</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Example syntax:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">const queue = new WorkflowQueue(&quot;example_queue&quot;, {usePriority: true});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function taskFunction(task) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const taskWorkflow = DBOS.registerWorkflow(taskFunction, {&quot;name&quot;: &quot;taskWorkflow&quot;});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const task = ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const priority: number = ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const handle = await DBOS.startWorkflow(taskWorkflow, {queueName: queue.name, enqueueOptions: {priority: priority}})(task);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Explicit Queue Listening</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">By default, a process running DBOS listens to (dequeues workflows from) all declared queues.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">However, sometimes you only want a process to listen to a specific list of queues.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can configure </span><span class="token code-snippet code keyword" style="color:#66d9ef">`listenQueues`</span><span class="token plain"> in your DBOS configuration to explicitly tell a process running DBOS to only listen to a specific set of queues.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is particularly useful when managing heterogeneous workers, where specific tasks should execute on specific physical servers.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, say you have a mix of CPU workers and GPU workers and you want CPU tasks to only execute on CPU workers and GPU tasks to only execute on GPU workers.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can create separate queues for CPU and GPU tasks and configure each type of worker to only listen to the appropriate queue:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">import { DBOS, WorkflowQueue } from &quot;@dbos-inc/dbos-sdk&quot;;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const cpuQueue = new WorkflowQueue(&quot;cpu_queue&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">const gpuQueue = new WorkflowQueue(&quot;gpu_queue&quot;);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">async function main() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const workerType = process.env.WORKER_TYPE; // &quot;cpu&quot; or &quot;gpu&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  const config = // ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  if (workerType === &quot;gpu&quot;) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // GPU workers will only dequeue and execute workflows from the GPU queue</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    config.listenQueues = [gpuQueue];</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  } else if (workerType === &quot;cpu&quot;) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    // CPU workers will only dequeue and execute workflows from the CPU queue</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">    config.listenQueues = [cpuQueue];</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  DBOS.setConfig(config);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  await DBOS.launch();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Note that </span><span class="token code-snippet code keyword" style="color:#66d9ef">`listenQueues`</span><span class="token plain"> only controls what workflows are dequeued, not what workflows can be enqueued, so you can freely enqueue tasks onto the GPU queue from a CPU worker for execution on a GPU worker, and vice versa.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Classes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use class instance methods as workflows and steps.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Any class instance method can be freely used as a step using the DBOS.step decorator or DBOS.runstep; there are no special requirements.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To use a class instance method as a workflow, you must use the DBOS.workflow decorator and the class must inherit from </span><span class="token code-snippet code keyword" style="color:#66d9ef">`ConfiguredInstance`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">class MyClass extends ConfiguredInstance {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  cfg: MyConfig;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  constructor(name: string, config: MyConfig) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    super(name);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    this.cfg = cfg;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  override async initialize() : Promise&lt;void&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    // ... Validate this.cfg; will be called at DBOS.launch()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  @DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  async testWorkflow(p: string): Promise&lt;void&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    // ... Operations that use this.cfg</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">const myClassInstance = new MyClass(&#x27;instanceA&#x27;);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When you create a new instance of such a class, the constructor for the base </span><span class="token code-snippet code keyword" style="color:#66d9ef">`ConfiguredInstance`</span><span class="token plain"> must be called with a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`name`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This </span><span class="token code-snippet code keyword" style="color:#66d9ef">`name`</span><span class="token plain"> should be unique among instances of the same class.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Additionally, all </span><span class="token code-snippet code keyword" style="color:#66d9ef">`ConfiguredInstance`</span><span class="token plain"> classes must be instantiated before DBOS.launch() is called.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The reason for these requirements is to enable workflow recovery.  When you create a new instance of, DBOS stores it in a global registry indexed by </span><span class="token code-snippet code keyword" style="color:#66d9ef">`name`</span><span class="token plain">.  When DBOS needs to recover a workflow belonging to that class, it looks up the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`name`</span><span class="token plain"> so it can run the workflow using the right class instance.  While names are used by DBOS Transact internally to find the correct object instance across system restarts, they are also potentially useful for monitoring, tracing, and debugging.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You should AVOID using ConfiguredInstance if at all possible and instead use registerWorkflow on regular non-class functions.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Testing DBOS Functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Unless otherwise specified, recommend testing DBOS applications with jest.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">There are two approaches to testing workflows:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">1.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Unit testing.</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> Test workflow logic in isolation by mocking the DBOS interface. Does not require Postgres.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">2.</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Integration testing.</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> Test workflows with real DBOS infrastructure. Requires a Postgres test database.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> Unit Testing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can unit test workflows by mocking the DBOS interface with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`jest.mock`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">It&#x27;s important to mock </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.registerWorkflow`</span><span class="token plain"> to directly return the workflow function instead of wrapping it with durable workflow code:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">ts</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-ts">// Mock DBOS</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">jest.mock(&#x27;@dbos-inc/dbos-sdk&#x27;, () =&gt; ({</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">  DBOS: {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // IMPORTANT: Mock DBOS.registerWorkflow to return the workflow function</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    registerWorkflow: jest.fn((fn) =&gt; fn),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    setEvent: jest.fn(),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    recv: jest.fn(),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    startWorkflow: jest.fn(),</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    workflowID: &#x27;test-workflow-id-123&#x27;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">  },</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">}));</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Then call the workflow function directly in your tests and assert on the mocked calls.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">####</span><span class="token title important"> Integration Testing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Integration tests require a Postgres database. You should reset DBOS and its system database between tests:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">ts</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-ts">describe(&#x27;example integration tests&#x27;, () =&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">  beforeEach(async () =&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    const databaseUrl = process.env.DBOS_TEST_DATABASE_URL;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // Shut down DBOS (in case a previous test launched it) and reset the database.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    await DBOS.shutdown();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // Configure and launch DBOS</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    const dbosTestConfig: DBOSConfig = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">      name: &quot;my-integration-test&quot;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">      systemDatabaseUrl: databaseUrl,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    };</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    DBOS.setConfig(dbosTestConfig);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    await DBOS.launch();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">  }, 10000);</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">  afterEach(async () =&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    await DBOS.shutdown();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">  });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">  it(&#x27;my integration test&#x27;, async () =&gt; {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">    // test goes here</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">  });</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-ts">});</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Logging</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ALWAYS log errors like this:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">      DBOS.logger.error(`Error: ${(error as Error).message}`);</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Handles</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">A workflow handle represents the state of a particular active or completed workflow execution.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You obtain a workflow handle when using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.startWorkflow`</span><span class="token plain"> to start a workflow in the background.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If you know a workflow&#x27;s identity, you can also retrieve its handle using </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.retrieveWorkflow`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Workflow handles have the following methods:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> handle.workflowID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">handle.workflowID(): string;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retrieve the ID of the workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> handle.getResult</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">handle.getResult(): Promise&lt;R&gt;;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Wait for the workflow to complete, then return its result.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> handle.getStatus</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">handle.getStatus(): Promise&lt;WorkflowStatus | null&gt;;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retrieve the WorkflowStatus of the workflow, or </span><span class="token code-snippet code keyword" style="color:#66d9ef">`null`</span><span class="token plain"> if not found:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Workflow Status</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Some workflow introspection and management methods return a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`WorkflowStatus`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This object has the following definition:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">export interface WorkflowStatus {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The workflow ID</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly workflowID: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The status of the workflow.  One of PENDING, SUCCESS, ERROR, ENQUEUED, CANCELLED, or MAX_RECOVERY_ATTEMPTS_EXCEEDED.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly status: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The name of the workflow function.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly workflowName: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The name of the workflow&#x27;s class, if any.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly workflowClassName: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The name with which the workflow&#x27;s class instance was configured, if any.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly workflowConfigName?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // If the workflow was enqueued, the name of the queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly queueName?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The deserialized workflow inputs.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly input?: unknown[];</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The workflow&#x27;s deserialized output, if any.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly output?: unknown;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The error thrown by the workflow, if any.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly error?: unknown;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The ID of the executor (process) that most recently executed this workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly executorId?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The application version on which this workflow started.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly applicationVersion?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // Workflow start time, as a UNIX epoch timestamp in milliseconds</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly createdAt: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // Last time the workflow status was updated, as a UNIX epoch timestamp in milliseconds. For a completed workflow, this is the workflow completion timestamp.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly updatedAt?: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The timeout specified for this workflow, if any. Timeouts are start-to-close.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly timeoutMS?: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The deadline at which this workflow times out, if any. Not set until the workflow begins execution.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly deadlineEpochMS?: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // Unique queue deduplication ID, if any. Deduplication IDs are unset when the workflow completes.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly deduplicationID?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // Priority of the workflow on a queue, starting from 1 ~ 2,147,483,647. Default 0 (highest priority).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly priority: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // If this workflow is enqueued on a partitioned queue, its partition key</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly queuePartitionKey?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // If this workflow was forked from another, that workflow&#x27;s ID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly forkedFrom?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> DBOS Variables</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> DBOS.workflowID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.workflowID: string | undefined;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Return the ID of the current workflow, if in a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> DBOS.stepID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.stepID: number | undefined;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Return the unique ID of the current step within a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> DBOS.stepStatus</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.stepStatus: StepStatus | undefined;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Return the status of the currently executing step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This object has the following properties:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">interface StepStatus {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The unique ID of this step in its workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  stepID: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // For steps with automatic retries, which attempt number (zero-indexed) is currently executing.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  currentAttempt?: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // For steps with automatic retries, the maximum number of attempts that will be made before the step fails.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  maxAttempts?: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> DBOS.applicationVersion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.applicationVersion: string</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Return the current application version.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> DBOS.executorID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.executorID: string</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retrieve the current executor ID, a unique process ID used to identify the application instance in distributed environments.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Workflow Management Methods</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> DBOS.listWorkflows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.listWorkflows(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  input: GetWorkflowsInput</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">): Promise&lt;WorkflowStatus[]&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">interface GetWorkflowsInput {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  workflowIDs?: string[]; // Retrieve workflows with these IDs.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  workflowName?: string; // Retrieve workflows with this name.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  status?: string; // Retrieve workflows with this status (Must be `ENQUEUED`, `PENDING`, `SUCCESS`, `ERROR`, `CANCELLED`, or `RETRIES_EXCEEDED`)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  startTime?: string; // Retrieve workflows started after this (RFC 3339-compliant) timestamp.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  endTime?: string; // Retrieve workflows started before this (RFC 3339-compliant) timestamp.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  authenticatedUser?: string; // Retrieve workflows run by this authenticated user.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  applicationVersion?: string; // Retrieve workflows started on this application version.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  executorId?: string; // Retrieve workflows run by this executor ID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  workflow_id_prefix?: string; // Retrieve workflows whose ID have this prefix</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  queueName?: string; // If this workflow is enqueued, on which queue</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  queuesOnly?: boolean; // Return only workflows that are actively enqueued</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  forkedFrom?: string; // Get workflows forked from this workflow ID.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  limit?: number; // Return up to this many workflows IDs. IDs are ordered by workflow creation time.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  offset?: number; // Skip this many workflows IDs. IDs are ordered by workflow creation time.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  sortDesc?: boolean; // Sort the workflows in descending order by creation time (default ascending order).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  loadInput?: boolean; // Load the input of the workflow (default true).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  loadOutput?: boolean; // Load the output of the workflow (default true).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retrieve a list of WorkflowStatus of all workflows matching specified criteria.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> DBOS.listQueuedWorkflows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.listQueuedWorkflows(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  input: GetWorkflowsInput</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">): Promise&lt;WorkflowStatus[]&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retrieve a list of WorkflowStatus of all </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">currently enqueued</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> (status </span><span class="token code-snippet code keyword" style="color:#66d9ef">`PENDING`</span><span class="token plain"> or </span><span class="token code-snippet code keyword" style="color:#66d9ef">`ENQUEUED`</span><span class="token plain">) workflows matching specified criteria.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The input type is the same as </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.listWorkflows`</span><span class="token plain">; this method is equivalent to calling </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.listWorkflows`</span><span class="token plain"> with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`queuesOnly`</span><span class="token plain"> set.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> DBOS.listWorkflowSteps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.listWorkflowSteps(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  workflowID: string</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">): Promise&lt;StepInfo[] | undefined&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Retrieve the steps of a workflow. Returns </span><span class="token code-snippet code keyword" style="color:#66d9ef">`undefined`</span><span class="token plain"> if the workflow is not found.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is a list of </span><span class="token code-snippet code keyword" style="color:#66d9ef">`StepInfo`</span><span class="token plain"> objects, with the following structure:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">interface StepInfo {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The unique ID of the step in the workflow. Zero-indexed.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly functionID: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The name of the step</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly name: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The step&#x27;s output, if any</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly output: unknown;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The error the step threw, if any</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly error: Error | null;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // If the step starts or retrieves the result of a workflow, its ID</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly childWorkflowID: string | null;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The Unix epoch timestamp at which this step started</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly startedAtEpochMs?: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // The Unix epoch timestamp at which this step completed</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  readonly completedAtEpochMs?: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> DBOS.cancelWorkflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">cancelWorkflow(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  workflowID: string</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">): Promise&lt;void&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Cancel a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This sets is status to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`CANCELLED`</span><span class="token plain">, removes it from its queue (if it is enqueued) and preempts its execution (interrupting it at the beginning of its next step)</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> DBOS.resumeWorkflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.resumeWorkflow&lt;T&gt;(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  workflowID: string</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">): Promise&lt;WorkflowHandle&lt;Awaited&lt;T&gt;&gt;&gt; </span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Resume a workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This immediately starts it from its last completed step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can use this to resume workflows that are cancelled or have exceeded their maximum recovery attempts.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You can also use this to start an enqueued workflow immediately, bypassing its queue.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> DBOS.forkWorkflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">static async forkWorkflow&lt;T&gt;(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  workflowID: string,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  startStep: number,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  options?: { newWorkflowID?: string; applicationVersion?: string; timeoutMS?: number },</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">): Promise&lt;WorkflowHandle&lt;Awaited&lt;T&gt;&gt;&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Start a new execution of a workflow from a specific step.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The input step ID (</span><span class="token code-snippet code keyword" style="color:#66d9ef">`startStep`</span><span class="token plain">) must match the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`functionID`</span><span class="token plain"> of the step returned by </span><span class="token code-snippet code keyword" style="color:#66d9ef">`listWorkflowSteps`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The specified </span><span class="token code-snippet code keyword" style="color:#66d9ef">`startStep`</span><span class="token plain"> is the step from which the new workflow will start, so any steps whose ID is less than </span><span class="token code-snippet code keyword" style="color:#66d9ef">`startStep`</span><span class="token plain"> will not be re-executed.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Parameters:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">workflowID</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: The ID of the workflow to fork.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">startStep</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: The ID of the step from which to start the forked workflow. Must match the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`functionID`</span><span class="token plain"> of the step in the original workflow execution.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">newWorkflowID</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: The ID of the new workflow created by the fork. If not specified, a random UUID is used.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">applicationVersion</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: The application version on which the forked workflow will run. Useful for &quot;patching&quot; workflows that failed due to a bug in the previous application version.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">timeoutMS</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: A timeout for the forked workflow in milliseconds.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Upgrading Workflow Code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">A challenge encountered when operating long-running durable workflows in production is </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">how to deploy breaking changes without disrupting in-progress workflows.</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">A breaking change to a workflow is one that changes which steps are run, or the order in which the steps are run.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If a breaking change was made to a workflow and that workflow is replayed by the recovery system, the checkpoints created by the previous version of the code may not match the steps called by the workflow in the new version of the code, causing recovery to fail.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">DBOS supports two strategies for safely upgrading workflow code: </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">patching</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> and </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">versioning</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Patching</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">In patching, the result of a call to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.patch()`</span><span class="token plain"> is used to conditionally execute the new code.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.patch()`</span><span class="token plain"> returns </span><span class="token code-snippet code keyword" style="color:#66d9ef">`true`</span><span class="token plain"> for new calls (those executing after the breaking change) and </span><span class="token code-snippet code keyword" style="color:#66d9ef">`false`</span><span class="token plain"> for old calls (those that executed before the breaking change).</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Therefore, if </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.patch()`</span><span class="token plain"> returns </span><span class="token code-snippet code keyword" style="color:#66d9ef">`true`</span><span class="token plain">, the workflow should follow the new code path, otherwise it must follow the prior codepath.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.patch(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    patchName: string</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">): Promise&lt;boolean&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Parameters:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#66d9ef">`patchName`</span><span class="token plain">: The name to give the patch marker that will be inserted into workflow history.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, let&#x27;s say our original workflow is:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">static async workflow() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await foo();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await bar();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">We want to replace the call to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`foo()`</span><span class="token plain"> with a call to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`baz()`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This is a breaking change because it changes what steps run.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">We can make this breaking change safely using a patch:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">static async workflow() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  if (await DBOS.patch(&#x27;use-baz&#x27;)) {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    await baz();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  else {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    await foo();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await bar();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Now, new workflows will run </span><span class="token code-snippet code keyword" style="color:#66d9ef">`baz()`</span><span class="token plain">, while old workflows will reexecute </span><span class="token code-snippet code keyword" style="color:#66d9ef">`foo()`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Deprecating and Removing Patches</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Patches add complexity and runtime overhead; fortunately they don&#x27;t need to stay in your code forever.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Once all workflows that started before you deployed the patch are complete, you can safely remove patches from your code.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">First, you must deprecate the patch with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.deprecatePatch()`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.deprecatePatch`</span><span class="token plain"> must be used for a transition period prior to fully removing the patch, as it allows coexistence with any ongoing workflows that used </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.patch()`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">DBOS.deprecatePatch(</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    patchName: string</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">): Promise&lt;boolean&gt;</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Always returns </span><span class="token code-snippet code keyword" style="color:#66d9ef">`true`</span><span class="token plain">. Safely bypasses a patch marker at the current point in workflow history if present.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">Parameters:</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token code-snippet code keyword" style="color:#66d9ef">`patchName`</span><span class="token plain">: The name of the patch marker to be bypassed.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example, here&#x27;s how to deprecate the patch above:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">static async workflow(){</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  if (await DBOS.deprecatePatch(&quot;use-baz&quot;)) { // always true</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">    await baz();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  }</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await bar();</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Then, when all workflows that started before you deprecated the patch are complete, you can remove the patch entirely:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">@DBOS.workflow()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">static async workflow() {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await baz()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  await bar()</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If any mistakes happen during the process (a breaking change is not patched, or a patch is deprecated or removed prematurely), the workflow will throw a </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOSUnexpectedStepError`</span><span class="token plain"> pointing to the step where the problem occurred.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">###</span><span class="token title important"> Versioning</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When using versioning, DBOS </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">versions</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain"> applications and workflows, and only continues workflow execution with the same application version that started the workflow.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">All workflows are tagged with the application version on which they started.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">By default, application version is automatically computed from a hash of workflow source code.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">However, you can set your own version through configuration.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">typescript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-typescript">config: DBOSConfig = {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  // ...</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">  applicationVersion: &#x27;1.0.0&#x27;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-typescript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">When DBOS tries to recover workflows, it only recovers workflows whose version matches the current application version.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">This prevents recovery of workflows that depend on different code.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">You cannot change the version of a workflow, but you can use </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.forkWorkflow`</span><span class="token plain"> to restart a workflow from a specific step on a specific code version.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token title important punctuation" style="color:#f8f8f2">##</span><span class="token title important"> Configuring DBOS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">To configure DBOS, pass in a configuration with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.setConfig`</span><span class="token plain"> before you call </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOS.launch`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">For example:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">DBOS.setConfig({</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  name: &#x27;my-app&#x27;,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  systemDatabaseUrl: process.env.DBOS_SYSTEM_DATABASE_URL,</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">});</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">await DBOS.launch();</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">A configuration object has the following fields.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">All fields except </span><span class="token code-snippet code keyword" style="color:#66d9ef">`name`</span><span class="token plain"> are optional.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code code-language">javascript</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block language-javascript">export interface DBOSConfig {</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  name?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  applicationVersion?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  executorID?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  systemDatabaseUrl?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  systemDatabasePoolSize?: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  systemDatabaseSchemaName?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  systemDatabasePool?: Pool;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  enableOTLP?: boolean;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  logLevel?: string;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  otlpLogsEndpoints?: string[];</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  otlpTracesEndpoints?: string[];</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  runAdminServer?: boolean;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  adminPort?: number;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  listenQueues?: WorkflowQueue[];</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">  serializer?: DBOSSerializer;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code code-block language-javascript">}</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">name</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Your application&#x27;s name.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">applicationVersion</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: The code version for this application and its workflows.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">executorID</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: A unique process ID used to identify the application instance in distributed environments.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">systemDatabaseUrl</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: A connection string to a Postgres database in which DBOS can store internal state. The supported format is:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block">postgresql://[username]:[password]@[hostname]:[port]/[database name]</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">The default is:</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code code-block">postgresql://postgres:dbos@localhost:5432/[application name]_dbos_sys</span><span class="token code"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token code"></span><span class="token code punctuation" style="color:#f8f8f2">```</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">If the Postgres database referenced by this connection string does not exist, DBOS will attempt to create it.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">systemDatabasePoolSize</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: The size of the connection pool used for the DBOS system database. Defaults to 10.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">systemDatabaseSchemaName</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Postgres schema name for DBOS system tables. Defaults to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`dbos`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">systemDatabasePool</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: A custom </span><span class="token code-snippet code keyword" style="color:#66d9ef">`node-postgres`</span><span class="token plain"> connection pool to use to connect to your system database. If provided, DBOS will not create a connection pool but use this instead.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">enableOTLP</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Enable DBOS OpenTelemetry tracing and export. Defaults to False.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">logLevel</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Configure the DBOS logger severity. Defaults to </span><span class="token code-snippet code keyword" style="color:#66d9ef">`info`</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">otlpTracesEndpoints</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: DBOS operations automatically generate OpenTelemetry Traces. Use this field to declare a list of OTLP-compatible receivers.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">otlpLogsEndpoints</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: DBOS operations automatically generate OpenTelemetry Logs. Use this field to declare a list of OTLP-compatible receivers.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">runAdminServer</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: Whether to run an HTTP admin server for workflow management operations. Defaults to True.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">adminPort</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: The port on which the admin server runs. Defaults to 3001.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">listenQueues</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: This process should only listen to (dequeue and execute workflows from) these queues.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token list punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token bold content">serializer</span><span class="token bold punctuation" style="color:#f8f8f2">**</span><span class="token plain">: A custom serializer for the system database. Must match the </span><span class="token code-snippet code keyword" style="color:#66d9ef">`DBOSSerializer`</span><span class="token plain"> interface with </span><span class="token code-snippet code keyword" style="color:#66d9ef">`stringify`</span><span class="token plain"> and </span><span class="token code-snippet code keyword" style="color:#66d9ef">`parse`</span><span class="token plain"> methods.</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></div></details></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/typescript/integrating-dbos"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Add DBOS To Your App</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/typescript/tutorials/workflow-tutorial"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Workflows</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dbos-agent-skills" class="table-of-contents__link toc-highlight">DBOS Agent Skills</a></li><li><a href="#dbos-prompt" class="table-of-contents__link toc-highlight">DBOS Prompt</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Follow Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/dbos-inc/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://bsky.app/profile/dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bluesky<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/DBOS_Inc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter/X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.dbos.dev/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.dbos.dev/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Questions or Comments?</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/fMwQjeW5zg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat with us on Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:contact@dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Write to us at contact@dbos.dev<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://dbos.dev" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="100"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="100"></a></div><div class="footer__copyright">Copyright Â© 2026 DBOS, Inc. | <a href="https://www.dbos.dev/privacy" target="_blank">Privacy Policy</a></div></div></div></footer></div>
</body>
</html>