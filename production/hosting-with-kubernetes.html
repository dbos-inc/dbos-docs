<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-production/hosting-with-kubernetes" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Deploying With Kubernetes | DBOS Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.dbos.dev/production/hosting-with-kubernetes"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploying With Kubernetes | DBOS Docs"><meta data-rh="true" name="description" content="This guide covers deploying a DBOS application on Kubernetes."><meta data-rh="true" property="og:description" content="This guide covers deploying a DBOS application on Kubernetes."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.dbos.dev/production/hosting-with-kubernetes"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/production/hosting-with-kubernetes" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/production/hosting-with-kubernetes" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UY2VKOMIL2-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Deploying With Kubernetes","item":"https://docs.dbos.dev/production/hosting-with-kubernetes"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="DBOS Docs" href="/opensearch.xml">


<link rel="preconnect" href="https://dbosdev.matomo.cloud/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://dbosdev.matomo.cloud/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>

<link rel="preconnect" href="https://d2j9bas80r5yfz.cloudfront.net">
<script>!function(t,e){var o,r,s,a;e.__SV||(window.posthog=e,e._i=[],e.init=function(n,i,p){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(s=t.createElement("script")).type="text/javascript",s.async=!0,s.src=i.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(a=t.getElementsByTagName("script")[0]).parentNode.insertBefore(s,a);var g=e;for(void 0!==p?g=e[p]=[]:p="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==p&&(e+="."+p),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),r=0;r<o.length;r++)c(g,o[r]);e._i.push([n,i,p])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_vKGgPmFevFB3QVyqZdIZeNqcWAPqk3i3mDhwGqwk6nP",{api_host:"https://d2j9bas80r5yfz.cloudfront.net",id:"default"})</script>
<script async defer="defer" id="hs-script-loader" src="//js.hs-scripts.com/45237820.js"></script>
<script src="/scripts/reo.js"></script><link rel="stylesheet" href="/assets/css/styles.292b392a.css">
<script src="/assets/js/runtime~main.eabe09f8.js" defer="defer"></script>
<script src="/assets/js/main.db590a4a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://dbos.dev" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/quickstart">Quickstart</a><a class="navbar__item navbar__link" href="/examples">Examples</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://console.dbos.dev/login-redirect" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link dbos-button-blue">DBOS Console</a><a href="https://github.com/dbos-inc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/"><span title="Home" class="linkLabel_WmDU">Home</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quickstart"><span title="Get Started" class="linkLabel_WmDU">Get Started</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/why-dbos"><span title="Why DBOS?" class="linkLabel_WmDU">Why DBOS?</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/architecture"><span title="DBOS Architecture" class="linkLabel_WmDU">DBOS Architecture</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/python/programming-guide"><span title="Develop with Python" class="categoryLinkLabel_W154">Develop with Python</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/typescript/programming-guide"><span title="Develop with TypeScript" class="categoryLinkLabel_W154">Develop with TypeScript</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/golang/programming-guide"><span title="Develop with Go" class="categoryLinkLabel_W154">Develop with Go</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/java/programming-guide"><span title="Develop with Java" class="categoryLinkLabel_W154">Develop with Java</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/production/checklist"><span title="Deploy To Production" class="categoryLinkLabel_W154">Deploy To Production</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/checklist"><span title="Production Checklist" class="linkLabel_WmDU">Production Checklist</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/conductor"><span title="DBOS Conductor" class="linkLabel_WmDU">DBOS Conductor</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/hosting-conductor"><span title="Self-Hosting Conductor" class="linkLabel_WmDU">Self-Hosting Conductor</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/workflow-management"><span title="Workflow Management" class="linkLabel_WmDU">Workflow Management</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/alerting"><span title="Alerting" class="linkLabel_WmDU">Alerting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/retention"><span title="Workflow Retention Policies" class="linkLabel_WmDU">Workflow Retention Policies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/workflow-recovery"><span title="Workflow Recovery" class="linkLabel_WmDU">Workflow Recovery</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/hosting-conductor-with-kubernetes"><span title="Self-Hosting Conductor With Kubernetes" class="linkLabel_WmDU">Self-Hosting Conductor With Kubernetes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/production/hosting-with-kubernetes"><span title="Deploying With Kubernetes" class="linkLabel_WmDU">Deploying With Kubernetes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/hosting-with-cloud-run"><span title="Deploying With Google Cloud Run" class="linkLabel_WmDU">Deploying With Google Cloud Run</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/production/dbos-cloud/deploying-to-cloud"><span title="DBOS Cloud" class="categoryLinkLabel_W154">DBOS Cloud</span></a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/integrations/supabase"><span title="Integrations" class="categoryLinkLabel_W154">Integrations</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/explanations/system-tables"><span title="Concepts and Explanations" class="categoryLinkLabel_W154">Concepts and Explanations</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq"><span title="Troubleshooting &amp; FAQ" class="linkLabel_WmDU">Troubleshooting &amp; FAQ</span></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deploy To Production</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Deploying With Kubernetes</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Deploying With Kubernetes</h1></header><p>This guide covers deploying a DBOS application on Kubernetes.
It walks through DBOS-specific deployment concepts, then provides a full walkthrough covering infrastructure, secrets, database migrations, application deployment, and autoscaling.</p>
<p>The Kubernetes manifests are portable to any conformant cluster.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment" translate="no">​</a></h2>
<p>DBOS is a library — it does not require any sidecar, operator, or external service besides PostgreSQL.
Pods are stateless and interchangeable and should use a standard <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer" class="">Deployment</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration" translate="no">​</a></h2>
<p>DBOS configuration contains sensitive values: the <a class="" href="/explanations/system-tables">system database URL</a> and, if using <a class="" href="/production/conductor">Conductor</a>, an API key.
Store these as <a href="https://kubernetes.io/docs/concepts/configuration/secret/" target="_blank" rel="noopener noreferrer" class="">Kubernetes Secrets</a> and inject them via <a href="https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets-as-environment-variables" target="_blank" rel="noopener noreferrer" class=""><code>secretKeyRef</code></a>.
For Git-safe storage, encrypt with <a href="https://github.com/bitnami-labs/sealed-secrets" target="_blank" rel="noopener noreferrer" class="">Sealed Secrets</a>, <a href="https://github.com/getsops/sops" target="_blank" rel="noopener noreferrer" class="">SOPS</a>, or a cloud-native secrets manager.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Connecting to DBOS Conductor</div><div class="admonitionContent_BuS1"><p>If you use <a href="https://console.dbos.dev/" target="_blank" rel="noopener noreferrer" class="">DBOS managed Conductor</a>, no <code>DBOS_CONDUCTOR_URL</code> is needed. The SDK connects automatically.
If you <a class="" href="/production/hosting-conductor">self-host Conductor</a>, set <code>DBOS_CONDUCTOR_URL</code> in your application&#x27;s environment.</p><p>When Conductor is in a different cluster, use <code>wss://</code> so the WebSocket connection is encrypted. In the same cluster, use <code>ws://</code>, as Conductor requires TLS termination at the ingress layer.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="database-privilege-separation">Database Privilege Separation<a href="#database-privilege-separation" class="hash-link" aria-label="Direct link to Database Privilege Separation" title="Direct link to Database Privilege Separation" translate="no">​</a></h2>
<p>DBOS applications store workflow state in <a class="" href="/explanations/system-tables">system tables</a>.
These tables must be created before the application can start.</p>
<p>Run <code>dbos migrate</code> (<a class="" href="/python/reference/cli#dbos-migrate">Python</a>, <a class="" href="/golang/reference/cli">Go</a>) or <code>dbos schema</code> (<a class="" href="/typescript/reference/cli#npx-dbos-schema">TypeScript</a>) with an <strong>admin</strong> role that can create schema and grant permissions, and run the application with a <strong>restricted</strong> role that can only read/write data. Use the <code>--app-role</code> flag to grant the necessary schema permissions to the restricted role.</p>
<p><code>dbos migrate</code> works well as a Kubernetes <a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/" target="_blank" rel="noopener noreferrer" class="">Job</a> that you compose into your CI/CD pipeline.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="availability">Availability<a href="#availability" class="hash-link" aria-label="Direct link to Availability" title="Direct link to Availability" translate="no">​</a></h2>
<p>In addition to <a class="" href="/production/checklist">general tips</a> for running a DBOS-enabled app in production:</p>
<p><strong>Readiness probe</strong> — have the probe wait until DBOS is launched before Kubernetes routes traffic to pods.</p>
<p><strong>Resource limits</strong> — DBOS doesn&#x27;t add significant CPU or memory overhead, but all DBOS SDKs run background tasks; setting more than 1000m CPU can significantly improve the performance of a busy application.</p>
<p><strong>Replicas</strong> — configure more than one replica. Each replica starts an independent DBOS worker that can process scheduled workflows and handle tasks from DBOS queues. Each replica should have a unique executor ID (which is automatically assigned when using <a class="" href="/production/conductor">DBOS Conductor</a>)</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="upgrading-workflow-code">Upgrading Workflow Code<a href="#upgrading-workflow-code" class="hash-link" aria-label="Direct link to Upgrading Workflow Code" title="Direct link to Upgrading Workflow Code" translate="no">​</a></h2>
<p>DBOS workflows can run for weeks or years while the underlying code evolves.
Two patterns support this:</p>
<ol>
<li class="">
<p><strong>Application versioning</strong> — DBOS SDKs store a version number alongside each workflow record. You should create a separate Deployment per active version. Point the Service selector at the latest version only, such that new HTTP requests creating DBOS workflows go exclusively to the new Deployment. Old deployments will stay alive and keep executing pending workflows. Once workflows for an old version complete, delete its Deployment. Tools like <a href="https://flagger.app/" target="_blank" rel="noopener noreferrer" class="">Flagger</a> or <a href="https://argoproj.github.io/argo-rollouts/" target="_blank" rel="noopener noreferrer" class="">Argo Rollouts</a> can automate this lifecycle.</p>
</li>
<li class="">
<p><strong>Workflow patching</strong> — Keep a single Deployment. Add conditional logic (patches) that detect which code path a recovering workflow should take. See the <a class="" href="/python/tutorials/upgrading-workflows">workflow patching guide</a> for details.</p>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="scaling-with-keda">Scaling with KEDA<a href="#scaling-with-keda" class="hash-link" aria-label="Direct link to Scaling with KEDA" title="Direct link to Scaling with KEDA" translate="no">​</a></h2>
<p><a href="https://keda.sh/" target="_blank" rel="noopener noreferrer" class="">KEDA</a> scales application pods based on external metrics.
A simple pattern for scaling based on DBOS queue depth:</p>
<ol>
<li class="">The application exposes a <code>/metrics/:queueName</code> endpoint returning the current queue depth as JSON.</li>
<li class="">KEDA&#x27;s <code>metrics-api</code> trigger polls this endpoint on an interval.</li>
<li class="">KEDA computes <code>desiredReplicas = ceil(queue_length / targetValue)</code>, where <code>targetValue</code> matches the queue&#x27;s per-worker concurrency.</li>
</ol>
<p>Since the <code>metrics-api</code> trigger polls the application itself, <code>minReplicaCount</code> must be at least 1 — KEDA needs a running pod to scrape. For scale-to-zero, use a push-based trigger (e.g., PostgreSQL) or an external metrics endpoint.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="walkthrough-aws-eks">Walkthrough (AWS EKS)<a href="#walkthrough-aws-eks" class="hash-link" aria-label="Direct link to Walkthrough (AWS EKS)" title="Direct link to Walkthrough (AWS EKS)" translate="no">​</a></h2>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">EKS (AWS)</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>This walkthrough deploys a sample DBOS Go application on EKS with RDS PostgreSQL, Sealed Secrets, database migrations, and KEDA autoscaling.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Set environment variables</strong></summary><div><div class="collapsibleContent_i85q"><p>Set these variables before proceeding — replace the placeholder values with your own:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Your AWS account ID (12-digit number)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">AWS_ACCOUNT_ID</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">123456789012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># AWS region for all resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">AWS_REGION</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">us-west-2</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># PostgreSQL admin password (used for the RDS master user)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">POSTGRES_PASSWORD</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;choose-a-secure-password&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Password for the restricted application database role</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">APP_ROLE_PASSWORD</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;choose-another-secure-password&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Conductor API key (from the Console after registering your app)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">CONDUCTOR_API_KEY</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;your-api-key&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Conductor URL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># DBOS Cloud: wss://conductor.dbos.dev/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Self-hosted (same cluster): ws://conductor.dbos.svc.cluster.local:8090</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Self-hosted (external): wss://your-conductor-hostname/conductor/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">CONDUCTOR_URL</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;wss://conductor.dbos.dev/&#x27;</span><br></span></code></pre></div></div></div></div></details><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="infrastructure">Infrastructure<a href="#infrastructure" class="hash-link" aria-label="Direct link to Infrastructure" title="Direct link to Infrastructure" translate="no">​</a></h3><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>CLI tools required on your workstation</strong></summary><div><div class="collapsibleContent_i85q"><table><thead><tr><th>Tool</th><th>Purpose</th><th>Install</th></tr></thead><tbody><tr><td><strong>AWS CLI</strong></td><td>AWS account access</td><td><a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" target="_blank" rel="noopener noreferrer" class="">Install guide</a></td></tr><tr><td><strong>eksctl</strong></td><td>Create and manage EKS clusters</td><td><a href="https://eksctl.io/installation/" target="_blank" rel="noopener noreferrer" class="">Install guide</a></td></tr><tr><td><strong>kubectl</strong></td><td>Interact with Kubernetes</td><td>Included with eksctl, or <a href="https://kubernetes.io/docs/tasks/tools/" target="_blank" rel="noopener noreferrer" class="">install separately</a></td></tr><tr><td><strong>Helm</strong></td><td>Install cluster add-ons (KEDA, Sealed Secrets)</td><td><a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener noreferrer" class="">Install guide</a></td></tr><tr><td><strong>kubeseal</strong></td><td>Encrypt Kubernetes secrets</td><td><a href="https://github.com/bitnami-labs/sealed-secrets#kubeseal" target="_blank" rel="noopener noreferrer" class="">Install guide</a></td></tr><tr><td><strong>Go</strong></td><td>Build the DBOS application</td><td><a href="https://go.dev/doc/install" target="_blank" rel="noopener noreferrer" class="">Install guide</a></td></tr><tr><td><strong>Docker</strong></td><td>Build application container images</td><td><a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer" class="">Install guide</a></td></tr></tbody></table><p>Verify your AWS credentials are configured:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws sts get-caller-identity</span><br></span></code></pre></div></div></div></div></details><p><strong>DBOS Conductor</strong></p><p>This walkthrough connects the application to <a class="" href="/production/conductor">DBOS Conductor</a> for workflow recovery and observability.
You can use either <a href="https://console.dbos.dev/" target="_blank" rel="noopener noreferrer" class="">DBOS Cloud</a> or a <a class="" href="/production/hosting-conductor-with-kubernetes">self-hosted Conductor</a>.
You&#x27;ll need the <strong>Conductor URL</strong> and an <strong>API key</strong> — both are available from the Console after <a class="" href="/production/conductor#connecting-to-conductor">registering your application</a>.</p><p><strong>Create an EKS Cluster</strong></p><p>Create a managed EKS cluster with two nodes. This takes approximately 15 minutes.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Create EKS cluster</strong></summary><div><div class="collapsibleContent_i85q"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">eksctl create cluster </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--name</span><span class="token plain"> dbos-app-cluster </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--version</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">1.31</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --nodegroup-name default </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --node-type t3.medium </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--nodes</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--managed</span><br></span></code></pre></div></div><p><code>eksctl</code> automatically:</p><ul>
<li class="">Creates a VPC with public and private subnets</li>
<li class="">Configures the <a href="https://docs.aws.amazon.com/eks/latest/userguide/managing-vpc-cni.html" target="_blank" rel="noopener noreferrer" class="">Amazon VPC CNI</a></li>
<li class="">Sets up your <code>~/.kube/config</code> to point at the new cluster</li>
</ul><p>Once complete, verify the cluster is ready:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl get nodes</span><br></span></code></pre></div></div><p>You should see two nodes in <code>Ready</code> status.</p></div></div></details><p><strong>Create a Namespace</strong></p><p>All resources in this walkthrough are deployed to a dedicated <code>dbos</code> namespace:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl create namespace dbos</span><br></span></code></pre></div></div><p><strong>Provision an RDS PostgreSQL Instance</strong></p><p>Your DBOS application needs a PostgreSQL database for its <a class="" href="/explanations/system-tables">system tables</a>.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>RDS provisioning commands</strong></summary><div><div class="collapsibleContent_i85q"><p>Find the VPC and private subnets that <code>eksctl</code> created:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Get the VPC ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">VPC_ID</span><span class="token operator" style="color:#66d9ef">=</span><span class="token variable" style="color:#f8f8f2">$(</span><span class="token variable" style="color:#f8f8f2">aws ec2 describe-vpcs </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--filters</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable string" style="color:#a6e22e">&quot;Name=tag:alpha.eksctl.io/cluster-name,Values=dbos-app-cluster&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--query</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable string" style="color:#a6e22e">&quot;Vpcs[0].VpcId&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable parameter variable" style="color:#f8f8f2">--output</span><span class="token variable" style="color:#f8f8f2"> text </span><span class="token variable parameter variable" style="color:#f8f8f2">--region</span><span class="token variable" style="color:#f8f8f2"> $AWS_REGION</span><span class="token variable" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#e6db74">echo</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;VPC: </span><span class="token string variable" style="color:#f8f8f2">$VPC_ID</span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Get the private subnets (array for bash/zsh compatibility)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">PRIVATE_SUBNETS</span><span class="token operator" style="color:#66d9ef">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:#f8f8f2">$(</span><span class="token variable" style="color:#f8f8f2">aws ec2 describe-subnets </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--filters</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable string" style="color:#a6e22e">&quot;Name=vpc-id,Values=</span><span class="token variable string variable" style="color:#f8f8f2">$VPC_ID</span><span class="token variable string" style="color:#a6e22e">&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">             </span><span class="token variable string" style="color:#a6e22e">&quot;Name=tag:aws:cloudformation:logical-id,Values=SubnetPrivate*&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--query</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable string" style="color:#a6e22e">&quot;Subnets[*].SubnetId&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable parameter variable" style="color:#f8f8f2">--output</span><span class="token variable" style="color:#f8f8f2"> text </span><span class="token variable parameter variable" style="color:#f8f8f2">--region</span><span class="token variable" style="color:#f8f8f2"> $AWS_REGION</span><span class="token variable" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#e6db74">echo</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;Private subnets: </span><span class="token string variable" style="color:#f8f8f2">${PRIVATE_SUBNETS</span><span class="token string variable punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string variable" style="color:#f8f8f2">@</span><span class="token string variable punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token string variable" style="color:#f8f8f2">}</span><span class="token string" style="color:#a6e22e">&quot;</span><br></span></code></pre></div></div><p>Create a DB subnet group from the private subnets:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws rds create-db-subnet-group </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --db-subnet-group-name dbos-app-db </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --db-subnet-group-description </span><span class="token string" style="color:#a6e22e">&quot;DBOS application RDS subnets&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --subnet-ids </span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token string variable" style="color:#f8f8f2">${PRIVATE_SUBNETS</span><span class="token string variable punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string variable" style="color:#f8f8f2">@</span><span class="token string variable punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token string variable" style="color:#f8f8f2">}</span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><br></span></code></pre></div></div><p>Create a security group that allows PostgreSQL access from the EKS nodes:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Get the EKS cluster security group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">EKS_SG</span><span class="token operator" style="color:#66d9ef">=</span><span class="token variable" style="color:#f8f8f2">$(</span><span class="token variable" style="color:#f8f8f2">aws ec2 describe-security-groups </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--filters</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable string" style="color:#a6e22e">&quot;Name=vpc-id,Values=</span><span class="token variable string variable" style="color:#f8f8f2">$VPC_ID</span><span class="token variable string" style="color:#a6e22e">&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">            </span><span class="token variable string" style="color:#a6e22e">&quot;Name=tag:aws:eks:cluster-name,Values=dbos-app-cluster&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--query</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable string" style="color:#a6e22e">&quot;SecurityGroups[0].GroupId&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--output</span><span class="token variable" style="color:#f8f8f2"> text </span><span class="token variable parameter variable" style="color:#f8f8f2">--region</span><span class="token variable" style="color:#f8f8f2"> $AWS_REGION</span><span class="token variable" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#e6db74">echo</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;EKS SG: </span><span class="token string variable" style="color:#f8f8f2">$EKS_SG</span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Create a security group for RDS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">RDS_SG</span><span class="token operator" style="color:#66d9ef">=</span><span class="token variable" style="color:#f8f8f2">$(</span><span class="token variable" style="color:#f8f8f2">aws ec2 create-security-group </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  --group-name dbos-app-rds </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--description</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable string" style="color:#a6e22e">&quot;Allow PostgreSQL from EKS nodes&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  --vpc-id $VPC_ID </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--query</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable string" style="color:#a6e22e">&quot;GroupId&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable parameter variable" style="color:#f8f8f2">--output</span><span class="token variable" style="color:#f8f8f2"> text </span><span class="token variable parameter variable" style="color:#f8f8f2">--region</span><span class="token variable" style="color:#f8f8f2"> $AWS_REGION</span><span class="token variable" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#e6db74">echo</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;RDS SG: </span><span class="token string variable" style="color:#f8f8f2">$RDS_SG</span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Allow inbound PostgreSQL from EKS nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws ec2 authorize-security-group-ingress </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --group-id </span><span class="token variable" style="color:#f8f8f2">$RDS_SG</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--protocol</span><span class="token plain"> tcp </span><span class="token parameter variable" style="color:#f8f8f2">--port</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">5432</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --source-group </span><span class="token variable" style="color:#f8f8f2">$EKS_SG</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><br></span></code></pre></div></div><p>Create the RDS instance:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws rds create-db-instance </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --db-instance-identifier dbos-app-pg </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --db-instance-class db.t4g.micro </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--engine</span><span class="token plain"> postgres </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --engine-version </span><span class="token number" style="color:#ae81ff">16</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --master-username postgres </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --master-user-password </span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token string variable" style="color:#f8f8f2">$POSTGRES_PASSWORD</span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --allocated-storage </span><span class="token number" style="color:#ae81ff">20</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --db-subnet-group-name dbos-app-db </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --vpc-security-group-ids </span><span class="token variable" style="color:#f8f8f2">$RDS_SG</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --no-publicly-accessible </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><br></span></code></pre></div></div><p>Wait for the instance to become available (this takes a few minutes):</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws rds </span><span class="token function" style="color:#e6db74">wait</span><span class="token plain"> db-instance-available </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --db-instance-identifier dbos-app-pg </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><br></span></code></pre></div></div><p>Get the RDS endpoint:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token assign-left variable" style="color:#f8f8f2">RDS_ENDPOINT</span><span class="token operator" style="color:#66d9ef">=</span><span class="token variable" style="color:#f8f8f2">$(</span><span class="token variable" style="color:#f8f8f2">aws rds describe-db-instances </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  --db-instance-identifier dbos-app-pg </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--query</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable string" style="color:#a6e22e">&quot;DBInstances[0].Endpoint.Address&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--output</span><span class="token variable" style="color:#f8f8f2"> text </span><span class="token variable parameter variable" style="color:#f8f8f2">--region</span><span class="token variable" style="color:#f8f8f2"> $AWS_REGION</span><span class="token variable" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token builtin class-name" style="color:#e6db74">echo</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;RDS endpoint: </span><span class="token string variable" style="color:#f8f8f2">$RDS_ENDPOINT</span><span class="token string" style="color:#a6e22e">&quot;</span><br></span></code></pre></div></div></div></div></details><p>Create the database and application role from a pod inside the cluster (since the RDS instance is not publicly accessible):</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Create database and role</strong></summary><div><div class="collapsibleContent_i85q"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl run pg-setup </span><span class="token parameter variable" style="color:#f8f8f2">--restart</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">Never </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--namespace</span><span class="token plain"> dbos </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--image</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">postgres:16 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--env</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;PGPASSWORD=</span><span class="token string variable" style="color:#f8f8f2">$POSTGRES_PASSWORD</span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--command</span><span class="token plain"> -- </span><span class="token function" style="color:#e6db74">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-c</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token string" style="color:#a6e22e">    psql -h </span><span class="token string variable" style="color:#f8f8f2">$RDS_ENDPOINT</span><span class="token string" style="color:#a6e22e"> -U postgres -c &#x27;CREATE DATABASE dbos_app;&#x27;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token string" style="color:#a6e22e">    psql -h </span><span class="token string variable" style="color:#f8f8f2">$RDS_ENDPOINT</span><span class="token string" style="color:#a6e22e"> -U postgres -c </span><span class="token string entity" style="color:#a6e22e">\&quot;</span><span class="token string" style="color:#a6e22e">CREATE ROLE dbos_app_role WITH LOGIN PASSWORD &#x27;</span><span class="token string variable" style="color:#f8f8f2">$APP_ROLE_PASSWORD</span><span class="token string" style="color:#a6e22e">&#x27;;</span><span class="token string entity" style="color:#a6e22e">\&quot;</span><span class="token string" style="color:#a6e22e"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token string" style="color:#a6e22e">  &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Wait for the pod to finish, then clean up</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">sleep</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">15</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;&amp;</span><span class="token plain"> kubectl logs pg-setup </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos </span><span class="token operator" style="color:#66d9ef">&amp;&amp;</span><span class="token plain"> kubectl delete pod pg-setup </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos</span><br></span></code></pre></div></div><p>This creates:</p><ul>
<li class=""><code>dbos_app</code> — the application&#x27;s system database for workflow state</li>
<li class=""><code>dbos_app_role</code> — a restricted role the application uses at runtime (granted permissions by <code>dbos migrate</code>)</li>
</ul></div></div></details><p><strong>Install Cluster Add-ons</strong></p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Helm installs (Sealed Secrets, KEDA)</strong></summary><div><div class="collapsibleContent_i85q"><p><strong>Sealed Secrets</strong> — encrypt secrets for safe Git storage:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">helm repo </span><span class="token function" style="color:#e6db74">add</span><span class="token plain"> sealed-secrets https://bitnami-labs.github.io/sealed-secrets</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">helm </span><span class="token function" style="color:#e6db74">install</span><span class="token plain"> sealed-secrets sealed-secrets/sealed-secrets </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--namespace</span><span class="token plain"> kube-system</span><br></span></code></pre></div></div><p><strong>KEDA</strong> — event-driven autoscaling:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">helm repo </span><span class="token function" style="color:#e6db74">add</span><span class="token plain"> kedacore https://kedacore.github.io/charts</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">helm </span><span class="token function" style="color:#e6db74">install</span><span class="token plain"> keda kedacore/keda </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--namespace</span><span class="token plain"> keda --create-namespace</span><br></span></code></pre></div></div><p>Verify both add-ons are running:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Sealed Secrets controller</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl get pods </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> kube-system </span><span class="token parameter variable" style="color:#f8f8f2">-l</span><span class="token plain"> app.kubernetes.io/name</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">sealed-secrets</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># KEDA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl get pods </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> keda</span><br></span></code></pre></div></div></div></div></details><p><strong>Create ECR Repositories</strong></p><p>We push two container images to Amazon ECR — one for the application and one for the migration job:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws ecr create-repository --repository-name dbos-app </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws ecr create-repository --repository-name dbos-migrate </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><br></span></code></pre></div></div><p>Note the repository URIs from the output (e.g., <code>${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com/dbos-app</code>).
The commands below use <code>$AWS_ACCOUNT_ID</code> and <code>$AWS_REGION</code>, which you set earlier.</p><p>Authenticate Docker with ECR (tokens expire after 12 hours):</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws ecr get-login-password </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#e6db74">docker</span><span class="token plain"> login </span><span class="token parameter variable" style="color:#f8f8f2">--username</span><span class="token plain"> AWS --password-stdin </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token variable" style="color:#f8f8f2">${AWS_ACCOUNT_ID}</span><span class="token plain">.dkr.ecr.</span><span class="token variable" style="color:#f8f8f2">${AWS_REGION}</span><span class="token plain">.amazonaws.com</span><br></span></code></pre></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="secrets">Secrets<a href="#secrets" class="hash-link" aria-label="Direct link to Secrets" title="Direct link to Secrets" translate="no">​</a></h3><p>Several components need sensitive credentials.
We use <a href="https://github.com/bitnami-labs/sealed-secrets" target="_blank" rel="noopener noreferrer" class="">Bitnami Sealed Secrets</a>: create a regular Secret, encrypt it with <code>kubeseal</code>, and apply the encrypted <code>SealedSecret</code> to the cluster.
The controller decrypts it in-cluster into a standard Kubernetes Secret that pods can reference.
The encrypted form is safe to commit to Git.</p><p><strong>Secrets Inventory</strong></p><table><thead><tr><th>Secret</th><th>Keys</th><th>Used by</th></tr></thead><tbody><tr><td><code>postgres-admin</code></td><td><code>password</code>, <code>database-url</code></td><td>Migration Job — admin access to create/update DBOS system tables</td></tr><tr><td><code>dbos-app-db</code></td><td><code>database-url</code></td><td>DBOS Application — restricted access to <code>dbos_app</code> database</td></tr><tr><td><code>conductor-api-key</code></td><td><code>api-key</code></td><td>DBOS Application — authenticates with Conductor</td></tr></tbody></table><p><strong>Create and Seal Secrets</strong></p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>kubeseal commands for all 3 secrets</strong></summary><div><div class="collapsibleContent_i85q"><p>Create each secret, pipe it through <code>kubeseal</code>, and save the encrypted form:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># 1. PostgreSQL admin credentials (used by the migration Job)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl create secret generic postgres-admin </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--namespace</span><span class="token plain"> dbos </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --from-literal</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">password</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token string variable" style="color:#f8f8f2">$POSTGRES_PASSWORD</span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --from-literal</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">database-url</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;postgresql://postgres:</span><span class="token string variable" style="color:#f8f8f2">${POSTGRES_PASSWORD}</span><span class="token string" style="color:#a6e22e">@</span><span class="token string variable" style="color:#f8f8f2">${RDS_ENDPOINT}</span><span class="token string" style="color:#a6e22e">:5432/dbos_app?sslmode=require&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --dry-run</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">client </span><span class="token parameter variable" style="color:#f8f8f2">-o</span><span class="token plain"> yaml </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  kubeseal --controller-name</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">sealed-secrets --controller-namespace</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">kube-system </span><span class="token parameter variable" style="color:#f8f8f2">--format</span><span class="token plain"> yaml </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> sealed-postgres-admin.yaml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># 2. DBOS application database credentials (restricted role)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl create secret generic dbos-app-db </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--namespace</span><span class="token plain"> dbos </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --from-literal</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">database-url</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;postgresql://dbos_app_role:</span><span class="token string variable" style="color:#f8f8f2">${APP_ROLE_PASSWORD}</span><span class="token string" style="color:#a6e22e">@</span><span class="token string variable" style="color:#f8f8f2">${RDS_ENDPOINT}</span><span class="token string" style="color:#a6e22e">:5432/dbos_app?sslmode=require&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --dry-run</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">client </span><span class="token parameter variable" style="color:#f8f8f2">-o</span><span class="token plain"> yaml </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  kubeseal --controller-name</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">sealed-secrets --controller-namespace</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">kube-system </span><span class="token parameter variable" style="color:#f8f8f2">--format</span><span class="token plain"> yaml </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> sealed-dbos-app-db.yaml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># 3. Conductor API key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl create secret generic conductor-api-key </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--namespace</span><span class="token plain"> dbos </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --from-literal</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">api-key</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token string variable" style="color:#f8f8f2">$CONDUCTOR_API_KEY</span><span class="token string" style="color:#a6e22e">&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --dry-run</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">client </span><span class="token parameter variable" style="color:#f8f8f2">-o</span><span class="token plain"> yaml </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  kubeseal --controller-name</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">sealed-secrets --controller-namespace</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">kube-system </span><span class="token parameter variable" style="color:#f8f8f2">--format</span><span class="token plain"> yaml </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> sealed-conductor-api-key.yaml</span><br></span></code></pre></div></div></div></div></details><p><strong>Apply and Verify</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#f8f8f2">-f</span><span class="token plain"> sealed-postgres-admin.yaml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#f8f8f2">-f</span><span class="token plain"> sealed-dbos-app-db.yaml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#f8f8f2">-f</span><span class="token plain"> sealed-conductor-api-key.yaml</span><br></span></code></pre></div></div><p>Verify the controller has decrypted them into regular Kubernetes Secrets:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl get secrets </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos</span><br></span></code></pre></div></div><p>You should see all three secrets with type <code>Opaque</code>:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">NAME                TYPE     DATA   AGE</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">conductor-api-key   Opaque   1      10s</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dbos-app-db         Opaque   1      10s</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">postgres-admin      Opaque   2      10s</span><br></span></code></pre></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="database-migrations">Database Migrations<a href="#database-migrations" class="hash-link" aria-label="Direct link to Database Migrations" title="Direct link to Database Migrations" translate="no">​</a></h3><p>DBOS applications store workflow state in <a class="" href="/explanations/system-tables">system tables</a>.
These tables must be created before the application can start.
We use a separate Kubernetes Job that runs <code>dbos migrate</code> with <strong>admin</strong> credentials, then the application itself runs with a <strong>restricted</strong> role that can only read/write data — not modify schema.</p><p>This separation follows the principle of least privilege: the application never holds the keys to alter its own schema.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Migration image and build</strong></summary><div><div class="collapsibleContent_i85q"><p>The migration image contains only the DBOS CLI — it doesn&#x27;t include your application code.</p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_OeMC">Dockerfile.migrate</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">FROM golang:1.25-alpine AS builder</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">RUN CGO_ENABLED=0 GOOS=linux go install github.com/dbos-inc/dbos-transact-golang/cmd/dbos@latest</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">FROM alpine:latest</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">RUN apk --no-cache add ca-certificates</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">COPY --from=builder /go/bin/dbos /usr/local/bin/dbos</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ENTRYPOINT [&quot;dbos&quot;]</span><br></span></code></pre></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Set your ECR repository URI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">ECR_MIGRATE</span><span class="token operator" style="color:#66d9ef">=</span><span class="token variable" style="color:#f8f8f2">${AWS_ACCOUNT_ID}</span><span class="token plain">.dkr.ecr.</span><span class="token variable" style="color:#f8f8f2">${AWS_REGION}</span><span class="token plain">.amazonaws.com/dbos-migrate</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Build for linux/amd64</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:#f8f8f2">--platform</span><span class="token plain"> linux/amd64 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">-t</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">${ECR_MIGRATE}</span><span class="token plain">:latest </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">-f</span><span class="token plain"> Dockerfile.migrate </span><span class="token builtin class-name" style="color:#e6db74">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Push to ECR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">docker</span><span class="token plain"> push </span><span class="token variable" style="color:#f8f8f2">${ECR_MIGRATE}</span><span class="token plain">:latest</span><br></span></code></pre></div></div></div></div></details><p>The Job runs <code>dbos migrate --app-role dbos_app_role</code>, which:</p><ol>
<li class="">Creates the DBOS system tables in the <code>dbos_app</code> database (if they don&#x27;t exist)</li>
<li class="">Applies any pending schema migrations</li>
<li class="">Grants the necessary permissions to <code>dbos_app_role</code> so the application can read and write workflow state</li>
</ol><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>manifests/migrate-job.yaml</strong></summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> batch/v1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> Job</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">migrate</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">backoffLimit</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> OnFailure</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> migrate</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">AWS_ACCOUNT_ID</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">.dkr.ecr.$</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">AWS_REGION</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">.amazonaws.com/dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">migrate</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">args</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;migrate&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;--app-role&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;dbos_app_role&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">env</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> DBOS_SYSTEM_DATABASE_URL</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">valueFrom</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token key atrule">secretKeyRef</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> postgres</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">admin</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  </span><span class="token key atrule">key</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> database</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">url</span><br></span></code></pre></div></div><p>The <code>postgres-admin</code> secret contains the admin connection string, which has the privileges needed to create tables and grant permissions.
The <code>--app-role</code> flag tells <code>dbos migrate</code> to grant the specified role access to the system tables.</p></div></div></details><p><strong>Run the Migration</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#f8f8f2">-f</span><span class="token plain"> manifests/migrate-job.yaml</span><br></span></code></pre></div></div><p>Wait for the job to complete:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl get </span><span class="token function" style="color:#e6db74">jobs</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos</span><br></span></code></pre></div></div><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">NAME           STATUS     COMPLETIONS   DURATION   AGE</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dbos-migrate   Complete   1/1           8s         30s</span><br></span></code></pre></div></div><p>Check the logs to confirm the migration succeeded:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl logs </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos job/dbos-migrate</span><br></span></code></pre></div></div><p><strong>Re-running Migrations</strong></p><p>When you deploy a new version of the DBOS SDK that includes schema changes, re-run the migration job.
Since Kubernetes Job names must be unique, delete the old job first:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl delete job dbos-migrate </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#f8f8f2">-f</span><span class="token plain"> manifests/migrate-job.yaml</span><br></span></code></pre></div></div><p>In a CI/CD pipeline, you would typically give each migration job a unique name (e.g., <code>dbos-migrate-v2</code>) or use a Helm hook with <code>hook-delete-policy: before-hook-creation</code>.</p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="application-deployment">Application Deployment<a href="#application-deployment" class="hash-link" aria-label="Direct link to Application Deployment" title="Direct link to Application Deployment" translate="no">​</a></h3><p>Build and push the application image to ECR, then apply the application manifest.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Dockerfile, manifest, and ECR push</strong></summary><div><div class="collapsibleContent_i85q"><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_OeMC">Dockerfile</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">FROM golang:1.25-alpine AS builder</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">COPY go.mod go.sum ./</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">RUN go mod download</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">COPY . .</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">RUN CGO_ENABLED=0 GOOS=linux go build -o dbos-app .</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">FROM alpine:latest</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">RUN apk --no-cache add ca-certificates</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">COPY --from=builder /app/dbos-app .</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">EXPOSE 8080</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">CMD [&quot;./dbos-app&quot;]</span><br></span></code></pre></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Set your ECR repository URI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">ECR_REPO</span><span class="token operator" style="color:#66d9ef">=</span><span class="token variable" style="color:#f8f8f2">${AWS_ACCOUNT_ID}</span><span class="token plain">.dkr.ecr.</span><span class="token variable" style="color:#f8f8f2">${AWS_REGION}</span><span class="token plain">.amazonaws.com/dbos-app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Build for linux/amd64 (EKS nodes run Linux)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:#f8f8f2">--platform</span><span class="token plain"> linux/amd64 </span><span class="token parameter variable" style="color:#f8f8f2">-t</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">${ECR_REPO}</span><span class="token plain">:latest </span><span class="token builtin class-name" style="color:#e6db74">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Push to ECR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">docker</span><span class="token plain"> push </span><span class="token variable" style="color:#f8f8f2">${ECR_REPO}</span><span class="token plain">:latest</span><br></span></code></pre></div></div><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_OeMC">manifests/dbos-app.yaml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">AWS_ACCOUNT_ID</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">.dkr.ecr.$</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">AWS_REGION</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain">.amazonaws.com/dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">app</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">env</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> DBOS_SYSTEM_DATABASE_URL</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">valueFrom</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token key atrule">secretKeyRef</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">app</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">db</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  </span><span class="token key atrule">key</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> database</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">url</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> DBOS_CONDUCTOR_URL</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">value</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;${CONDUCTOR_URL}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> DBOS_CONDUCTOR_KEY</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">valueFrom</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token key atrule">secretKeyRef</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> conductor</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">api</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">key</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                  </span><span class="token key atrule">key</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> api</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">key</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">readinessProbe</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">path</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> /healthz</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">periodSeconds</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">livenessProbe</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">path</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> /healthz</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">periodSeconds</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 500m</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 256Mi</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">limits</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">cpu</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;2&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token key atrule">memory</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> 512Mi</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">port</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">8080</span><br></span></code></pre></div></div><p>Replace <code>${CONDUCTOR_URL}</code> with the value you set earlier:</p><ul>
<li class=""><strong>DBOS Cloud</strong>: <code>wss://conductor.dbos.dev/</code></li>
<li class=""><strong>Self-hosted (same cluster)</strong>: <code>ws://conductor.dbos.svc.cluster.local:8090</code></li>
<li class=""><strong>Self-hosted (external)</strong>: <code>wss://&lt;your-conductor-hostname&gt;/conductor/</code></li>
</ul><p>The database URL and API key are pulled from the Sealed Secrets created in the <a href="#secrets" class="">Secrets</a> section.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Trusting a self-signed TLS certificate</strong></summary><div><div class="collapsibleContent_i85q"><p>If your self-hosted Conductor uses a <strong>CA-signed certificate</strong> (e.g., from <a href="https://cert-manager.io/" target="_blank" rel="noopener noreferrer" class="">cert-manager</a> with Let&#x27;s Encrypt), no extra configuration is needed — the system CA bundle already trusts it.</p><p>If Conductor uses a <strong>self-signed certificate</strong>, the application must explicitly trust it.
Store the certificate as a Kubernetes Secret, mount it into an init container that appends it to the system CA bundle, and point the app container at the extended bundle via <code>SSL_CERT_FILE</code>:</p><ol>
<li class="">
<p>Create a TLS secret from your certificate files:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl create secret tls dbos-tls </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--cert</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">tls.crt </span><span class="token parameter variable" style="color:#f8f8f2">--key</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">tls.key </span><span class="token parameter variable" style="color:#f8f8f2">--namespace</span><span class="token plain"> dbos</span><br></span></code></pre></div></div>
</li>
<li class="">
<p>Add an init container and volumes to the Deployment spec:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">initContainers</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> setup</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">certs</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">image</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">command</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#a6e22e">&quot;sh&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;-c&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;cp /etc/ssl/certs/ca-certificates.crt /certs/ca-certificates.crt &amp;&amp; cat /tls/tls.crt &gt;&gt; /certs/ca-certificates.crt&quot;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> tls</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">cert</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> /tls</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token key atrule">readOnly</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ae81ff">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> ca</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">certs</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> /certs </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#8292a2;font-style:italic"># ... app container with:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#8292a2;font-style:italic">#   env:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#8292a2;font-style:italic">#     - name: SSL_CERT_FILE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#8292a2;font-style:italic">#       value: &quot;/certs/ca-certificates.crt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#8292a2;font-style:italic">#   volumeMounts:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#8292a2;font-style:italic">#     - { name: ca-certs, mountPath: /certs, readOnly: true }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> tls</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">cert</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">secret</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">tls</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token key atrule">items</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">              </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> tls.crt</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> tls.crt </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> ca</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">certs</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token key atrule">emptyDir</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div>
</li>
</ol></div></div></details></div></div></details><div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>When using DBOS managed Conductor, you don&#x27;t need to set <code>DBOS_CONDUCTOR_URL</code> in the manifest.</p></div></div><p><strong>Deploy the Application</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#f8f8f2">-f</span><span class="token plain"> manifests/dbos-app.yaml</span><br></span></code></pre></div></div><p>Verify the pod is running:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl get pods </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos </span><span class="token parameter variable" style="color:#f8f8f2">-l</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#f8f8f2">app</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">dbos-app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl logs </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos </span><span class="token parameter variable" style="color:#f8f8f2">-l</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#f8f8f2">app</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">dbos-app </span><span class="token parameter variable" style="color:#f8f8f2">--tail</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">20</span><br></span></code></pre></div></div><p>You should see Conductor connection messages in the logs. You can also verify the connection in the Console UI.</p><p>To access the application locally, use port-forwarding:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl port-forward svc/dbos-app </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos </span><span class="token number" style="color:#ae81ff">8080</span><span class="token plain">:8080</span><br></span></code></pre></div></div><p>Then in another terminal:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">curl</span><span class="token plain"> http://localhost:8080/healthz</span><br></span></code></pre></div></div><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="scaling-with-keda-1">Scaling with KEDA<a href="#scaling-with-keda-1" class="hash-link" aria-label="Direct link to Scaling with KEDA" title="Direct link to Scaling with KEDA" translate="no">​</a></h3><p><a href="https://keda.sh/" target="_blank" rel="noopener noreferrer" class="">KEDA</a> (Kubernetes Event-Driven Autoscaling) scales your application pods based on external metrics.
In this section, KEDA polls the application&#x27;s queue-depth endpoint and adjusts the replica count so that your application deployment has enough capacity to absorb load.</p><p><strong>How the Metrics Endpoint Works</strong></p><p>The sample application exposes <code>GET /metrics/:queueName</code>, which returns the number of workflows currently waiting on a queue:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">curl</span><span class="token plain"> http://dbos-app.dbos.svc.cluster.local:8080/metrics/taskQueue</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># {&quot;queue_length&quot;: 7}</span><br></span></code></pre></div></div><p>KEDA uses the <code>metrics-api</code> trigger to poll this endpoint and extract <code>queue_length</code>.
It computes the desired replica count as:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">desiredReplicas = ceil(queue_length / targetValue)</span><br></span></code></pre></div></div><p>With <code>targetValue: &quot;2&quot;</code> (matching the queue&#x27;s <code>WithWorkerConcurrency(2)</code>), each pod handles two concurrent workflows.
For example, if 7 workflows are queued, KEDA scales to <code>ceil(7 / 2) = 4</code> pods.</p><p><strong>ScaledObject Manifest</strong></p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>manifests/keda-scaledobject.yaml</strong></summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> keda.sh/v1alpha1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> ScaledObject</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">app</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">scaledobject</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">scaleTargetRef</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">pollingInterval</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">cooldownPeriod</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">minReplicaCount</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">maxReplicaCount</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">triggers</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">type</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> metrics</span><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">url</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;http://dbos-app.dbos.svc.cluster.local:8080/metrics/taskQueue&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">valueLocation</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;queue_length&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token key atrule">targetValue</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;2&quot;</span><br></span></code></pre></div></div><table><thead><tr><th>Field</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>scaleTargetRef.name</code></td><td><code>dbos-app</code></td><td>The Deployment to scale</td></tr><tr><td><code>pollingInterval</code></td><td><code>15</code></td><td>Seconds between metric checks (default 30)</td></tr><tr><td><code>cooldownPeriod</code></td><td><code>60</code></td><td>Seconds to wait after the last trigger activation before scaling down (default 300)</td></tr><tr><td><code>minReplicaCount</code></td><td><code>1</code></td><td>Minimum replicas — must be ≥1 because the <code>metrics-api</code> trigger polls the app itself</td></tr><tr><td><code>maxReplicaCount</code></td><td><code>10</code></td><td>Upper bound for the replica count</td></tr><tr><td><code>url</code></td><td><code>http://dbos-app...</code></td><td>In-cluster URL to the app&#x27;s queue metrics endpoint</td></tr><tr><td><code>valueLocation</code></td><td><code>queue_length</code></td><td>JSON field to extract from the response</td></tr><tr><td><code>targetValue</code></td><td><code>&quot;2&quot;</code></td><td>Desired metric value per replica — matches <code>WithWorkerConcurrency(2)</code></td></tr></tbody></table></div></div></details><p><strong>Apply and Verify</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#f8f8f2">-f</span><span class="token plain"> manifests/keda-scaledobject.yaml</span><br></span></code></pre></div></div><p>Verify the ScaledObject is ready:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl get scaledobject </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos</span><br></span></code></pre></div></div><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">NAME                      SCALETARGETKIND      SCALETARGETNAME   MIN   MAX   TRIGGERS      AUTHENTICATION   READY   ACTIVE   FALLBACK   AGE</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dbos-app-scaledobject     apps/v1.Deployment   dbos-app          1     10    metrics-api                    True    False    False      10s</span><br></span></code></pre></div></div><p>KEDA auto-creates a Horizontal Pod Autoscaler (HPA) under the hood:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl get hpa </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos</span><br></span></code></pre></div></div><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">NAME                               REFERENCE             TARGETS       MINPODS   MAXPODS   REPLICAS   AGE</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">keda-hpa-dbos-app-scaledobject     Deployment/dbos-app   0/2 (avg)     1         10        1          10s</span><br></span></code></pre></div></div><p><strong>Test Autoscaling</strong></p><p>With port-forwarding active (<code>kubectl port-forward svc/dbos-app -n dbos 8080:8080</code>), enqueue several long-running workflows to build up queue depth.
Each call enqueues a workflow that sleeps for 60 seconds:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#f8f8f2">i</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$(</span><span class="token variable function" style="color:#e6db74">seq</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable number" style="color:#ae81ff">1</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable number" style="color:#ae81ff">10</span><span class="token variable" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#e6db74">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-s</span><span class="token plain"> http://localhost:8080/enqueue/60</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">done</span><br></span></code></pre></div></div><p>Watch the pods scale up (in another terminal):</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">kubectl get pods </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> dbos </span><span class="token parameter variable" style="color:#f8f8f2">-l</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#f8f8f2">app</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">dbos-app </span><span class="token parameter variable" style="color:#f8f8f2">-w</span><br></span></code></pre></div></div><p>You should see new pods appear as KEDA detects the growing queue:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">NAME                        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dbos-app-xxxxxxxxx-aaaaa    1/1     Running   0          5m</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dbos-app-xxxxxxxxx-bbbbb    1/1     Running   0          15s</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dbos-app-xxxxxxxxx-ccccc    1/1     Running   0          15s</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dbos-app-xxxxxxxxx-ddddd    1/1     Running   0          15s</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dbos-app-xxxxxxxxx-eeeee    1/1     Running   0          15s</span><br></span></code></pre></div></div><p>Check the current queue depth:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-s</span><span class="token plain"> http://localhost:8080/metrics/taskQueue</span><br></span></code></pre></div></div><p>As workflows complete and the queue drains, the metric drops.
After the <code>cooldownPeriod</code> (60 seconds of no trigger activation), KEDA scales back down to <code>minReplicaCount</code> (1).</p><h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cleanup">Cleanup<a href="#cleanup" class="hash-link" aria-label="Direct link to Cleanup" title="Direct link to Cleanup" translate="no">​</a></h3><p>To tear down all AWS resources when done:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Delete the EKS cluster (includes VPC, security groups, and node group)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">eksctl delete cluster </span><span class="token parameter variable" style="color:#f8f8f2">--name</span><span class="token plain"> dbos-app-cluster </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Delete the RDS instance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws rds delete-db-instance --db-instance-identifier dbos-app-pg </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --skip-final-snapshot </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Delete ECR repositories</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws ecr delete-repository --repository-name dbos-app </span><span class="token parameter variable" style="color:#f8f8f2">--force</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws ecr delete-repository --repository-name dbos-migrate </span><span class="token parameter variable" style="color:#f8f8f2">--force</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Delete the RDS security group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token assign-left variable" style="color:#f8f8f2">RDS_SG</span><span class="token operator" style="color:#66d9ef">=</span><span class="token variable" style="color:#f8f8f2">$(</span><span class="token variable" style="color:#f8f8f2">aws ec2 describe-security-groups </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--filters</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable string" style="color:#a6e22e">&quot;Name=group-name,Values=dbos-app-rds&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token variable" style="color:#f8f8f2"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token variable" style="color:#f8f8f2">  </span><span class="token variable parameter variable" style="color:#f8f8f2">--query</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable string" style="color:#a6e22e">&quot;SecurityGroups[0].GroupId&quot;</span><span class="token variable" style="color:#f8f8f2"> </span><span class="token variable parameter variable" style="color:#f8f8f2">--output</span><span class="token variable" style="color:#f8f8f2"> text </span><span class="token variable parameter variable" style="color:#f8f8f2">--region</span><span class="token variable" style="color:#f8f8f2"> $AWS_REGION</span><span class="token variable" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws ec2 delete-security-group --group-id </span><span class="token variable" style="color:#f8f8f2">$RDS_SG</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Delete the DB subnet group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">aws rds delete-db-subnet-group --db-subnet-group-name dbos-app-db </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$AWS_REGION</span><br></span></code></pre></div></div></div></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/production/hosting-conductor-with-kubernetes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Self-Hosting Conductor With Kubernetes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/production/hosting-with-cloud-run"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deploying With Google Cloud Run</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#database-privilege-separation" class="table-of-contents__link toc-highlight">Database Privilege Separation</a></li><li><a href="#availability" class="table-of-contents__link toc-highlight">Availability</a></li><li><a href="#upgrading-workflow-code" class="table-of-contents__link toc-highlight">Upgrading Workflow Code</a></li><li><a href="#scaling-with-keda" class="table-of-contents__link toc-highlight">Scaling with KEDA</a></li><li><a href="#walkthrough-aws-eks" class="table-of-contents__link toc-highlight">Walkthrough (AWS EKS)</a><ul><li><a href="#infrastructure" class="table-of-contents__link toc-highlight">Infrastructure</a></li><li><a href="#secrets" class="table-of-contents__link toc-highlight">Secrets</a></li><li><a href="#database-migrations" class="table-of-contents__link toc-highlight">Database Migrations</a></li><li><a href="#application-deployment" class="table-of-contents__link toc-highlight">Application Deployment</a></li><li><a href="#scaling-with-keda-1" class="table-of-contents__link toc-highlight">Scaling with KEDA</a></li><li><a href="#cleanup" class="table-of-contents__link toc-highlight">Cleanup</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Follow Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/dbos-inc/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://bsky.app/profile/dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bluesky<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/DBOS_Inc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter/X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.dbos.dev/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.dbos.dev/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Questions or Comments?</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/fMwQjeW5zg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat with us on Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:contact@dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Write to us at contact@dbos.dev<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://dbos.dev" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="100"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="100"></a></div><div class="footer__copyright">Copyright © 2026 DBOS, Inc. | <a href="https://www.dbos.dev/privacy" target="_blank">Privacy Policy</a></div></div></div></footer></div>
</body>
</html>