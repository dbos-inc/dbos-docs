<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-production/hosting-with-cloud-run" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Deploying With Google Cloud Run | DBOS Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.dbos.dev/img/social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.dbos.dev/production/hosting-with-cloud-run"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploying With Google Cloud Run | DBOS Docs"><meta data-rh="true" name="description" content="This guide covers deploying a DBOS application to Google Cloud Run with a Cloud SQL for PostgreSQL database. It includes best practices for security, availability, and scalability. This guide assumes DBOS Conductor is hosted separately."><meta data-rh="true" property="og:description" content="This guide covers deploying a DBOS application to Google Cloud Run with a Cloud SQL for PostgreSQL database. It includes best practices for security, availability, and scalability. This guide assumes DBOS Conductor is hosted separately."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.dbos.dev/production/hosting-with-cloud-run"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/production/hosting-with-cloud-run" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.dbos.dev/production/hosting-with-cloud-run" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://UY2VKOMIL2-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Deploying With Google Cloud Run","item":"https://docs.dbos.dev/production/hosting-with-cloud-run"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="DBOS Docs" href="/opensearch.xml">


<link rel="preconnect" href="https://dbosdev.matomo.cloud/">
<script>var _paq=window._paq=window._paq||[];_paq.push(["setRequestMethod","POST"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),_paq.push(["enableHeartBeatTimer"]),function(){var e="https://dbosdev.matomo.cloud/";_paq.push(["setRequestMethod","POST"]),_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var a=document,t=a.createElement("script"),p=a.getElementsByTagName("script")[0];t.type="text/javascript",t.async=!0,t.src=e+"matomo.js",p.parentNode.insertBefore(t,p)}()</script>

<link rel="preconnect" href="https://d2j9bas80r5yfz.cloudfront.net">
<script>!function(t,e){var o,r,s,a;e.__SV||(window.posthog=e,e._i=[],e.init=function(n,i,p){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(s=t.createElement("script")).type="text/javascript",s.async=!0,s.src=i.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(a=t.getElementsByTagName("script")[0]).parentNode.insertBefore(s,a);var g=e;for(void 0!==p?g=e[p]=[]:p="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==p&&(e+="."+p),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),r=0;r<o.length;r++)c(g,o[r]);e._i.push([n,i,p])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_vKGgPmFevFB3QVyqZdIZeNqcWAPqk3i3mDhwGqwk6nP",{api_host:"https://d2j9bas80r5yfz.cloudfront.net",id:"default"})</script>
<script async defer="defer" id="hs-script-loader" src="//js.hs-scripts.com/45237820.js"></script>
<script src="/scripts/reo.js"></script><link rel="stylesheet" href="/assets/css/styles.292b392a.css">
<script src="/assets/js/runtime~main.d01660e1.js" defer="defer"></script>
<script src="/assets/js/main.bc1922d7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://dbos.dev" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/quickstart">Quickstart</a><a class="navbar__item navbar__link" href="/examples">Examples</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://console.dbos.dev/login-redirect" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link dbos-button-blue">DBOS Console</a><a href="https://github.com/dbos-inc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/"><span title="Home" class="linkLabel_WmDU">Home</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quickstart"><span title="Get Started" class="linkLabel_WmDU">Get Started</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/why-dbos"><span title="Why DBOS?" class="linkLabel_WmDU">Why DBOS?</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/architecture"><span title="DBOS Architecture" class="linkLabel_WmDU">DBOS Architecture</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/python/programming-guide"><span title="Develop with Python" class="categoryLinkLabel_W154">Develop with Python</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/typescript/programming-guide"><span title="Develop with TypeScript" class="categoryLinkLabel_W154">Develop with TypeScript</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/golang/programming-guide"><span title="Develop with Go" class="categoryLinkLabel_W154">Develop with Go</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/java/programming-guide"><span title="Develop with Java" class="categoryLinkLabel_W154">Develop with Java</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/production/conductor"><span title="Deploy To Production" class="categoryLinkLabel_W154">Deploy To Production</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/conductor"><span title="DBOS Conductor" class="linkLabel_WmDU">DBOS Conductor</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/hosting-conductor"><span title="Self-Hosting Conductor" class="linkLabel_WmDU">Self-Hosting Conductor</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/checklist"><span title="Production Checklist" class="linkLabel_WmDU">Production Checklist</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/workflow-management"><span title="Workflow Management" class="linkLabel_WmDU">Workflow Management</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/workflow-recovery"><span title="Workflow Recovery" class="linkLabel_WmDU">Workflow Recovery</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/alerting"><span title="Alerting" class="linkLabel_WmDU">Alerting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/mcp"><span title="DBOS MCP Server" class="linkLabel_WmDU">DBOS MCP Server</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/hosting-with-docker"><span title="Deploying With Docker" class="linkLabel_WmDU">Deploying With Docker</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/hosting-with-kubernetes"><span title="Deploying With Kubernetes" class="linkLabel_WmDU">Deploying With Kubernetes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/production/hosting-with-cloud-run"><span title="Deploying With Google Cloud Run" class="linkLabel_WmDU">Deploying With Google Cloud Run</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/production/retention"><span title="Workflow Retention Policies" class="linkLabel_WmDU">Workflow Retention Policies</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/production/dbos-cloud/deploying-to-cloud"><span title="DBOS Cloud" class="categoryLinkLabel_W154">DBOS Cloud</span></a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/integrations/supabase"><span title="Integrations" class="categoryLinkLabel_W154">Integrations</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/explanations/system-tables"><span title="Concepts and Explanations" class="categoryLinkLabel_W154">Concepts and Explanations</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq"><span title="Troubleshooting &amp; FAQ" class="linkLabel_WmDU">Troubleshooting &amp; FAQ</span></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deploy To Production</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Deploying With Google Cloud Run</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Deploying a DBOS App on Google Cloud Run</h1></header>
<p>This guide covers deploying a DBOS application to <a href="https://cloud.google.com/run" target="_blank" rel="noopener noreferrer" class="">Google Cloud Run</a> with a <a href="https://cloud.google.com/sql/docs/postgres" target="_blank" rel="noopener noreferrer" class="">Cloud SQL for PostgreSQL</a> database. It includes best practices for security, availability, and scalability. This guide assumes <a class="" href="/production/conductor">DBOS Conductor</a> is hosted separately.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="choosing-a-cloud-run-execution-mode">Choosing a Cloud Run Execution Mode<a href="#choosing-a-cloud-run-execution-mode" class="hash-link" aria-label="Direct link to Choosing a Cloud Run Execution Mode" title="Direct link to Choosing a Cloud Run Execution Mode" translate="no">​</a></h2>
<p>Cloud Run offers three execution modes, each mapping differently to DBOS workloads:</p>
<ul>
<li class=""><strong>Service</strong> handles HTTP requests and auto-scales based on traffic and CPU usage. Best for synchronous workflows.</li>
<li class=""><strong>Worker Pool</strong> runs always-on instances with no HTTP listener. Best for queue-heavy applications that need all DBOS background services online at all times.</li>
<li class=""><strong>Job</strong> runs a container to completion and exits. Useful for periodic batch work with no always-on requirement.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="service">Service<a href="#service" class="hash-link" aria-label="Direct link to Service" title="Direct link to Service" translate="no">​</a></h3>
<p>A <a href="https://cloud.google.com/run/docs/overview/what-is-cloud-run#services" target="_blank" rel="noopener noreferrer" class="">Cloud Run service</a> listens for HTTP requests and scales automatically based on traffic and CPU usage.</p>
<p>DBOS runs background services—the scheduler, queue runner, recovery service, and Conductor connection—that operate independently of HTTP requests. These require CPU at all times, so you should use <a href="https://docs.cloud.google.com/run/docs/configuring/billing-settings" target="_blank" rel="noopener noreferrer" class="">instance-based billing</a> and set <code>--min-instances=1</code> to keep one instance always on. This is similar to the requirements for using <a href="https://docs.cloud.google.com/run/docs/deploying#sidecars" target="_blank" rel="noopener noreferrer" class="">sidecars on Cloud Run</a>.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Database connection exhaustion</div><div class="admonitionContent_BuS1"><p>In Service mode, use a connection pooler like <a href="https://www.pgbouncer.org/" target="_blank" rel="noopener noreferrer" class="">PgBouncer</a> in front of your Cloud SQL instance. Cloud Run can scale to hundreds of instances under load, which may exhaust your database&#x27;s maximum connections. PgBouncer must run in <strong>session mode</strong>—DBOS uses LISTEN/NOTIFY, which is <a href="https://www.pgbouncer.org/features.html" target="_blank" rel="noopener noreferrer" class="">incompatible with transaction mode</a>.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="worker-pool">Worker Pool<a href="#worker-pool" class="hash-link" aria-label="Direct link to Worker Pool" title="Direct link to Worker Pool" translate="no">​</a></h3>
<p>A <a href="https://cloud.google.com/run/docs/overview/what-is-cloud-run#workers" target="_blank" rel="noopener noreferrer" class="">Cloud Run worker pool</a> runs always-on containers without an HTTP listener. Because instances never scale to zero, all DBOS background services stay online.</p>
<p>Worker pools suit DBOS applications that rely heavily on queues. Every instance actively dequeues and processes workflows, and the pool can be resized via the <a href="https://docs.cloud.google.com/run/docs/reference/rest" target="_blank" rel="noopener noreferrer" class="">Cloud Run REST API</a>.</p>
<p>Worker pools don&#x27;t auto-scale, but you can implement an <strong>external scaler</strong> from within the pool. Use a DBOS <a class="" href="/golang/tutorials/workflow-tutorial#scheduled-workflows">scheduled workflow</a> that periodically checks queue length with <a class="" href="/golang/reference/client"><code>ListWorkflows</code></a> and calls the <a href="https://cloud.google.com/run/docs/reference/rest/v2/projects.locations.workerPools" target="_blank" rel="noopener noreferrer" class="">Cloud Run Admin API</a> to resize the pool based on load.
This works <em>even from within the pool</em> because DBOS guarantees only one process runs a scheduled function at a time, even across multiple instances. This prevents a thundering herd of conflicting resize requests.</p>
<p>See <a href="#scaling-a-worker-pool" class="">Scaling a worker pool</a> below for a full walkthrough.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="job">Job<a href="#job" class="hash-link" aria-label="Direct link to Job" title="Direct link to Job" translate="no">​</a></h3>
<p>A <a href="https://cloud.google.com/run/docs/overview/what-is-cloud-run#jobs" target="_blank" rel="noopener noreferrer" class="">Cloud Run job</a> runs a container to completion and exits without listening for HTTP requests.</p>
<p>Because DBOS has a <a class="" href="/golang/tutorials/workflow-tutorial#scheduled-workflows">built-in scheduler</a>, you typically don&#x27;t need Cloud Run Jobs. However, Jobs suit applications that consist entirely of periodic work with no always-on requirement—the job starts, runs workflows to completion, and shuts down, so you only pay for the time it runs.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="deploying-to-cloud-run">Deploying to Cloud Run<a href="#deploying-to-cloud-run" class="hash-link" aria-label="Direct link to Deploying to Cloud Run" title="Direct link to Deploying to Cloud Run" translate="no">​</a></h2>
<p>Deploying a DBOS application to Cloud Run is no different from deploying any other containerized application. You need a Dockerfile, a database, and the standard Cloud Run deployment commands.</p>
<p>The one DBOS-specific detail is the <strong>database connection string</strong>: it must be provided in <code>key=value</code> format (e.g., <code>user=postgres password=secret database=myappdb host=/cloudsql/...</code>). On Cloud Run, use the <code>--add-cloudsql-instances</code> flag to mount the <a href="https://cloud.google.com/sql/docs/postgres/connect-run" target="_blank" rel="noopener noreferrer" class="">Cloud SQL Auth Proxy</a> Unix socket, then pass the socket path as the <code>host</code> parameter. This gives your app a private, encrypted path to the database with no public IP.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Schema migration</div><div class="admonitionContent_BuS1"><p>By default, DBOS creates its <a class="" href="/explanations/system-tables">system tables</a> on startup. If your Cloud Run service account doesn&#x27;t have DDL privileges, run <a class="" href="/golang/reference/cli"><code>dbos migrate</code></a> with a privileged user before deploying.</p></div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Walkthrough: deploying a DBOS app</strong></summary><div><div class="collapsibleContent_i85q"><p>This walkthrough deploys a sample DBOS Go application (<a href="https://github.com/dbos-inc/dbos-demo-apps/tree/main/golang/cloudrun" target="_blank" rel="noopener noreferrer" class="">source code</a>) to Cloud Run with a Cloud SQL PostgreSQL database. It covers project setup, infrastructure, and deployment in both <strong>Service</strong> and <strong>Worker Pool</strong> modes.</p><hr><p><strong>Google Cloud project setup</strong></p><p>You need a Google Cloud project with billing enabled and the required APIs turned on.</p><p>Install the <a href="https://cloud.google.com/sdk/docs/install-sdk" target="_blank" rel="noopener noreferrer" class="">Google Cloud SDK</a>, then:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud auth login</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud projects create </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud config </span><span class="token builtin class-name" style="color:#e6db74">set</span><span class="token plain"> project </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud beta billing projects </span><span class="token function" style="color:#e6db74">link</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --billing-account</span><span class="token operator" style="color:#66d9ef">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_BILLING_ACCOUNT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud services </span><span class="token builtin class-name" style="color:#e6db74">enable</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  run.googleapis.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  sqladmin.googleapis.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  compute.googleapis.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  servicenetworking.googleapis.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  secretmanager.googleapis.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  artifactregistry.googleapis.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  cloudbuild.googleapis.com</span><br></span></code></pre></div></div><hr><p><strong>VPC networking for Cloud SQL</strong></p><p>Create a VPC with a subnet for Cloud Run, allocate an IP range for VPC peering, and establish the peering connection:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Create VPC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud compute networks create main-vpc --subnet-mode</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">custom</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Create subnet for Cloud Run</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud compute networks subnets create run-subnet </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--network</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">main-vpc </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">us-central1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--range</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">10.0</span><span class="token plain">.0.0/24</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Allocate IP range for Cloud SQL peering</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud compute addresses create google-managed-services-default </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--global</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--purpose</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">VPC_PEERING </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --prefix-length</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">16</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--description</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;Peering for Google Cloud SQL&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--network</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">main-vpc</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Establish VPC peering</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud services vpc-peerings connect </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--service</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">servicenetworking.googleapis.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--ranges</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">google-managed-services-default </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--network</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">main-vpc</span><br></span></code></pre></div></div><hr><p><strong>Cloud SQL PostgreSQL instance</strong></p><p>Create a private-IP-only PostgreSQL instance and an application database:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Create the Cloud SQL instance (private IP only)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud sql instances create my-postgres-instance </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --database-version</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">POSTGRES_17 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--tier</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">db-perf-optimized-N-2 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">us-central1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --root-password</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;[YOUR_STRONG_PASSWORD]&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--network</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">projects/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">/global/networks/main-vpc </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --no-assign-ip</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Create the application database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud sql databases create myappdb </span><span class="token parameter variable" style="color:#f8f8f2">--instance</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">my-postgres-instance</span><br></span></code></pre></div></div><p>Store the database password in Secret Manager:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token builtin class-name" style="color:#e6db74">echo</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;[YOUR_STRONG_PASSWORD]&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> gcloud secrets create db-password </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --data-file</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">- </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --replication-policy</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;automatic&quot;</span><br></span></code></pre></div></div><p>Store the <a class="" href="/production/conductor">DBOS Conductor</a> API key:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token builtin class-name" style="color:#e6db74">echo</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-n</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;[YOUR_CONDUCTOR_API_KEY]&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">|</span><span class="token plain"> gcloud secrets create conductor-api-key </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --data-file</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">- </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --replication-policy</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;automatic&quot;</span><br></span></code></pre></div></div><div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>For production, consider creating a dedicated database user instead of using the <code>postgres</code> superuser. Grant it only the permissions your application needs.</p></div></div><hr><p><strong>IAM service account and permissions</strong></p><p>Create a service account for Cloud Run and grant it access to the secrets and Cloud SQL:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Create service account</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud iam service-accounts create run-identity </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --display-name</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;Cloud Run Service Account&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Grant access to the database password secret</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud secrets add-iam-policy-binding db-password </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--member</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;serviceAccount:run-identity@[YOUR_PROJECT_ID].iam.gserviceaccount.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--role</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;roles/secretmanager.secretAccessor&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Grant access to the Conductor API key secret (if using Conductor)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud secrets add-iam-policy-binding conductor-api-key </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--member</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;serviceAccount:run-identity@[YOUR_PROJECT_ID].iam.gserviceaccount.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--role</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;roles/secretmanager.secretAccessor&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Grant Cloud SQL client role</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud projects add-iam-policy-binding </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--member</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;serviceAccount:run-identity@[YOUR_PROJECT_ID].iam.gserviceaccount.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--role</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;roles/cloudsql.client&quot;</span><br></span></code></pre></div></div><p>When deploying with <code>--source</code>, Cloud Build runs under the project&#x27;s default Compute Engine service account, not <code>run-identity</code>. This account needs the <code>cloudbuild.builds.builder</code> role to build and push container images:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># [YOUR_PROJECT_NUMBER] is the numeric project number (not the project ID)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Find it in the Google Cloud Console under project settings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud projects add-iam-policy-binding </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--member</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;serviceAccount:[YOUR_PROJECT_NUMBER]-compute@developer.gserviceaccount.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--role</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;roles/cloudbuild.builds.builder&quot;</span><br></span></code></pre></div></div><hr><p><strong>Sample Dockerfile</strong></p><p>Multi-stage build with a distroless runtime image:</p><div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_OeMC">Dockerfile</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain"># --- Build Stage ---</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">FROM golang:1.24 as builder</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">COPY go.mod go.sum ./</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">RUN go mod download &amp;&amp; go mod tidy</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">COPY . .</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">RUN CGO_ENABLED=0 GOOS=linux go build -o main .</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"># --- Run Stage ---</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">FROM gcr.io/distroless/static-debian12</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">COPY --from=builder /app/main /</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">EXPOSE 8080</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">CMD [&quot;/main&quot;]</span><br></span></code></pre></div></div><p>You can test the build locally against a local PostgreSQL instance before deploying:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Build the image</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:#f8f8f2">-t</span><span class="token plain"> dbos-go-starter-image </span><span class="token builtin class-name" style="color:#e6db74">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Run with a local Postgres</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:#f8f8f2">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-p</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">8080</span><span class="token plain">:8080 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#f8f8f2">DB_USER</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">postgres </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#f8f8f2">DB_PASSWORD</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;your_local_db_password&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#f8f8f2">DB_NAME</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">myappdb </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#f8f8f2">INSTANCE_UNIX_SOCKET</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">host.docker.internal </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#f8f8f2">DBOS_CONDUCTOR_KEY</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;your_conductor_api_key&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  dbos-go-starter-image</span><br></span></code></pre></div></div><p>Then hit <code>http://localhost:8080/workflow/1</code> to start a DBOS workflow.</p><hr><p><strong>Deploy</strong></p><p>Deploy from source—Cloud Build automatically builds your container and pushes it to Artifact Registry.</p><div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Service</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Worker Pool</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud run deploy my-app </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--source</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#e6db74">.</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> us-central1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --no-cpu-throttling </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --min-instances</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --service-account run-identity@</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">.iam.gserviceaccount.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--network</span><span class="token plain"> main-vpc </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--subnet</span><span class="token plain"> run-subnet </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --vpc-egress private-ranges-only </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --add-cloudsql-instances </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">:us-central1:my-postgres-instance </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --set-secrets </span><span class="token assign-left variable" style="color:#f8f8f2">DB_PASSWORD</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">db-password:latest,DBOS_CONDUCTOR_KEY</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">conductor-api-key:latest </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --set-env-vars </span><span class="token assign-left variable" style="color:#f8f8f2">DB_USER</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">postgres,DB_NAME</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">myappdb,INSTANCE_UNIX_SOCKET</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">/cloudsql/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">:us-central1:my-postgres-instance </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --allow-unauthenticated</span><br></span></code></pre></div></div><p>Key flags:</p><ul>
<li class=""><strong><code>--no-cpu-throttling</code></strong> Enables <a href="https://docs.cloud.google.com/run/docs/configuring/billing-settings" target="_blank" rel="noopener noreferrer" class="">instance-based billing</a> so DBOS background services keep running between requests.</li>
<li class=""><strong><code>--min-instances=1</code></strong> Keeps one instance always on so background services never stop.</li>
<li class=""><strong><code>--set-secrets</code></strong> Injects secrets from Secret Manager as environment variables.</li>
<li class=""><strong><code>--add-cloudsql-instances</code></strong> Mounts the Cloud SQL Auth Proxy socket, letting the app connect via <code>INSTANCE_UNIX_SOCKET</code>.</li>
<li class=""><strong><code>--source .</code></strong> Builds your Dockerfile remotely via <a href="http://cloud.google.com/build" target="_blank" rel="noopener noreferrer" class="">Cloud Build</a>.</li>
<li class=""><strong><code>--allow-unauthenticated</code></strong> Makes the service publicly accessible.</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud beta run worker-pools deploy my-app </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--source</span><span class="token plain"> </span><span class="token builtin class-name" style="color:#e6db74">.</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> us-central1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--instances</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --service-account run-identity@</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">.iam.gserviceaccount.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--network</span><span class="token plain"> main-vpc </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--subnet</span><span class="token plain"> run-subnet </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --vpc-egress private-ranges-only </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --add-cloudsql-instances </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">:us-central1:my-postgres-instance </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --set-secrets </span><span class="token assign-left variable" style="color:#f8f8f2">DB_PASSWORD</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">db-password:latest,DBOS_CONDUCTOR_KEY</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">conductor-api-key:latest </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  --set-env-vars </span><span class="token assign-left variable" style="color:#f8f8f2">DB_USER</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">postgres,DB_NAME</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">myappdb,INSTANCE_UNIX_SOCKET</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">/cloudsql/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">:us-central1:my-postgres-instance,GCP_PROJECT_ID</span><span class="token operator" style="color:#66d9ef">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">,GCP_REGION</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">us-central1,WORKER_POOL_NAME</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">my-app</span><br></span></code></pre></div></div><p>Key flags:</p><ul>
<li class=""><strong><code>--set-secrets</code></strong> Injects secrets from Secret Manager as environment variables.</li>
<li class=""><strong><code>--add-cloudsql-instances</code></strong> Mounts the Cloud SQL Auth Proxy socket, letting the app connect via <code>INSTANCE_UNIX_SOCKET</code>.</li>
<li class=""><strong><code>--source .</code></strong> Builds your Dockerfile remotely via <a href="https://cloud.google.com/build" target="_blank" rel="noopener noreferrer" class="">Cloud Build</a>.</li>
<li class=""><strong><code>--instances=1</code></strong> Initial always-on instance count. The <a href="#scaling-a-worker-pool-1" class="">scaling workflow</a> adjusts this based on queue depth.</li>
<li class=""><strong><code>GCP_PROJECT_ID</code></strong>, <strong><code>GCP_REGION</code></strong>, <strong><code>WORKER_POOL_NAME</code></strong> Used by the scaling workflow to call the Cloud Run API.</li>
</ul></div></div></div><hr><p><strong>Build logs</strong></p><p>During deployment, <code>gcloud</code> streams Cloud Build output to your terminal. You can also view logs in the <a href="https://console.cloud.google.com/cloud-build/builds" target="_blank" rel="noopener noreferrer" class="">Cloud Build console</a> or with:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud builds list </span><span class="token parameter variable" style="color:#f8f8f2">--limit</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">5</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">us-central1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud builds log </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">BUILD_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">us-central1</span><br></span></code></pre></div></div><p><strong>Service URL (service mode only)</strong></p><p>On successful deployment, <code>gcloud</code> prints the service URL:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Service URL: https://my-app-XXXXXXXXXX.us-central1.run.app</span><br></span></code></pre></div></div><p>Retrieve it later with:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud run services describe my-app </span><span class="token parameter variable" style="color:#f8f8f2">--region</span><span class="token plain"> us-central1 </span><span class="token parameter variable" style="color:#f8f8f2">--format</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;value(status.url)&#x27;</span><br></span></code></pre></div></div><p><strong>Application logs</strong></p><p>For a <strong>service</strong>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud logging </span><span class="token builtin class-name" style="color:#e6db74">read</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#a6e22e">&#x27;resource.type=cloud_run_revision AND resource.labels.service_name=my-app&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--limit</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">100</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">--format</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;text&#x27;</span><br></span></code></pre></div></div><p>For a <strong>worker pool</strong>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud logging </span><span class="token builtin class-name" style="color:#e6db74">read</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#a6e22e">&#x27;resource.type=cloud_run_worker_pool AND resource.labels.worker_pool_name=my-app&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--limit</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">100</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">--format</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&#x27;text&#x27;</span><br></span></code></pre></div></div><p>Or view logs in the <a href="https://console.cloud.google.com/run" target="_blank" rel="noopener noreferrer" class="">Cloud Run console</a> under the <strong>Logs</strong> tab.</p><p><strong>Test the deployment (service mode only)</strong></p><p>Start a DBOS workflow:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-X</span><span class="token plain"> GET https://my-app-XXXXXXXXXX.us-central1.run.app/workflow/1</span><br></span></code></pre></div></div><p>This runs the three-step <code>ExampleWorkflow</code> with task ID <code>1</code>. Each step takes 5 seconds. Poll progress with:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#f8f8f2">-X</span><span class="token plain"> GET https://my-app-XXXXXXXXXX.us-central1.run.app/last_step/1</span><br></span></code></pre></div></div><p>Returns <code>1</code>, <code>2</code>, or <code>3</code> depending on how many steps have completed.</p></div></div></details>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="scaling-a-worker-pool">Scaling a Worker Pool<a href="#scaling-a-worker-pool" class="hash-link" aria-label="Direct link to Scaling a Worker Pool" title="Direct link to Scaling a Worker Pool" translate="no">​</a></h2>
<p>Worker pools don&#x27;t auto-scale, but you can build an <strong>external scaler</strong> inside the pool using a DBOS <a class="" href="/golang/tutorials/workflow-tutorial#scheduled-workflows">scheduled workflow</a>. DBOS guarantees only one instance runs a scheduled function at a time—even across a multi-instance pool—preventing a thundering herd of conflicting resize requests.</p>
<p>The complete implementation is in the <a href="https://github.com/dbos-inc/dbos-demo-apps/tree/main/golang/cloudrun" target="_blank" rel="noopener noreferrer" class="">cloud-run demo app</a>.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>IAM permissions</div><div class="admonitionContent_BuS1"><p>The worker pool&#x27;s service account needs permission to manage Cloud Run resources and to act as itself when creating new revisions.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>IAM commands</strong></summary><div><div class="collapsibleContent_i85q"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic"># Grant Cloud Run admin role</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud projects add-iam-policy-binding </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--member</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;serviceAccount:run-identity@[YOUR_PROJECT_ID].iam.gserviceaccount.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--role</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;roles/run.admin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># Grant actAs permission on the service account itself</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcloud iam service-accounts add-iam-policy-binding </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  run-identity@</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">YOUR_PROJECT_ID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">.iam.gserviceaccount.com </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--member</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;serviceAccount:run-identity@[YOUR_PROJECT_ID].iam.gserviceaccount.com&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter variable" style="color:#f8f8f2">--role</span><span class="token operator" style="color:#66d9ef">=</span><span class="token string" style="color:#a6e22e">&quot;roles/iam.serviceAccountUser&quot;</span><br></span></code></pre></div></div></div></div></details></div></div>
<p>The scheduled workflow periodically checks the queue depth and resizes the pool to match by calling the <a href="https://cloud.google.com/run/docs/reference/rest/v2/projects.locations.workerPools" target="_blank" rel="noopener noreferrer" class="">Cloud Run Admin API</a>. It authenticates with a short-lived access token from the <a href="https://cloud.google.com/compute/docs/metadata/overview" target="_blank" rel="noopener noreferrer" class="">GCE metadata server</a>, reads the current instance count with a <code>GET</code>, and updates it with a <code>PATCH</code>.</p>
<p>Here&#x27;s an example in Go (the same approach works in any DBOS-supported language):</p>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary><strong>Scaling workflow snippet</strong></summary><div><div class="collapsibleContent_i85q"><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_OeMC">main.go</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">func</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ScalingWorkflow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">DBOSContext</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> scheduledTime time</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Time</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// 1. Read queue length by listing all enqueued/pending workflows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    workflows</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">ListWorkflows</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">WithQueuesOnly</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">WithQueueName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">taskQueue</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Errorf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;failed to list workflows: %w&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    qlen </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">len</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">workflows</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// 2. Get current instance count from the Cloud Run Admin API</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    currentInstances</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RunAsStep</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">int</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">getWorkerPoolInstances</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Errorf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;failed to get current instances: %w&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// 3. Compute desired instances: ceil(queue_depth / worker_concurrency)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    desiredInstances </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">int</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">math</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Ceil</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">float64</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">qlen</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">/</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">float64</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">WORKER_CONCURRENCY</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> desiredInstances </span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        desiredInstances </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#8292a2;font-style:italic">// 4. Resize the pool if needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> desiredInstances </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> currentInstances </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token boolean" style="color:#ae81ff">_</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">:=</span><span class="token plain"> dbos</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">RunAsStep</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">func</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx context</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token builtin" style="color:#e6db74">string</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token builtin" style="color:#e6db74">error</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">setWorkerPoolInstances</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">stepCtx</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> desiredInstances</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> err </span><span class="token operator" style="color:#66d9ef">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&quot;&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Errorf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;failed to set instances: %w&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Sprintf</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">&quot;qlen=%d, instances=%d&quot;</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> qlen</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> desiredInstances</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre></div></div></div></div></details>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="upgrading-workflow-code">Upgrading Workflow Code<a href="#upgrading-workflow-code" class="hash-link" aria-label="Direct link to Upgrading Workflow Code" title="Direct link to Upgrading Workflow Code" translate="no">​</a></h2>
<p>Deploying new code to Cloud Run creates a new <strong>revision</strong>. By default, Cloud Run routes all traffic to the latest revision immediately. Understanding how revisions interact with <a class="" href="/golang/tutorials/upgrading-workflows">upgrading DBOS code</a> is key to safely deploying changes without disrupting in-progress workflows.</p>
<p>DBOS supports two strategies for deploying breaking changes: <strong>versioning</strong> and <strong>patching</strong>. Each maps differently to Cloud Run&#x27;s revision model depending on whether you run a Service or a Worker Pool.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cloud-run-revisions">Cloud Run revisions<a href="#cloud-run-revisions" class="hash-link" aria-label="Direct link to Cloud Run revisions" title="Direct link to Cloud Run revisions" translate="no">​</a></h3>
<p>Every <code>gcloud run deploy</code> or <code>gcloud beta run worker-pools deploy</code> creates a new revision (e.g., <code>my-app-00001-abc</code>). Cloud Run injects the revision name into every container as the <code>K_REVISION</code> environment variable.</p>
<p>For <strong>services</strong>, you can <a href="https://cloud.google.com/run/docs/rollouts-rollbacks-traffic-migration" target="_blank" rel="noopener noreferrer" class="">split traffic</a> between revisions, enabling blue-green or canary deployments. By default, 100% of traffic goes to the latest revision.</p>
<p>For <strong>worker pools</strong>, a new deployment replaces all running instances. Old instances are shut down regardless of what they were processing.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="service-mode">Service mode<a href="#service-mode" class="hash-link" aria-label="Direct link to Service mode" title="Direct link to Service mode" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="versioning">Versioning<a href="#versioning" class="hash-link" aria-label="Direct link to Versioning" title="Direct link to Versioning" translate="no">​</a></h4>
<p>Set <a class="" href="/golang/reference/dbos-context#initialization"><code>ApplicationVersion</code></a> to <code>K_REVISION</code> so each Cloud Run revision gets a distinct DBOS version. Workflows started on a revision are tagged with that revision&#x27;s version. A DBOS process only recovers workflows matching its own version, so old workflows won&#x27;t be replayed with new code. To drain old workflows, keep the previous revision active (with a share of traffic or <code>--min-instances=1</code>) until all its workflows complete. You can check with <a class="" href="/golang/reference/methods#listworkflows"><code>ListWorkflows</code></a>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="patching">Patching<a href="#patching" class="hash-link" aria-label="Direct link to Patching" title="Direct link to Patching" translate="no">​</a></h4>
<p>With <a class="" href="/golang/tutorials/upgrading-workflows#patching">patching</a>, fix the application version to a constant and enable patching in the <a class="" href="/golang/reference/dbos-context#initialization">DBOS configuration</a>. Since all revisions share the same version, new containers automatically recover in-progress workflows from previous deployments. Cloud Run routes traffic to the latest revision by default, so new requests go to the new code while the patching logic in your workflow handles the transition for recovered workflows.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="worker-pool-mode">Worker pool mode<a href="#worker-pool-mode" class="hash-link" aria-label="Direct link to Worker pool mode" title="Direct link to Worker pool mode" translate="no">​</a></h3>
<p>When you deploy a new worker pool revision, Cloud Run replaces all running instances. Old instances shut down, and new instances start with the new code.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="versioning-1">Versioning<a href="#versioning-1" class="hash-link" aria-label="Direct link to Versioning" title="Direct link to Versioning" translate="no">​</a></h4>
<p>If <code>ApplicationVersion</code> is set to <code>K_REVISION</code>, the new instances have a different version than workflows started by the old instances. Those in-progress workflows won&#x27;t be automatically recovered because the version doesn&#x27;t match.</p>
<p>To migrate them, <a class="" href="/golang/tutorials/workflow-management#forking-workflows">fork</a> the old workflows to the new version using <a class="" href="/golang/reference/methods#forkworkflow"><code>ForkWorkflow</code></a> with the new <code>ApplicationVersion</code>. The new workers will then execute the forked workflows. You can automate this as part of a post-deployment step or a startup routine that lists old-version workflows and forks them.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="patching-1">Patching<a href="#patching-1" class="hash-link" aria-label="Direct link to Patching" title="Direct link to Patching" translate="no">​</a></h4>
<p>With a fixed application version and patching enabled, the new worker pool instances automatically recover workflows from the previous deployment. <a class="" href="/production/conductor">Conductor</a> detects that the old instances went down and that new instances with the same version are available, triggering recovery without any manual intervention.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="advanced-scenarios">Advanced scenarios<a href="#advanced-scenarios" class="hash-link" aria-label="Direct link to Advanced scenarios" title="Direct link to Advanced scenarios" translate="no">​</a></h3>
<p>More complex deployment strategies are possible. You can combine versioning and patching—for example, using versioning for major changes and patching for hotfixes within a version. In Service mode, you can use Cloud Run <a href="https://cloud.google.com/run/docs/rollouts-rollbacks-traffic-migration#tags" target="_blank" rel="noopener noreferrer" class="">revision tags</a> to route a subset of traffic to a tagged revision, letting you test new workflow code in production before shifting all traffic.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/production/hosting-with-kubernetes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deploying With Kubernetes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/production/retention"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Workflow Retention Policies</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#choosing-a-cloud-run-execution-mode" class="table-of-contents__link toc-highlight">Choosing a Cloud Run Execution Mode</a><ul><li><a href="#service" class="table-of-contents__link toc-highlight">Service</a></li><li><a href="#worker-pool" class="table-of-contents__link toc-highlight">Worker Pool</a></li><li><a href="#job" class="table-of-contents__link toc-highlight">Job</a></li></ul></li><li><a href="#deploying-to-cloud-run" class="table-of-contents__link toc-highlight">Deploying to Cloud Run</a></li><li><a href="#scaling-a-worker-pool" class="table-of-contents__link toc-highlight">Scaling a Worker Pool</a></li><li><a href="#upgrading-workflow-code" class="table-of-contents__link toc-highlight">Upgrading Workflow Code</a><ul><li><a href="#cloud-run-revisions" class="table-of-contents__link toc-highlight">Cloud Run revisions</a></li><li><a href="#service-mode" class="table-of-contents__link toc-highlight">Service mode</a><ul><li><a href="#versioning" class="table-of-contents__link toc-highlight">Versioning</a></li><li><a href="#patching" class="table-of-contents__link toc-highlight">Patching</a></li></ul></li><li><a href="#worker-pool-mode" class="table-of-contents__link toc-highlight">Worker pool mode</a><ul><li><a href="#versioning-1" class="table-of-contents__link toc-highlight">Versioning</a></li><li><a href="#patching-1" class="table-of-contents__link toc-highlight">Patching</a></li></ul></li><li><a href="#advanced-scenarios" class="table-of-contents__link toc-highlight">Advanced scenarios</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Follow Us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.linkedin.com/company/dbos-inc/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://bsky.app/profile/dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bluesky<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/DBOS_Inc" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter/X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Learn More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.dbos.dev/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.dbos.dev/about" target="_blank" rel="noopener noreferrer" class="footer__link-item">About<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Questions or Comments?</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/fMwQjeW5zg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Chat with us on Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="mailto:contact@dbos.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Write to us at contact@dbos.dev<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://dbos.dev" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/dbos-logo.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="100"><img src="/img/dbos-logo-dark.png" alt="DBOS Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="100"></a></div><div class="footer__copyright">Copyright © 2026 DBOS, Inc. | <a href="https://www.dbos.dev/privacy" target="_blank">Privacy Policy</a></div></div></div></footer></div>
</body>
</html>